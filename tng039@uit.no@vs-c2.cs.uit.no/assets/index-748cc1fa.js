(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))m(v);new MutationObserver(v=>{for(const b of v)if(b.type==="childList")for(const C of b.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&m(C)}).observe(document,{childList:!0,subtree:!0});function u(v){const b={};return v.integrity&&(b.integrity=v.integrity),v.referrerPolicy&&(b.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?b.credentials="include":v.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function m(v){if(v.ep)return;v.ep=!0;const b=u(v);fetch(v.href,b)}})();var sP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function KT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var YT={exports:{}},Qm={},JT={exports:{}},Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rp=Symbol.for("react.element"),aP=Symbol.for("react.portal"),lP=Symbol.for("react.fragment"),cP=Symbol.for("react.strict_mode"),uP=Symbol.for("react.profiler"),hP=Symbol.for("react.provider"),dP=Symbol.for("react.context"),pP=Symbol.for("react.forward_ref"),fP=Symbol.for("react.suspense"),mP=Symbol.for("react.memo"),gP=Symbol.for("react.lazy"),Bw=Symbol.iterator;function _P(t){return t===null||typeof t!="object"?null:(t=Bw&&t[Bw]||t["@@iterator"],typeof t=="function"?t:null)}var QT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},e2=Object.assign,t2={};function Iu(t,o,u){this.props=t,this.context=o,this.refs=t2,this.updater=u||QT}Iu.prototype.isReactComponent={};Iu.prototype.setState=function(t,o){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,o,"setState")};Iu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function n2(){}n2.prototype=Iu.prototype;function Z0(t,o,u){this.props=t,this.context=o,this.refs=t2,this.updater=u||QT}var q0=Z0.prototype=new n2;q0.constructor=Z0;e2(q0,Iu.prototype);q0.isPureReactComponent=!0;var Fw=Array.isArray,i2=Object.prototype.hasOwnProperty,W0={current:null},r2={key:!0,ref:!0,__self:!0,__source:!0};function o2(t,o,u){var m,v={},b=null,C=null;if(o!=null)for(m in o.ref!==void 0&&(C=o.ref),o.key!==void 0&&(b=""+o.key),o)i2.call(o,m)&&!r2.hasOwnProperty(m)&&(v[m]=o[m]);var a=arguments.length-2;if(a===1)v.children=u;else if(1<a){for(var I=Array(a),O=0;O<a;O++)I[O]=arguments[O+2];v.children=I}if(t&&t.defaultProps)for(m in a=t.defaultProps,a)v[m]===void 0&&(v[m]=a[m]);return{$$typeof:rp,type:t,key:b,ref:C,props:v,_owner:W0.current}}function yP(t,o){return{$$typeof:rp,type:t.type,key:o,ref:t.ref,props:t.props,_owner:t._owner}}function X0(t){return typeof t=="object"&&t!==null&&t.$$typeof===rp}function vP(t){var o={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(u){return o[u]})}var Ow=/\/+/g;function ty(t,o){return typeof t=="object"&&t!==null&&t.key!=null?vP(""+t.key):o.toString(36)}function sm(t,o,u,m,v){var b=typeof t;(b==="undefined"||b==="boolean")&&(t=null);var C=!1;if(t===null)C=!0;else switch(b){case"string":case"number":C=!0;break;case"object":switch(t.$$typeof){case rp:case aP:C=!0}}if(C)return C=t,v=v(C),t=m===""?"."+ty(C,0):m,Fw(v)?(u="",t!=null&&(u=t.replace(Ow,"$&/")+"/"),sm(v,o,u,"",function(O){return O})):v!=null&&(X0(v)&&(v=yP(v,u+(!v.key||C&&C.key===v.key?"":(""+v.key).replace(Ow,"$&/")+"/")+t)),o.push(v)),1;if(C=0,m=m===""?".":m+":",Fw(t))for(var a=0;a<t.length;a++){b=t[a];var I=m+ty(b,a);C+=sm(b,o,u,I,v)}else if(I=_P(t),typeof I=="function")for(t=I.call(t),a=0;!(b=t.next()).done;)b=b.value,I=m+ty(b,a++),C+=sm(b,o,u,I,v);else if(b==="object")throw o=String(t),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return C}function Vf(t,o,u){if(t==null)return t;var m=[],v=0;return sm(t,m,"","",function(b){return o.call(u,b,v++)}),m}function xP(t){if(t._status===-1){var o=t._result;o=o(),o.then(function(u){(t._status===0||t._status===-1)&&(t._status=1,t._result=u)},function(u){(t._status===0||t._status===-1)&&(t._status=2,t._result=u)}),t._status===-1&&(t._status=0,t._result=o)}if(t._status===1)return t._result.default;throw t._result}var Qi={current:null},am={transition:null},wP={ReactCurrentDispatcher:Qi,ReactCurrentBatchConfig:am,ReactCurrentOwner:W0};Yt.Children={map:Vf,forEach:function(t,o,u){Vf(t,function(){o.apply(this,arguments)},u)},count:function(t){var o=0;return Vf(t,function(){o++}),o},toArray:function(t){return Vf(t,function(o){return o})||[]},only:function(t){if(!X0(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Yt.Component=Iu;Yt.Fragment=lP;Yt.Profiler=uP;Yt.PureComponent=Z0;Yt.StrictMode=cP;Yt.Suspense=fP;Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wP;Yt.cloneElement=function(t,o,u){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var m=e2({},t.props),v=t.key,b=t.ref,C=t._owner;if(o!=null){if(o.ref!==void 0&&(b=o.ref,C=W0.current),o.key!==void 0&&(v=""+o.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(I in o)i2.call(o,I)&&!r2.hasOwnProperty(I)&&(m[I]=o[I]===void 0&&a!==void 0?a[I]:o[I])}var I=arguments.length-2;if(I===1)m.children=u;else if(1<I){a=Array(I);for(var O=0;O<I;O++)a[O]=arguments[O+2];m.children=a}return{$$typeof:rp,type:t.type,key:v,ref:b,props:m,_owner:C}};Yt.createContext=function(t){return t={$$typeof:dP,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:hP,_context:t},t.Consumer=t};Yt.createElement=o2;Yt.createFactory=function(t){var o=o2.bind(null,t);return o.type=t,o};Yt.createRef=function(){return{current:null}};Yt.forwardRef=function(t){return{$$typeof:pP,render:t}};Yt.isValidElement=X0;Yt.lazy=function(t){return{$$typeof:gP,_payload:{_status:-1,_result:t},_init:xP}};Yt.memo=function(t,o){return{$$typeof:mP,type:t,compare:o===void 0?null:o}};Yt.startTransition=function(t){var o=am.transition;am.transition={};try{t()}finally{am.transition=o}};Yt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Yt.useCallback=function(t,o){return Qi.current.useCallback(t,o)};Yt.useContext=function(t){return Qi.current.useContext(t)};Yt.useDebugValue=function(){};Yt.useDeferredValue=function(t){return Qi.current.useDeferredValue(t)};Yt.useEffect=function(t,o){return Qi.current.useEffect(t,o)};Yt.useId=function(){return Qi.current.useId()};Yt.useImperativeHandle=function(t,o,u){return Qi.current.useImperativeHandle(t,o,u)};Yt.useInsertionEffect=function(t,o){return Qi.current.useInsertionEffect(t,o)};Yt.useLayoutEffect=function(t,o){return Qi.current.useLayoutEffect(t,o)};Yt.useMemo=function(t,o){return Qi.current.useMemo(t,o)};Yt.useReducer=function(t,o,u){return Qi.current.useReducer(t,o,u)};Yt.useRef=function(t){return Qi.current.useRef(t)};Yt.useState=function(t){return Qi.current.useState(t)};Yt.useSyncExternalStore=function(t,o,u){return Qi.current.useSyncExternalStore(t,o,u)};Yt.useTransition=function(){return Qi.current.useTransition()};Yt.version="18.2.0";JT.exports=Yt;var Rt=JT.exports;const H0=KT(Rt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bP=Rt,TP=Symbol.for("react.element"),EP=Symbol.for("react.fragment"),SP=Object.prototype.hasOwnProperty,CP=bP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,MP={key:!0,ref:!0,__self:!0,__source:!0};function s2(t,o,u){var m,v={},b=null,C=null;u!==void 0&&(b=""+u),o.key!==void 0&&(b=""+o.key),o.ref!==void 0&&(C=o.ref);for(m in o)SP.call(o,m)&&!MP.hasOwnProperty(m)&&(v[m]=o[m]);if(t&&t.defaultProps)for(m in o=t.defaultProps,o)v[m]===void 0&&(v[m]=o[m]);return{$$typeof:TP,type:t,key:b,ref:C,props:v,_owner:CP.current}}Qm.Fragment=EP;Qm.jsx=s2;Qm.jsxs=s2;YT.exports=Qm;var ys=YT.exports,Vy={},a2={exports:{}},kr={},l2={exports:{}},c2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function o(We,Et){var vt=We.length;We.push(Et);e:for(;0<vt;){var gt=vt-1>>>1,Qt=We[gt];if(0<v(Qt,Et))We[gt]=Et,We[vt]=Qt,vt=gt;else break e}}function u(We){return We.length===0?null:We[0]}function m(We){if(We.length===0)return null;var Et=We[0],vt=We.pop();if(vt!==Et){We[0]=vt;e:for(var gt=0,Qt=We.length,hn=Qt>>>1;gt<hn;){var ti=2*(gt+1)-1,Zi=We[ti],Ln=ti+1,di=We[Ln];if(0>v(Zi,vt))Ln<Qt&&0>v(di,Zi)?(We[gt]=di,We[Ln]=vt,gt=Ln):(We[gt]=Zi,We[ti]=vt,gt=ti);else if(Ln<Qt&&0>v(di,vt))We[gt]=di,We[Ln]=vt,gt=Ln;else break e}}return Et}function v(We,Et){var vt=We.sortIndex-Et.sortIndex;return vt!==0?vt:We.id-Et.id}if(typeof performance=="object"&&typeof performance.now=="function"){var b=performance;t.unstable_now=function(){return b.now()}}else{var C=Date,a=C.now();t.unstable_now=function(){return C.now()-a}}var I=[],O=[],q=1,G=null,H=3,ue=!1,_e=!1,Ie=!1,at=typeof setTimeout=="function"?setTimeout:null,me=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(We){for(var Et=u(O);Et!==null;){if(Et.callback===null)m(O);else if(Et.startTime<=We)m(O),Et.sortIndex=Et.expirationTime,o(I,Et);else break;Et=u(O)}}function ke(We){if(Ie=!1,le(We),!_e)if(u(I)!==null)_e=!0,ii(je);else{var Et=u(O);Et!==null&&Mi(ke,Et.startTime-We)}}function je(We,Et){_e=!1,Ie&&(Ie=!1,me(Qe),Qe=-1),ue=!0;var vt=H;try{for(le(Et),G=u(I);G!==null&&(!(G.expirationTime>Et)||We&&!bn());){var gt=G.callback;if(typeof gt=="function"){G.callback=null,H=G.priorityLevel;var Qt=gt(G.expirationTime<=Et);Et=t.unstable_now(),typeof Qt=="function"?G.callback=Qt:G===u(I)&&m(I),le(Et)}else m(I);G=u(I)}if(G!==null)var hn=!0;else{var ti=u(O);ti!==null&&Mi(ke,ti.startTime-Et),hn=!1}return hn}finally{G=null,H=vt,ue=!1}}var ct=!1,it=null,Qe=-1,Be=5,St=-1;function bn(){return!(t.unstable_now()-St<Be)}function bt(){if(it!==null){var We=t.unstable_now();St=We;var Et=!0;try{Et=it(!0,We)}finally{Et?Jt():(ct=!1,it=null)}}else ct=!1}var Jt;if(typeof ne=="function")Jt=function(){ne(bt)};else if(typeof MessageChannel<"u"){var Tn=new MessageChannel,vn=Tn.port2;Tn.port1.onmessage=bt,Jt=function(){vn.postMessage(null)}}else Jt=function(){at(bt,0)};function ii(We){it=We,ct||(ct=!0,Jt())}function Mi(We,Et){Qe=at(function(){We(t.unstable_now())},Et)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(We){We.callback=null},t.unstable_continueExecution=function(){_e||ue||(_e=!0,ii(je))},t.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Be=0<We?Math.floor(1e3/We):5},t.unstable_getCurrentPriorityLevel=function(){return H},t.unstable_getFirstCallbackNode=function(){return u(I)},t.unstable_next=function(We){switch(H){case 1:case 2:case 3:var Et=3;break;default:Et=H}var vt=H;H=Et;try{return We()}finally{H=vt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(We,Et){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var vt=H;H=We;try{return Et()}finally{H=vt}},t.unstable_scheduleCallback=function(We,Et,vt){var gt=t.unstable_now();switch(typeof vt=="object"&&vt!==null?(vt=vt.delay,vt=typeof vt=="number"&&0<vt?gt+vt:gt):vt=gt,We){case 1:var Qt=-1;break;case 2:Qt=250;break;case 5:Qt=1073741823;break;case 4:Qt=1e4;break;default:Qt=5e3}return Qt=vt+Qt,We={id:q++,callback:Et,priorityLevel:We,startTime:vt,expirationTime:Qt,sortIndex:-1},vt>gt?(We.sortIndex=vt,o(O,We),u(I)===null&&We===u(O)&&(Ie?(me(Qe),Qe=-1):Ie=!0,Mi(ke,vt-gt))):(We.sortIndex=Qt,o(I,We),_e||ue||(_e=!0,ii(je))),We},t.unstable_shouldYield=bn,t.unstable_wrapCallback=function(We){var Et=H;return function(){var vt=H;H=Et;try{return We.apply(this,arguments)}finally{H=vt}}}})(c2);l2.exports=c2;var AP=l2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u2=Rt,Pr=AP;function tt(t){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+t,u=1;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+t+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h2=new Set,Od={};function Wl(t,o){wu(t,o),wu(t+"Capture",o)}function wu(t,o){for(Od[t]=o,t=0;t<o.length;t++)h2.add(o[t])}var Ss=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Uy=Object.prototype.hasOwnProperty,PP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Vw={},Uw={};function IP(t){return Uy.call(Uw,t)?!0:Uy.call(Vw,t)?!1:PP.test(t)?Uw[t]=!0:(Vw[t]=!0,!1)}function kP(t,o,u,m){if(u!==null&&u.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return m?!1:u!==null?!u.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function zP(t,o,u,m){if(o===null||typeof o>"u"||kP(t,o,u,m))return!0;if(m)return!1;if(u!==null)switch(u.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function er(t,o,u,m,v,b,C){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=m,this.attributeNamespace=v,this.mustUseProperty=u,this.propertyName=t,this.type=o,this.sanitizeURL=b,this.removeEmptyString=C}var zi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){zi[t]=new er(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var o=t[0];zi[o]=new er(o,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){zi[t]=new er(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){zi[t]=new er(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){zi[t]=new er(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){zi[t]=new er(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){zi[t]=new er(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){zi[t]=new er(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){zi[t]=new er(t,5,!1,t.toLowerCase(),null,!1,!1)});var K0=/[\-:]([a-z])/g;function Y0(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var o=t.replace(K0,Y0);zi[o]=new er(o,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var o=t.replace(K0,Y0);zi[o]=new er(o,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var o=t.replace(K0,Y0);zi[o]=new er(o,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){zi[t]=new er(t,1,!1,t.toLowerCase(),null,!1,!1)});zi.xlinkHref=new er("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){zi[t]=new er(t,1,!1,t.toLowerCase(),null,!0,!0)});function J0(t,o,u,m){var v=zi.hasOwnProperty(o)?zi[o]:null;(v!==null?v.type!==0:m||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(zP(o,u,v,m)&&(u=null),m||v===null?IP(o)&&(u===null?t.removeAttribute(o):t.setAttribute(o,""+u)):v.mustUseProperty?t[v.propertyName]=u===null?v.type===3?!1:"":u:(o=v.attributeName,m=v.attributeNamespace,u===null?t.removeAttribute(o):(v=v.type,u=v===3||v===4&&u===!0?"":""+u,m?t.setAttributeNS(m,o,u):t.setAttribute(o,u))))}var Is=u2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Uf=Symbol.for("react.element"),Qc=Symbol.for("react.portal"),eu=Symbol.for("react.fragment"),Q0=Symbol.for("react.strict_mode"),Ny=Symbol.for("react.profiler"),d2=Symbol.for("react.provider"),p2=Symbol.for("react.context"),ev=Symbol.for("react.forward_ref"),jy=Symbol.for("react.suspense"),Gy=Symbol.for("react.suspense_list"),tv=Symbol.for("react.memo"),fa=Symbol.for("react.lazy"),f2=Symbol.for("react.offscreen"),Nw=Symbol.iterator;function ud(t){return t===null||typeof t!="object"?null:(t=Nw&&t[Nw]||t["@@iterator"],typeof t=="function"?t:null)}var Kn=Object.assign,ny;function xd(t){if(ny===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);ny=o&&o[1]||""}return`
`+ny+t}var iy=!1;function ry(t,o){if(!t||iy)return"";iy=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(O){var m=O}Reflect.construct(t,[],o)}else{try{o.call()}catch(O){m=O}t.call(o.prototype)}else{try{throw Error()}catch(O){m=O}t()}}catch(O){if(O&&m&&typeof O.stack=="string"){for(var v=O.stack.split(`
`),b=m.stack.split(`
`),C=v.length-1,a=b.length-1;1<=C&&0<=a&&v[C]!==b[a];)a--;for(;1<=C&&0<=a;C--,a--)if(v[C]!==b[a]){if(C!==1||a!==1)do if(C--,a--,0>a||v[C]!==b[a]){var I=`
`+v[C].replace(" at new "," at ");return t.displayName&&I.includes("<anonymous>")&&(I=I.replace("<anonymous>",t.displayName)),I}while(1<=C&&0<=a);break}}}finally{iy=!1,Error.prepareStackTrace=u}return(t=t?t.displayName||t.name:"")?xd(t):""}function DP(t){switch(t.tag){case 5:return xd(t.type);case 16:return xd("Lazy");case 13:return xd("Suspense");case 19:return xd("SuspenseList");case 0:case 2:case 15:return t=ry(t.type,!1),t;case 11:return t=ry(t.type.render,!1),t;case 1:return t=ry(t.type,!0),t;default:return""}}function $y(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case eu:return"Fragment";case Qc:return"Portal";case Ny:return"Profiler";case Q0:return"StrictMode";case jy:return"Suspense";case Gy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case p2:return(t.displayName||"Context")+".Consumer";case d2:return(t._context.displayName||"Context")+".Provider";case ev:var o=t.render;return t=t.displayName,t||(t=o.displayName||o.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case tv:return o=t.displayName||null,o!==null?o:$y(t.type)||"Memo";case fa:o=t._payload,t=t._init;try{return $y(t(o))}catch{}}return null}function LP(t){var o=t.type;switch(t.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=o.render,t=t.displayName||t.name||"",o.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $y(o);case 8:return o===Q0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function ka(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function m2(t){var o=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function RP(t){var o=m2(t)?"checked":"value",u=Object.getOwnPropertyDescriptor(t.constructor.prototype,o),m=""+t[o];if(!t.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var v=u.get,b=u.set;return Object.defineProperty(t,o,{configurable:!0,get:function(){return v.call(this)},set:function(C){m=""+C,b.call(this,C)}}),Object.defineProperty(t,o,{enumerable:u.enumerable}),{getValue:function(){return m},setValue:function(C){m=""+C},stopTracking:function(){t._valueTracker=null,delete t[o]}}}}function Nf(t){t._valueTracker||(t._valueTracker=RP(t))}function g2(t){if(!t)return!1;var o=t._valueTracker;if(!o)return!0;var u=o.getValue(),m="";return t&&(m=m2(t)?t.checked?"true":"false":t.value),t=m,t!==u?(o.setValue(t),!0):!1}function xm(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Zy(t,o){var u=o.checked;return Kn({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??t._wrapperState.initialChecked})}function jw(t,o){var u=o.defaultValue==null?"":o.defaultValue,m=o.checked!=null?o.checked:o.defaultChecked;u=ka(o.value!=null?o.value:u),t._wrapperState={initialChecked:m,initialValue:u,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function _2(t,o){o=o.checked,o!=null&&J0(t,"checked",o,!1)}function qy(t,o){_2(t,o);var u=ka(o.value),m=o.type;if(u!=null)m==="number"?(u===0&&t.value===""||t.value!=u)&&(t.value=""+u):t.value!==""+u&&(t.value=""+u);else if(m==="submit"||m==="reset"){t.removeAttribute("value");return}o.hasOwnProperty("value")?Wy(t,o.type,u):o.hasOwnProperty("defaultValue")&&Wy(t,o.type,ka(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(t.defaultChecked=!!o.defaultChecked)}function Gw(t,o,u){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var m=o.type;if(!(m!=="submit"&&m!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+t._wrapperState.initialValue,u||o===t.value||(t.value=o),t.defaultValue=o}u=t.name,u!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,u!==""&&(t.name=u)}function Wy(t,o,u){(o!=="number"||xm(t.ownerDocument)!==t)&&(u==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+u&&(t.defaultValue=""+u))}var wd=Array.isArray;function mu(t,o,u,m){if(t=t.options,o){o={};for(var v=0;v<u.length;v++)o["$"+u[v]]=!0;for(u=0;u<t.length;u++)v=o.hasOwnProperty("$"+t[u].value),t[u].selected!==v&&(t[u].selected=v),v&&m&&(t[u].defaultSelected=!0)}else{for(u=""+ka(u),o=null,v=0;v<t.length;v++){if(t[v].value===u){t[v].selected=!0,m&&(t[v].defaultSelected=!0);return}o!==null||t[v].disabled||(o=t[v])}o!==null&&(o.selected=!0)}}function Xy(t,o){if(o.dangerouslySetInnerHTML!=null)throw Error(tt(91));return Kn({},o,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function $w(t,o){var u=o.value;if(u==null){if(u=o.children,o=o.defaultValue,u!=null){if(o!=null)throw Error(tt(92));if(wd(u)){if(1<u.length)throw Error(tt(93));u=u[0]}o=u}o==null&&(o=""),u=o}t._wrapperState={initialValue:ka(u)}}function y2(t,o){var u=ka(o.value),m=ka(o.defaultValue);u!=null&&(u=""+u,u!==t.value&&(t.value=u),o.defaultValue==null&&t.defaultValue!==u&&(t.defaultValue=u)),m!=null&&(t.defaultValue=""+m)}function Zw(t){var o=t.textContent;o===t._wrapperState.initialValue&&o!==""&&o!==null&&(t.value=o)}function v2(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hy(t,o){return t==null||t==="http://www.w3.org/1999/xhtml"?v2(o):t==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var jf,x2=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,u,m,v){MSApp.execUnsafeLocalFunction(function(){return t(o,u,m,v)})}:t}(function(t,o){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=o;else{for(jf=jf||document.createElement("div"),jf.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=jf.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;o.firstChild;)t.appendChild(o.firstChild)}});function Vd(t,o){if(o){var u=t.firstChild;if(u&&u===t.lastChild&&u.nodeType===3){u.nodeValue=o;return}}t.textContent=o}var Sd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BP=["Webkit","ms","Moz","O"];Object.keys(Sd).forEach(function(t){BP.forEach(function(o){o=o+t.charAt(0).toUpperCase()+t.substring(1),Sd[o]=Sd[t]})});function w2(t,o,u){return o==null||typeof o=="boolean"||o===""?"":u||typeof o!="number"||o===0||Sd.hasOwnProperty(t)&&Sd[t]?(""+o).trim():o+"px"}function b2(t,o){t=t.style;for(var u in o)if(o.hasOwnProperty(u)){var m=u.indexOf("--")===0,v=w2(u,o[u],m);u==="float"&&(u="cssFloat"),m?t.setProperty(u,v):t[u]=v}}var FP=Kn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ky(t,o){if(o){if(FP[t]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(tt(137,t));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(tt(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(tt(61))}if(o.style!=null&&typeof o.style!="object")throw Error(tt(62))}}function Yy(t,o){if(t.indexOf("-")===-1)return typeof o.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Jy=null;function nv(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Qy=null,gu=null,_u=null;function qw(t){if(t=ap(t)){if(typeof Qy!="function")throw Error(tt(280));var o=t.stateNode;o&&(o=rg(o),Qy(t.stateNode,t.type,o))}}function T2(t){gu?_u?_u.push(t):_u=[t]:gu=t}function E2(){if(gu){var t=gu,o=_u;if(_u=gu=null,qw(t),o)for(t=0;t<o.length;t++)qw(o[t])}}function S2(t,o){return t(o)}function C2(){}var oy=!1;function M2(t,o,u){if(oy)return t(o,u);oy=!0;try{return S2(t,o,u)}finally{oy=!1,(gu!==null||_u!==null)&&(C2(),E2())}}function Ud(t,o){var u=t.stateNode;if(u===null)return null;var m=rg(u);if(m===null)return null;u=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(t=t.type,m=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!m;break e;default:t=!1}if(t)return null;if(u&&typeof u!="function")throw Error(tt(231,o,typeof u));return u}var e0=!1;if(Ss)try{var hd={};Object.defineProperty(hd,"passive",{get:function(){e0=!0}}),window.addEventListener("test",hd,hd),window.removeEventListener("test",hd,hd)}catch{e0=!1}function OP(t,o,u,m,v,b,C,a,I){var O=Array.prototype.slice.call(arguments,3);try{o.apply(u,O)}catch(q){this.onError(q)}}var Cd=!1,wm=null,bm=!1,t0=null,VP={onError:function(t){Cd=!0,wm=t}};function UP(t,o,u,m,v,b,C,a,I){Cd=!1,wm=null,OP.apply(VP,arguments)}function NP(t,o,u,m,v,b,C,a,I){if(UP.apply(this,arguments),Cd){if(Cd){var O=wm;Cd=!1,wm=null}else throw Error(tt(198));bm||(bm=!0,t0=O)}}function Xl(t){var o=t,u=t;if(t.alternate)for(;o.return;)o=o.return;else{t=o;do o=t,o.flags&4098&&(u=o.return),t=o.return;while(t)}return o.tag===3?u:null}function A2(t){if(t.tag===13){var o=t.memoizedState;if(o===null&&(t=t.alternate,t!==null&&(o=t.memoizedState)),o!==null)return o.dehydrated}return null}function Ww(t){if(Xl(t)!==t)throw Error(tt(188))}function jP(t){var o=t.alternate;if(!o){if(o=Xl(t),o===null)throw Error(tt(188));return o!==t?null:t}for(var u=t,m=o;;){var v=u.return;if(v===null)break;var b=v.alternate;if(b===null){if(m=v.return,m!==null){u=m;continue}break}if(v.child===b.child){for(b=v.child;b;){if(b===u)return Ww(v),t;if(b===m)return Ww(v),o;b=b.sibling}throw Error(tt(188))}if(u.return!==m.return)u=v,m=b;else{for(var C=!1,a=v.child;a;){if(a===u){C=!0,u=v,m=b;break}if(a===m){C=!0,m=v,u=b;break}a=a.sibling}if(!C){for(a=b.child;a;){if(a===u){C=!0,u=b,m=v;break}if(a===m){C=!0,m=b,u=v;break}a=a.sibling}if(!C)throw Error(tt(189))}}if(u.alternate!==m)throw Error(tt(190))}if(u.tag!==3)throw Error(tt(188));return u.stateNode.current===u?t:o}function P2(t){return t=jP(t),t!==null?I2(t):null}function I2(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var o=I2(t);if(o!==null)return o;t=t.sibling}return null}var k2=Pr.unstable_scheduleCallback,Xw=Pr.unstable_cancelCallback,GP=Pr.unstable_shouldYield,$P=Pr.unstable_requestPaint,ni=Pr.unstable_now,ZP=Pr.unstable_getCurrentPriorityLevel,iv=Pr.unstable_ImmediatePriority,z2=Pr.unstable_UserBlockingPriority,Tm=Pr.unstable_NormalPriority,qP=Pr.unstable_LowPriority,D2=Pr.unstable_IdlePriority,eg=null,Zo=null;function WP(t){if(Zo&&typeof Zo.onCommitFiberRoot=="function")try{Zo.onCommitFiberRoot(eg,t,void 0,(t.current.flags&128)===128)}catch{}}var Eo=Math.clz32?Math.clz32:KP,XP=Math.log,HP=Math.LN2;function KP(t){return t>>>=0,t===0?32:31-(XP(t)/HP|0)|0}var Gf=64,$f=4194304;function bd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Em(t,o){var u=t.pendingLanes;if(u===0)return 0;var m=0,v=t.suspendedLanes,b=t.pingedLanes,C=u&268435455;if(C!==0){var a=C&~v;a!==0?m=bd(a):(b&=C,b!==0&&(m=bd(b)))}else C=u&~v,C!==0?m=bd(C):b!==0&&(m=bd(b));if(m===0)return 0;if(o!==0&&o!==m&&!(o&v)&&(v=m&-m,b=o&-o,v>=b||v===16&&(b&4194240)!==0))return o;if(m&4&&(m|=u&16),o=t.entangledLanes,o!==0)for(t=t.entanglements,o&=m;0<o;)u=31-Eo(o),v=1<<u,m|=t[u],o&=~v;return m}function YP(t,o){switch(t){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JP(t,o){for(var u=t.suspendedLanes,m=t.pingedLanes,v=t.expirationTimes,b=t.pendingLanes;0<b;){var C=31-Eo(b),a=1<<C,I=v[C];I===-1?(!(a&u)||a&m)&&(v[C]=YP(a,o)):I<=o&&(t.expiredLanes|=a),b&=~a}}function n0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function L2(){var t=Gf;return Gf<<=1,!(Gf&4194240)&&(Gf=64),t}function sy(t){for(var o=[],u=0;31>u;u++)o.push(t);return o}function op(t,o,u){t.pendingLanes|=o,o!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,o=31-Eo(o),t[o]=u}function QP(t,o){var u=t.pendingLanes&~o;t.pendingLanes=o,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=o,t.mutableReadLanes&=o,t.entangledLanes&=o,o=t.entanglements;var m=t.eventTimes;for(t=t.expirationTimes;0<u;){var v=31-Eo(u),b=1<<v;o[v]=0,m[v]=-1,t[v]=-1,u&=~b}}function rv(t,o){var u=t.entangledLanes|=o;for(t=t.entanglements;u;){var m=31-Eo(u),v=1<<m;v&o|t[m]&o&&(t[m]|=o),u&=~v}}var yn=0;function R2(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var B2,ov,F2,O2,V2,i0=!1,Zf=[],wa=null,ba=null,Ta=null,Nd=new Map,jd=new Map,_a=[],eI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Hw(t,o){switch(t){case"focusin":case"focusout":wa=null;break;case"dragenter":case"dragleave":ba=null;break;case"mouseover":case"mouseout":Ta=null;break;case"pointerover":case"pointerout":Nd.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":jd.delete(o.pointerId)}}function dd(t,o,u,m,v,b){return t===null||t.nativeEvent!==b?(t={blockedOn:o,domEventName:u,eventSystemFlags:m,nativeEvent:b,targetContainers:[v]},o!==null&&(o=ap(o),o!==null&&ov(o)),t):(t.eventSystemFlags|=m,o=t.targetContainers,v!==null&&o.indexOf(v)===-1&&o.push(v),t)}function tI(t,o,u,m,v){switch(o){case"focusin":return wa=dd(wa,t,o,u,m,v),!0;case"dragenter":return ba=dd(ba,t,o,u,m,v),!0;case"mouseover":return Ta=dd(Ta,t,o,u,m,v),!0;case"pointerover":var b=v.pointerId;return Nd.set(b,dd(Nd.get(b)||null,t,o,u,m,v)),!0;case"gotpointercapture":return b=v.pointerId,jd.set(b,dd(jd.get(b)||null,t,o,u,m,v)),!0}return!1}function U2(t){var o=Bl(t.target);if(o!==null){var u=Xl(o);if(u!==null){if(o=u.tag,o===13){if(o=A2(u),o!==null){t.blockedOn=o,V2(t.priority,function(){F2(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){t.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}t.blockedOn=null}function lm(t){if(t.blockedOn!==null)return!1;for(var o=t.targetContainers;0<o.length;){var u=r0(t.domEventName,t.eventSystemFlags,o[0],t.nativeEvent);if(u===null){u=t.nativeEvent;var m=new u.constructor(u.type,u);Jy=m,u.target.dispatchEvent(m),Jy=null}else return o=ap(u),o!==null&&ov(o),t.blockedOn=u,!1;o.shift()}return!0}function Kw(t,o,u){lm(t)&&u.delete(o)}function nI(){i0=!1,wa!==null&&lm(wa)&&(wa=null),ba!==null&&lm(ba)&&(ba=null),Ta!==null&&lm(Ta)&&(Ta=null),Nd.forEach(Kw),jd.forEach(Kw)}function pd(t,o){t.blockedOn===o&&(t.blockedOn=null,i0||(i0=!0,Pr.unstable_scheduleCallback(Pr.unstable_NormalPriority,nI)))}function Gd(t){function o(v){return pd(v,t)}if(0<Zf.length){pd(Zf[0],t);for(var u=1;u<Zf.length;u++){var m=Zf[u];m.blockedOn===t&&(m.blockedOn=null)}}for(wa!==null&&pd(wa,t),ba!==null&&pd(ba,t),Ta!==null&&pd(Ta,t),Nd.forEach(o),jd.forEach(o),u=0;u<_a.length;u++)m=_a[u],m.blockedOn===t&&(m.blockedOn=null);for(;0<_a.length&&(u=_a[0],u.blockedOn===null);)U2(u),u.blockedOn===null&&_a.shift()}var yu=Is.ReactCurrentBatchConfig,Sm=!0;function iI(t,o,u,m){var v=yn,b=yu.transition;yu.transition=null;try{yn=1,sv(t,o,u,m)}finally{yn=v,yu.transition=b}}function rI(t,o,u,m){var v=yn,b=yu.transition;yu.transition=null;try{yn=4,sv(t,o,u,m)}finally{yn=v,yu.transition=b}}function sv(t,o,u,m){if(Sm){var v=r0(t,o,u,m);if(v===null)gy(t,o,m,Cm,u),Hw(t,m);else if(tI(v,t,o,u,m))m.stopPropagation();else if(Hw(t,m),o&4&&-1<eI.indexOf(t)){for(;v!==null;){var b=ap(v);if(b!==null&&B2(b),b=r0(t,o,u,m),b===null&&gy(t,o,m,Cm,u),b===v)break;v=b}v!==null&&m.stopPropagation()}else gy(t,o,m,null,u)}}var Cm=null;function r0(t,o,u,m){if(Cm=null,t=nv(m),t=Bl(t),t!==null)if(o=Xl(t),o===null)t=null;else if(u=o.tag,u===13){if(t=A2(o),t!==null)return t;t=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;t=null}else o!==t&&(t=null);return Cm=t,null}function N2(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ZP()){case iv:return 1;case z2:return 4;case Tm:case qP:return 16;case D2:return 536870912;default:return 16}default:return 16}}var va=null,av=null,cm=null;function j2(){if(cm)return cm;var t,o=av,u=o.length,m,v="value"in va?va.value:va.textContent,b=v.length;for(t=0;t<u&&o[t]===v[t];t++);var C=u-t;for(m=1;m<=C&&o[u-m]===v[b-m];m++);return cm=v.slice(t,1<m?1-m:void 0)}function um(t){var o=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&o===13&&(t=13)):t=o,t===10&&(t=13),32<=t||t===13?t:0}function qf(){return!0}function Yw(){return!1}function zr(t){function o(u,m,v,b,C){this._reactName=u,this._targetInst=v,this.type=m,this.nativeEvent=b,this.target=C,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(u=t[a],this[a]=u?u(b):b[a]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?qf:Yw,this.isPropagationStopped=Yw,this}return Kn(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=qf)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=qf)},persist:function(){},isPersistent:qf}),o}var ku={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lv=zr(ku),sp=Kn({},ku,{view:0,detail:0}),oI=zr(sp),ay,ly,fd,tg=Kn({},sp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cv,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==fd&&(fd&&t.type==="mousemove"?(ay=t.screenX-fd.screenX,ly=t.screenY-fd.screenY):ly=ay=0,fd=t),ay)},movementY:function(t){return"movementY"in t?t.movementY:ly}}),Jw=zr(tg),sI=Kn({},tg,{dataTransfer:0}),aI=zr(sI),lI=Kn({},sp,{relatedTarget:0}),cy=zr(lI),cI=Kn({},ku,{animationName:0,elapsedTime:0,pseudoElement:0}),uI=zr(cI),hI=Kn({},ku,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),dI=zr(hI),pI=Kn({},ku,{data:0}),Qw=zr(pI),fI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _I(t){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(t):(t=gI[t])?!!o[t]:!1}function cv(){return _I}var yI=Kn({},sp,{key:function(t){if(t.key){var o=fI[t.key]||t.key;if(o!=="Unidentified")return o}return t.type==="keypress"?(t=um(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?mI[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cv,charCode:function(t){return t.type==="keypress"?um(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?um(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),vI=zr(yI),xI=Kn({},tg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),eb=zr(xI),wI=Kn({},sp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cv}),bI=zr(wI),TI=Kn({},ku,{propertyName:0,elapsedTime:0,pseudoElement:0}),EI=zr(TI),SI=Kn({},tg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),CI=zr(SI),MI=[9,13,27,32],uv=Ss&&"CompositionEvent"in window,Md=null;Ss&&"documentMode"in document&&(Md=document.documentMode);var AI=Ss&&"TextEvent"in window&&!Md,G2=Ss&&(!uv||Md&&8<Md&&11>=Md),tb=String.fromCharCode(32),nb=!1;function $2(t,o){switch(t){case"keyup":return MI.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Z2(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var tu=!1;function PI(t,o){switch(t){case"compositionend":return Z2(o);case"keypress":return o.which!==32?null:(nb=!0,tb);case"textInput":return t=o.data,t===tb&&nb?null:t;default:return null}}function II(t,o){if(tu)return t==="compositionend"||!uv&&$2(t,o)?(t=j2(),cm=av=va=null,tu=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return G2&&o.locale!=="ko"?null:o.data;default:return null}}var kI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ib(t){var o=t&&t.nodeName&&t.nodeName.toLowerCase();return o==="input"?!!kI[t.type]:o==="textarea"}function q2(t,o,u,m){T2(m),o=Mm(o,"onChange"),0<o.length&&(u=new lv("onChange","change",null,u,m),t.push({event:u,listeners:o}))}var Ad=null,$d=null;function zI(t){iE(t,0)}function ng(t){var o=ru(t);if(g2(o))return t}function DI(t,o){if(t==="change")return o}var W2=!1;if(Ss){var uy;if(Ss){var hy="oninput"in document;if(!hy){var rb=document.createElement("div");rb.setAttribute("oninput","return;"),hy=typeof rb.oninput=="function"}uy=hy}else uy=!1;W2=uy&&(!document.documentMode||9<document.documentMode)}function ob(){Ad&&(Ad.detachEvent("onpropertychange",X2),$d=Ad=null)}function X2(t){if(t.propertyName==="value"&&ng($d)){var o=[];q2(o,$d,t,nv(t)),M2(zI,o)}}function LI(t,o,u){t==="focusin"?(ob(),Ad=o,$d=u,Ad.attachEvent("onpropertychange",X2)):t==="focusout"&&ob()}function RI(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ng($d)}function BI(t,o){if(t==="click")return ng(o)}function FI(t,o){if(t==="input"||t==="change")return ng(o)}function OI(t,o){return t===o&&(t!==0||1/t===1/o)||t!==t&&o!==o}var Co=typeof Object.is=="function"?Object.is:OI;function Zd(t,o){if(Co(t,o))return!0;if(typeof t!="object"||t===null||typeof o!="object"||o===null)return!1;var u=Object.keys(t),m=Object.keys(o);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var v=u[m];if(!Uy.call(o,v)||!Co(t[v],o[v]))return!1}return!0}function sb(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ab(t,o){var u=sb(t);t=0;for(var m;u;){if(u.nodeType===3){if(m=t+u.textContent.length,t<=o&&m>=o)return{node:u,offset:o-t};t=m}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=sb(u)}}function H2(t,o){return t&&o?t===o?!0:t&&t.nodeType===3?!1:o&&o.nodeType===3?H2(t,o.parentNode):"contains"in t?t.contains(o):t.compareDocumentPosition?!!(t.compareDocumentPosition(o)&16):!1:!1}function K2(){for(var t=window,o=xm();o instanceof t.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)t=o.contentWindow;else break;o=xm(t.document)}return o}function hv(t){var o=t&&t.nodeName&&t.nodeName.toLowerCase();return o&&(o==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||o==="textarea"||t.contentEditable==="true")}function VI(t){var o=K2(),u=t.focusedElem,m=t.selectionRange;if(o!==u&&u&&u.ownerDocument&&H2(u.ownerDocument.documentElement,u)){if(m!==null&&hv(u)){if(o=m.start,t=m.end,t===void 0&&(t=o),"selectionStart"in u)u.selectionStart=o,u.selectionEnd=Math.min(t,u.value.length);else if(t=(o=u.ownerDocument||document)&&o.defaultView||window,t.getSelection){t=t.getSelection();var v=u.textContent.length,b=Math.min(m.start,v);m=m.end===void 0?b:Math.min(m.end,v),!t.extend&&b>m&&(v=m,m=b,b=v),v=ab(u,b);var C=ab(u,m);v&&C&&(t.rangeCount!==1||t.anchorNode!==v.node||t.anchorOffset!==v.offset||t.focusNode!==C.node||t.focusOffset!==C.offset)&&(o=o.createRange(),o.setStart(v.node,v.offset),t.removeAllRanges(),b>m?(t.addRange(o),t.extend(C.node,C.offset)):(o.setEnd(C.node,C.offset),t.addRange(o)))}}for(o=[],t=u;t=t.parentNode;)t.nodeType===1&&o.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<o.length;u++)t=o[u],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var UI=Ss&&"documentMode"in document&&11>=document.documentMode,nu=null,o0=null,Pd=null,s0=!1;function lb(t,o,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;s0||nu==null||nu!==xm(m)||(m=nu,"selectionStart"in m&&hv(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Pd&&Zd(Pd,m)||(Pd=m,m=Mm(o0,"onSelect"),0<m.length&&(o=new lv("onSelect","select",null,o,u),t.push({event:o,listeners:m}),o.target=nu)))}function Wf(t,o){var u={};return u[t.toLowerCase()]=o.toLowerCase(),u["Webkit"+t]="webkit"+o,u["Moz"+t]="moz"+o,u}var iu={animationend:Wf("Animation","AnimationEnd"),animationiteration:Wf("Animation","AnimationIteration"),animationstart:Wf("Animation","AnimationStart"),transitionend:Wf("Transition","TransitionEnd")},dy={},Y2={};Ss&&(Y2=document.createElement("div").style,"AnimationEvent"in window||(delete iu.animationend.animation,delete iu.animationiteration.animation,delete iu.animationstart.animation),"TransitionEvent"in window||delete iu.transitionend.transition);function ig(t){if(dy[t])return dy[t];if(!iu[t])return t;var o=iu[t],u;for(u in o)if(o.hasOwnProperty(u)&&u in Y2)return dy[t]=o[u];return t}var J2=ig("animationend"),Q2=ig("animationiteration"),eE=ig("animationstart"),tE=ig("transitionend"),nE=new Map,cb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ra(t,o){nE.set(t,o),Wl(o,[t])}for(var py=0;py<cb.length;py++){var fy=cb[py],NI=fy.toLowerCase(),jI=fy[0].toUpperCase()+fy.slice(1);Ra(NI,"on"+jI)}Ra(J2,"onAnimationEnd");Ra(Q2,"onAnimationIteration");Ra(eE,"onAnimationStart");Ra("dblclick","onDoubleClick");Ra("focusin","onFocus");Ra("focusout","onBlur");Ra(tE,"onTransitionEnd");wu("onMouseEnter",["mouseout","mouseover"]);wu("onMouseLeave",["mouseout","mouseover"]);wu("onPointerEnter",["pointerout","pointerover"]);wu("onPointerLeave",["pointerout","pointerover"]);Wl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Td="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GI=new Set("cancel close invalid load scroll toggle".split(" ").concat(Td));function ub(t,o,u){var m=t.type||"unknown-event";t.currentTarget=u,NP(m,o,void 0,t),t.currentTarget=null}function iE(t,o){o=(o&4)!==0;for(var u=0;u<t.length;u++){var m=t[u],v=m.event;m=m.listeners;e:{var b=void 0;if(o)for(var C=m.length-1;0<=C;C--){var a=m[C],I=a.instance,O=a.currentTarget;if(a=a.listener,I!==b&&v.isPropagationStopped())break e;ub(v,a,O),b=I}else for(C=0;C<m.length;C++){if(a=m[C],I=a.instance,O=a.currentTarget,a=a.listener,I!==b&&v.isPropagationStopped())break e;ub(v,a,O),b=I}}}if(bm)throw t=t0,bm=!1,t0=null,t}function kn(t,o){var u=o[h0];u===void 0&&(u=o[h0]=new Set);var m=t+"__bubble";u.has(m)||(rE(o,t,2,!1),u.add(m))}function my(t,o,u){var m=0;o&&(m|=4),rE(u,t,m,o)}var Xf="_reactListening"+Math.random().toString(36).slice(2);function qd(t){if(!t[Xf]){t[Xf]=!0,h2.forEach(function(u){u!=="selectionchange"&&(GI.has(u)||my(u,!1,t),my(u,!0,t))});var o=t.nodeType===9?t:t.ownerDocument;o===null||o[Xf]||(o[Xf]=!0,my("selectionchange",!1,o))}}function rE(t,o,u,m){switch(N2(o)){case 1:var v=iI;break;case 4:v=rI;break;default:v=sv}u=v.bind(null,o,u,t),v=void 0,!e0||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(v=!0),m?v!==void 0?t.addEventListener(o,u,{capture:!0,passive:v}):t.addEventListener(o,u,!0):v!==void 0?t.addEventListener(o,u,{passive:v}):t.addEventListener(o,u,!1)}function gy(t,o,u,m,v){var b=m;if(!(o&1)&&!(o&2)&&m!==null)e:for(;;){if(m===null)return;var C=m.tag;if(C===3||C===4){var a=m.stateNode.containerInfo;if(a===v||a.nodeType===8&&a.parentNode===v)break;if(C===4)for(C=m.return;C!==null;){var I=C.tag;if((I===3||I===4)&&(I=C.stateNode.containerInfo,I===v||I.nodeType===8&&I.parentNode===v))return;C=C.return}for(;a!==null;){if(C=Bl(a),C===null)return;if(I=C.tag,I===5||I===6){m=b=C;continue e}a=a.parentNode}}m=m.return}M2(function(){var O=b,q=nv(u),G=[];e:{var H=nE.get(t);if(H!==void 0){var ue=lv,_e=t;switch(t){case"keypress":if(um(u)===0)break e;case"keydown":case"keyup":ue=vI;break;case"focusin":_e="focus",ue=cy;break;case"focusout":_e="blur",ue=cy;break;case"beforeblur":case"afterblur":ue=cy;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ue=Jw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ue=aI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ue=bI;break;case J2:case Q2:case eE:ue=uI;break;case tE:ue=EI;break;case"scroll":ue=oI;break;case"wheel":ue=CI;break;case"copy":case"cut":case"paste":ue=dI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ue=eb}var Ie=(o&4)!==0,at=!Ie&&t==="scroll",me=Ie?H!==null?H+"Capture":null:H;Ie=[];for(var ne=O,le;ne!==null;){le=ne;var ke=le.stateNode;if(le.tag===5&&ke!==null&&(le=ke,me!==null&&(ke=Ud(ne,me),ke!=null&&Ie.push(Wd(ne,ke,le)))),at)break;ne=ne.return}0<Ie.length&&(H=new ue(H,_e,null,u,q),G.push({event:H,listeners:Ie}))}}if(!(o&7)){e:{if(H=t==="mouseover"||t==="pointerover",ue=t==="mouseout"||t==="pointerout",H&&u!==Jy&&(_e=u.relatedTarget||u.fromElement)&&(Bl(_e)||_e[Cs]))break e;if((ue||H)&&(H=q.window===q?q:(H=q.ownerDocument)?H.defaultView||H.parentWindow:window,ue?(_e=u.relatedTarget||u.toElement,ue=O,_e=_e?Bl(_e):null,_e!==null&&(at=Xl(_e),_e!==at||_e.tag!==5&&_e.tag!==6)&&(_e=null)):(ue=null,_e=O),ue!==_e)){if(Ie=Jw,ke="onMouseLeave",me="onMouseEnter",ne="mouse",(t==="pointerout"||t==="pointerover")&&(Ie=eb,ke="onPointerLeave",me="onPointerEnter",ne="pointer"),at=ue==null?H:ru(ue),le=_e==null?H:ru(_e),H=new Ie(ke,ne+"leave",ue,u,q),H.target=at,H.relatedTarget=le,ke=null,Bl(q)===O&&(Ie=new Ie(me,ne+"enter",_e,u,q),Ie.target=le,Ie.relatedTarget=at,ke=Ie),at=ke,ue&&_e)t:{for(Ie=ue,me=_e,ne=0,le=Ie;le;le=Jc(le))ne++;for(le=0,ke=me;ke;ke=Jc(ke))le++;for(;0<ne-le;)Ie=Jc(Ie),ne--;for(;0<le-ne;)me=Jc(me),le--;for(;ne--;){if(Ie===me||me!==null&&Ie===me.alternate)break t;Ie=Jc(Ie),me=Jc(me)}Ie=null}else Ie=null;ue!==null&&hb(G,H,ue,Ie,!1),_e!==null&&at!==null&&hb(G,at,_e,Ie,!0)}}e:{if(H=O?ru(O):window,ue=H.nodeName&&H.nodeName.toLowerCase(),ue==="select"||ue==="input"&&H.type==="file")var je=DI;else if(ib(H))if(W2)je=FI;else{je=RI;var ct=LI}else(ue=H.nodeName)&&ue.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(je=BI);if(je&&(je=je(t,O))){q2(G,je,u,q);break e}ct&&ct(t,H,O),t==="focusout"&&(ct=H._wrapperState)&&ct.controlled&&H.type==="number"&&Wy(H,"number",H.value)}switch(ct=O?ru(O):window,t){case"focusin":(ib(ct)||ct.contentEditable==="true")&&(nu=ct,o0=O,Pd=null);break;case"focusout":Pd=o0=nu=null;break;case"mousedown":s0=!0;break;case"contextmenu":case"mouseup":case"dragend":s0=!1,lb(G,u,q);break;case"selectionchange":if(UI)break;case"keydown":case"keyup":lb(G,u,q)}var it;if(uv)e:{switch(t){case"compositionstart":var Qe="onCompositionStart";break e;case"compositionend":Qe="onCompositionEnd";break e;case"compositionupdate":Qe="onCompositionUpdate";break e}Qe=void 0}else tu?$2(t,u)&&(Qe="onCompositionEnd"):t==="keydown"&&u.keyCode===229&&(Qe="onCompositionStart");Qe&&(G2&&u.locale!=="ko"&&(tu||Qe!=="onCompositionStart"?Qe==="onCompositionEnd"&&tu&&(it=j2()):(va=q,av="value"in va?va.value:va.textContent,tu=!0)),ct=Mm(O,Qe),0<ct.length&&(Qe=new Qw(Qe,t,null,u,q),G.push({event:Qe,listeners:ct}),it?Qe.data=it:(it=Z2(u),it!==null&&(Qe.data=it)))),(it=AI?PI(t,u):II(t,u))&&(O=Mm(O,"onBeforeInput"),0<O.length&&(q=new Qw("onBeforeInput","beforeinput",null,u,q),G.push({event:q,listeners:O}),q.data=it))}iE(G,o)})}function Wd(t,o,u){return{instance:t,listener:o,currentTarget:u}}function Mm(t,o){for(var u=o+"Capture",m=[];t!==null;){var v=t,b=v.stateNode;v.tag===5&&b!==null&&(v=b,b=Ud(t,u),b!=null&&m.unshift(Wd(t,b,v)),b=Ud(t,o),b!=null&&m.push(Wd(t,b,v))),t=t.return}return m}function Jc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function hb(t,o,u,m,v){for(var b=o._reactName,C=[];u!==null&&u!==m;){var a=u,I=a.alternate,O=a.stateNode;if(I!==null&&I===m)break;a.tag===5&&O!==null&&(a=O,v?(I=Ud(u,b),I!=null&&C.unshift(Wd(u,I,a))):v||(I=Ud(u,b),I!=null&&C.push(Wd(u,I,a)))),u=u.return}C.length!==0&&t.push({event:o,listeners:C})}var $I=/\r\n?/g,ZI=/\u0000|\uFFFD/g;function db(t){return(typeof t=="string"?t:""+t).replace($I,`
`).replace(ZI,"")}function Hf(t,o,u){if(o=db(o),db(t)!==o&&u)throw Error(tt(425))}function Am(){}var a0=null,l0=null;function c0(t,o){return t==="textarea"||t==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var u0=typeof setTimeout=="function"?setTimeout:void 0,qI=typeof clearTimeout=="function"?clearTimeout:void 0,pb=typeof Promise=="function"?Promise:void 0,WI=typeof queueMicrotask=="function"?queueMicrotask:typeof pb<"u"?function(t){return pb.resolve(null).then(t).catch(XI)}:u0;function XI(t){setTimeout(function(){throw t})}function _y(t,o){var u=o,m=0;do{var v=u.nextSibling;if(t.removeChild(u),v&&v.nodeType===8)if(u=v.data,u==="/$"){if(m===0){t.removeChild(v),Gd(o);return}m--}else u!=="$"&&u!=="$?"&&u!=="$!"||m++;u=v}while(u);Gd(o)}function Ea(t){for(;t!=null;t=t.nextSibling){var o=t.nodeType;if(o===1||o===3)break;if(o===8){if(o=t.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return t}function fb(t){t=t.previousSibling;for(var o=0;t;){if(t.nodeType===8){var u=t.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return t;o--}else u==="/$"&&o++}t=t.previousSibling}return null}var zu=Math.random().toString(36).slice(2),$o="__reactFiber$"+zu,Xd="__reactProps$"+zu,Cs="__reactContainer$"+zu,h0="__reactEvents$"+zu,HI="__reactListeners$"+zu,KI="__reactHandles$"+zu;function Bl(t){var o=t[$o];if(o)return o;for(var u=t.parentNode;u;){if(o=u[Cs]||u[$o]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(t=fb(t);t!==null;){if(u=t[$o])return u;t=fb(t)}return o}t=u,u=t.parentNode}return null}function ap(t){return t=t[$o]||t[Cs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ru(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(tt(33))}function rg(t){return t[Xd]||null}var d0=[],ou=-1;function Ba(t){return{current:t}}function zn(t){0>ou||(t.current=d0[ou],d0[ou]=null,ou--)}function An(t,o){ou++,d0[ou]=t.current,t.current=o}var za={},$i=Ba(za),fr=Ba(!1),jl=za;function bu(t,o){var u=t.type.contextTypes;if(!u)return za;var m=t.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===o)return m.__reactInternalMemoizedMaskedChildContext;var v={},b;for(b in u)v[b]=o[b];return m&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=v),v}function mr(t){return t=t.childContextTypes,t!=null}function Pm(){zn(fr),zn($i)}function mb(t,o,u){if($i.current!==za)throw Error(tt(168));An($i,o),An(fr,u)}function oE(t,o,u){var m=t.stateNode;if(o=o.childContextTypes,typeof m.getChildContext!="function")return u;m=m.getChildContext();for(var v in m)if(!(v in o))throw Error(tt(108,LP(t)||"Unknown",v));return Kn({},u,m)}function Im(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||za,jl=$i.current,An($i,t),An(fr,fr.current),!0}function gb(t,o,u){var m=t.stateNode;if(!m)throw Error(tt(169));u?(t=oE(t,o,jl),m.__reactInternalMemoizedMergedChildContext=t,zn(fr),zn($i),An($i,t)):zn(fr),An(fr,u)}var _s=null,og=!1,yy=!1;function sE(t){_s===null?_s=[t]:_s.push(t)}function YI(t){og=!0,sE(t)}function Fa(){if(!yy&&_s!==null){yy=!0;var t=0,o=yn;try{var u=_s;for(yn=1;t<u.length;t++){var m=u[t];do m=m(!0);while(m!==null)}_s=null,og=!1}catch(v){throw _s!==null&&(_s=_s.slice(t+1)),k2(iv,Fa),v}finally{yn=o,yy=!1}}return null}var su=[],au=0,km=null,zm=0,Zr=[],qr=0,Gl=null,vs=1,xs="";function zl(t,o){su[au++]=zm,su[au++]=km,km=t,zm=o}function aE(t,o,u){Zr[qr++]=vs,Zr[qr++]=xs,Zr[qr++]=Gl,Gl=t;var m=vs;t=xs;var v=32-Eo(m)-1;m&=~(1<<v),u+=1;var b=32-Eo(o)+v;if(30<b){var C=v-v%5;b=(m&(1<<C)-1).toString(32),m>>=C,v-=C,vs=1<<32-Eo(o)+v|u<<v|m,xs=b+t}else vs=1<<b|u<<v|m,xs=t}function dv(t){t.return!==null&&(zl(t,1),aE(t,1,0))}function pv(t){for(;t===km;)km=su[--au],su[au]=null,zm=su[--au],su[au]=null;for(;t===Gl;)Gl=Zr[--qr],Zr[qr]=null,xs=Zr[--qr],Zr[qr]=null,vs=Zr[--qr],Zr[qr]=null}var Ar=null,Mr=null,Fn=!1,To=null;function lE(t,o){var u=Wr(5,null,null,0);u.elementType="DELETED",u.stateNode=o,u.return=t,o=t.deletions,o===null?(t.deletions=[u],t.flags|=16):o.push(u)}function _b(t,o){switch(t.tag){case 5:var u=t.type;return o=o.nodeType!==1||u.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(t.stateNode=o,Ar=t,Mr=Ea(o.firstChild),!0):!1;case 6:return o=t.pendingProps===""||o.nodeType!==3?null:o,o!==null?(t.stateNode=o,Ar=t,Mr=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(u=Gl!==null?{id:vs,overflow:xs}:null,t.memoizedState={dehydrated:o,treeContext:u,retryLane:1073741824},u=Wr(18,null,null,0),u.stateNode=o,u.return=t,t.child=u,Ar=t,Mr=null,!0):!1;default:return!1}}function p0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function f0(t){if(Fn){var o=Mr;if(o){var u=o;if(!_b(t,o)){if(p0(t))throw Error(tt(418));o=Ea(u.nextSibling);var m=Ar;o&&_b(t,o)?lE(m,u):(t.flags=t.flags&-4097|2,Fn=!1,Ar=t)}}else{if(p0(t))throw Error(tt(418));t.flags=t.flags&-4097|2,Fn=!1,Ar=t}}}function yb(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Ar=t}function Kf(t){if(t!==Ar)return!1;if(!Fn)return yb(t),Fn=!0,!1;var o;if((o=t.tag!==3)&&!(o=t.tag!==5)&&(o=t.type,o=o!=="head"&&o!=="body"&&!c0(t.type,t.memoizedProps)),o&&(o=Mr)){if(p0(t))throw cE(),Error(tt(418));for(;o;)lE(t,o),o=Ea(o.nextSibling)}if(yb(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(tt(317));e:{for(t=t.nextSibling,o=0;t;){if(t.nodeType===8){var u=t.data;if(u==="/$"){if(o===0){Mr=Ea(t.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++}t=t.nextSibling}Mr=null}}else Mr=Ar?Ea(t.stateNode.nextSibling):null;return!0}function cE(){for(var t=Mr;t;)t=Ea(t.nextSibling)}function Tu(){Mr=Ar=null,Fn=!1}function fv(t){To===null?To=[t]:To.push(t)}var JI=Is.ReactCurrentBatchConfig;function wo(t,o){if(t&&t.defaultProps){o=Kn({},o),t=t.defaultProps;for(var u in t)o[u]===void 0&&(o[u]=t[u]);return o}return o}var Dm=Ba(null),Lm=null,lu=null,mv=null;function gv(){mv=lu=Lm=null}function _v(t){var o=Dm.current;zn(Dm),t._currentValue=o}function m0(t,o,u){for(;t!==null;){var m=t.alternate;if((t.childLanes&o)!==o?(t.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),t===u)break;t=t.return}}function vu(t,o){Lm=t,mv=lu=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&o&&(pr=!0),t.firstContext=null)}function Hr(t){var o=t._currentValue;if(mv!==t)if(t={context:t,memoizedValue:o,next:null},lu===null){if(Lm===null)throw Error(tt(308));lu=t,Lm.dependencies={lanes:0,firstContext:t}}else lu=lu.next=t;return o}var Fl=null;function yv(t){Fl===null?Fl=[t]:Fl.push(t)}function uE(t,o,u,m){var v=o.interleaved;return v===null?(u.next=u,yv(o)):(u.next=v.next,v.next=u),o.interleaved=u,Ms(t,m)}function Ms(t,o){t.lanes|=o;var u=t.alternate;for(u!==null&&(u.lanes|=o),u=t,t=t.return;t!==null;)t.childLanes|=o,u=t.alternate,u!==null&&(u.childLanes|=o),u=t,t=t.return;return u.tag===3?u.stateNode:null}var ma=!1;function vv(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hE(t,o){t=t.updateQueue,o.updateQueue===t&&(o.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function bs(t,o){return{eventTime:t,lane:o,tag:0,payload:null,callback:null,next:null}}function Sa(t,o,u){var m=t.updateQueue;if(m===null)return null;if(m=m.shared,tn&2){var v=m.pending;return v===null?o.next=o:(o.next=v.next,v.next=o),m.pending=o,Ms(t,u)}return v=m.interleaved,v===null?(o.next=o,yv(m)):(o.next=v.next,v.next=o),m.interleaved=o,Ms(t,u)}function hm(t,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194240)!==0)){var m=o.lanes;m&=t.pendingLanes,u|=m,o.lanes=u,rv(t,u)}}function vb(t,o){var u=t.updateQueue,m=t.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var v=null,b=null;if(u=u.firstBaseUpdate,u!==null){do{var C={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};b===null?v=b=C:b=b.next=C,u=u.next}while(u!==null);b===null?v=b=o:b=b.next=o}else v=b=o;u={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:b,shared:m.shared,effects:m.effects},t.updateQueue=u;return}t=u.lastBaseUpdate,t===null?u.firstBaseUpdate=o:t.next=o,u.lastBaseUpdate=o}function Rm(t,o,u,m){var v=t.updateQueue;ma=!1;var b=v.firstBaseUpdate,C=v.lastBaseUpdate,a=v.shared.pending;if(a!==null){v.shared.pending=null;var I=a,O=I.next;I.next=null,C===null?b=O:C.next=O,C=I;var q=t.alternate;q!==null&&(q=q.updateQueue,a=q.lastBaseUpdate,a!==C&&(a===null?q.firstBaseUpdate=O:a.next=O,q.lastBaseUpdate=I))}if(b!==null){var G=v.baseState;C=0,q=O=I=null,a=b;do{var H=a.lane,ue=a.eventTime;if((m&H)===H){q!==null&&(q=q.next={eventTime:ue,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var _e=t,Ie=a;switch(H=o,ue=u,Ie.tag){case 1:if(_e=Ie.payload,typeof _e=="function"){G=_e.call(ue,G,H);break e}G=_e;break e;case 3:_e.flags=_e.flags&-65537|128;case 0:if(_e=Ie.payload,H=typeof _e=="function"?_e.call(ue,G,H):_e,H==null)break e;G=Kn({},G,H);break e;case 2:ma=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,H=v.effects,H===null?v.effects=[a]:H.push(a))}else ue={eventTime:ue,lane:H,tag:a.tag,payload:a.payload,callback:a.callback,next:null},q===null?(O=q=ue,I=G):q=q.next=ue,C|=H;if(a=a.next,a===null){if(a=v.shared.pending,a===null)break;H=a,a=H.next,H.next=null,v.lastBaseUpdate=H,v.shared.pending=null}}while(1);if(q===null&&(I=G),v.baseState=I,v.firstBaseUpdate=O,v.lastBaseUpdate=q,o=v.shared.interleaved,o!==null){v=o;do C|=v.lane,v=v.next;while(v!==o)}else b===null&&(v.shared.lanes=0);Zl|=C,t.lanes=C,t.memoizedState=G}}function xb(t,o,u){if(t=o.effects,o.effects=null,t!==null)for(o=0;o<t.length;o++){var m=t[o],v=m.callback;if(v!==null){if(m.callback=null,m=u,typeof v!="function")throw Error(tt(191,v));v.call(m)}}}var dE=new u2.Component().refs;function g0(t,o,u,m){o=t.memoizedState,u=u(m,o),u=u==null?o:Kn({},o,u),t.memoizedState=u,t.lanes===0&&(t.updateQueue.baseState=u)}var sg={isMounted:function(t){return(t=t._reactInternals)?Xl(t)===t:!1},enqueueSetState:function(t,o,u){t=t._reactInternals;var m=Ji(),v=Ma(t),b=bs(m,v);b.payload=o,u!=null&&(b.callback=u),o=Sa(t,b,v),o!==null&&(So(o,t,v,m),hm(o,t,v))},enqueueReplaceState:function(t,o,u){t=t._reactInternals;var m=Ji(),v=Ma(t),b=bs(m,v);b.tag=1,b.payload=o,u!=null&&(b.callback=u),o=Sa(t,b,v),o!==null&&(So(o,t,v,m),hm(o,t,v))},enqueueForceUpdate:function(t,o){t=t._reactInternals;var u=Ji(),m=Ma(t),v=bs(u,m);v.tag=2,o!=null&&(v.callback=o),o=Sa(t,v,m),o!==null&&(So(o,t,m,u),hm(o,t,m))}};function wb(t,o,u,m,v,b,C){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(m,b,C):o.prototype&&o.prototype.isPureReactComponent?!Zd(u,m)||!Zd(v,b):!0}function pE(t,o,u){var m=!1,v=za,b=o.contextType;return typeof b=="object"&&b!==null?b=Hr(b):(v=mr(o)?jl:$i.current,m=o.contextTypes,b=(m=m!=null)?bu(t,v):za),o=new o(u,b),t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=sg,t.stateNode=o,o._reactInternals=t,m&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=v,t.__reactInternalMemoizedMaskedChildContext=b),o}function bb(t,o,u,m){t=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,m),o.state!==t&&sg.enqueueReplaceState(o,o.state,null)}function _0(t,o,u,m){var v=t.stateNode;v.props=u,v.state=t.memoizedState,v.refs=dE,vv(t);var b=o.contextType;typeof b=="object"&&b!==null?v.context=Hr(b):(b=mr(o)?jl:$i.current,v.context=bu(t,b)),v.state=t.memoizedState,b=o.getDerivedStateFromProps,typeof b=="function"&&(g0(t,o,b,u),v.state=t.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(o=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),o!==v.state&&sg.enqueueReplaceState(v,v.state,null),Rm(t,u,v,m),v.state=t.memoizedState),typeof v.componentDidMount=="function"&&(t.flags|=4194308)}function md(t,o,u){if(t=u.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(tt(309));var m=u.stateNode}if(!m)throw Error(tt(147,t));var v=m,b=""+t;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===b?o.ref:(o=function(C){var a=v.refs;a===dE&&(a=v.refs={}),C===null?delete a[b]:a[b]=C},o._stringRef=b,o)}if(typeof t!="string")throw Error(tt(284));if(!u._owner)throw Error(tt(290,t))}return t}function Yf(t,o){throw t=Object.prototype.toString.call(o),Error(tt(31,t==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":t))}function Tb(t){var o=t._init;return o(t._payload)}function fE(t){function o(me,ne){if(t){var le=me.deletions;le===null?(me.deletions=[ne],me.flags|=16):le.push(ne)}}function u(me,ne){if(!t)return null;for(;ne!==null;)o(me,ne),ne=ne.sibling;return null}function m(me,ne){for(me=new Map;ne!==null;)ne.key!==null?me.set(ne.key,ne):me.set(ne.index,ne),ne=ne.sibling;return me}function v(me,ne){return me=Aa(me,ne),me.index=0,me.sibling=null,me}function b(me,ne,le){return me.index=le,t?(le=me.alternate,le!==null?(le=le.index,le<ne?(me.flags|=2,ne):le):(me.flags|=2,ne)):(me.flags|=1048576,ne)}function C(me){return t&&me.alternate===null&&(me.flags|=2),me}function a(me,ne,le,ke){return ne===null||ne.tag!==6?(ne=Sy(le,me.mode,ke),ne.return=me,ne):(ne=v(ne,le),ne.return=me,ne)}function I(me,ne,le,ke){var je=le.type;return je===eu?q(me,ne,le.props.children,ke,le.key):ne!==null&&(ne.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===fa&&Tb(je)===ne.type)?(ke=v(ne,le.props),ke.ref=md(me,ne,le),ke.return=me,ke):(ke=_m(le.type,le.key,le.props,null,me.mode,ke),ke.ref=md(me,ne,le),ke.return=me,ke)}function O(me,ne,le,ke){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==le.containerInfo||ne.stateNode.implementation!==le.implementation?(ne=Cy(le,me.mode,ke),ne.return=me,ne):(ne=v(ne,le.children||[]),ne.return=me,ne)}function q(me,ne,le,ke,je){return ne===null||ne.tag!==7?(ne=Nl(le,me.mode,ke,je),ne.return=me,ne):(ne=v(ne,le),ne.return=me,ne)}function G(me,ne,le){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return ne=Sy(""+ne,me.mode,le),ne.return=me,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case Uf:return le=_m(ne.type,ne.key,ne.props,null,me.mode,le),le.ref=md(me,null,ne),le.return=me,le;case Qc:return ne=Cy(ne,me.mode,le),ne.return=me,ne;case fa:var ke=ne._init;return G(me,ke(ne._payload),le)}if(wd(ne)||ud(ne))return ne=Nl(ne,me.mode,le,null),ne.return=me,ne;Yf(me,ne)}return null}function H(me,ne,le,ke){var je=ne!==null?ne.key:null;if(typeof le=="string"&&le!==""||typeof le=="number")return je!==null?null:a(me,ne,""+le,ke);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case Uf:return le.key===je?I(me,ne,le,ke):null;case Qc:return le.key===je?O(me,ne,le,ke):null;case fa:return je=le._init,H(me,ne,je(le._payload),ke)}if(wd(le)||ud(le))return je!==null?null:q(me,ne,le,ke,null);Yf(me,le)}return null}function ue(me,ne,le,ke,je){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return me=me.get(le)||null,a(ne,me,""+ke,je);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case Uf:return me=me.get(ke.key===null?le:ke.key)||null,I(ne,me,ke,je);case Qc:return me=me.get(ke.key===null?le:ke.key)||null,O(ne,me,ke,je);case fa:var ct=ke._init;return ue(me,ne,le,ct(ke._payload),je)}if(wd(ke)||ud(ke))return me=me.get(le)||null,q(ne,me,ke,je,null);Yf(ne,ke)}return null}function _e(me,ne,le,ke){for(var je=null,ct=null,it=ne,Qe=ne=0,Be=null;it!==null&&Qe<le.length;Qe++){it.index>Qe?(Be=it,it=null):Be=it.sibling;var St=H(me,it,le[Qe],ke);if(St===null){it===null&&(it=Be);break}t&&it&&St.alternate===null&&o(me,it),ne=b(St,ne,Qe),ct===null?je=St:ct.sibling=St,ct=St,it=Be}if(Qe===le.length)return u(me,it),Fn&&zl(me,Qe),je;if(it===null){for(;Qe<le.length;Qe++)it=G(me,le[Qe],ke),it!==null&&(ne=b(it,ne,Qe),ct===null?je=it:ct.sibling=it,ct=it);return Fn&&zl(me,Qe),je}for(it=m(me,it);Qe<le.length;Qe++)Be=ue(it,me,Qe,le[Qe],ke),Be!==null&&(t&&Be.alternate!==null&&it.delete(Be.key===null?Qe:Be.key),ne=b(Be,ne,Qe),ct===null?je=Be:ct.sibling=Be,ct=Be);return t&&it.forEach(function(bn){return o(me,bn)}),Fn&&zl(me,Qe),je}function Ie(me,ne,le,ke){var je=ud(le);if(typeof je!="function")throw Error(tt(150));if(le=je.call(le),le==null)throw Error(tt(151));for(var ct=je=null,it=ne,Qe=ne=0,Be=null,St=le.next();it!==null&&!St.done;Qe++,St=le.next()){it.index>Qe?(Be=it,it=null):Be=it.sibling;var bn=H(me,it,St.value,ke);if(bn===null){it===null&&(it=Be);break}t&&it&&bn.alternate===null&&o(me,it),ne=b(bn,ne,Qe),ct===null?je=bn:ct.sibling=bn,ct=bn,it=Be}if(St.done)return u(me,it),Fn&&zl(me,Qe),je;if(it===null){for(;!St.done;Qe++,St=le.next())St=G(me,St.value,ke),St!==null&&(ne=b(St,ne,Qe),ct===null?je=St:ct.sibling=St,ct=St);return Fn&&zl(me,Qe),je}for(it=m(me,it);!St.done;Qe++,St=le.next())St=ue(it,me,Qe,St.value,ke),St!==null&&(t&&St.alternate!==null&&it.delete(St.key===null?Qe:St.key),ne=b(St,ne,Qe),ct===null?je=St:ct.sibling=St,ct=St);return t&&it.forEach(function(bt){return o(me,bt)}),Fn&&zl(me,Qe),je}function at(me,ne,le,ke){if(typeof le=="object"&&le!==null&&le.type===eu&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case Uf:e:{for(var je=le.key,ct=ne;ct!==null;){if(ct.key===je){if(je=le.type,je===eu){if(ct.tag===7){u(me,ct.sibling),ne=v(ct,le.props.children),ne.return=me,me=ne;break e}}else if(ct.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===fa&&Tb(je)===ct.type){u(me,ct.sibling),ne=v(ct,le.props),ne.ref=md(me,ct,le),ne.return=me,me=ne;break e}u(me,ct);break}else o(me,ct);ct=ct.sibling}le.type===eu?(ne=Nl(le.props.children,me.mode,ke,le.key),ne.return=me,me=ne):(ke=_m(le.type,le.key,le.props,null,me.mode,ke),ke.ref=md(me,ne,le),ke.return=me,me=ke)}return C(me);case Qc:e:{for(ct=le.key;ne!==null;){if(ne.key===ct)if(ne.tag===4&&ne.stateNode.containerInfo===le.containerInfo&&ne.stateNode.implementation===le.implementation){u(me,ne.sibling),ne=v(ne,le.children||[]),ne.return=me,me=ne;break e}else{u(me,ne);break}else o(me,ne);ne=ne.sibling}ne=Cy(le,me.mode,ke),ne.return=me,me=ne}return C(me);case fa:return ct=le._init,at(me,ne,ct(le._payload),ke)}if(wd(le))return _e(me,ne,le,ke);if(ud(le))return Ie(me,ne,le,ke);Yf(me,le)}return typeof le=="string"&&le!==""||typeof le=="number"?(le=""+le,ne!==null&&ne.tag===6?(u(me,ne.sibling),ne=v(ne,le),ne.return=me,me=ne):(u(me,ne),ne=Sy(le,me.mode,ke),ne.return=me,me=ne),C(me)):u(me,ne)}return at}var Eu=fE(!0),mE=fE(!1),lp={},qo=Ba(lp),Hd=Ba(lp),Kd=Ba(lp);function Ol(t){if(t===lp)throw Error(tt(174));return t}function xv(t,o){switch(An(Kd,o),An(Hd,t),An(qo,lp),t=o.nodeType,t){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Hy(null,"");break;default:t=t===8?o.parentNode:o,o=t.namespaceURI||null,t=t.tagName,o=Hy(o,t)}zn(qo),An(qo,o)}function Su(){zn(qo),zn(Hd),zn(Kd)}function gE(t){Ol(Kd.current);var o=Ol(qo.current),u=Hy(o,t.type);o!==u&&(An(Hd,t),An(qo,u))}function wv(t){Hd.current===t&&(zn(qo),zn(Hd))}var Wn=Ba(0);function Bm(t){for(var o=t;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===t)break;for(;o.sibling===null;){if(o.return===null||o.return===t)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var vy=[];function bv(){for(var t=0;t<vy.length;t++)vy[t]._workInProgressVersionPrimary=null;vy.length=0}var dm=Is.ReactCurrentDispatcher,xy=Is.ReactCurrentBatchConfig,$l=0,Hn=null,gi=null,Si=null,Fm=!1,Id=!1,Yd=0,QI=0;function Ni(){throw Error(tt(321))}function Tv(t,o){if(o===null)return!1;for(var u=0;u<o.length&&u<t.length;u++)if(!Co(t[u],o[u]))return!1;return!0}function Ev(t,o,u,m,v,b){if($l=b,Hn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,dm.current=t===null||t.memoizedState===null?ik:rk,t=u(m,v),Id){b=0;do{if(Id=!1,Yd=0,25<=b)throw Error(tt(301));b+=1,Si=gi=null,o.updateQueue=null,dm.current=ok,t=u(m,v)}while(Id)}if(dm.current=Om,o=gi!==null&&gi.next!==null,$l=0,Si=gi=Hn=null,Fm=!1,o)throw Error(tt(300));return t}function Sv(){var t=Yd!==0;return Yd=0,t}function jo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Si===null?Hn.memoizedState=Si=t:Si=Si.next=t,Si}function Kr(){if(gi===null){var t=Hn.alternate;t=t!==null?t.memoizedState:null}else t=gi.next;var o=Si===null?Hn.memoizedState:Si.next;if(o!==null)Si=o,gi=t;else{if(t===null)throw Error(tt(310));gi=t,t={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},Si===null?Hn.memoizedState=Si=t:Si=Si.next=t}return Si}function Jd(t,o){return typeof o=="function"?o(t):o}function wy(t){var o=Kr(),u=o.queue;if(u===null)throw Error(tt(311));u.lastRenderedReducer=t;var m=gi,v=m.baseQueue,b=u.pending;if(b!==null){if(v!==null){var C=v.next;v.next=b.next,b.next=C}m.baseQueue=v=b,u.pending=null}if(v!==null){b=v.next,m=m.baseState;var a=C=null,I=null,O=b;do{var q=O.lane;if(($l&q)===q)I!==null&&(I=I.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),m=O.hasEagerState?O.eagerState:t(m,O.action);else{var G={lane:q,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};I===null?(a=I=G,C=m):I=I.next=G,Hn.lanes|=q,Zl|=q}O=O.next}while(O!==null&&O!==b);I===null?C=m:I.next=a,Co(m,o.memoizedState)||(pr=!0),o.memoizedState=m,o.baseState=C,o.baseQueue=I,u.lastRenderedState=m}if(t=u.interleaved,t!==null){v=t;do b=v.lane,Hn.lanes|=b,Zl|=b,v=v.next;while(v!==t)}else v===null&&(u.lanes=0);return[o.memoizedState,u.dispatch]}function by(t){var o=Kr(),u=o.queue;if(u===null)throw Error(tt(311));u.lastRenderedReducer=t;var m=u.dispatch,v=u.pending,b=o.memoizedState;if(v!==null){u.pending=null;var C=v=v.next;do b=t(b,C.action),C=C.next;while(C!==v);Co(b,o.memoizedState)||(pr=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),u.lastRenderedState=b}return[b,m]}function _E(){}function yE(t,o){var u=Hn,m=Kr(),v=o(),b=!Co(m.memoizedState,v);if(b&&(m.memoizedState=v,pr=!0),m=m.queue,Cv(wE.bind(null,u,m,t),[t]),m.getSnapshot!==o||b||Si!==null&&Si.memoizedState.tag&1){if(u.flags|=2048,Qd(9,xE.bind(null,u,m,v,o),void 0,null),Ci===null)throw Error(tt(349));$l&30||vE(u,o,v)}return v}function vE(t,o,u){t.flags|=16384,t={getSnapshot:o,value:u},o=Hn.updateQueue,o===null?(o={lastEffect:null,stores:null},Hn.updateQueue=o,o.stores=[t]):(u=o.stores,u===null?o.stores=[t]:u.push(t))}function xE(t,o,u,m){o.value=u,o.getSnapshot=m,bE(o)&&TE(t)}function wE(t,o,u){return u(function(){bE(o)&&TE(t)})}function bE(t){var o=t.getSnapshot;t=t.value;try{var u=o();return!Co(t,u)}catch{return!0}}function TE(t){var o=Ms(t,1);o!==null&&So(o,t,1,-1)}function Eb(t){var o=jo();return typeof t=="function"&&(t=t()),o.memoizedState=o.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Jd,lastRenderedState:t},o.queue=t,t=t.dispatch=nk.bind(null,Hn,t),[o.memoizedState,t]}function Qd(t,o,u,m){return t={tag:t,create:o,destroy:u,deps:m,next:null},o=Hn.updateQueue,o===null?(o={lastEffect:null,stores:null},Hn.updateQueue=o,o.lastEffect=t.next=t):(u=o.lastEffect,u===null?o.lastEffect=t.next=t:(m=u.next,u.next=t,t.next=m,o.lastEffect=t)),t}function EE(){return Kr().memoizedState}function pm(t,o,u,m){var v=jo();Hn.flags|=t,v.memoizedState=Qd(1|o,u,void 0,m===void 0?null:m)}function ag(t,o,u,m){var v=Kr();m=m===void 0?null:m;var b=void 0;if(gi!==null){var C=gi.memoizedState;if(b=C.destroy,m!==null&&Tv(m,C.deps)){v.memoizedState=Qd(o,u,b,m);return}}Hn.flags|=t,v.memoizedState=Qd(1|o,u,b,m)}function Sb(t,o){return pm(8390656,8,t,o)}function Cv(t,o){return ag(2048,8,t,o)}function SE(t,o){return ag(4,2,t,o)}function CE(t,o){return ag(4,4,t,o)}function ME(t,o){if(typeof o=="function")return t=t(),o(t),function(){o(null)};if(o!=null)return t=t(),o.current=t,function(){o.current=null}}function AE(t,o,u){return u=u!=null?u.concat([t]):null,ag(4,4,ME.bind(null,o,t),u)}function Mv(){}function PE(t,o){var u=Kr();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&Tv(o,m[1])?m[0]:(u.memoizedState=[t,o],t)}function IE(t,o){var u=Kr();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&Tv(o,m[1])?m[0]:(t=t(),u.memoizedState=[t,o],t)}function kE(t,o,u){return $l&21?(Co(u,o)||(u=L2(),Hn.lanes|=u,Zl|=u,t.baseState=!0),o):(t.baseState&&(t.baseState=!1,pr=!0),t.memoizedState=u)}function ek(t,o){var u=yn;yn=u!==0&&4>u?u:4,t(!0);var m=xy.transition;xy.transition={};try{t(!1),o()}finally{yn=u,xy.transition=m}}function zE(){return Kr().memoizedState}function tk(t,o,u){var m=Ma(t);if(u={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null},DE(t))LE(o,u);else if(u=uE(t,o,u,m),u!==null){var v=Ji();So(u,t,m,v),RE(u,o,m)}}function nk(t,o,u){var m=Ma(t),v={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null};if(DE(t))LE(o,v);else{var b=t.alternate;if(t.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var C=o.lastRenderedState,a=b(C,u);if(v.hasEagerState=!0,v.eagerState=a,Co(a,C)){var I=o.interleaved;I===null?(v.next=v,yv(o)):(v.next=I.next,I.next=v),o.interleaved=v;return}}catch{}finally{}u=uE(t,o,v,m),u!==null&&(v=Ji(),So(u,t,m,v),RE(u,o,m))}}function DE(t){var o=t.alternate;return t===Hn||o!==null&&o===Hn}function LE(t,o){Id=Fm=!0;var u=t.pending;u===null?o.next=o:(o.next=u.next,u.next=o),t.pending=o}function RE(t,o,u){if(u&4194240){var m=o.lanes;m&=t.pendingLanes,u|=m,o.lanes=u,rv(t,u)}}var Om={readContext:Hr,useCallback:Ni,useContext:Ni,useEffect:Ni,useImperativeHandle:Ni,useInsertionEffect:Ni,useLayoutEffect:Ni,useMemo:Ni,useReducer:Ni,useRef:Ni,useState:Ni,useDebugValue:Ni,useDeferredValue:Ni,useTransition:Ni,useMutableSource:Ni,useSyncExternalStore:Ni,useId:Ni,unstable_isNewReconciler:!1},ik={readContext:Hr,useCallback:function(t,o){return jo().memoizedState=[t,o===void 0?null:o],t},useContext:Hr,useEffect:Sb,useImperativeHandle:function(t,o,u){return u=u!=null?u.concat([t]):null,pm(4194308,4,ME.bind(null,o,t),u)},useLayoutEffect:function(t,o){return pm(4194308,4,t,o)},useInsertionEffect:function(t,o){return pm(4,2,t,o)},useMemo:function(t,o){var u=jo();return o=o===void 0?null:o,t=t(),u.memoizedState=[t,o],t},useReducer:function(t,o,u){var m=jo();return o=u!==void 0?u(o):o,m.memoizedState=m.baseState=o,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:o},m.queue=t,t=t.dispatch=tk.bind(null,Hn,t),[m.memoizedState,t]},useRef:function(t){var o=jo();return t={current:t},o.memoizedState=t},useState:Eb,useDebugValue:Mv,useDeferredValue:function(t){return jo().memoizedState=t},useTransition:function(){var t=Eb(!1),o=t[0];return t=ek.bind(null,t[1]),jo().memoizedState=t,[o,t]},useMutableSource:function(){},useSyncExternalStore:function(t,o,u){var m=Hn,v=jo();if(Fn){if(u===void 0)throw Error(tt(407));u=u()}else{if(u=o(),Ci===null)throw Error(tt(349));$l&30||vE(m,o,u)}v.memoizedState=u;var b={value:u,getSnapshot:o};return v.queue=b,Sb(wE.bind(null,m,b,t),[t]),m.flags|=2048,Qd(9,xE.bind(null,m,b,u,o),void 0,null),u},useId:function(){var t=jo(),o=Ci.identifierPrefix;if(Fn){var u=xs,m=vs;u=(m&~(1<<32-Eo(m)-1)).toString(32)+u,o=":"+o+"R"+u,u=Yd++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=QI++,o=":"+o+"r"+u.toString(32)+":";return t.memoizedState=o},unstable_isNewReconciler:!1},rk={readContext:Hr,useCallback:PE,useContext:Hr,useEffect:Cv,useImperativeHandle:AE,useInsertionEffect:SE,useLayoutEffect:CE,useMemo:IE,useReducer:wy,useRef:EE,useState:function(){return wy(Jd)},useDebugValue:Mv,useDeferredValue:function(t){var o=Kr();return kE(o,gi.memoizedState,t)},useTransition:function(){var t=wy(Jd)[0],o=Kr().memoizedState;return[t,o]},useMutableSource:_E,useSyncExternalStore:yE,useId:zE,unstable_isNewReconciler:!1},ok={readContext:Hr,useCallback:PE,useContext:Hr,useEffect:Cv,useImperativeHandle:AE,useInsertionEffect:SE,useLayoutEffect:CE,useMemo:IE,useReducer:by,useRef:EE,useState:function(){return by(Jd)},useDebugValue:Mv,useDeferredValue:function(t){var o=Kr();return gi===null?o.memoizedState=t:kE(o,gi.memoizedState,t)},useTransition:function(){var t=by(Jd)[0],o=Kr().memoizedState;return[t,o]},useMutableSource:_E,useSyncExternalStore:yE,useId:zE,unstable_isNewReconciler:!1};function Cu(t,o){try{var u="",m=o;do u+=DP(m),m=m.return;while(m);var v=u}catch(b){v=`
Error generating stack: `+b.message+`
`+b.stack}return{value:t,source:o,stack:v,digest:null}}function Ty(t,o,u){return{value:t,source:null,stack:u??null,digest:o??null}}function y0(t,o){try{console.error(o.value)}catch(u){setTimeout(function(){throw u})}}var sk=typeof WeakMap=="function"?WeakMap:Map;function BE(t,o,u){u=bs(-1,u),u.tag=3,u.payload={element:null};var m=o.value;return u.callback=function(){Um||(Um=!0,A0=m),y0(t,o)},u}function FE(t,o,u){u=bs(-1,u),u.tag=3;var m=t.type.getDerivedStateFromError;if(typeof m=="function"){var v=o.value;u.payload=function(){return m(v)},u.callback=function(){y0(t,o)}}var b=t.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(u.callback=function(){y0(t,o),typeof m!="function"&&(Ca===null?Ca=new Set([this]):Ca.add(this));var C=o.stack;this.componentDidCatch(o.value,{componentStack:C!==null?C:""})}),u}function Cb(t,o,u){var m=t.pingCache;if(m===null){m=t.pingCache=new sk;var v=new Set;m.set(o,v)}else v=m.get(o),v===void 0&&(v=new Set,m.set(o,v));v.has(u)||(v.add(u),t=xk.bind(null,t,o,u),o.then(t,t))}function Mb(t){do{var o;if((o=t.tag===13)&&(o=t.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return t;t=t.return}while(t!==null);return null}function Ab(t,o,u,m,v){return t.mode&1?(t.flags|=65536,t.lanes=v,t):(t===o?t.flags|=65536:(t.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(o=bs(-1,1),o.tag=2,Sa(u,o,1))),u.lanes|=1),t)}var ak=Is.ReactCurrentOwner,pr=!1;function Yi(t,o,u,m){o.child=t===null?mE(o,null,u,m):Eu(o,t.child,u,m)}function Pb(t,o,u,m,v){u=u.render;var b=o.ref;return vu(o,v),m=Ev(t,o,u,m,b,v),u=Sv(),t!==null&&!pr?(o.updateQueue=t.updateQueue,o.flags&=-2053,t.lanes&=~v,As(t,o,v)):(Fn&&u&&dv(o),o.flags|=1,Yi(t,o,m,v),o.child)}function Ib(t,o,u,m,v){if(t===null){var b=u.type;return typeof b=="function"&&!Rv(b)&&b.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(o.tag=15,o.type=b,OE(t,o,b,m,v)):(t=_m(u.type,null,m,o,o.mode,v),t.ref=o.ref,t.return=o,o.child=t)}if(b=t.child,!(t.lanes&v)){var C=b.memoizedProps;if(u=u.compare,u=u!==null?u:Zd,u(C,m)&&t.ref===o.ref)return As(t,o,v)}return o.flags|=1,t=Aa(b,m),t.ref=o.ref,t.return=o,o.child=t}function OE(t,o,u,m,v){if(t!==null){var b=t.memoizedProps;if(Zd(b,m)&&t.ref===o.ref)if(pr=!1,o.pendingProps=m=b,(t.lanes&v)!==0)t.flags&131072&&(pr=!0);else return o.lanes=t.lanes,As(t,o,v)}return v0(t,o,u,m,v)}function VE(t,o,u){var m=o.pendingProps,v=m.children,b=t!==null?t.memoizedState:null;if(m.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},An(uu,Cr),Cr|=u;else{if(!(u&1073741824))return t=b!==null?b.baseLanes|u:u,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:t,cachePool:null,transitions:null},o.updateQueue=null,An(uu,Cr),Cr|=t,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=b!==null?b.baseLanes:u,An(uu,Cr),Cr|=m}else b!==null?(m=b.baseLanes|u,o.memoizedState=null):m=u,An(uu,Cr),Cr|=m;return Yi(t,o,v,u),o.child}function UE(t,o){var u=o.ref;(t===null&&u!==null||t!==null&&t.ref!==u)&&(o.flags|=512,o.flags|=2097152)}function v0(t,o,u,m,v){var b=mr(u)?jl:$i.current;return b=bu(o,b),vu(o,v),u=Ev(t,o,u,m,b,v),m=Sv(),t!==null&&!pr?(o.updateQueue=t.updateQueue,o.flags&=-2053,t.lanes&=~v,As(t,o,v)):(Fn&&m&&dv(o),o.flags|=1,Yi(t,o,u,v),o.child)}function kb(t,o,u,m,v){if(mr(u)){var b=!0;Im(o)}else b=!1;if(vu(o,v),o.stateNode===null)fm(t,o),pE(o,u,m),_0(o,u,m,v),m=!0;else if(t===null){var C=o.stateNode,a=o.memoizedProps;C.props=a;var I=C.context,O=u.contextType;typeof O=="object"&&O!==null?O=Hr(O):(O=mr(u)?jl:$i.current,O=bu(o,O));var q=u.getDerivedStateFromProps,G=typeof q=="function"||typeof C.getSnapshotBeforeUpdate=="function";G||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(a!==m||I!==O)&&bb(o,C,m,O),ma=!1;var H=o.memoizedState;C.state=H,Rm(o,m,C,v),I=o.memoizedState,a!==m||H!==I||fr.current||ma?(typeof q=="function"&&(g0(o,u,q,m),I=o.memoizedState),(a=ma||wb(o,u,a,m,H,I,O))?(G||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(o.flags|=4194308)):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=I),C.props=m,C.state=I,C.context=O,m=a):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{C=o.stateNode,hE(t,o),a=o.memoizedProps,O=o.type===o.elementType?a:wo(o.type,a),C.props=O,G=o.pendingProps,H=C.context,I=u.contextType,typeof I=="object"&&I!==null?I=Hr(I):(I=mr(u)?jl:$i.current,I=bu(o,I));var ue=u.getDerivedStateFromProps;(q=typeof ue=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(a!==G||H!==I)&&bb(o,C,m,I),ma=!1,H=o.memoizedState,C.state=H,Rm(o,m,C,v);var _e=o.memoizedState;a!==G||H!==_e||fr.current||ma?(typeof ue=="function"&&(g0(o,u,ue,m),_e=o.memoizedState),(O=ma||wb(o,u,O,m,H,_e,I)||!1)?(q||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(m,_e,I),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(m,_e,I)),typeof C.componentDidUpdate=="function"&&(o.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof C.componentDidUpdate!="function"||a===t.memoizedProps&&H===t.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&H===t.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=_e),C.props=m,C.state=_e,C.context=I,m=O):(typeof C.componentDidUpdate!="function"||a===t.memoizedProps&&H===t.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&H===t.memoizedState||(o.flags|=1024),m=!1)}return x0(t,o,u,m,b,v)}function x0(t,o,u,m,v,b){UE(t,o);var C=(o.flags&128)!==0;if(!m&&!C)return v&&gb(o,u,!1),As(t,o,b);m=o.stateNode,ak.current=o;var a=C&&typeof u.getDerivedStateFromError!="function"?null:m.render();return o.flags|=1,t!==null&&C?(o.child=Eu(o,t.child,null,b),o.child=Eu(o,null,a,b)):Yi(t,o,a,b),o.memoizedState=m.state,v&&gb(o,u,!0),o.child}function NE(t){var o=t.stateNode;o.pendingContext?mb(t,o.pendingContext,o.pendingContext!==o.context):o.context&&mb(t,o.context,!1),xv(t,o.containerInfo)}function zb(t,o,u,m,v){return Tu(),fv(v),o.flags|=256,Yi(t,o,u,m),o.child}var w0={dehydrated:null,treeContext:null,retryLane:0};function b0(t){return{baseLanes:t,cachePool:null,transitions:null}}function jE(t,o,u){var m=o.pendingProps,v=Wn.current,b=!1,C=(o.flags&128)!==0,a;if((a=C)||(a=t!==null&&t.memoizedState===null?!1:(v&2)!==0),a?(b=!0,o.flags&=-129):(t===null||t.memoizedState!==null)&&(v|=1),An(Wn,v&1),t===null)return f0(o),t=o.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(o.mode&1?t.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(C=m.children,t=m.fallback,b?(m=o.mode,b=o.child,C={mode:"hidden",children:C},!(m&1)&&b!==null?(b.childLanes=0,b.pendingProps=C):b=ug(C,m,0,null),t=Nl(t,m,u,null),b.return=o,t.return=o,b.sibling=t,o.child=b,o.child.memoizedState=b0(u),o.memoizedState=w0,t):Av(o,C));if(v=t.memoizedState,v!==null&&(a=v.dehydrated,a!==null))return lk(t,o,C,m,a,v,u);if(b){b=m.fallback,C=o.mode,v=t.child,a=v.sibling;var I={mode:"hidden",children:m.children};return!(C&1)&&o.child!==v?(m=o.child,m.childLanes=0,m.pendingProps=I,o.deletions=null):(m=Aa(v,I),m.subtreeFlags=v.subtreeFlags&14680064),a!==null?b=Aa(a,b):(b=Nl(b,C,u,null),b.flags|=2),b.return=o,m.return=o,m.sibling=b,o.child=m,m=b,b=o.child,C=t.child.memoizedState,C=C===null?b0(u):{baseLanes:C.baseLanes|u,cachePool:null,transitions:C.transitions},b.memoizedState=C,b.childLanes=t.childLanes&~u,o.memoizedState=w0,m}return b=t.child,t=b.sibling,m=Aa(b,{mode:"visible",children:m.children}),!(o.mode&1)&&(m.lanes=u),m.return=o,m.sibling=null,t!==null&&(u=o.deletions,u===null?(o.deletions=[t],o.flags|=16):u.push(t)),o.child=m,o.memoizedState=null,m}function Av(t,o){return o=ug({mode:"visible",children:o},t.mode,0,null),o.return=t,t.child=o}function Jf(t,o,u,m){return m!==null&&fv(m),Eu(o,t.child,null,u),t=Av(o,o.pendingProps.children),t.flags|=2,o.memoizedState=null,t}function lk(t,o,u,m,v,b,C){if(u)return o.flags&256?(o.flags&=-257,m=Ty(Error(tt(422))),Jf(t,o,C,m)):o.memoizedState!==null?(o.child=t.child,o.flags|=128,null):(b=m.fallback,v=o.mode,m=ug({mode:"visible",children:m.children},v,0,null),b=Nl(b,v,C,null),b.flags|=2,m.return=o,b.return=o,m.sibling=b,o.child=m,o.mode&1&&Eu(o,t.child,null,C),o.child.memoizedState=b0(C),o.memoizedState=w0,b);if(!(o.mode&1))return Jf(t,o,C,null);if(v.data==="$!"){if(m=v.nextSibling&&v.nextSibling.dataset,m)var a=m.dgst;return m=a,b=Error(tt(419)),m=Ty(b,m,void 0),Jf(t,o,C,m)}if(a=(C&t.childLanes)!==0,pr||a){if(m=Ci,m!==null){switch(C&-C){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=v&(m.suspendedLanes|C)?0:v,v!==0&&v!==b.retryLane&&(b.retryLane=v,Ms(t,v),So(m,t,v,-1))}return Lv(),m=Ty(Error(tt(421))),Jf(t,o,C,m)}return v.data==="$?"?(o.flags|=128,o.child=t.child,o=wk.bind(null,t),v._reactRetry=o,null):(t=b.treeContext,Mr=Ea(v.nextSibling),Ar=o,Fn=!0,To=null,t!==null&&(Zr[qr++]=vs,Zr[qr++]=xs,Zr[qr++]=Gl,vs=t.id,xs=t.overflow,Gl=o),o=Av(o,m.children),o.flags|=4096,o)}function Db(t,o,u){t.lanes|=o;var m=t.alternate;m!==null&&(m.lanes|=o),m0(t.return,o,u)}function Ey(t,o,u,m,v){var b=t.memoizedState;b===null?t.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:v}:(b.isBackwards=o,b.rendering=null,b.renderingStartTime=0,b.last=m,b.tail=u,b.tailMode=v)}function GE(t,o,u){var m=o.pendingProps,v=m.revealOrder,b=m.tail;if(Yi(t,o,m.children,u),m=Wn.current,m&2)m=m&1|2,o.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=o.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Db(t,u,o);else if(t.tag===19)Db(t,u,o);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===o)break e;for(;t.sibling===null;){if(t.return===null||t.return===o)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}m&=1}if(An(Wn,m),!(o.mode&1))o.memoizedState=null;else switch(v){case"forwards":for(u=o.child,v=null;u!==null;)t=u.alternate,t!==null&&Bm(t)===null&&(v=u),u=u.sibling;u=v,u===null?(v=o.child,o.child=null):(v=u.sibling,u.sibling=null),Ey(o,!1,v,u,b);break;case"backwards":for(u=null,v=o.child,o.child=null;v!==null;){if(t=v.alternate,t!==null&&Bm(t)===null){o.child=v;break}t=v.sibling,v.sibling=u,u=v,v=t}Ey(o,!0,u,null,b);break;case"together":Ey(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function fm(t,o){!(o.mode&1)&&t!==null&&(t.alternate=null,o.alternate=null,o.flags|=2)}function As(t,o,u){if(t!==null&&(o.dependencies=t.dependencies),Zl|=o.lanes,!(u&o.childLanes))return null;if(t!==null&&o.child!==t.child)throw Error(tt(153));if(o.child!==null){for(t=o.child,u=Aa(t,t.pendingProps),o.child=u,u.return=o;t.sibling!==null;)t=t.sibling,u=u.sibling=Aa(t,t.pendingProps),u.return=o;u.sibling=null}return o.child}function ck(t,o,u){switch(o.tag){case 3:NE(o),Tu();break;case 5:gE(o);break;case 1:mr(o.type)&&Im(o);break;case 4:xv(o,o.stateNode.containerInfo);break;case 10:var m=o.type._context,v=o.memoizedProps.value;An(Dm,m._currentValue),m._currentValue=v;break;case 13:if(m=o.memoizedState,m!==null)return m.dehydrated!==null?(An(Wn,Wn.current&1),o.flags|=128,null):u&o.child.childLanes?jE(t,o,u):(An(Wn,Wn.current&1),t=As(t,o,u),t!==null?t.sibling:null);An(Wn,Wn.current&1);break;case 19:if(m=(u&o.childLanes)!==0,t.flags&128){if(m)return GE(t,o,u);o.flags|=128}if(v=o.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),An(Wn,Wn.current),m)break;return null;case 22:case 23:return o.lanes=0,VE(t,o,u)}return As(t,o,u)}var $E,T0,ZE,qE;$E=function(t,o){for(var u=o.child;u!==null;){if(u.tag===5||u.tag===6)t.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};T0=function(){};ZE=function(t,o,u,m){var v=t.memoizedProps;if(v!==m){t=o.stateNode,Ol(qo.current);var b=null;switch(u){case"input":v=Zy(t,v),m=Zy(t,m),b=[];break;case"select":v=Kn({},v,{value:void 0}),m=Kn({},m,{value:void 0}),b=[];break;case"textarea":v=Xy(t,v),m=Xy(t,m),b=[];break;default:typeof v.onClick!="function"&&typeof m.onClick=="function"&&(t.onclick=Am)}Ky(u,m);var C;u=null;for(O in v)if(!m.hasOwnProperty(O)&&v.hasOwnProperty(O)&&v[O]!=null)if(O==="style"){var a=v[O];for(C in a)a.hasOwnProperty(C)&&(u||(u={}),u[C]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(Od.hasOwnProperty(O)?b||(b=[]):(b=b||[]).push(O,null));for(O in m){var I=m[O];if(a=v!=null?v[O]:void 0,m.hasOwnProperty(O)&&I!==a&&(I!=null||a!=null))if(O==="style")if(a){for(C in a)!a.hasOwnProperty(C)||I&&I.hasOwnProperty(C)||(u||(u={}),u[C]="");for(C in I)I.hasOwnProperty(C)&&a[C]!==I[C]&&(u||(u={}),u[C]=I[C])}else u||(b||(b=[]),b.push(O,u)),u=I;else O==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,a=a?a.__html:void 0,I!=null&&a!==I&&(b=b||[]).push(O,I)):O==="children"?typeof I!="string"&&typeof I!="number"||(b=b||[]).push(O,""+I):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(Od.hasOwnProperty(O)?(I!=null&&O==="onScroll"&&kn("scroll",t),b||a===I||(b=[])):(b=b||[]).push(O,I))}u&&(b=b||[]).push("style",u);var O=b;(o.updateQueue=O)&&(o.flags|=4)}};qE=function(t,o,u,m){u!==m&&(o.flags|=4)};function gd(t,o){if(!Fn)switch(t.tailMode){case"hidden":o=t.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?t.tail=null:u.sibling=null;break;case"collapsed":u=t.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?o||t.tail===null?t.tail=null:t.tail.sibling=null:m.sibling=null}}function ji(t){var o=t.alternate!==null&&t.alternate.child===t.child,u=0,m=0;if(o)for(var v=t.child;v!==null;)u|=v.lanes|v.childLanes,m|=v.subtreeFlags&14680064,m|=v.flags&14680064,v.return=t,v=v.sibling;else for(v=t.child;v!==null;)u|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=t,v=v.sibling;return t.subtreeFlags|=m,t.childLanes=u,o}function uk(t,o,u){var m=o.pendingProps;switch(pv(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ji(o),null;case 1:return mr(o.type)&&Pm(),ji(o),null;case 3:return m=o.stateNode,Su(),zn(fr),zn($i),bv(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(t===null||t.child===null)&&(Kf(o)?o.flags|=4:t===null||t.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,To!==null&&(k0(To),To=null))),T0(t,o),ji(o),null;case 5:wv(o);var v=Ol(Kd.current);if(u=o.type,t!==null&&o.stateNode!=null)ZE(t,o,u,m,v),t.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!m){if(o.stateNode===null)throw Error(tt(166));return ji(o),null}if(t=Ol(qo.current),Kf(o)){m=o.stateNode,u=o.type;var b=o.memoizedProps;switch(m[$o]=o,m[Xd]=b,t=(o.mode&1)!==0,u){case"dialog":kn("cancel",m),kn("close",m);break;case"iframe":case"object":case"embed":kn("load",m);break;case"video":case"audio":for(v=0;v<Td.length;v++)kn(Td[v],m);break;case"source":kn("error",m);break;case"img":case"image":case"link":kn("error",m),kn("load",m);break;case"details":kn("toggle",m);break;case"input":jw(m,b),kn("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!b.multiple},kn("invalid",m);break;case"textarea":$w(m,b),kn("invalid",m)}Ky(u,b),v=null;for(var C in b)if(b.hasOwnProperty(C)){var a=b[C];C==="children"?typeof a=="string"?m.textContent!==a&&(b.suppressHydrationWarning!==!0&&Hf(m.textContent,a,t),v=["children",a]):typeof a=="number"&&m.textContent!==""+a&&(b.suppressHydrationWarning!==!0&&Hf(m.textContent,a,t),v=["children",""+a]):Od.hasOwnProperty(C)&&a!=null&&C==="onScroll"&&kn("scroll",m)}switch(u){case"input":Nf(m),Gw(m,b,!0);break;case"textarea":Nf(m),Zw(m);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(m.onclick=Am)}m=v,o.updateQueue=m,m!==null&&(o.flags|=4)}else{C=v.nodeType===9?v:v.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=v2(u)),t==="http://www.w3.org/1999/xhtml"?u==="script"?(t=C.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof m.is=="string"?t=C.createElement(u,{is:m.is}):(t=C.createElement(u),u==="select"&&(C=t,m.multiple?C.multiple=!0:m.size&&(C.size=m.size))):t=C.createElementNS(t,u),t[$o]=o,t[Xd]=m,$E(t,o,!1,!1),o.stateNode=t;e:{switch(C=Yy(u,m),u){case"dialog":kn("cancel",t),kn("close",t),v=m;break;case"iframe":case"object":case"embed":kn("load",t),v=m;break;case"video":case"audio":for(v=0;v<Td.length;v++)kn(Td[v],t);v=m;break;case"source":kn("error",t),v=m;break;case"img":case"image":case"link":kn("error",t),kn("load",t),v=m;break;case"details":kn("toggle",t),v=m;break;case"input":jw(t,m),v=Zy(t,m),kn("invalid",t);break;case"option":v=m;break;case"select":t._wrapperState={wasMultiple:!!m.multiple},v=Kn({},m,{value:void 0}),kn("invalid",t);break;case"textarea":$w(t,m),v=Xy(t,m),kn("invalid",t);break;default:v=m}Ky(u,v),a=v;for(b in a)if(a.hasOwnProperty(b)){var I=a[b];b==="style"?b2(t,I):b==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,I!=null&&x2(t,I)):b==="children"?typeof I=="string"?(u!=="textarea"||I!=="")&&Vd(t,I):typeof I=="number"&&Vd(t,""+I):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(Od.hasOwnProperty(b)?I!=null&&b==="onScroll"&&kn("scroll",t):I!=null&&J0(t,b,I,C))}switch(u){case"input":Nf(t),Gw(t,m,!1);break;case"textarea":Nf(t),Zw(t);break;case"option":m.value!=null&&t.setAttribute("value",""+ka(m.value));break;case"select":t.multiple=!!m.multiple,b=m.value,b!=null?mu(t,!!m.multiple,b,!1):m.defaultValue!=null&&mu(t,!!m.multiple,m.defaultValue,!0);break;default:typeof v.onClick=="function"&&(t.onclick=Am)}switch(u){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return ji(o),null;case 6:if(t&&o.stateNode!=null)qE(t,o,t.memoizedProps,m);else{if(typeof m!="string"&&o.stateNode===null)throw Error(tt(166));if(u=Ol(Kd.current),Ol(qo.current),Kf(o)){if(m=o.stateNode,u=o.memoizedProps,m[$o]=o,(b=m.nodeValue!==u)&&(t=Ar,t!==null))switch(t.tag){case 3:Hf(m.nodeValue,u,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Hf(m.nodeValue,u,(t.mode&1)!==0)}b&&(o.flags|=4)}else m=(u.nodeType===9?u:u.ownerDocument).createTextNode(m),m[$o]=o,o.stateNode=m}return ji(o),null;case 13:if(zn(Wn),m=o.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Fn&&Mr!==null&&o.mode&1&&!(o.flags&128))cE(),Tu(),o.flags|=98560,b=!1;else if(b=Kf(o),m!==null&&m.dehydrated!==null){if(t===null){if(!b)throw Error(tt(318));if(b=o.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(tt(317));b[$o]=o}else Tu(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;ji(o),b=!1}else To!==null&&(k0(To),To=null),b=!0;if(!b)return o.flags&65536?o:null}return o.flags&128?(o.lanes=u,o):(m=m!==null,m!==(t!==null&&t.memoizedState!==null)&&m&&(o.child.flags|=8192,o.mode&1&&(t===null||Wn.current&1?_i===0&&(_i=3):Lv())),o.updateQueue!==null&&(o.flags|=4),ji(o),null);case 4:return Su(),T0(t,o),t===null&&qd(o.stateNode.containerInfo),ji(o),null;case 10:return _v(o.type._context),ji(o),null;case 17:return mr(o.type)&&Pm(),ji(o),null;case 19:if(zn(Wn),b=o.memoizedState,b===null)return ji(o),null;if(m=(o.flags&128)!==0,C=b.rendering,C===null)if(m)gd(b,!1);else{if(_i!==0||t!==null&&t.flags&128)for(t=o.child;t!==null;){if(C=Bm(t),C!==null){for(o.flags|=128,gd(b,!1),m=C.updateQueue,m!==null&&(o.updateQueue=m,o.flags|=4),o.subtreeFlags=0,m=u,u=o.child;u!==null;)b=u,t=m,b.flags&=14680066,C=b.alternate,C===null?(b.childLanes=0,b.lanes=t,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=C.childLanes,b.lanes=C.lanes,b.child=C.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=C.memoizedProps,b.memoizedState=C.memoizedState,b.updateQueue=C.updateQueue,b.type=C.type,t=C.dependencies,b.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),u=u.sibling;return An(Wn,Wn.current&1|2),o.child}t=t.sibling}b.tail!==null&&ni()>Mu&&(o.flags|=128,m=!0,gd(b,!1),o.lanes=4194304)}else{if(!m)if(t=Bm(C),t!==null){if(o.flags|=128,m=!0,u=t.updateQueue,u!==null&&(o.updateQueue=u,o.flags|=4),gd(b,!0),b.tail===null&&b.tailMode==="hidden"&&!C.alternate&&!Fn)return ji(o),null}else 2*ni()-b.renderingStartTime>Mu&&u!==1073741824&&(o.flags|=128,m=!0,gd(b,!1),o.lanes=4194304);b.isBackwards?(C.sibling=o.child,o.child=C):(u=b.last,u!==null?u.sibling=C:o.child=C,b.last=C)}return b.tail!==null?(o=b.tail,b.rendering=o,b.tail=o.sibling,b.renderingStartTime=ni(),o.sibling=null,u=Wn.current,An(Wn,m?u&1|2:u&1),o):(ji(o),null);case 22:case 23:return Dv(),m=o.memoizedState!==null,t!==null&&t.memoizedState!==null!==m&&(o.flags|=8192),m&&o.mode&1?Cr&1073741824&&(ji(o),o.subtreeFlags&6&&(o.flags|=8192)):ji(o),null;case 24:return null;case 25:return null}throw Error(tt(156,o.tag))}function hk(t,o){switch(pv(o),o.tag){case 1:return mr(o.type)&&Pm(),t=o.flags,t&65536?(o.flags=t&-65537|128,o):null;case 3:return Su(),zn(fr),zn($i),bv(),t=o.flags,t&65536&&!(t&128)?(o.flags=t&-65537|128,o):null;case 5:return wv(o),null;case 13:if(zn(Wn),t=o.memoizedState,t!==null&&t.dehydrated!==null){if(o.alternate===null)throw Error(tt(340));Tu()}return t=o.flags,t&65536?(o.flags=t&-65537|128,o):null;case 19:return zn(Wn),null;case 4:return Su(),null;case 10:return _v(o.type._context),null;case 22:case 23:return Dv(),null;case 24:return null;default:return null}}var Qf=!1,Gi=!1,dk=typeof WeakSet=="function"?WeakSet:Set,_t=null;function cu(t,o){var u=t.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(m){Qn(t,o,m)}else u.current=null}function E0(t,o,u){try{u()}catch(m){Qn(t,o,m)}}var Lb=!1;function pk(t,o){if(a0=Sm,t=K2(),hv(t)){if("selectionStart"in t)var u={start:t.selectionStart,end:t.selectionEnd};else e:{u=(u=t.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var v=m.anchorOffset,b=m.focusNode;m=m.focusOffset;try{u.nodeType,b.nodeType}catch{u=null;break e}var C=0,a=-1,I=-1,O=0,q=0,G=t,H=null;t:for(;;){for(var ue;G!==u||v!==0&&G.nodeType!==3||(a=C+v),G!==b||m!==0&&G.nodeType!==3||(I=C+m),G.nodeType===3&&(C+=G.nodeValue.length),(ue=G.firstChild)!==null;)H=G,G=ue;for(;;){if(G===t)break t;if(H===u&&++O===v&&(a=C),H===b&&++q===m&&(I=C),(ue=G.nextSibling)!==null)break;G=H,H=G.parentNode}G=ue}u=a===-1||I===-1?null:{start:a,end:I}}else u=null}u=u||{start:0,end:0}}else u=null;for(l0={focusedElem:t,selectionRange:u},Sm=!1,_t=o;_t!==null;)if(o=_t,t=o.child,(o.subtreeFlags&1028)!==0&&t!==null)t.return=o,_t=t;else for(;_t!==null;){o=_t;try{var _e=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(_e!==null){var Ie=_e.memoizedProps,at=_e.memoizedState,me=o.stateNode,ne=me.getSnapshotBeforeUpdate(o.elementType===o.type?Ie:wo(o.type,Ie),at);me.__reactInternalSnapshotBeforeUpdate=ne}break;case 3:var le=o.stateNode.containerInfo;le.nodeType===1?le.textContent="":le.nodeType===9&&le.documentElement&&le.removeChild(le.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(tt(163))}}catch(ke){Qn(o,o.return,ke)}if(t=o.sibling,t!==null){t.return=o.return,_t=t;break}_t=o.return}return _e=Lb,Lb=!1,_e}function kd(t,o,u){var m=o.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var v=m=m.next;do{if((v.tag&t)===t){var b=v.destroy;v.destroy=void 0,b!==void 0&&E0(o,u,b)}v=v.next}while(v!==m)}}function lg(t,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&t)===t){var m=u.create;u.destroy=m()}u=u.next}while(u!==o)}}function S0(t){var o=t.ref;if(o!==null){var u=t.stateNode;switch(t.tag){case 5:t=u;break;default:t=u}typeof o=="function"?o(t):o.current=t}}function WE(t){var o=t.alternate;o!==null&&(t.alternate=null,WE(o)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(o=t.stateNode,o!==null&&(delete o[$o],delete o[Xd],delete o[h0],delete o[HI],delete o[KI])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function XE(t){return t.tag===5||t.tag===3||t.tag===4}function Rb(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||XE(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function C0(t,o,u){var m=t.tag;if(m===5||m===6)t=t.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(t,o):u.insertBefore(t,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(t,u)):(o=u,o.appendChild(t)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=Am));else if(m!==4&&(t=t.child,t!==null))for(C0(t,o,u),t=t.sibling;t!==null;)C0(t,o,u),t=t.sibling}function M0(t,o,u){var m=t.tag;if(m===5||m===6)t=t.stateNode,o?u.insertBefore(t,o):u.appendChild(t);else if(m!==4&&(t=t.child,t!==null))for(M0(t,o,u),t=t.sibling;t!==null;)M0(t,o,u),t=t.sibling}var Ii=null,bo=!1;function da(t,o,u){for(u=u.child;u!==null;)HE(t,o,u),u=u.sibling}function HE(t,o,u){if(Zo&&typeof Zo.onCommitFiberUnmount=="function")try{Zo.onCommitFiberUnmount(eg,u)}catch{}switch(u.tag){case 5:Gi||cu(u,o);case 6:var m=Ii,v=bo;Ii=null,da(t,o,u),Ii=m,bo=v,Ii!==null&&(bo?(t=Ii,u=u.stateNode,t.nodeType===8?t.parentNode.removeChild(u):t.removeChild(u)):Ii.removeChild(u.stateNode));break;case 18:Ii!==null&&(bo?(t=Ii,u=u.stateNode,t.nodeType===8?_y(t.parentNode,u):t.nodeType===1&&_y(t,u),Gd(t)):_y(Ii,u.stateNode));break;case 4:m=Ii,v=bo,Ii=u.stateNode.containerInfo,bo=!0,da(t,o,u),Ii=m,bo=v;break;case 0:case 11:case 14:case 15:if(!Gi&&(m=u.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){v=m=m.next;do{var b=v,C=b.destroy;b=b.tag,C!==void 0&&(b&2||b&4)&&E0(u,o,C),v=v.next}while(v!==m)}da(t,o,u);break;case 1:if(!Gi&&(cu(u,o),m=u.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=u.memoizedProps,m.state=u.memoizedState,m.componentWillUnmount()}catch(a){Qn(u,o,a)}da(t,o,u);break;case 21:da(t,o,u);break;case 22:u.mode&1?(Gi=(m=Gi)||u.memoizedState!==null,da(t,o,u),Gi=m):da(t,o,u);break;default:da(t,o,u)}}function Bb(t){var o=t.updateQueue;if(o!==null){t.updateQueue=null;var u=t.stateNode;u===null&&(u=t.stateNode=new dk),o.forEach(function(m){var v=bk.bind(null,t,m);u.has(m)||(u.add(m),m.then(v,v))})}}function xo(t,o){var u=o.deletions;if(u!==null)for(var m=0;m<u.length;m++){var v=u[m];try{var b=t,C=o,a=C;e:for(;a!==null;){switch(a.tag){case 5:Ii=a.stateNode,bo=!1;break e;case 3:Ii=a.stateNode.containerInfo,bo=!0;break e;case 4:Ii=a.stateNode.containerInfo,bo=!0;break e}a=a.return}if(Ii===null)throw Error(tt(160));HE(b,C,v),Ii=null,bo=!1;var I=v.alternate;I!==null&&(I.return=null),v.return=null}catch(O){Qn(v,o,O)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)KE(o,t),o=o.sibling}function KE(t,o){var u=t.alternate,m=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(xo(o,t),No(t),m&4){try{kd(3,t,t.return),lg(3,t)}catch(Ie){Qn(t,t.return,Ie)}try{kd(5,t,t.return)}catch(Ie){Qn(t,t.return,Ie)}}break;case 1:xo(o,t),No(t),m&512&&u!==null&&cu(u,u.return);break;case 5:if(xo(o,t),No(t),m&512&&u!==null&&cu(u,u.return),t.flags&32){var v=t.stateNode;try{Vd(v,"")}catch(Ie){Qn(t,t.return,Ie)}}if(m&4&&(v=t.stateNode,v!=null)){var b=t.memoizedProps,C=u!==null?u.memoizedProps:b,a=t.type,I=t.updateQueue;if(t.updateQueue=null,I!==null)try{a==="input"&&b.type==="radio"&&b.name!=null&&_2(v,b),Yy(a,C);var O=Yy(a,b);for(C=0;C<I.length;C+=2){var q=I[C],G=I[C+1];q==="style"?b2(v,G):q==="dangerouslySetInnerHTML"?x2(v,G):q==="children"?Vd(v,G):J0(v,q,G,O)}switch(a){case"input":qy(v,b);break;case"textarea":y2(v,b);break;case"select":var H=v._wrapperState.wasMultiple;v._wrapperState.wasMultiple=!!b.multiple;var ue=b.value;ue!=null?mu(v,!!b.multiple,ue,!1):H!==!!b.multiple&&(b.defaultValue!=null?mu(v,!!b.multiple,b.defaultValue,!0):mu(v,!!b.multiple,b.multiple?[]:"",!1))}v[Xd]=b}catch(Ie){Qn(t,t.return,Ie)}}break;case 6:if(xo(o,t),No(t),m&4){if(t.stateNode===null)throw Error(tt(162));v=t.stateNode,b=t.memoizedProps;try{v.nodeValue=b}catch(Ie){Qn(t,t.return,Ie)}}break;case 3:if(xo(o,t),No(t),m&4&&u!==null&&u.memoizedState.isDehydrated)try{Gd(o.containerInfo)}catch(Ie){Qn(t,t.return,Ie)}break;case 4:xo(o,t),No(t);break;case 13:xo(o,t),No(t),v=t.child,v.flags&8192&&(b=v.memoizedState!==null,v.stateNode.isHidden=b,!b||v.alternate!==null&&v.alternate.memoizedState!==null||(kv=ni())),m&4&&Bb(t);break;case 22:if(q=u!==null&&u.memoizedState!==null,t.mode&1?(Gi=(O=Gi)||q,xo(o,t),Gi=O):xo(o,t),No(t),m&8192){if(O=t.memoizedState!==null,(t.stateNode.isHidden=O)&&!q&&t.mode&1)for(_t=t,q=t.child;q!==null;){for(G=_t=q;_t!==null;){switch(H=_t,ue=H.child,H.tag){case 0:case 11:case 14:case 15:kd(4,H,H.return);break;case 1:cu(H,H.return);var _e=H.stateNode;if(typeof _e.componentWillUnmount=="function"){m=H,u=H.return;try{o=m,_e.props=o.memoizedProps,_e.state=o.memoizedState,_e.componentWillUnmount()}catch(Ie){Qn(m,u,Ie)}}break;case 5:cu(H,H.return);break;case 22:if(H.memoizedState!==null){Ob(G);continue}}ue!==null?(ue.return=H,_t=ue):Ob(G)}q=q.sibling}e:for(q=null,G=t;;){if(G.tag===5){if(q===null){q=G;try{v=G.stateNode,O?(b=v.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(a=G.stateNode,I=G.memoizedProps.style,C=I!=null&&I.hasOwnProperty("display")?I.display:null,a.style.display=w2("display",C))}catch(Ie){Qn(t,t.return,Ie)}}}else if(G.tag===6){if(q===null)try{G.stateNode.nodeValue=O?"":G.memoizedProps}catch(Ie){Qn(t,t.return,Ie)}}else if((G.tag!==22&&G.tag!==23||G.memoizedState===null||G===t)&&G.child!==null){G.child.return=G,G=G.child;continue}if(G===t)break e;for(;G.sibling===null;){if(G.return===null||G.return===t)break e;q===G&&(q=null),G=G.return}q===G&&(q=null),G.sibling.return=G.return,G=G.sibling}}break;case 19:xo(o,t),No(t),m&4&&Bb(t);break;case 21:break;default:xo(o,t),No(t)}}function No(t){var o=t.flags;if(o&2){try{e:{for(var u=t.return;u!==null;){if(XE(u)){var m=u;break e}u=u.return}throw Error(tt(160))}switch(m.tag){case 5:var v=m.stateNode;m.flags&32&&(Vd(v,""),m.flags&=-33);var b=Rb(t);M0(t,b,v);break;case 3:case 4:var C=m.stateNode.containerInfo,a=Rb(t);C0(t,a,C);break;default:throw Error(tt(161))}}catch(I){Qn(t,t.return,I)}t.flags&=-3}o&4096&&(t.flags&=-4097)}function fk(t,o,u){_t=t,YE(t)}function YE(t,o,u){for(var m=(t.mode&1)!==0;_t!==null;){var v=_t,b=v.child;if(v.tag===22&&m){var C=v.memoizedState!==null||Qf;if(!C){var a=v.alternate,I=a!==null&&a.memoizedState!==null||Gi;a=Qf;var O=Gi;if(Qf=C,(Gi=I)&&!O)for(_t=v;_t!==null;)C=_t,I=C.child,C.tag===22&&C.memoizedState!==null?Vb(v):I!==null?(I.return=C,_t=I):Vb(v);for(;b!==null;)_t=b,YE(b),b=b.sibling;_t=v,Qf=a,Gi=O}Fb(t)}else v.subtreeFlags&8772&&b!==null?(b.return=v,_t=b):Fb(t)}}function Fb(t){for(;_t!==null;){var o=_t;if(o.flags&8772){var u=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Gi||lg(5,o);break;case 1:var m=o.stateNode;if(o.flags&4&&!Gi)if(u===null)m.componentDidMount();else{var v=o.elementType===o.type?u.memoizedProps:wo(o.type,u.memoizedProps);m.componentDidUpdate(v,u.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var b=o.updateQueue;b!==null&&xb(o,b,m);break;case 3:var C=o.updateQueue;if(C!==null){if(u=null,o.child!==null)switch(o.child.tag){case 5:u=o.child.stateNode;break;case 1:u=o.child.stateNode}xb(o,C,u)}break;case 5:var a=o.stateNode;if(u===null&&o.flags&4){u=a;var I=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":I.autoFocus&&u.focus();break;case"img":I.src&&(u.src=I.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var O=o.alternate;if(O!==null){var q=O.memoizedState;if(q!==null){var G=q.dehydrated;G!==null&&Gd(G)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(tt(163))}Gi||o.flags&512&&S0(o)}catch(H){Qn(o,o.return,H)}}if(o===t){_t=null;break}if(u=o.sibling,u!==null){u.return=o.return,_t=u;break}_t=o.return}}function Ob(t){for(;_t!==null;){var o=_t;if(o===t){_t=null;break}var u=o.sibling;if(u!==null){u.return=o.return,_t=u;break}_t=o.return}}function Vb(t){for(;_t!==null;){var o=_t;try{switch(o.tag){case 0:case 11:case 15:var u=o.return;try{lg(4,o)}catch(I){Qn(o,u,I)}break;case 1:var m=o.stateNode;if(typeof m.componentDidMount=="function"){var v=o.return;try{m.componentDidMount()}catch(I){Qn(o,v,I)}}var b=o.return;try{S0(o)}catch(I){Qn(o,b,I)}break;case 5:var C=o.return;try{S0(o)}catch(I){Qn(o,C,I)}}}catch(I){Qn(o,o.return,I)}if(o===t){_t=null;break}var a=o.sibling;if(a!==null){a.return=o.return,_t=a;break}_t=o.return}}var mk=Math.ceil,Vm=Is.ReactCurrentDispatcher,Pv=Is.ReactCurrentOwner,Xr=Is.ReactCurrentBatchConfig,tn=0,Ci=null,hi=null,ki=0,Cr=0,uu=Ba(0),_i=0,ep=null,Zl=0,cg=0,Iv=0,zd=null,dr=null,kv=0,Mu=1/0,gs=null,Um=!1,A0=null,Ca=null,em=!1,xa=null,Nm=0,Dd=0,P0=null,mm=-1,gm=0;function Ji(){return tn&6?ni():mm!==-1?mm:mm=ni()}function Ma(t){return t.mode&1?tn&2&&ki!==0?ki&-ki:JI.transition!==null?(gm===0&&(gm=L2()),gm):(t=yn,t!==0||(t=window.event,t=t===void 0?16:N2(t.type)),t):1}function So(t,o,u,m){if(50<Dd)throw Dd=0,P0=null,Error(tt(185));op(t,u,m),(!(tn&2)||t!==Ci)&&(t===Ci&&(!(tn&2)&&(cg|=u),_i===4&&ya(t,ki)),gr(t,m),u===1&&tn===0&&!(o.mode&1)&&(Mu=ni()+500,og&&Fa()))}function gr(t,o){var u=t.callbackNode;JP(t,o);var m=Em(t,t===Ci?ki:0);if(m===0)u!==null&&Xw(u),t.callbackNode=null,t.callbackPriority=0;else if(o=m&-m,t.callbackPriority!==o){if(u!=null&&Xw(u),o===1)t.tag===0?YI(Ub.bind(null,t)):sE(Ub.bind(null,t)),WI(function(){!(tn&6)&&Fa()}),u=null;else{switch(R2(m)){case 1:u=iv;break;case 4:u=z2;break;case 16:u=Tm;break;case 536870912:u=D2;break;default:u=Tm}u=oS(u,JE.bind(null,t))}t.callbackPriority=o,t.callbackNode=u}}function JE(t,o){if(mm=-1,gm=0,tn&6)throw Error(tt(327));var u=t.callbackNode;if(xu()&&t.callbackNode!==u)return null;var m=Em(t,t===Ci?ki:0);if(m===0)return null;if(m&30||m&t.expiredLanes||o)o=jm(t,m);else{o=m;var v=tn;tn|=2;var b=eS();(Ci!==t||ki!==o)&&(gs=null,Mu=ni()+500,Ul(t,o));do try{yk();break}catch(a){QE(t,a)}while(1);gv(),Vm.current=b,tn=v,hi!==null?o=0:(Ci=null,ki=0,o=_i)}if(o!==0){if(o===2&&(v=n0(t),v!==0&&(m=v,o=I0(t,v))),o===1)throw u=ep,Ul(t,0),ya(t,m),gr(t,ni()),u;if(o===6)ya(t,m);else{if(v=t.current.alternate,!(m&30)&&!gk(v)&&(o=jm(t,m),o===2&&(b=n0(t),b!==0&&(m=b,o=I0(t,b))),o===1))throw u=ep,Ul(t,0),ya(t,m),gr(t,ni()),u;switch(t.finishedWork=v,t.finishedLanes=m,o){case 0:case 1:throw Error(tt(345));case 2:Dl(t,dr,gs);break;case 3:if(ya(t,m),(m&130023424)===m&&(o=kv+500-ni(),10<o)){if(Em(t,0)!==0)break;if(v=t.suspendedLanes,(v&m)!==m){Ji(),t.pingedLanes|=t.suspendedLanes&v;break}t.timeoutHandle=u0(Dl.bind(null,t,dr,gs),o);break}Dl(t,dr,gs);break;case 4:if(ya(t,m),(m&4194240)===m)break;for(o=t.eventTimes,v=-1;0<m;){var C=31-Eo(m);b=1<<C,C=o[C],C>v&&(v=C),m&=~b}if(m=v,m=ni()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*mk(m/1960))-m,10<m){t.timeoutHandle=u0(Dl.bind(null,t,dr,gs),m);break}Dl(t,dr,gs);break;case 5:Dl(t,dr,gs);break;default:throw Error(tt(329))}}}return gr(t,ni()),t.callbackNode===u?JE.bind(null,t):null}function I0(t,o){var u=zd;return t.current.memoizedState.isDehydrated&&(Ul(t,o).flags|=256),t=jm(t,o),t!==2&&(o=dr,dr=u,o!==null&&k0(o)),t}function k0(t){dr===null?dr=t:dr.push.apply(dr,t)}function gk(t){for(var o=t;;){if(o.flags&16384){var u=o.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var m=0;m<u.length;m++){var v=u[m],b=v.getSnapshot;v=v.value;try{if(!Co(b(),v))return!1}catch{return!1}}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===t)break;for(;o.sibling===null;){if(o.return===null||o.return===t)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function ya(t,o){for(o&=~Iv,o&=~cg,t.suspendedLanes|=o,t.pingedLanes&=~o,t=t.expirationTimes;0<o;){var u=31-Eo(o),m=1<<u;t[u]=-1,o&=~m}}function Ub(t){if(tn&6)throw Error(tt(327));xu();var o=Em(t,0);if(!(o&1))return gr(t,ni()),null;var u=jm(t,o);if(t.tag!==0&&u===2){var m=n0(t);m!==0&&(o=m,u=I0(t,m))}if(u===1)throw u=ep,Ul(t,0),ya(t,o),gr(t,ni()),u;if(u===6)throw Error(tt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=o,Dl(t,dr,gs),gr(t,ni()),null}function zv(t,o){var u=tn;tn|=1;try{return t(o)}finally{tn=u,tn===0&&(Mu=ni()+500,og&&Fa())}}function ql(t){xa!==null&&xa.tag===0&&!(tn&6)&&xu();var o=tn;tn|=1;var u=Xr.transition,m=yn;try{if(Xr.transition=null,yn=1,t)return t()}finally{yn=m,Xr.transition=u,tn=o,!(tn&6)&&Fa()}}function Dv(){Cr=uu.current,zn(uu)}function Ul(t,o){t.finishedWork=null,t.finishedLanes=0;var u=t.timeoutHandle;if(u!==-1&&(t.timeoutHandle=-1,qI(u)),hi!==null)for(u=hi.return;u!==null;){var m=u;switch(pv(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&Pm();break;case 3:Su(),zn(fr),zn($i),bv();break;case 5:wv(m);break;case 4:Su();break;case 13:zn(Wn);break;case 19:zn(Wn);break;case 10:_v(m.type._context);break;case 22:case 23:Dv()}u=u.return}if(Ci=t,hi=t=Aa(t.current,null),ki=Cr=o,_i=0,ep=null,Iv=cg=Zl=0,dr=zd=null,Fl!==null){for(o=0;o<Fl.length;o++)if(u=Fl[o],m=u.interleaved,m!==null){u.interleaved=null;var v=m.next,b=u.pending;if(b!==null){var C=b.next;b.next=v,m.next=C}u.pending=m}Fl=null}return t}function QE(t,o){do{var u=hi;try{if(gv(),dm.current=Om,Fm){for(var m=Hn.memoizedState;m!==null;){var v=m.queue;v!==null&&(v.pending=null),m=m.next}Fm=!1}if($l=0,Si=gi=Hn=null,Id=!1,Yd=0,Pv.current=null,u===null||u.return===null){_i=1,ep=o,hi=null;break}e:{var b=t,C=u.return,a=u,I=o;if(o=ki,a.flags|=32768,I!==null&&typeof I=="object"&&typeof I.then=="function"){var O=I,q=a,G=q.tag;if(!(q.mode&1)&&(G===0||G===11||G===15)){var H=q.alternate;H?(q.updateQueue=H.updateQueue,q.memoizedState=H.memoizedState,q.lanes=H.lanes):(q.updateQueue=null,q.memoizedState=null)}var ue=Mb(C);if(ue!==null){ue.flags&=-257,Ab(ue,C,a,b,o),ue.mode&1&&Cb(b,O,o),o=ue,I=O;var _e=o.updateQueue;if(_e===null){var Ie=new Set;Ie.add(I),o.updateQueue=Ie}else _e.add(I);break e}else{if(!(o&1)){Cb(b,O,o),Lv();break e}I=Error(tt(426))}}else if(Fn&&a.mode&1){var at=Mb(C);if(at!==null){!(at.flags&65536)&&(at.flags|=256),Ab(at,C,a,b,o),fv(Cu(I,a));break e}}b=I=Cu(I,a),_i!==4&&(_i=2),zd===null?zd=[b]:zd.push(b),b=C;do{switch(b.tag){case 3:b.flags|=65536,o&=-o,b.lanes|=o;var me=BE(b,I,o);vb(b,me);break e;case 1:a=I;var ne=b.type,le=b.stateNode;if(!(b.flags&128)&&(typeof ne.getDerivedStateFromError=="function"||le!==null&&typeof le.componentDidCatch=="function"&&(Ca===null||!Ca.has(le)))){b.flags|=65536,o&=-o,b.lanes|=o;var ke=FE(b,a,o);vb(b,ke);break e}}b=b.return}while(b!==null)}nS(u)}catch(je){o=je,hi===u&&u!==null&&(hi=u=u.return);continue}break}while(1)}function eS(){var t=Vm.current;return Vm.current=Om,t===null?Om:t}function Lv(){(_i===0||_i===3||_i===2)&&(_i=4),Ci===null||!(Zl&268435455)&&!(cg&268435455)||ya(Ci,ki)}function jm(t,o){var u=tn;tn|=2;var m=eS();(Ci!==t||ki!==o)&&(gs=null,Ul(t,o));do try{_k();break}catch(v){QE(t,v)}while(1);if(gv(),tn=u,Vm.current=m,hi!==null)throw Error(tt(261));return Ci=null,ki=0,_i}function _k(){for(;hi!==null;)tS(hi)}function yk(){for(;hi!==null&&!GP();)tS(hi)}function tS(t){var o=rS(t.alternate,t,Cr);t.memoizedProps=t.pendingProps,o===null?nS(t):hi=o,Pv.current=null}function nS(t){var o=t;do{var u=o.alternate;if(t=o.return,o.flags&32768){if(u=hk(u,o),u!==null){u.flags&=32767,hi=u;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_i=6,hi=null;return}}else if(u=uk(u,o,Cr),u!==null){hi=u;return}if(o=o.sibling,o!==null){hi=o;return}hi=o=t}while(o!==null);_i===0&&(_i=5)}function Dl(t,o,u){var m=yn,v=Xr.transition;try{Xr.transition=null,yn=1,vk(t,o,u,m)}finally{Xr.transition=v,yn=m}return null}function vk(t,o,u,m){do xu();while(xa!==null);if(tn&6)throw Error(tt(327));u=t.finishedWork;var v=t.finishedLanes;if(u===null)return null;if(t.finishedWork=null,t.finishedLanes=0,u===t.current)throw Error(tt(177));t.callbackNode=null,t.callbackPriority=0;var b=u.lanes|u.childLanes;if(QP(t,b),t===Ci&&(hi=Ci=null,ki=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||em||(em=!0,oS(Tm,function(){return xu(),null})),b=(u.flags&15990)!==0,u.subtreeFlags&15990||b){b=Xr.transition,Xr.transition=null;var C=yn;yn=1;var a=tn;tn|=4,Pv.current=null,pk(t,u),KE(u,t),VI(l0),Sm=!!a0,l0=a0=null,t.current=u,fk(u),$P(),tn=a,yn=C,Xr.transition=b}else t.current=u;if(em&&(em=!1,xa=t,Nm=v),b=t.pendingLanes,b===0&&(Ca=null),WP(u.stateNode),gr(t,ni()),o!==null)for(m=t.onRecoverableError,u=0;u<o.length;u++)v=o[u],m(v.value,{componentStack:v.stack,digest:v.digest});if(Um)throw Um=!1,t=A0,A0=null,t;return Nm&1&&t.tag!==0&&xu(),b=t.pendingLanes,b&1?t===P0?Dd++:(Dd=0,P0=t):Dd=0,Fa(),null}function xu(){if(xa!==null){var t=R2(Nm),o=Xr.transition,u=yn;try{if(Xr.transition=null,yn=16>t?16:t,xa===null)var m=!1;else{if(t=xa,xa=null,Nm=0,tn&6)throw Error(tt(331));var v=tn;for(tn|=4,_t=t.current;_t!==null;){var b=_t,C=b.child;if(_t.flags&16){var a=b.deletions;if(a!==null){for(var I=0;I<a.length;I++){var O=a[I];for(_t=O;_t!==null;){var q=_t;switch(q.tag){case 0:case 11:case 15:kd(8,q,b)}var G=q.child;if(G!==null)G.return=q,_t=G;else for(;_t!==null;){q=_t;var H=q.sibling,ue=q.return;if(WE(q),q===O){_t=null;break}if(H!==null){H.return=ue,_t=H;break}_t=ue}}}var _e=b.alternate;if(_e!==null){var Ie=_e.child;if(Ie!==null){_e.child=null;do{var at=Ie.sibling;Ie.sibling=null,Ie=at}while(Ie!==null)}}_t=b}}if(b.subtreeFlags&2064&&C!==null)C.return=b,_t=C;else e:for(;_t!==null;){if(b=_t,b.flags&2048)switch(b.tag){case 0:case 11:case 15:kd(9,b,b.return)}var me=b.sibling;if(me!==null){me.return=b.return,_t=me;break e}_t=b.return}}var ne=t.current;for(_t=ne;_t!==null;){C=_t;var le=C.child;if(C.subtreeFlags&2064&&le!==null)le.return=C,_t=le;else e:for(C=ne;_t!==null;){if(a=_t,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:lg(9,a)}}catch(je){Qn(a,a.return,je)}if(a===C){_t=null;break e}var ke=a.sibling;if(ke!==null){ke.return=a.return,_t=ke;break e}_t=a.return}}if(tn=v,Fa(),Zo&&typeof Zo.onPostCommitFiberRoot=="function")try{Zo.onPostCommitFiberRoot(eg,t)}catch{}m=!0}return m}finally{yn=u,Xr.transition=o}}return!1}function Nb(t,o,u){o=Cu(u,o),o=BE(t,o,1),t=Sa(t,o,1),o=Ji(),t!==null&&(op(t,1,o),gr(t,o))}function Qn(t,o,u){if(t.tag===3)Nb(t,t,u);else for(;o!==null;){if(o.tag===3){Nb(o,t,u);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Ca===null||!Ca.has(m))){t=Cu(u,t),t=FE(o,t,1),o=Sa(o,t,1),t=Ji(),o!==null&&(op(o,1,t),gr(o,t));break}}o=o.return}}function xk(t,o,u){var m=t.pingCache;m!==null&&m.delete(o),o=Ji(),t.pingedLanes|=t.suspendedLanes&u,Ci===t&&(ki&u)===u&&(_i===4||_i===3&&(ki&130023424)===ki&&500>ni()-kv?Ul(t,0):Iv|=u),gr(t,o)}function iS(t,o){o===0&&(t.mode&1?(o=$f,$f<<=1,!($f&130023424)&&($f=4194304)):o=1);var u=Ji();t=Ms(t,o),t!==null&&(op(t,o,u),gr(t,u))}function wk(t){var o=t.memoizedState,u=0;o!==null&&(u=o.retryLane),iS(t,u)}function bk(t,o){var u=0;switch(t.tag){case 13:var m=t.stateNode,v=t.memoizedState;v!==null&&(u=v.retryLane);break;case 19:m=t.stateNode;break;default:throw Error(tt(314))}m!==null&&m.delete(o),iS(t,u)}var rS;rS=function(t,o,u){if(t!==null)if(t.memoizedProps!==o.pendingProps||fr.current)pr=!0;else{if(!(t.lanes&u)&&!(o.flags&128))return pr=!1,ck(t,o,u);pr=!!(t.flags&131072)}else pr=!1,Fn&&o.flags&1048576&&aE(o,zm,o.index);switch(o.lanes=0,o.tag){case 2:var m=o.type;fm(t,o),t=o.pendingProps;var v=bu(o,$i.current);vu(o,u),v=Ev(null,o,m,t,v,u);var b=Sv();return o.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,mr(m)?(b=!0,Im(o)):b=!1,o.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,vv(o),v.updater=sg,o.stateNode=v,v._reactInternals=o,_0(o,m,t,u),o=x0(null,o,m,!0,b,u)):(o.tag=0,Fn&&b&&dv(o),Yi(null,o,v,u),o=o.child),o;case 16:m=o.elementType;e:{switch(fm(t,o),t=o.pendingProps,v=m._init,m=v(m._payload),o.type=m,v=o.tag=Ek(m),t=wo(m,t),v){case 0:o=v0(null,o,m,t,u);break e;case 1:o=kb(null,o,m,t,u);break e;case 11:o=Pb(null,o,m,t,u);break e;case 14:o=Ib(null,o,m,wo(m.type,t),u);break e}throw Error(tt(306,m,""))}return o;case 0:return m=o.type,v=o.pendingProps,v=o.elementType===m?v:wo(m,v),v0(t,o,m,v,u);case 1:return m=o.type,v=o.pendingProps,v=o.elementType===m?v:wo(m,v),kb(t,o,m,v,u);case 3:e:{if(NE(o),t===null)throw Error(tt(387));m=o.pendingProps,b=o.memoizedState,v=b.element,hE(t,o),Rm(o,m,null,u);var C=o.memoizedState;if(m=C.element,b.isDehydrated)if(b={element:m,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){v=Cu(Error(tt(423)),o),o=zb(t,o,m,u,v);break e}else if(m!==v){v=Cu(Error(tt(424)),o),o=zb(t,o,m,u,v);break e}else for(Mr=Ea(o.stateNode.containerInfo.firstChild),Ar=o,Fn=!0,To=null,u=mE(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Tu(),m===v){o=As(t,o,u);break e}Yi(t,o,m,u)}o=o.child}return o;case 5:return gE(o),t===null&&f0(o),m=o.type,v=o.pendingProps,b=t!==null?t.memoizedProps:null,C=v.children,c0(m,v)?C=null:b!==null&&c0(m,b)&&(o.flags|=32),UE(t,o),Yi(t,o,C,u),o.child;case 6:return t===null&&f0(o),null;case 13:return jE(t,o,u);case 4:return xv(o,o.stateNode.containerInfo),m=o.pendingProps,t===null?o.child=Eu(o,null,m,u):Yi(t,o,m,u),o.child;case 11:return m=o.type,v=o.pendingProps,v=o.elementType===m?v:wo(m,v),Pb(t,o,m,v,u);case 7:return Yi(t,o,o.pendingProps,u),o.child;case 8:return Yi(t,o,o.pendingProps.children,u),o.child;case 12:return Yi(t,o,o.pendingProps.children,u),o.child;case 10:e:{if(m=o.type._context,v=o.pendingProps,b=o.memoizedProps,C=v.value,An(Dm,m._currentValue),m._currentValue=C,b!==null)if(Co(b.value,C)){if(b.children===v.children&&!fr.current){o=As(t,o,u);break e}}else for(b=o.child,b!==null&&(b.return=o);b!==null;){var a=b.dependencies;if(a!==null){C=b.child;for(var I=a.firstContext;I!==null;){if(I.context===m){if(b.tag===1){I=bs(-1,u&-u),I.tag=2;var O=b.updateQueue;if(O!==null){O=O.shared;var q=O.pending;q===null?I.next=I:(I.next=q.next,q.next=I),O.pending=I}}b.lanes|=u,I=b.alternate,I!==null&&(I.lanes|=u),m0(b.return,u,o),a.lanes|=u;break}I=I.next}}else if(b.tag===10)C=b.type===o.type?null:b.child;else if(b.tag===18){if(C=b.return,C===null)throw Error(tt(341));C.lanes|=u,a=C.alternate,a!==null&&(a.lanes|=u),m0(C,u,o),C=b.sibling}else C=b.child;if(C!==null)C.return=b;else for(C=b;C!==null;){if(C===o){C=null;break}if(b=C.sibling,b!==null){b.return=C.return,C=b;break}C=C.return}b=C}Yi(t,o,v.children,u),o=o.child}return o;case 9:return v=o.type,m=o.pendingProps.children,vu(o,u),v=Hr(v),m=m(v),o.flags|=1,Yi(t,o,m,u),o.child;case 14:return m=o.type,v=wo(m,o.pendingProps),v=wo(m.type,v),Ib(t,o,m,v,u);case 15:return OE(t,o,o.type,o.pendingProps,u);case 17:return m=o.type,v=o.pendingProps,v=o.elementType===m?v:wo(m,v),fm(t,o),o.tag=1,mr(m)?(t=!0,Im(o)):t=!1,vu(o,u),pE(o,m,v),_0(o,m,v,u),x0(null,o,m,!0,t,u);case 19:return GE(t,o,u);case 22:return VE(t,o,u)}throw Error(tt(156,o.tag))};function oS(t,o){return k2(t,o)}function Tk(t,o,u,m){this.tag=t,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wr(t,o,u,m){return new Tk(t,o,u,m)}function Rv(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ek(t){if(typeof t=="function")return Rv(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ev)return 11;if(t===tv)return 14}return 2}function Aa(t,o){var u=t.alternate;return u===null?(u=Wr(t.tag,o,t.key,t.mode),u.elementType=t.elementType,u.type=t.type,u.stateNode=t.stateNode,u.alternate=t,t.alternate=u):(u.pendingProps=o,u.type=t.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=t.flags&14680064,u.childLanes=t.childLanes,u.lanes=t.lanes,u.child=t.child,u.memoizedProps=t.memoizedProps,u.memoizedState=t.memoizedState,u.updateQueue=t.updateQueue,o=t.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=t.sibling,u.index=t.index,u.ref=t.ref,u}function _m(t,o,u,m,v,b){var C=2;if(m=t,typeof t=="function")Rv(t)&&(C=1);else if(typeof t=="string")C=5;else e:switch(t){case eu:return Nl(u.children,v,b,o);case Q0:C=8,v|=8;break;case Ny:return t=Wr(12,u,o,v|2),t.elementType=Ny,t.lanes=b,t;case jy:return t=Wr(13,u,o,v),t.elementType=jy,t.lanes=b,t;case Gy:return t=Wr(19,u,o,v),t.elementType=Gy,t.lanes=b,t;case f2:return ug(u,v,b,o);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case d2:C=10;break e;case p2:C=9;break e;case ev:C=11;break e;case tv:C=14;break e;case fa:C=16,m=null;break e}throw Error(tt(130,t==null?t:typeof t,""))}return o=Wr(C,u,o,v),o.elementType=t,o.type=m,o.lanes=b,o}function Nl(t,o,u,m){return t=Wr(7,t,m,o),t.lanes=u,t}function ug(t,o,u,m){return t=Wr(22,t,m,o),t.elementType=f2,t.lanes=u,t.stateNode={isHidden:!1},t}function Sy(t,o,u){return t=Wr(6,t,null,o),t.lanes=u,t}function Cy(t,o,u){return o=Wr(4,t.children!==null?t.children:[],t.key,o),o.lanes=u,o.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},o}function Sk(t,o,u,m,v){this.tag=o,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sy(0),this.expirationTimes=sy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sy(0),this.identifierPrefix=m,this.onRecoverableError=v,this.mutableSourceEagerHydrationData=null}function Bv(t,o,u,m,v,b,C,a,I){return t=new Sk(t,o,u,a,I),o===1?(o=1,b===!0&&(o|=8)):o=0,b=Wr(3,null,null,o),t.current=b,b.stateNode=t,b.memoizedState={element:m,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},vv(b),t}function Ck(t,o,u){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Qc,key:m==null?null:""+m,children:t,containerInfo:o,implementation:u}}function sS(t){if(!t)return za;t=t._reactInternals;e:{if(Xl(t)!==t||t.tag!==1)throw Error(tt(170));var o=t;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(mr(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(tt(171))}if(t.tag===1){var u=t.type;if(mr(u))return oE(t,u,o)}return o}function aS(t,o,u,m,v,b,C,a,I){return t=Bv(u,m,!0,t,v,b,C,a,I),t.context=sS(null),u=t.current,m=Ji(),v=Ma(u),b=bs(m,v),b.callback=o??null,Sa(u,b,v),t.current.lanes=v,op(t,v,m),gr(t,m),t}function hg(t,o,u,m){var v=o.current,b=Ji(),C=Ma(v);return u=sS(u),o.context===null?o.context=u:o.pendingContext=u,o=bs(b,C),o.payload={element:t},m=m===void 0?null:m,m!==null&&(o.callback=m),t=Sa(v,o,C),t!==null&&(So(t,v,C,b),hm(t,v,C)),C}function Gm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function jb(t,o){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var u=t.retryLane;t.retryLane=u!==0&&u<o?u:o}}function Fv(t,o){jb(t,o),(t=t.alternate)&&jb(t,o)}function Mk(){return null}var lS=typeof reportError=="function"?reportError:function(t){console.error(t)};function Ov(t){this._internalRoot=t}dg.prototype.render=Ov.prototype.render=function(t){var o=this._internalRoot;if(o===null)throw Error(tt(409));hg(t,o,null,null)};dg.prototype.unmount=Ov.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var o=t.containerInfo;ql(function(){hg(null,t,null,null)}),o[Cs]=null}};function dg(t){this._internalRoot=t}dg.prototype.unstable_scheduleHydration=function(t){if(t){var o=O2();t={blockedOn:null,target:t,priority:o};for(var u=0;u<_a.length&&o!==0&&o<_a[u].priority;u++);_a.splice(u,0,t),u===0&&U2(t)}};function Vv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function pg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Gb(){}function Ak(t,o,u,m,v){if(v){if(typeof m=="function"){var b=m;m=function(){var O=Gm(C);b.call(O)}}var C=aS(o,m,t,0,null,!1,!1,"",Gb);return t._reactRootContainer=C,t[Cs]=C.current,qd(t.nodeType===8?t.parentNode:t),ql(),C}for(;v=t.lastChild;)t.removeChild(v);if(typeof m=="function"){var a=m;m=function(){var O=Gm(I);a.call(O)}}var I=Bv(t,0,!1,null,null,!1,!1,"",Gb);return t._reactRootContainer=I,t[Cs]=I.current,qd(t.nodeType===8?t.parentNode:t),ql(function(){hg(o,I,u,m)}),I}function fg(t,o,u,m,v){var b=u._reactRootContainer;if(b){var C=b;if(typeof v=="function"){var a=v;v=function(){var I=Gm(C);a.call(I)}}hg(o,C,t,v)}else C=Ak(u,o,t,v,m);return Gm(C)}B2=function(t){switch(t.tag){case 3:var o=t.stateNode;if(o.current.memoizedState.isDehydrated){var u=bd(o.pendingLanes);u!==0&&(rv(o,u|1),gr(o,ni()),!(tn&6)&&(Mu=ni()+500,Fa()))}break;case 13:ql(function(){var m=Ms(t,1);if(m!==null){var v=Ji();So(m,t,1,v)}}),Fv(t,1)}};ov=function(t){if(t.tag===13){var o=Ms(t,134217728);if(o!==null){var u=Ji();So(o,t,134217728,u)}Fv(t,134217728)}};F2=function(t){if(t.tag===13){var o=Ma(t),u=Ms(t,o);if(u!==null){var m=Ji();So(u,t,o,m)}Fv(t,o)}};O2=function(){return yn};V2=function(t,o){var u=yn;try{return yn=t,o()}finally{yn=u}};Qy=function(t,o,u){switch(o){case"input":if(qy(t,u),o=u.name,u.type==="radio"&&o!=null){for(u=t;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<u.length;o++){var m=u[o];if(m!==t&&m.form===t.form){var v=rg(m);if(!v)throw Error(tt(90));g2(m),qy(m,v)}}}break;case"textarea":y2(t,u);break;case"select":o=u.value,o!=null&&mu(t,!!u.multiple,o,!1)}};S2=zv;C2=ql;var Pk={usingClientEntryPoint:!1,Events:[ap,ru,rg,T2,E2,zv]},_d={findFiberByHostInstance:Bl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Ik={bundleType:_d.bundleType,version:_d.version,rendererPackageName:_d.rendererPackageName,rendererConfig:_d.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Is.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=P2(t),t===null?null:t.stateNode},findFiberByHostInstance:_d.findFiberByHostInstance||Mk,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tm.isDisabled&&tm.supportsFiber)try{eg=tm.inject(Ik),Zo=tm}catch{}}kr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pk;kr.createPortal=function(t,o){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vv(o))throw Error(tt(200));return Ck(t,o,null,u)};kr.createRoot=function(t,o){if(!Vv(t))throw Error(tt(299));var u=!1,m="",v=lS;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(v=o.onRecoverableError)),o=Bv(t,1,!1,null,null,u,!1,m,v),t[Cs]=o.current,qd(t.nodeType===8?t.parentNode:t),new Ov(o)};kr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var o=t._reactInternals;if(o===void 0)throw typeof t.render=="function"?Error(tt(188)):(t=Object.keys(t).join(","),Error(tt(268,t)));return t=P2(o),t=t===null?null:t.stateNode,t};kr.flushSync=function(t){return ql(t)};kr.hydrate=function(t,o,u){if(!pg(o))throw Error(tt(200));return fg(null,t,o,!0,u)};kr.hydrateRoot=function(t,o,u){if(!Vv(t))throw Error(tt(405));var m=u!=null&&u.hydratedSources||null,v=!1,b="",C=lS;if(u!=null&&(u.unstable_strictMode===!0&&(v=!0),u.identifierPrefix!==void 0&&(b=u.identifierPrefix),u.onRecoverableError!==void 0&&(C=u.onRecoverableError)),o=aS(o,null,t,1,u??null,v,!1,b,C),t[Cs]=o.current,qd(t),m)for(t=0;t<m.length;t++)u=m[t],v=u._getVersion,v=v(u._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[u,v]:o.mutableSourceEagerHydrationData.push(u,v);return new dg(o)};kr.render=function(t,o,u){if(!pg(o))throw Error(tt(200));return fg(null,t,o,!1,u)};kr.unmountComponentAtNode=function(t){if(!pg(t))throw Error(tt(40));return t._reactRootContainer?(ql(function(){fg(null,null,t,!1,function(){t._reactRootContainer=null,t[Cs]=null})}),!0):!1};kr.unstable_batchedUpdates=zv;kr.unstable_renderSubtreeIntoContainer=function(t,o,u,m){if(!pg(u))throw Error(tt(200));if(t==null||t._reactInternals===void 0)throw Error(tt(38));return fg(t,o,u,!1,m)};kr.version="18.2.0-next-9e3b772b8-20220608";function cS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(cS)}catch(t){console.error(t)}}cS(),a2.exports=kr;var kk=a2.exports,$b=kk;Vy.createRoot=$b.createRoot,Vy.hydrateRoot=$b.hydrateRoot;var uS={exports:{}};(function(t,o){(function(u,m){t.exports=m()})(sP,function(){var u,m,v;function b(a,I){if(!u)u=I;else if(!m)m=I;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",q={};u(q),v=I(q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}b(["exports"],function(a){var I=typeof self<"u"?self:{},O="2.15.0";let q;const G={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(q==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{q={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):n}catch{q=n}}return q},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!G.API_URL)return null;try{const n=new URL(G.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},H={supported:!1,testSupport:function(n){!Ie&&_e&&(at?me(n):ue=n)}};let ue,_e,Ie=!1,at=!1;function me(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,_e),n.isContextLost())return;H.supported=!0}catch{}n.deleteTexture(e),Ie=!0}I.document&&(_e=I.document.createElement("img"),_e.onload=function(){ue&&me(ue),ue=null,at=!0},_e.onerror=function(){Ie=!0,ue=null},_e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ne="01";function le(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ke=je;function je(n,e,i,s){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=i,this.p2y=s}je.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,s=0;s<8;s++){var c=this.sampleCurveX(i)-n;if(Math.abs(c)<e)return i;var d=this.sampleCurveDerivativeX(i);if(Math.abs(d)<1e-6)break;i-=c/d}var f=0,_=1;for(i=n,s=0;s<20&&(c=this.sampleCurveX(i),!(Math.abs(c-n)<e));s++)n>c?f=i:_=i,i=.5*(_-f)+f;return i},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var ct=le(ke),it=Qe;function Qe(n,e){this.x=n,this.y=e}Qe.prototype={clone:function(){return new Qe(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround:function(n,e){var i=Math.cos(n),s=Math.sin(n),c=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qe.convert=function(n){return n instanceof Qe?n:Array.isArray(n)?new Qe(n[0],n[1]):n};var Be=le(it);const St=Math.PI/180,bn=180/Math.PI;function bt(n){return n*St}function Jt(n){return n*bn}const Tn=[[0,0],[1,0],[1,1],[0,1]];function vn(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ii(n,e,i,s){const c=new ct(n,e,i,s);return function(d){return c.solve(d)}}const Mi=ii(.25,.1,.25,1);function We(n,e,i){return Math.min(i,Math.max(e,n))}function Et(n,e,i){return(i=We((i-n)/(e-n),0,1))*i*(3-2*i)}function vt(n,e,i){const s=i-e,c=((n-e)%s+s)%s+e;return c===e?i:c}function gt(n,e,i){if(!n.length)return i(null,[]);let s=n.length;const c=new Array(n.length);let d=null;n.forEach((f,_)=>{e(f,(x,w)=>{x&&(d=x),c[_]=w,--s==0&&i(d,c)})})}function Qt(n){const e=[];for(const i in n)e.push(n[i]);return e}function hn(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}let ti=1;function Zi(){return ti++}function Ln(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function di(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function ks(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function yr(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function vr(n,e){return n.indexOf(e,n.length-e.length)!==-1}function Pt(n,e,i){const s={};for(const c in n)s[c]=e.call(i||this,n[c],c,n);return s}function Yr(n,e,i){const s={};for(const c in n)e.call(i||this,n[c],c,n)&&(s[c]=n[c]);return s}function yi(n){return Array.isArray(n)?n.map(yi):typeof n=="object"&&n?Pt(n,yi):n}const Va={};function En(n){Va[n]||(typeof console<"u"&&console.warn(n),Va[n]=!0)}function tr(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Yl(n){let e=0;for(let i,s,c=0,d=n.length,f=d-1;c<d;f=c++)i=n[c],s=n[f],e+=(s.x-i.x)*(i.y+s.y);return e}function Jr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function qi(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,c,d)=>{const f=c||d;return e[s]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Ua=null;function zs(n){if(Ua==null){const e=n.navigator?n.navigator.userAgent:null;Ua=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ua}function Na(n){try{const e=I[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Mo(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Ds="mapbox-tiles";let Jl=500,Ql=50,nr,Ao;function ja(){try{return I.caches}catch{}}function Xo(){ja()&&!nr&&(nr=I.caches.open(Ds))}function Ls(n){const e=n.indexOf("?");if(e<0)return n;const i=function(c){const d=c.indexOf("?");return d>0?c.slice(d+1).split("&"):[]}(n),s=i.filter(c=>{const d=c.split("=");return d[0]==="language"||d[0]==="worldview"});return s.length?`${n.slice(0,e)}?${s.join("&")}`:n.slice(0,e)}let Ga=1/0;const Ho={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ho);class Po extends Error{constructor(e,i,s){i===401&&we(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ko=Jr()?()=>self.worker&&self.worker.referrer:()=>(I.location.protocol==="blob:"?I.parent:I).location.href,Yo=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Ko())&&!/^\w+:/.test(i))){if(I.fetch&&I.Request&&I.AbortController&&I.Request.prototype.hasOwnProperty("signal"))return function(s,c){const d=new I.AbortController,f=new I.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Ko(),referrerPolicy:s.referrerPolicy,signal:d.signal});let _=!1,x=!1;const w=(S=f.url).indexOf("sku=")>0&&we(S);var S;s.type==="json"&&f.headers.set("Accept","application/json");const A=(D,L,F)=>{if(x)return;if(D&&D.message!=="SecurityError"&&En(D.toString()),L&&F)return P(L);const j=Date.now();I.fetch(f).then(Y=>{if(Y.ok){const oe=w?Y.clone():null;return P(Y,oe,j)}return c(new Po(Y.statusText,Y.status,s.url))}).catch(Y=>{Y.name!=="AbortError"&&c(new Error(`${Y.message} ${s.url}`))})},P=(D,L,F)=>{(s.type==="arrayBuffer"?D.arrayBuffer():s.type==="json"?D.json():D.text()).then(j=>{x||(L&&F&&function(Y,oe,J){if(Xo(),!nr)return;const ie={status:oe.status,statusText:oe.statusText,headers:new I.Headers};oe.headers.forEach((Ce,Te)=>ie.headers.set(Te,Ce));const ae=qi(oe.headers.get("Cache-Control")||"");if(ae["no-store"])return;ae["max-age"]&&ie.headers.set("Expires",new Date(J+1e3*ae["max-age"]).toUTCString());const se=ie.headers.get("Expires");se&&(new Date(se).getTime()-J<42e4||function(Ce,Te){if(Ao===void 0)try{new Response(new ReadableStream),Ao=!0}catch{Ao=!1}Ao?Te(Ce.body):Ce.blob().then(Te)}(oe,Ce=>{const Te=new I.Response(Ce,ie);Xo(),nr&&nr.then(Le=>Le.put(Ls(Y.url),Te)).catch(Le=>En(Le.message))}))}(f,L,F),_=!0,c(null,j,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(j=>{x||c(new Error(j.message))})};return w?function(D,L){if(Xo(),!nr)return L(null);const F=Ls(D.url);nr.then(j=>{j.match(F).then(Y=>{const oe=function(J){if(!J)return!1;const ie=new Date(J.headers.get("Expires")||0),ae=qi(J.headers.get("Cache-Control")||"");return ie>Date.now()&&!ae["no-cache"]}(Y);j.delete(F),oe&&j.put(F,Y.clone()),L(null,Y,oe)}).catch(L)}).catch(L)}(f,A):A(null,null),{cancel:()=>{x=!0,_||d.abort()}}}(n,e);if(Jr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(s,c){const d=new I.XMLHttpRequest;d.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const f in s.headers)d.setRequestHeader(f,s.headers[f]);return s.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=s.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(s.type==="json")try{f=JSON.parse(d.response)}catch(_){return c(_)}c(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new Po(d.statusText,d.status,s.url))},d.send(s.body),{cancel:()=>d.abort()}}(n,e)},Rs=function(n,e){return Yo(hn(n,{type:"arrayBuffer"}),e)};function ec(n){const e=I.document.createElement("a");return e.href=n,e.protocol===I.document.location.protocol&&e.host===I.document.location.host}const re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let V,U;V=[],U=0;const te=function(n,e){if(H.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),U>=G.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return V.push(d),d}U++;let i=!1;const s=()=>{if(!i)for(i=!0,U--;V.length&&U<G.MAX_PARALLEL_IMAGE_REQUESTS;){const d=V.shift(),{requestParameters:f,callback:_,cancelled:x}=d;x||(d.cancel=te(f,_).cancel)}},c=Rs(n,(d,f,_,x)=>{s(),d?e(d):f&&(I.createImageBitmap?function(w,S){const A=new I.Blob([new Uint8Array(w)],{type:"image/png"});I.createImageBitmap(A).then(P=>{S(null,P)}).catch(P=>{S(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(w,S)=>e(w,S,_,x)):function(w,S){const A=new I.Image,P=I.URL;A.onload=()=>{S(null,A),P.revokeObjectURL(A.src),A.onload=null,I.requestAnimationFrame(()=>{A.src=re})},A.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new I.Blob([new Uint8Array(w)],{type:"image/png"});A.src=w.byteLength?P.createObjectURL(D):re}(f,(w,S)=>e(w,S,_,x)))});return{cancel:()=>{c.cancel(),s()}}},ce="NO_ACCESS_TOKEN";function ge(n){return n.indexOf("mapbox:")===0}function we(n){return G.API_URL_REGEX.test(n)}function xe(n){return G.API_CDN_URL_REGEX.test(n)}function fe(n){return G.API_STYLE_REGEX.test(n)&&!Pe(n)}function Pe(n){return G.API_SPRITE_REGEX.test(n)}const Je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function et(n){const e=n.match(Je);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function He(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}const It="mapbox.eventData";function Bt(n){if(!n)return null;const e=n.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(I.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class kt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Bt(G.ACCESS_TOKEN);let s="";return s=i&&i.u?I.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(+("0x"+d)))):G.ACCESS_TOKEN||"",e?`${It}.${e}:${s}`:`${It}:${s}`}fetchEventData(){const e=Na("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const c=I.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const d=I.localStorage.getItem(s);d&&(this.anonId=d)}catch{En("Unable to read from LocalStorage")}}saveEventData(){const e=Na("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{I.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&I.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{En("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,s,c){if(!G.EVENTS_URL)return;const d=et(G.EVENTS_URL);d.params.push(`access_token=${c||G.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString()},_=i?hn(f,i):f,x={url:He(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(w,S){return Yo(hn(w,{method:"POST"}),S)}(x,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Ft=new class extends kt{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){G.EVENTS_URL&&G.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>ge(i)||we(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Bt(G.ACCESS_TOKEN),i=e?e.u:G.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;ks(this.anonId)||(this.anonId=Ln(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),f=new Date(c),_=(c-this.eventData.lastSuccess)/864e5;s=s||_>=1||_<-1||d.getDate()!==f.getDate()}else s=!0;s?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:ne,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},n):this.processRequests()}},Gt=Ft.postTurnstileEvent.bind(Ft),Sn=new class extends kt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,s){this.skuToken=e,this.errorCb=s,G.EVENTS_URL&&(i||G.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(ce)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ks(this.anonId)||(this.anonId=Ln()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:ne,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},On=Sn.postMapLoadEvent.bind(Sn),vi=new class extends kt{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){G.EVENTS_URL&&(n||G.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),s=function(c){const d=I.performance.getEntriesByType("resource"),f=I.performance.getEntriesByType("mark"),_=function(P){const D={};if(P){for(const L in P)if(L!=="other")for(const F of P[L]){const j=`${L}ResolveRangeMin`,Y=`${L}ResolveRangeMax`,oe=`${L}RequestCount`,J=`${L}RequestCachedCount`;D[j]=Math.min(D[j]||1/0,F.startTime),D[Y]=Math.max(D[Y]||-1/0,F.responseEnd);const ie=ae=>{D[ae]===void 0&&(D[ae]=0),++D[ae]};F.transferSize!==void 0&&F.transferSize===0&&ie(J),ie(oe)}}return D}(function(P,D){const L={};if(P)for(const F of P){const j=D(F);L[j]===void 0&&(L[j]=[]),L[j].push(F)}return L}(d,pp)),x=I.devicePixelRatio,w=I.navigator.connection||I.navigator.mozConnection||I.navigator.webkitConnection,S={counters:[],metadata:[],attributes:[]},A=(P,D,L)=>{L!=null&&P.push({name:D,value:L.toString()})};for(const P in _)A(S.counters,P,_[P]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(A(S.counters,"interactionRangeMin",c.interactionRange[0]),A(S.counters,"interactionRangeMax",c.interactionRange[1])),f)for(const P of Object.keys(Bs)){const D=Bs[P],L=f.find(F=>F.name===D);L&&A(S.counters,D,L.startTime)}return A(S.counters,"visibilityHidden",c.visibilityHidden),A(S.attributes,"style",function(P){if(P)for(const D of P){const L=D.name.split("?")[0];if(fe(L)){const F=L.split("/").slice(-2);if(F.length===2)return`mapbox://styles/${F[0]}/${F[1]}`}}}(d)),A(S.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),A(S.attributes,"fogEnabled",c.fogEnabled?"true":"false"),A(S.attributes,"projection",c.projection),A(S.attributes,"zoom",c.zoom),A(S.metadata,"devicePixelRatio",x),A(S.metadata,"connectionEffectiveType",w?w.effectiveType:void 0),A(S.metadata,"navigatorUserAgent",I.navigator.userAgent),A(S.metadata,"screenWidth",I.screen.width),A(S.metadata,"screenHeight",I.screen.height),A(S.metadata,"windowWidth",I.innerWidth),A(S.metadata,"windowHeight",I.innerHeight),A(S.metadata,"mapWidth",c.width/x),A(S.metadata,"mapHeight",c.height/x),A(S.metadata,"webglRenderer",c.renderer),A(S.metadata,"webglVendor",c.vendor),A(S.metadata,"sdkVersion",O),A(S.metadata,"sdkIdentifier","mapbox-gl-js"),S}(i);for(const c of s.metadata);for(const c of s.counters);for(const c of s.attributes);this.postEvent(e,s,()=>{},n)}},Yn=vi.postPerformanceEvent.bind(vi),Dr=new class extends kt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,s){if(!G.API_URL||!G.SESSION_PATH)return;const c=et(G.API_URL+G.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${s||G.ACCESS_TOKEN||""}`);const d={url:He(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(f,_){return Yo(hn(f,{method:"GET"}),_)}(d,f=>{this.pendingRequest=null,i(f),this.saveEventData(),this.processRequests(s)})}getSessionAPI(n,e,i,s){this.skuToken=e,this.errorCb=s,G.SESSION_PATH&&G.API_URL&&(i||G.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(ce)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},ri=Dr.getSessionAPI.bind(Dr),Ai=new Set,Bs={create:"create",load:"load",fullLoad:"fullLoad"},bg={mark(n){I.performance.mark(n)},measure(n,e,i){I.performance.measure(n,e,i)}};function pp(n){const e=n.name.split("?")[0];return xe(e)&&e.includes("mapbox-gl.js")?"javascript":xe(e)&&e.includes("mapbox-gl.css")?"css":function(i){return G.API_FONTS_REGEX.test(i)}(e)?"fontRange":Pe(e)?"sprite":fe(e)?"style":function(i){return G.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const Ht=I.performance;function Du(n){const e=n?n.url.toString():void 0;return Ht.getEntriesByName(e)}let $a,Lu,tc,Lr;const Qr={now:()=>tc!==void 0?tc:I.performance.now(),setNow(n){tc=n},restoreNow(){tc=void 0},frame(n){const e=I.requestAnimationFrame(n);return{cancel:()=>I.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:s}=n;Lr||(Lr=I.document.createElement("canvas"));const c=Lr.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Lr.width||s>Lr.height)&&(Lr.width=i,Lr.height=s),c.clearRect(-e,-e,i+2*e,s+2*e),c.drawImage(n,0,0,i,s),c.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:n=>($a||($a=I.document.createElement("a")),$a.href=n,$a.href),get devicePixelRatio(){return I.devicePixelRatio},get prefersReducedMotion(){return!!I.matchMedia&&(Lu==null&&(Lu=I.matchMedia("(prefers-reduced-motion: reduce)")),Lu.matches)}};function Ru(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Bu(n,e,i){if(i&&i[n]){const s=i[n].indexOf(e);s!==-1&&i[n].splice(s,1)}}class Jo{constructor(e,i={}){hn(this,i),this.type=e}}class eo extends Jo{constructor(e,i={}){super("error",hn({error:e},i))}}class Za{on(e,i){return this._listeners=this._listeners||{},Ru(e,i,this._listeners),this}off(e,i){return Bu(e,i,this._listeners),Bu(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ru(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){typeof e=="string"&&(e=new Jo(e,i||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const _ of c)_.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const _ of d)Bu(s,_,this._oneTimeListeners),_.call(this,e);const f=this._eventedParent;f&&(hn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof eo&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var De=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function to(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}function Vn(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function oi(n){if(Array.isArray(n))return n.map(oi);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=oi(n[i]);return e}return Vn(n)}class fp extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Rr=fp;class Fu{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,c]of i)this.bindings[s]=c}concat(e){return new Fu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var mp=Fu;const Fs={kind:"null"},st={kind:"number"},jt={kind:"string"},Vt={kind:"boolean"},Wi={kind:"color"},xr={kind:"object"},Ut={kind:"value"},Xi={kind:"collator"},qa={kind:"formatted"},Qo={kind:"resolvedImage"};function ir(n,e){return{kind:"array",itemType:n,N:e}}function xn(n){if(n.kind==="array"){const e=xn(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const gp=[Fs,st,jt,Vt,Wi,qa,xr,ir(Ut),Qo];function no(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!no(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of gp)if(!no(i,e))return null}}return`Expected ${xn(n)} but found ${xn(e)} instead.`}function Wa(n,e){return e.some(i=>i.kind===n.kind)}function Xa(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}var Ou,_p={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ha(n){return(n=Math.round(n))<0?0:n>255?255:n}function Ka(n){return Ha(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function nc(n){return(e=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function Os(n,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?n+(e-n)*i*6:2*i<1?e:3*i<2?n+(e-n)*(2/3-i)*6:n}try{Ou={}.parseCSSColor=function(n){var e,i=n.replace(/ /g,"").toLowerCase();if(i in _p)return _p[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=i.indexOf("("),c=i.indexOf(")");if(s!==-1&&c+1===i.length){var d=i.substr(0,s),f=i.substr(s+1,c-(s+1)).split(","),_=1;switch(d){case"rgba":if(f.length!==4)return null;_=nc(f.pop());case"rgb":return f.length!==3?null:[Ka(f[0]),Ka(f[1]),Ka(f[2]),_];case"hsla":if(f.length!==4)return null;_=nc(f.pop());case"hsl":if(f.length!==3)return null;var x=(parseFloat(f[0])%360+360)%360/360,w=nc(f[1]),S=nc(f[2]),A=S<=.5?S*(w+1):S+w-S*w,P=2*S-A;return[Ha(255*Os(P,A,x+1/3)),Ha(255*Os(P,A,x)),Ha(255*Os(P,A,x-1/3)),_];default:return null}}return null}}catch{}class Di{constructor(e,i,s,c=1){this.r=e,this.g=i,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof Di)return e;if(typeof e!="string")return;const i=Ou(e);return i?new Di(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${c})`}toArray(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*s/c,c]}toArray01(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[e/c,i/c,s/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:c}=this;return[e,i,s,c]}}Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1),Di.blue=new Di(0,0,1,1);var Rn=Di;class Vu{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Uu{constructor(e,i,s,c,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=c,this.textColor=d}}class Li{constructor(e){this.sections=e}static fromString(e){return new Li([new Uu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Li?e:Li.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(s)}return e}}class rr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new rr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function yp(n,e,i,s){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,e,i,s]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ya(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Rn||n instanceof Vu||n instanceof Li||n instanceof rr)return!0;if(Array.isArray(n)){for(const e of n)if(!Ya(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Ya(n[e]))return!1;return!0}return!1}function Pn(n){if(n===null)return Fs;if(typeof n=="string")return jt;if(typeof n=="boolean")return Vt;if(typeof n=="number")return st;if(n instanceof Rn)return Wi;if(n instanceof Vu)return Xi;if(n instanceof Li)return qa;if(n instanceof rr)return Qo;if(Array.isArray(n)){const e=n.length;let i;for(const s of n){const c=Pn(s);if(i){if(i===c)continue;i=Ut;break}i=c}return ir(i||Ut,e)}return xr}function Ja(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Rn||n instanceof Li||n instanceof rr?n.toString():JSON.stringify(n)}class Nu{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ya(e[1]))return i.error("invalid value");const s=e[1];let c=Pn(s);const d=i.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new Nu(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Rn?["rgba"].concat(this.value.toArray()):this.value instanceof Li?this.value.serialize():this.value}}var es=Nu,pi=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const ju={string:jt,number:st,boolean:Vt,object:xr};class Gu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,c=1;const d=e[0];if(d==="array"){let _,x;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in ju)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=ju[w],c++}else _=Ut;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}s=ir(_,x)}else s=ju[d];const f=[];for(;c<e.length;c++){const _=i.parse(e[c],c,Ut);if(!_)return null;f.push(_)}return new Gu(s,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!no(this.type,Pn(s)))return s;if(i===this.args.length-1)throw new pi(`Expected value to be of type ${xn(this.type)}, but found ${xn(Pn(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(s=>s.serialize()))}}var io=Gu;class Io{constructor(e){this.type=qa,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const c=[];let d=!1;for(let f=1;f<=e.length-1;++f){const _=e[f];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let x=null;if(_["font-scale"]&&(x=i.parse(_["font-scale"],1,st),!x))return null;let w=null;if(_["text-font"]&&(w=i.parse(_["text-font"],1,ir(jt)),!w))return null;let S=null;if(_["text-color"]&&(S=i.parse(_["text-color"],1,Wi),!S))return null;const A=c[c.length-1];A.scale=x,A.font=w,A.textColor=S}else{const x=i.parse(e[f],1,Ut);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Io(c)}evaluate(e){return new Li(this.sections.map(i=>{const s=i.content.evaluate(e);return Pn(s)===Qo?new Uu("",s,null,null,null):new Uu(Ja(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class ic{constructor(e){this.type=Qo,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const s=i.parse(e[1],1,jt);return s?new ic(s):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),s=rr.fromString(i);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(i)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Tg={"to-boolean":Vt,"to-color":Wi,"to-number":st,"to-string":jt};class $u{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");const c=Tg[s],d=[];for(let f=1;f<e.length;f++){const _=i.parse(e[f],f,Ut);if(!_)return null;d.push(_)}return new $u(c,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const c of this.args){if(i=c.evaluate(e),s=null,i instanceof Rn)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:yp(i[0],i[1],i[2],i[3]),!s))return new Rn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new pi(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new pi(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Li.fromString(Ja(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?rr.fromString(Ja(this.args[0].evaluate(e))):Ja(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Io([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ic(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Vs=$u;const Br=["Unknown","Point","LineString","Polygon"];var Zu=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Br[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-n[0])+this.featureDistanceData.bearing[1]*(s*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=Rn.parse(n)),e}};class ts{constructor(e,i,s,c){this.name=e,this.type=i,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],c=ts.definitions[s];if(!c)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=f.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let x=null;for(const[w,S]of _){x=new Yu(i.registry,i.path,null,i.scope);const A=[];let P=!1;for(let D=1;D<e.length;D++){const L=e[D],F=Array.isArray(w)?w[D-1]:w.type,j=x.parse(L,1+A.length,F);if(!j){P=!0;break}A.push(j)}if(!P)if(Array.isArray(w)&&w.length!==A.length)x.error(`Expected ${w.length} arguments, but found ${A.length} instead.`);else{for(let D=0;D<A.length;D++){const L=Array.isArray(w)?w[D]:w.type,F=A[D];x.concat(D+1).checkSubtype(L,F.type)}if(x.errors.length===0)return new ts(s,d,S,A)}}if(_.length===1)i.errors.push(...x.errors);else{const w=(_.length?_:f).map(([A])=>{return P=A,Array.isArray(P)?`(${P.map(xn).join(", ")})`:`(${xn(P.type)}...)`;var P}).join(" | "),S=[];for(let A=1;A<e.length;A++){const P=i.parse(e[A],1+S.length);if(!P)return null;S.push(xn(P.type))}i.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(e,i){ts.definitions=i;for(const s in i)e[s]=ts}}var ro=ts;class Qa{constructor(e,i,s){this.type=Xi,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const c=i.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Vt);if(!c)return null;const d=i.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Vt);if(!d)return null;let f=null;return s.locale&&(f=i.parse(s.locale,1,jt),!f)?null:new Qa(c,d,f)}evaluate(e){return new Vu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const oo=8192;function rc(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Us(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function el(n,e){const i=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*oo),Math.round(s*c*oo)]}function vp(n,e,i){const s=n[0]-e[0],c=n[1]-e[1],d=n[0]-i[0],f=n[1]-i[1];return s*f-d*c==0&&s*d<=0&&c*f<=0}function oc(n,e){let i=!1;for(let f=0,_=e.length;f<_;f++){const x=e[f];for(let w=0,S=x.length;w<S-1;w++){if(vp(n,x[w],x[w+1]))return!1;(c=x[w])[1]>(s=n)[1]!=(d=x[w+1])[1]>s[1]&&s[0]<(d[0]-c[0])*(s[1]-c[1])/(d[1]-c[1])+c[0]&&(i=!i)}}var s,c,d;return i}function qu(n,e){for(let i=0;i<e.length;i++)if(oc(n,e[i]))return!0;return!1}function Wu(n,e,i,s){const c=s[0]-i[0],d=s[1]-i[1],f=(n[0]-i[0])*d-c*(n[1]-i[1]),_=(e[0]-i[0])*d-c*(e[1]-i[1]);return f>0&&_<0||f<0&&_>0}function Ns(n,e,i){for(const w of i)for(let S=0;S<w.length-1;++S)if((_=[(f=w[S+1])[0]-(d=w[S])[0],f[1]-d[1]])[0]*(x=[(c=e)[0]-(s=n)[0],c[1]-s[1]])[1]-_[1]*x[0]!=0&&Wu(s,c,d,f)&&Wu(d,f,s,c))return!0;var s,c,d,f,_,x;return!1}function Kt(n,e){for(let i=0;i<n.length;++i)if(!oc(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Ns(n[i],n[i+1],e))return!1;return!0}function Eg(n,e){for(let i=0;i<e.length;i++)if(Kt(n,e[i]))return!0;return!1}function Xu(n,e,i){const s=[];for(let c=0;c<n.length;c++){const d=[];for(let f=0;f<n[c].length;f++){const _=el(n[c][f],i);rc(e,_),d.push(_)}s.push(d)}return s}function xp(n,e,i){const s=[];for(let c=0;c<n.length;c++){const d=Xu(n[c],e,i);s.push(d)}return s}function Hu(n,e,i,s){if(n[0]<i[0]||n[0]>i[2]){const c=.5*s;let d=n[0]-i[0]>c?-s:i[0]-n[0]>c?s:0;d===0&&(d=n[0]-i[2]>c?-s:i[2]-n[0]>c?s:0),n[0]+=d}rc(e,n)}function wp(n,e,i,s){const c=Math.pow(2,s.z)*oo,d=[s.x*oo,s.y*oo],f=[];if(!n)return f;for(const _ of n)for(const x of _){const w=[x.x+d[0],x.y+d[1]];Hu(w,e,i,c),f.push(w)}return f}function Ku(n,e,i,s){const c=Math.pow(2,s.z)*oo,d=[s.x*oo,s.y*oo],f=[];if(!n)return f;for(const x of n){const w=[];for(const S of x){const A=[S.x+d[0],S.y+d[1]];rc(e,A),w.push(A)}f.push(w)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of f)for(const w of x)Hu(w,e,i,c)}var _;return f}class js{constructor(e,i){this.type=Vt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ya(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const d=s.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new js(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new js(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new js(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(s.type==="Polygon"){const _=Xu(s.coordinates,d,f),x=wp(i.geometry(),c,d,f);if(!Us(c,d))return!1;for(const w of x)if(!oc(w,_))return!1}if(s.type==="MultiPolygon"){const _=xp(s.coordinates,d,f),x=wp(i.geometry(),c,d,f);if(!Us(c,d))return!1;for(const w of x)if(!qu(w,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(s.type==="Polygon"){const _=Xu(s.coordinates,d,f),x=Ku(i.geometry(),c,d,f);if(!Us(c,d))return!1;for(const w of x)if(!Kt(w,_))return!1}if(s.type==="MultiPolygon"){const _=xp(s.coordinates,d,f),x=Ku(i.geometry(),c,d,f);if(!Us(c,d))return!1;for(const w of x)if(!Eg(w,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var sc=js;function Gs(n){if(n instanceof ro&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof sc)return!1;let e=!0;return n.eachChild(i=>{e&&!Gs(i)&&(e=!1)}),e}function so(n){if(n instanceof ro&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!so(i)&&(e=!1)}),e}function ns(n,e){if(n instanceof ro&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(s=>{i&&!ns(s,e)&&(i=!1)}),i}class ac{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new ac(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var bp=ac;class tl{constructor(e,i=[],s,c=new mp,d=[]){this.registry=e,this.path=i,this.key=i.map(f=>`[${f}]`).join(""),this.scope=c,this.errors=d,this.expectedType=s}parse(e,i,s,c,d={}){return i?this.concat(i,s,c)._parse(e,d):this._parse(e,d)}_parse(e,i){function s(c,d,f){return f==="assert"?new io(d,[c]):f==="coerce"?new Vs(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let f=d.parse(e,this);if(!f)return null;if(this.expectedType){const _=this.expectedType,x=f.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(_,x))return null}else f=s(f,_,i.typeAnnotation||"coerce");else f=s(f,_,i.typeAnnotation||"assert")}if(!(f instanceof es)&&f.type.kind!=="resolvedImage"&&Ju(f)){const _=new Zu;try{f=new es(f.type,f.evaluate(_))}catch(x){return this.error(x.message),null}}return f}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const c=typeof e=="number"?this.path.concat(e):this.path,d=s?this.scope.concat(s):this.scope;return new tl(this.registry,c,i||null,d,this.errors)}error(e,...i){const s=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new Rr(s,e))}checkSubtype(e,i){const s=no(e,i);return s&&this.error(s),s}}var Yu=tl;function Ju(n){if(n instanceof bp)return Ju(n.boundExpression);if(n instanceof ro&&n.name==="error"||n instanceof Qa||n instanceof sc)return!1;const e=n instanceof Vs||n instanceof io;let i=!0;return n.eachChild(s=>{i=e?i&&Ju(s):i&&s instanceof es}),!!i&&Gs(n)&&ns(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function lc(n,e){const i=n.length-1;let s,c,d=0,f=i,_=0;for(;d<=f;)if(_=Math.floor((d+f)/2),s=n[_],c=n[_+1],s<=e){if(_===i||e<c)return _;d=_+1}else{if(!(s>e))throw new pi("Input is not a number.");f=_-1}return 0}class cc{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,d]of s)this.labels.push(c),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,st);if(!s)return null;const c=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let f=1;f<e.length;f+=2){const _=f===1?-1/0:e[f],x=e[f+1],w=f,S=f+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const A=i.parse(x,S,d);if(!A)return null;d=d||A.type,c.push([_,A])}return new cc(d,s,c)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return s[0].evaluate(e);const d=i.length;return c>=i[d-1]?s[d-1].evaluate(e):s[lc(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Qu=cc;function $t(n,e,i){return n*(1-i)+e*i}var nl=Object.freeze({__proto__:null,array:function(n,e,i){return n.map((s,c)=>$t(s,e[c],i))},color:function(n,e,i){return new Rn($t(n.r,e.r,i),$t(n.g,e.g,i),$t(n.b,e.b,i),$t(n.a,e.a,i))},number:$t});const Tp=.95047,eh=1.08883,Ep=4/29,is=6/29,th=3*is*is,Sg=is*is*is,Cg=Math.PI/180,Mg=180/Math.PI;function nh(n){return n>Sg?Math.pow(n,1/3):n/th+Ep}function ih(n){return n>is?n*n*n:th*(n-Ep)}function rh(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function uc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Sp(n){const e=uc(n.r),i=uc(n.g),s=uc(n.b),c=nh((.4124564*e+.3575761*i+.1804375*s)/Tp),d=nh((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-nh((.0193339*e+.119192*i+.9503041*s)/eh)),alpha:n.a}}function Cp(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*ih(e),i=Tp*ih(i),s=eh*ih(s),new Rn(rh(3.2404542*i-1.5371385*e-.4985314*s),rh(-.969266*i+1.8760108*e+.041556*s),rh(.0556434*i-.2040259*e+1.0572252*s),n.alpha)}function Ag(n,e,i){const s=e-n;return n+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const il={forward:Sp,reverse:Cp,interpolate:function(n,e,i){return{l:$t(n.l,e.l,i),a:$t(n.a,e.a,i),b:$t(n.b,e.b,i),alpha:$t(n.alpha,e.alpha,i)}}},$s={forward:function(n){const{l:e,a:i,b:s}=Sp(n),c=Math.atan2(s,i)*Mg;return{h:c<0?c+360:c,c:Math.sqrt(i*i+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Cg,i=n.c;return Cp({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Ag(n.h,e.h,i),c:$t(n.c,e.c,i),l:$t(n.l,e.l,i),alpha:$t(n.alpha,e.alpha,i)}}};var oh=Object.freeze({__proto__:null,hcl:$s,lab:il});class rl{constructor(e,i,s,c,d){this.type=e,this.operator=i,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[f,_]of d)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(e,i,s,c){let d=0;if(e.name==="exponential")d=sh(i,e.base,s,c);else if(e.name==="linear")d=sh(i,1,s,c);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new ct(f[0],f[1],f[2],f[3]).solve(sh(i,1,s,c))}return d}static parse(e,i){let[s,c,d,...f]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const w=c[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(w.length!==4||w.some(S=>typeof S!="number"||S<0||S>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,st),!d)return null;const _=[];let x=null;s==="interpolate-hcl"||s==="interpolate-lab"?x=Wi:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let w=0;w<f.length;w+=2){const S=f[w],A=f[w+1],P=w+3,D=w+4;if(typeof S!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(_.length&&_[_.length-1][0]>=S)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const L=i.parse(A,D,x);if(!L)return null;x=x||L.type,_.push([S,L])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new rl(x,s,c,d,_):i.error(`Type ${xn(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return s[0].evaluate(e);const d=i.length;if(c>=i[d-1])return s[d-1].evaluate(e);const f=lc(i,c),_=rl.interpolationFactor(this.interpolation,c,i[f],i[f+1]),x=s[f].evaluate(e),w=s[f+1].evaluate(e);return this.operator==="interpolate"?nl[this.type.kind.toLowerCase()](x,w,_):this.operator==="interpolate-hcl"?$s.reverse($s.interpolate($s.forward(x),$s.forward(w),_)):il.reverse(il.interpolate(il.forward(x),il.forward(w),_))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function sh(n,e,i,s){const c=s-i,d=n-i;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}var Fr=rl;class hc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const c=i.expectedType;c&&c.kind!=="value"&&(s=c);const d=[];for(const _ of e.slice(1)){const x=i.parse(_,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,d.push(x)}const f=c&&d.some(_=>no(c,_.type));return new hc(f?Ut:s,d)}evaluate(e){let i,s=null,c=0;for(const d of this.args){if(c++,s=d.evaluate(e),s&&s instanceof rr&&!s.available&&(i||(i=s),s=null,c===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ah=hc;class dc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const _=i.parse(e[d+1],d+1);if(!_)return null;s.push([f,_])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return c?new dc(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}var Mp=dc;class lh{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,st),c=i.parse(e[2],2,ir(i.expectedType||Ut));return s&&c?new lh(c.type.itemType,s,c):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new pi(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new pi(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new pi(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Pg=lh;class ch{constructor(e,i){this.type=Vt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ut),c=i.parse(e[2],2,Ut);return s&&c?Wa(s.type,[Vt,jt,st,Fs,Ut])?new ch(s,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${xn(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Xa(i,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${xn(Pn(i))} instead.`);if(!Xa(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${xn(Pn(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var pc=ch;class ol{constructor(e,i,s){this.type=st,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ut),c=i.parse(e[2],2,Ut);if(!s||!c)return null;if(!Wa(s.type,[Vt,jt,st,Fs,Ut]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${xn(s.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,st);return d?new ol(s,c,d):null}return new ol(s,c)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Xa(i,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${xn(Pn(i))} instead.`);if(!Xa(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${xn(Pn(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(i,c)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ap=ol;class uh{constructor(e,i,s,c,d,f){this.inputType=e,this.type=i,this.input=s,this.cases=c,this.outputs=d,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const d={},f=[];for(let w=2;w<e.length-1;w+=2){let S=e[w];const A=e[w+1];Array.isArray(S)||(S=[S]);const P=i.concat(w);if(S.length===0)return P.error("Expected at least one branch label.");for(const L of S){if(typeof L!="number"&&typeof L!="string")return P.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return P.error("Numeric branch labels must be integer values.");if(s){if(P.checkSubtype(s,Pn(L)))return null}else s=Pn(L);if(d[String(L)]!==void 0)return P.error("Branch labels must be unique.");d[String(L)]=f.length}const D=i.parse(A,w,c);if(!D)return null;c=c||D.type,f.push(D)}const _=i.parse(e[1],1,Ut);if(!_)return null;const x=i.parse(e[e.length-1],e.length-1,c);return x?_.type.kind!=="value"&&i.concat(1).checkSubtype(s,_.type)?null:new uh(s,c,_,d,f,x):null}evaluate(e){const i=this.input.evaluate(e);return(Pn(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],c={};for(const f of i){const _=c[this.cases[f]];_===void 0?(c[this.cases[f]]=s.length,s.push([this.cases[f],[f]])):s[_][1].push(f)}const d=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,_]of s)e.push(_.length===1?d(_[0]):_.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}var Ig=uh;class hh{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const c=[];for(let f=1;f<e.length-1;f+=2){const _=i.parse(e[f],f,Vt);if(!_)return null;const x=i.parse(e[f+1],f+1,s);if(!x)return null;c.push([_,x]),s=s||x.type}const d=i.parse(e[e.length-1],e.length-1,s);return d?new hh(s,c,d):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Pp=hh;class sl{constructor(e,i,s,c){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ut),c=i.parse(e[2],2,st);if(!s||!c)return null;if(!Wa(s.type,[ir(Ut),jt,Ut]))return i.error(`Expected first argument to be of type array or string, but found ${xn(s.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,st);return d?new sl(s.type,s,c,d):null}return new sl(s.type,s,c)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Xa(i,["string","array"]))throw new pi(`Expected first argument to be of type array or string, but found ${xn(Pn(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(s,c)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ip=sl;function fc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function kp(n,e,i,s){return s.compare(e,i)===0}function Zs(n,e,i){const s=n!=="=="&&n!=="!=";return class hS{constructor(d,f,_){this.type=Vt,this.lhs=d,this.rhs=f,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const _=d[0];let x=f.parse(d[1],1,Ut);if(!x)return null;if(!fc(_,x.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${xn(x.type)}'.`);let w=f.parse(d[2],2,Ut);if(!w)return null;if(!fc(_,w.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${xn(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error(`Cannot compare types '${xn(x.type)}' and '${xn(w.type)}'.`);s&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new io(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new io(x.type,[w])));let S=null;if(d.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(S=f.parse(d[3],3,Xi),!S)return null}return new hS(x,w,S)}evaluate(d){const f=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const x=Pn(f),w=Pn(_);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new pi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=Pn(f),w=Pn(_);if(x.kind!=="string"||w.kind!=="string")return e(d,f,_)}return this.collator?i(d,f,_,this.collator.evaluate(d)):e(d,f,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const kg=Zs("==",function(n,e,i){return e===i},kp),zg=Zs("!=",function(n,e,i){return e!==i},function(n,e,i,s){return!kp(0,e,i,s)}),Dg=Zs("<",function(n,e,i){return e<i},function(n,e,i,s){return s.compare(e,i)<0}),Lg=Zs(">",function(n,e,i){return e>i},function(n,e,i,s){return s.compare(e,i)>0}),Rg=Zs("<=",function(n,e,i){return e<=i},function(n,e,i,s){return s.compare(e,i)<=0}),zp=Zs(">=",function(n,e,i){return e>=i},function(n,e,i,s){return s.compare(e,i)>=0});class mc{constructor(e,i,s,c,d,f){this.type=jt,this.number=e,this.locale=i,this.currency=s,this.unit=c,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,st);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=i.parse(c.locale,1,jt),!d))return null;let f=null;if(c.currency&&(f=i.parse(c.currency,1,jt),!f))return null;let _=null;if(c.unit&&(_=i.parse(c.unit,1,jt),!_))return null;let x=null;if(c["min-fraction-digits"]&&(x=i.parse(c["min-fraction-digits"],1,st),!x))return null;let w=null;return c["max-fraction-digits"]&&(w=i.parse(c["max-fraction-digits"],1,st),!w)?null:new mc(s,d,f,_,x,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class qs{constructor(e){this.type=st,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${xn(s.type)} instead.`):new qs(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new pi(`Expected value to be of type string or array, but found ${xn(Pn(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Dp={"==":kg,"!=":zg,">":Lg,"<":Dg,">=":zp,"<=":Rg,array:io,at:Pg,boolean:io,case:Pp,coalesce:ah,collator:Qa,format:Io,image:ic,in:pc,"index-of":Ap,interpolate:Fr,"interpolate-hcl":Fr,"interpolate-lab":Fr,length:qs,let:Mp,literal:es,match:Ig,number:io,"number-format":mc,object:io,slice:Ip,step:Qu,string:io,"to-boolean":Vs,"to-color":Vs,"to-number":Vs,"to-string":Vs,var:bp,within:sc};function Lp(n,[e,i,s,c]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const d=c?c.evaluate(n):1,f=yp(e,i,s,d);if(f)throw new pi(f);return new Rn(e/255*d,i/255*d,s/255*d,d)}function ao(n,e){return n in e}function gc(n,e){const i=e[n];return i===void 0?null:i}function or(n){return{type:n}}ro.register(Dp,{error:[{kind:"error"},[jt],(n,[e])=>{throw new pi(e.evaluate(n))}],typeof:[jt,[Ut],(n,[e])=>xn(Pn(e.evaluate(n)))],"to-rgba":[ir(st,4),[Wi],(n,[e])=>e.evaluate(n).toArray()],rgb:[Wi,[st,st,st],Lp],rgba:[Wi,[st,st,st,st],Lp],has:{type:Vt,overloads:[[[jt],(n,[e])=>ao(e.evaluate(n),n.properties())],[[jt,xr],(n,[e,i])=>ao(e.evaluate(n),i.evaluate(n))]]},get:{type:Ut,overloads:[[[jt],(n,[e])=>gc(e.evaluate(n),n.properties())],[[jt,xr],(n,[e,i])=>gc(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Ut,[jt],(n,[e])=>gc(e.evaluate(n),n.featureState||{})],properties:[xr,[],n=>n.properties()],"geometry-type":[jt,[],n=>n.geometryType()],id:[Ut,[],n=>n.id()],zoom:[st,[],n=>n.globals.zoom],pitch:[st,[],n=>n.globals.pitch||0],"distance-from-center":[st,[],n=>n.distanceFromCenter()],"heatmap-density":[st,[],n=>n.globals.heatmapDensity||0],"line-progress":[st,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[st,[],n=>n.globals.skyRadialProgress||0],accumulated:[Ut,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[st,or(st),(n,e)=>{let i=0;for(const s of e)i+=s.evaluate(n);return i}],"*":[st,or(st),(n,e)=>{let i=1;for(const s of e)i*=s.evaluate(n);return i}],"-":{type:st,overloads:[[[st,st],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[st],(n,[e])=>-e.evaluate(n)]]},"/":[st,[st,st],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[st,[st,st],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[st,[st],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[st,[st],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[st,[st],(n,[e])=>Math.log(e.evaluate(n))],log2:[st,[st],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[st,[st],(n,[e])=>Math.sin(e.evaluate(n))],cos:[st,[st],(n,[e])=>Math.cos(e.evaluate(n))],tan:[st,[st],(n,[e])=>Math.tan(e.evaluate(n))],asin:[st,[st],(n,[e])=>Math.asin(e.evaluate(n))],acos:[st,[st],(n,[e])=>Math.acos(e.evaluate(n))],atan:[st,[st],(n,[e])=>Math.atan(e.evaluate(n))],min:[st,or(st),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[st,or(st),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[st,[st],(n,[e])=>Math.abs(e.evaluate(n))],round:[st,[st],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[st,[st],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[st,[st],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Vt,[jt,Ut],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Vt,[Ut],(n,[e])=>n.id()===e.value],"filter-type-==":[Vt,[jt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Vt,[jt,Ut],(n,[e,i])=>{const s=n.properties()[e.value],c=i.value;return typeof s==typeof c&&s<c}],"filter-id-<":[Vt,[Ut],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Vt,[jt,Ut],(n,[e,i])=>{const s=n.properties()[e.value],c=i.value;return typeof s==typeof c&&s>c}],"filter-id->":[Vt,[Ut],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Vt,[jt,Ut],(n,[e,i])=>{const s=n.properties()[e.value],c=i.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[Vt,[Ut],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Vt,[jt,Ut],(n,[e,i])=>{const s=n.properties()[e.value],c=i.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[Vt,[Ut],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Vt,[Ut],(n,[e])=>e.value in n.properties()],"filter-has-id":[Vt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Vt,[ir(jt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Vt,[ir(Ut)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Vt,[jt,ir(Ut)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Vt,[jt,ir(Ut)],(n,[e,i])=>function(s,c,d,f){for(;d<=f;){const _=d+f>>1;if(c[_]===s)return!0;c[_]>s?f=_-1:d=_+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Vt,overloads:[[[Vt,Vt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[or(Vt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Vt,overloads:[[[Vt,Vt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[or(Vt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Vt,[Vt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Vt,[jt],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[jt,[jt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[jt,[jt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[jt,or(Ut),(n,e)=>e.map(i=>Ja(i.evaluate(n))).join("")],"resolved-locale":[jt,[Xi],(n,[e])=>e.evaluate(n).resolvedLocale()]});var al=Dp;function Rp(n){return{result:"success",value:n}}function rs(n){return{result:"error",value:n}}function Ws(n){return n["property-type"]==="data-driven"}function _c(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function yc(n){return!!n.expression&&n.expression.interpolated}function Zt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function ll(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Bp(n){return n}function vc(n,e){const i=e.type==="color",s=n.stops&&typeof n.stops[0][0]=="object",c=s||!(s||n.property!==void 0),d=n.type||(yc(e)?"exponential":"interval");if(i&&((n=to({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],Rn.parse(w[1])])),n.default=Rn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!oh[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let f,_,x;if(d==="exponential")f=lo;else if(d==="interval")f=xc;else if(d==="categorical"){f=Fp,_=Object.create(null);for(const w of n.stops)_[w[0]]=w[1];x=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=Op}if(s){const w={},S=[];for(let D=0;D<n.stops.length;D++){const L=n.stops[D],F=L[0].zoom;w[F]===void 0&&(w[F]={zoom:F,type:n.type,property:n.property,default:n.default,stops:[]},S.push(F)),w[F].stops.push([L[0].value,L[1]])}const A=[];for(const D of S)A.push([w[D].zoom,vc(w[D],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Fr.interpolationFactor.bind(void 0,P),zoomStops:A.map(D=>D[0]),evaluate:({zoom:D},L)=>lo({stops:A,base:n.base},e,D).evaluate(D,L)}}if(c){const w=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Fr.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(S=>S[0]),evaluate:({zoom:S})=>f(n,e,S,_,x)}}return{kind:"source",evaluate(w,S){const A=S&&S.properties?S.properties[n.property]:void 0;return A===void 0?Xs(n.default,e.default):f(n,e,A,_,x)}}}function Xs(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Fp(n,e,i,s,c){return Xs(typeof i===c?s[i]:void 0,n.default,e.default)}function xc(n,e,i){if(Zt(i)!=="number")return Xs(n.default,e.default);const s=n.stops.length;if(s===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const c=lc(n.stops.map(d=>d[0]),i);return n.stops[c][1]}function lo(n,e,i){const s=n.base!==void 0?n.base:1;if(Zt(i)!=="number")return Xs(n.default,e.default);const c=n.stops.length;if(c===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[c-1][0])return n.stops[c-1][1];const d=lc(n.stops.map(S=>S[0]),i),f=function(S,A,P,D){const L=D-P,F=S-P;return L===0?0:A===1?F/L:(Math.pow(A,F)-1)/(Math.pow(A,L)-1)}(i,s,n.stops[d][0],n.stops[d+1][0]),_=n.stops[d][1],x=n.stops[d+1][1];let w=nl[e.type]||Bp;if(n.colorSpace&&n.colorSpace!=="rgb"){const S=oh[n.colorSpace];w=(A,P)=>S.reverse(S.interpolate(S.forward(A),S.forward(P),f))}return typeof _.evaluate=="function"?{evaluate(...S){const A=_.evaluate.apply(void 0,S),P=x.evaluate.apply(void 0,S);if(A!==void 0&&P!==void 0)return w(A,P,f)}}:w(_,x,f)}function Op(n,e,i){return e.type==="color"?i=Rn.parse(i):e.type==="formatted"?i=Li.fromString(i.toString()):e.type==="resolvedImage"?i=rr.fromString(i.toString()):Zt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Xs(i,n.default,e.default)}class wc{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new Zu,this._defaultValue=i?function(s){return s.type==="color"&&(ll(s.default)||Array.isArray(s.default))?new Rn(0,0,0,0):s.type==="color"?Rn.parse(s.default)||null:s.default===void 0?null:s.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,s,c,d,f,_,x){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,c,d,f,_,x){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Hs(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in al}function Ks(n,e){const i=new Yu(al,[],e?function(c){const d={color:Wi,string:jt,number:st,enum:jt,boolean:Vt,formatted:qa,resolvedImage:Qo};return c.type==="array"?ir(d[c.value]||Ut,c.length):d[c.type]}(e):void 0),s=i.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Rp(new wc(s,e)):rs(i.errors)}class dh{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!so(i.expression)}evaluateWithoutErrorHandling(e,i,s,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,c,d,f)}evaluate(e,i,s,c,d,f){return this._styleExpression.evaluate(e,i,s,c,d,f)}}class cl{constructor(e,i,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!so(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,s,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,c,d,f)}evaluate(e,i,s,c,d,f){return this._styleExpression.evaluate(e,i,s,c,d,f)}interpolationFactor(e,i,s){return this.interpolationType?Fr.interpolationFactor(this.interpolationType,e,i,s):0}}function ul(n,e){if((n=Ks(n,e)).result==="error")return n;const i=n.value.expression,s=Gs(i);if(!s&&!Ws(e))return rs([new Rr("","data expressions not supported")]);const c=ns(i,["zoom","pitch","distance-from-center"]);if(!c&&!_c(e))return rs([new Rr("","zoom expressions not supported")]);const d=Tc(i);return d||c?d instanceof Rr?rs([d]):d instanceof Fr&&!yc(e)?rs([new Rr("",'"interpolate" expressions cannot be used with this property')]):Rp(d?new cl(s?"camera":"composite",n.value,d.labels,d instanceof Fr?d.interpolation:void 0):new dh(s?"constant":"source",n.value)):rs([new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class bc{constructor(e,i){this._parameters=e,this._specification=i,to(this,vc(this._parameters,this._specification))}static deserialize(e){return new bc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Tc(n){let e=null;if(n instanceof Mp)e=Tc(n.result);else if(n instanceof ah){for(const i of n.args)if(e=Tc(i),e)break}else(n instanceof Qu||n instanceof Fr)&&n.input instanceof ro&&n.input.name==="zoom"&&(e=n);return e instanceof Rr||n.eachChild(i=>{const s=Tc(i);s instanceof Rr?e=s:!e&&s?e=new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class lt{constructor(e,i,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function wr(n){const e=n.key,i=n.value,s=n.valueSpec||{},c=n.objectElementValidators||{},d=n.style,f=n.styleSpec;let _=[];const x=Zt(i);if(x!=="object")return[new lt(e,i,`object expected, ${x} found`)];for(const w in i){const S=w.split(".")[0];let A;c[S]?A=c[S]:s[S]?A=xi:c["*"]?A=c["*"]:s["*"]&&(A=xi),A?_=_.concat(A({key:(e&&`${e}.`)+w,value:i[w],valueSpec:s[S]||s["*"],style:d,styleSpec:f,object:i,objectKey:w},i)):_.push(new lt(e,i[w],`unknown property "${w}"`))}for(const w in s)c[w]||s[w].required&&s[w].default===void 0&&i[w]===void 0&&_.push(new lt(e,i,`missing required property "${w}"`));return _}function Vp(n){const e=n.value,i=n.valueSpec,s=n.style,c=n.styleSpec,d=n.key,f=n.arrayElementValidator||xi;if(Zt(e)!=="array")return[new lt(d,e,`array expected, ${Zt(e)} found`)];if(i.length&&e.length!==i.length)return[new lt(d,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new lt(d,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let _={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};c.$version<7&&(_.function=i.function),Zt(i.value)==="object"&&(_=i.value);let x=[];for(let w=0;w<e.length;w++)x=x.concat(f({array:e,arrayIndex:w,value:e[w],valueSpec:_,style:s,styleSpec:c,key:`${d}[${w}]`}));return x}function hl(n){const e=n.key,i=n.value,s=n.valueSpec;let c=Zt(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new lt(e,i,`number expected, ${c} found`)];if("minimum"in s){let d=s.minimum;if(Zt(s.minimum)==="array"&&(d=s.minimum[n.arrayIndex]),i<d)return[new lt(e,i,`${i} is less than the minimum value ${d}`)]}if("maximum"in s){let d=s.maximum;if(Zt(s.maximum)==="array"&&(d=s.maximum[n.arrayIndex]),i>d)return[new lt(e,i,`${i} is greater than the maximum value ${d}`)]}return[]}function dl(n){const e=n.valueSpec,i=Vn(n.value.type);let s,c,d,f={};const _=i!=="categorical"&&n.value.property===void 0,x=!_,w=Zt(n.value.stops)==="array"&&Zt(n.value.stops[0])==="array"&&Zt(n.value.stops[0][0])==="object",S=wr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(D){if(i==="identity")return[new lt(D.key,D.value,'identity function may not have a "stops" property')];let L=[];const F=D.value;return L=L.concat(Vp({key:D.key,value:F,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:A})),Zt(F)==="array"&&F.length===0&&L.push(new lt(D.key,F,"array must have at least one stop")),L},default:function(D){return xi({key:D.key,value:D.value,valueSpec:e,style:D.style,styleSpec:D.styleSpec})}}});return i==="identity"&&_&&S.push(new lt(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||S.push(new lt(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!yc(n.valueSpec)&&S.push(new lt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!Ws(n.valueSpec)?S.push(new lt(n.key,n.value,"property functions not supported")):_&&!_c(n.valueSpec)&&S.push(new lt(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!w||n.value.property!==void 0||S.push(new lt(n.key,n.value,'"property" property is required')),S;function A(D){let L=[];const F=D.value,j=D.key;if(Zt(F)!=="array")return[new lt(j,F,`array expected, ${Zt(F)} found`)];if(F.length!==2)return[new lt(j,F,`array length 2 expected, length ${F.length} found`)];if(w){if(Zt(F[0])!=="object")return[new lt(j,F,`object expected, ${Zt(F[0])} found`)];if(F[0].zoom===void 0)return[new lt(j,F,"object stop key must have zoom")];if(F[0].value===void 0)return[new lt(j,F,"object stop key must have value")];const Y=Vn(F[0].zoom);if(typeof Y!="number")return[new lt(j,F[0].zoom,"stop zoom values must be numbers")];if(d&&d>Y)return[new lt(j,F[0].zoom,"stop zoom values must appear in ascending order")];Y!==d&&(d=Y,c=void 0,f={}),L=L.concat(wr({key:`${j}[0]`,value:F[0],valueSpec:{zoom:{}},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{zoom:hl,value:P}}))}else L=L.concat(P({key:`${j}[0]`,value:F[0],valueSpec:{},style:D.style,styleSpec:D.styleSpec},F));return Hs(oi(F[1]))?L.concat([new lt(`${j}[1]`,F[1],"expressions are not allowed in function stops.")]):L.concat(xi({key:`${j}[1]`,value:F[1],valueSpec:e,style:D.style,styleSpec:D.styleSpec}))}function P(D,L){const F=Zt(D.value),j=Vn(D.value),Y=D.value!==null?D.value:L;if(s){if(F!==s)return[new lt(D.key,Y,`${F} stop domain type must match previous stop domain type ${s}`)]}else s=F;if(F!=="number"&&F!=="string"&&F!=="boolean"&&typeof j!="number"&&typeof j!="string"&&typeof j!="boolean")return[new lt(D.key,Y,"stop domain value must be a number, string, or boolean")];if(F!=="number"&&i!=="categorical"){let oe=`number expected, ${F} found`;return Ws(e)&&i===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(D.key,Y,oe)]}return i!=="categorical"||F!=="number"||typeof j=="number"&&isFinite(j)&&Math.floor(j)===j?i!=="categorical"&&F==="number"&&typeof j=="number"&&typeof c=="number"&&c!==void 0&&j<c?[new lt(D.key,Y,"stop domain values must appear in ascending order")]:(c=j,i==="categorical"&&j in f?[new lt(D.key,Y,"stop domain values must be unique")]:(f[j]=!0,[])):[new lt(D.key,Y,`integer expected, found ${String(j)}`)]}}function si(n){const e=(n.expressionContext==="property"?ul:Ks)(oi(n.value),n.valueSpec);if(e.result==="error")return e.value.map(s=>new lt(`${n.key}${s.key}`,n.value,s.message));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new lt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!so(i))return[new lt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return pl(i,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!ns(i,["zoom","feature-state"]))return[new lt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Gs(i))return[new lt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pl(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)i.delete(c);if(i.size===0)return[];const s=[];return n instanceof ro&&i.has(n.name)?[new lt(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(c=>{s.push(...pl(c,e))}),s)}function Ec(n){const e=n.key,i=n.value,s=n.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(Vn(i))===-1&&c.push(new lt(e,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(s.values).indexOf(Vn(i))===-1&&c.push(new lt(e,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function ph(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!ph(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Sc(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ph(n)||(n=Js(n));const i=n;let s=!0;try{s=function(w){if(!Ys(w))return w;let S=oi(w);return Cc(S),S=Up(S),S}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const c=De[`filter_${e}`],d=Ks(s,c);let f=null;if(d.result==="error")throw new Error(d.value.map(w=>`${w.key}: ${w.message}`).join(", "));f=(w,S,A)=>d.value.evaluate(w,S,{},A);let _=null,x=null;if(s!==i){const w=Ks(i,c);if(w.result==="error")throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));_=(S,A,P,D,L)=>w.value.evaluate(S,A,{},P,void 0,void 0,D,L),x=!Gs(w.value.expression)}return{filter:f,dynamicFilter:_||void 0,needGeometry:Np(s),needFeature:!!x}}function Up(n){if(!Array.isArray(n))return n;const e=function(i){if(fh.has(i[0])){for(let s=1;s<i.length;s++)if(Ys(i[s]))return!0}return i}(n);return e===!0?e:e.map(i=>Up(i))}function Cc(n){let e=!1;const i=[];if(n[0]==="case"){for(let s=1;s<n.length-1;s+=2)e=e||Ys(n[s]),i.push(n[s+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Ys(n[1]);for(let s=2;s<n.length-1;s+=2)i.push(n[s+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Ys(n[1]);for(let s=1;s<n.length-1;s+=2)i.push(n[s+1])}e&&(n.length=0,n.push("any",...i));for(let s=1;s<n.length;s++)Cc(n[s])}function Ys(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Ys(n[i]))return!0;return!1}const fh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Bg(n,e){return n<e?-1:n>e?1:0}function Np(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(Np(n[e]))return!0;return!1}function Js(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?mh(n[1],n[2],"=="):e==="!="?Mc(mh(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?mh(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Js))):e==="all"?["all"].concat(n.slice(1).map(Js)):e==="none"?["all"].concat(n.slice(1).map(Js).map(Mc)):e==="in"?gh(n[1],n.slice(2)):e==="!in"?Mc(gh(n[1],n.slice(2))):e==="has"?_h(n[1]):e==="!has"?Mc(_h(n[1])):e!=="within"||n;var i}function mh(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function gh(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Bg)]]:["filter-in-small",n,["literal",e]]}}function _h(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Mc(n){return["!",n]}function fl(n){return ph(oi(n.value))?si(to({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):ml(n)}function ml(n){const e=n.value,i=n.key;if(Zt(e)!=="array")return[new lt(i,e,`array expected, ${Zt(e)} found`)];const s=n.styleSpec;let c,d=[];if(e.length<1)return[new lt(i,e,"filter array must have at least 1 element")];switch(d=d.concat(Ec({key:`${i}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),Vn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Vn(e[1])==="$type"&&d.push(new lt(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new lt(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Zt(e[1]),c!=="string"&&d.push(new lt(`${i}[1]`,e[1],`string expected, ${c} found`)));for(let f=2;f<e.length;f++)c=Zt(e[f]),Vn(e[1])==="$type"?d=d.concat(Ec({key:`${i}[${f}]`,value:e[f],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new lt(`${i}[${f}]`,e[f],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)d=d.concat(ml({key:`${i}[${f}]`,value:e[f],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=Zt(e[1]),e.length!==2?d.push(new lt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new lt(`${i}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Zt(e[1]),e.length!==2?d.push(new lt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&d.push(new lt(`${i}[1]`,e[1],`object expected, ${c} found`))}return d}function yh(n,e){const i=n.key,s=n.style,c=n.styleSpec,d=n.value,f=n.objectKey,_=c[`${e}_${n.layerType}`];if(!_)return[];const x=f.match(/^(.*)-transition$/);if(e==="paint"&&x&&_[x[1]]&&_[x[1]].transition)return xi({key:i,value:d,valueSpec:c.transition,style:s,styleSpec:c});const w=n.valueSpec||_[f];if(!w)return[new lt(i,d,`unknown property "${f}"`)];let S;if(Zt(d)==="string"&&Ws(w)&&!w.tokens&&(S=/^{([^}]+)}$/.exec(d))){const P=`\`{ "type": "identity", "property": ${S?JSON.stringify(S[1]):'"_"'} }\``;return[new lt(i,d,`"${f}" does not support interpolation syntax
Use an identity property function instead: ${P}.`)]}const A=[];return n.layerType==="symbol"&&(f==="text-field"&&s&&!s.glyphs&&A.push(new lt(i,d,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&ll(oi(d))&&Vn(d.type)==="identity"&&A.push(new lt(i,d,'"text-font" does not support identity functions'))),A.concat(xi({key:n.key,value:d,valueSpec:w,style:s,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:f}))}function jp(n){return yh(n,"paint")}function vh(n){return yh(n,"layout")}function Gp(n){let e=[];const i=n.value,s=n.key,c=n.style,d=n.styleSpec;i.type||i.ref||e.push(new lt(s,i,'either "type" or "ref" is required'));let f=Vn(i.type);const _=Vn(i.ref);if(i.id){const x=Vn(i.id);for(let w=0;w<n.arrayIndex;w++){const S=c.layers[w];Vn(S.id)===x&&e.push(new lt(s,i.id,`duplicate layer id "${i.id}", previously used at line ${S.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach(w=>{w in i&&e.push(new lt(s,i[w],`"${w}" is prohibited for ref layers`))}),c.layers.forEach(w=>{Vn(w.id)===_&&(x=w)}),x?x.ref?e.push(new lt(s,i.ref,"ref cannot reference another ref layer")):f=Vn(x.type):typeof _=="string"&&e.push(new lt(s,i.ref,`ref layer "${_}" not found`))}else if(f!=="background"&&f!=="sky")if(i.source){const x=c.sources&&c.sources[i.source],w=x&&Vn(x.type);x?w==="vector"&&f==="raster"?e.push(new lt(s,i.source,`layer "${i.id}" requires a raster source`)):w==="raster"&&f!=="raster"?e.push(new lt(s,i.source,`layer "${i.id}" requires a vector source`)):w!=="vector"||i["source-layer"]?w==="raster-dem"&&f!=="hillshade"?e.push(new lt(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||w==="geojson"&&x.lineMetrics||e.push(new lt(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new lt(s,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new lt(s,i.source,`source "${i.source}" not found`))}else e.push(new lt(s,i,'missing required property "source"'));return e=e.concat(wr({key:s,value:i,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>xi({key:`${s}.type`,value:i.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:x=>fl(to({layerType:f},x)),layout:x=>wr({layer:i,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>vh(to({layerType:f},w))}}),paint:x=>wr({layer:i,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>jp(to({layerType:f},w))}})}})),e}function ko(n){const e=n.value,i=n.key,s=Zt(e);return s!=="string"?[new lt(i,e,`string expected, ${s} found`)]:[]}const $p={promoteId:function({key:n,value:e}){if(Zt(e)==="string")return ko({key:n,value:e});{const i=[];for(const s in e)i.push(...ko({key:`${n}.${s}`,value:e[s]}));return i}}};function Zp(n){const e=n.value,i=n.key,s=n.styleSpec,c=n.style;if(!e.type)return[new lt(i,e,'"type" is required')];const d=Vn(e.type);let f;switch(d){case"vector":case"raster":case"raster-dem":return f=wr({key:i,value:e,valueSpec:s[`source_${d.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:$p}),f;case"geojson":if(f=wr({key:i,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:$p}),e.cluster)for(const _ in e.clusterProperties){const[x,w]=e.clusterProperties[_],S=typeof x=="string"?[x,["accumulated"],["get",_]]:x;f.push(...si({key:`${i}.${_}.map`,value:w,expressionContext:"cluster-map"})),f.push(...si({key:`${i}.${_}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return f;case"video":return wr({key:i,value:e,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return wr({key:i,value:e,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new lt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ec({key:`${i}.type`,value:e.type,valueSpec:{values:Fg(s)},style:c,styleSpec:s})}}function Fg(n){return n.source.reduce((e,i)=>{const s=n[i];return s.type.type==="enum"&&(e=e.concat(Object.keys(s.type.values))),e},[])}function qp(n){const e=n.value,i=n.styleSpec,s=i.light,c=n.style;let d=[];const f=Zt(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new lt("light",e,`object expected, ${f} found`)]),d;for(const _ in e){const x=_.match(/^(.*)-transition$/);d=d.concat(x&&s[x[1]]&&s[x[1]].transition?xi({key:_,value:e[_],valueSpec:i.transition,style:c,styleSpec:i}):s[_]?xi({key:_,value:e[_],valueSpec:s[_],style:c,styleSpec:i}):[new lt(_,e[_],`unknown property "${_}"`)])}return d}function xh(n){const e=n.value,i=n.key,s=n.style,c=n.styleSpec,d=c.terrain;let f=[];const _=Zt(e);if(e===void 0)return f;if(_!=="object")return f=f.concat([new lt("terrain",e,`object expected, ${_} found`)]),f;for(const x in e){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&d[w[1]]&&d[w[1]].transition?xi({key:x,value:e[x],valueSpec:c.transition,style:s,styleSpec:c}):d[x]?xi({key:x,value:e[x],valueSpec:d[x],style:s,styleSpec:c}):[new lt(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=s.sources&&s.sources[e.source],w=x&&Vn(x.type);x?w!=="raster-dem"&&f.push(new lt(i,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):f.push(new lt(i,e.source,`source "${e.source}" not found`))}else f.push(new lt(i,e,'terrain is missing required property "source"'));return f}function Wp(n){const e=n.value,i=n.style,s=n.styleSpec,c=s.fog;let d=[];const f=Zt(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new lt("fog",e,`object expected, ${f} found`)]),d;for(const _ in e){const x=_.match(/^(.*)-transition$/);d=d.concat(x&&c[x[1]]&&c[x[1]].transition?xi({key:_,value:e[_],valueSpec:s.transition,style:i,styleSpec:s}):c[_]?xi({key:_,value:e[_],valueSpec:c[_],style:i,styleSpec:s}):[new lt(_,e[_],`unknown property "${_}"`)])}return d}const Xp={"*":()=>[],array:Vp,boolean:function(n){const e=n.value,i=n.key,s=Zt(e);return s!=="boolean"?[new lt(i,e,`boolean expected, ${s} found`)]:[]},number:hl,color:function(n){const e=n.key,i=n.value,s=Zt(i);return s!=="string"?[new lt(e,i,`color expected, ${s} found`)]:Ou(i)===null?[new lt(e,i,`color expected, "${i}" found`)]:[]},enum:Ec,filter:fl,function:dl,layer:Gp,object:wr,source:Zp,light:qp,terrain:xh,fog:Wp,string:ko,formatted:function(n){return ko(n).length===0?[]:si(n)},resolvedImage:function(n){return ko(n).length===0?[]:si(n)},projection:function(n){const e=n.value,i=n.styleSpec,s=i.projection,c=n.style;let d=[];const f=Zt(e);if(f==="object")for(const _ in e)d=d.concat(xi({key:_,value:e[_],valueSpec:s[_],style:c,styleSpec:i}));else f!=="string"&&(d=d.concat([new lt("projection",e,`object or string expected, ${f} found`)]));return d}};function xi(n){const e=n.value,i=n.valueSpec,s=n.styleSpec;return i.expression&&ll(Vn(e))?dl(n):i.expression&&Hs(oi(e))?si(n):i.type&&Xp[i.type]?Xp[i.type](n):wr(to({},n,{valueSpec:i.type?s[i.type]:i}))}function Og(n){const e=n.value,i=n.key,s=ko(n);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new lt(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new lt(i,e,'"glyphs" url must include a "{range}" token'))),s}function Hp(n,e=De){return sr(xi({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:Og,"*":()=>[]}}))}const Vg=n=>sr(jp(n)),Ug=n=>sr(vh(n));function sr(n){return n.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Kp(n,e){let i=!1;if(e&&e.length)for(const s of e)n.fire(new eo(new Error(s.message))),i=!0;return i}var Ng=Or,br=3;function Or(n,e,i){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var c=new Int32Array(this.arrayBuffer);n=c[0],this.d=(e=c[1])+2*(i=c[2]);for(var d=0;d<this.d*this.d;d++){var f=c[br+d],_=c[br+d+1];s.push(f===_?null:c.subarray(f,_))}var x=c[br+s.length+1];this.keys=c.subarray(c[br+s.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var S=i/e*n;this.min=-S,this.max=n+S}Or.prototype.insert=function(n,e,i,s,c){this._forEachCell(e,i,s,c,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c)},Or.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Or.prototype._insertCell=function(n,e,i,s,c,d){this.cells[c].push(d)},Or.prototype.query=function(n,e,i,s,c){var d=this.min,f=this.max;if(n<=d&&e<=d&&f<=i&&f<=s&&!c)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(n,e,i,s,this._queryCell,_,{},c),_},Or.prototype._queryCell=function(n,e,i,s,c,d,f,_){var x=this.cells[c];if(x!==null)for(var w=this.keys,S=this.bboxes,A=0;A<x.length;A++){var P=x[A];if(f[P]===void 0){var D=4*P;(_?_(S[D+0],S[D+1],S[D+2],S[D+3]):n<=S[D+2]&&e<=S[D+3]&&i>=S[D+0]&&s>=S[D+1])?(f[P]=!0,d.push(w[P])):f[P]=!1}}},Or.prototype._forEachCell=function(n,e,i,s,c,d,f,_){for(var x=this._convertToCellCoord(n),w=this._convertToCellCoord(e),S=this._convertToCellCoord(i),A=this._convertToCellCoord(s),P=x;P<=S;P++)for(var D=w;D<=A;D++){var L=this.d*D+P;if((!_||_(this._convertFromCellCoord(P),this._convertFromCellCoord(D),this._convertFromCellCoord(P+1),this._convertFromCellCoord(D+1)))&&c.call(this,n,e,i,s,L,d,f,_))return}},Or.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Or.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Or.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=br+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var c=new Int32Array(e+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,f=0;f<n.length;f++){var _=n[f];c[br+f]=d,c.set(_,d),d+=_.length}return c[br+n.length]=d,c.set(this.keys,d),c[br+n.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};var os=le(Ng);const Ac={};function ut(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Ac[e]={klass:n,omit:i.omit||[]}}ut(Object,"Object"),os.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},os.deserialize=function(n){return new os(n.buffer)},Object.defineProperty(os,"name",{value:"Grid"}),ut(os,"Grid"),ut(Rn,"Color"),ut(Error,"Error"),ut(Po,"AJAXError"),ut(rr,"ResolvedImage"),ut(bc,"StylePropertyFunction"),ut(wc,"StyleExpression",{omit:["_evaluator"]}),ut(cl,"ZoomDependentExpression"),ut(dh,"ZoomConstantExpression"),ut(ro,"CompoundExpression",{omit:["_evaluate"]});for(const n in al)Ac[al[n]._classRegistryKey]||ut(al[n],`Expression${n}`);function wh(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function bh(n){return I.ImageBitmap&&n instanceof I.ImageBitmap}function Qs(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(wh(n)||bh(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof I.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const s of n)i.push(Qs(s,e));return i}if(typeof n=="object"){const i=n.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const c=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const d in n)n.hasOwnProperty(d)&&(Ac[s].omit.indexOf(d)>=0||(c[d]=Qs(n[d],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof n)}function ss(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||wh(n)||bh(n)||ArrayBuffer.isView(n)||n instanceof I.ImageData)return n;if(Array.isArray(n))return n.map(ss);if(typeof n=="object"){const e=n.$name||"Object",{klass:i}=Ac[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const s=Object.create(i.prototype);for(const c of Object.keys(n))c!=="$name"&&(s[c]=ss(n[c]));return s}throw new Error("can't deserialize object of type "+typeof n)}const ot={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Th(n){for(const e of n)if(Eh(e.charCodeAt(0)))return!0;return!1}function jg(n){for(const e of n)if(!Yp(e.charCodeAt(0)))return!1;return!0}function Yp(n){return!(ot.Arabic(n)||ot["Arabic Supplement"](n)||ot["Arabic Extended-A"](n)||ot["Arabic Presentation Forms-A"](n)||ot["Arabic Presentation Forms-B"](n))}function Eh(n){return!(n!==746&&n!==747&&(n<4352||!(ot["Bopomofo Extended"](n)||ot.Bopomofo(n)||ot["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||ot["CJK Compatibility Ideographs"](n)||ot["CJK Compatibility"](n)||ot["CJK Radicals Supplement"](n)||ot["CJK Strokes"](n)||!(!ot["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||ot["CJK Unified Ideographs Extension A"](n)||ot["CJK Unified Ideographs"](n)||ot["Enclosed CJK Letters and Months"](n)||ot["Hangul Compatibility Jamo"](n)||ot["Hangul Jamo Extended-A"](n)||ot["Hangul Jamo Extended-B"](n)||ot["Hangul Jamo"](n)||ot["Hangul Syllables"](n)||ot.Hiragana(n)||ot["Ideographic Description Characters"](n)||ot.Kanbun(n)||ot["Kangxi Radicals"](n)||ot["Katakana Phonetic Extensions"](n)||ot.Katakana(n)&&n!==12540||!(!ot["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!ot["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||ot["Unified Canadian Aboriginal Syllabics"](n)||ot["Unified Canadian Aboriginal Syllabics Extended"](n)||ot["Vertical Forms"](n)||ot["Yijing Hexagram Symbols"](n)||ot["Yi Syllables"](n)||ot["Yi Radicals"](n))))}function Jp(n){return!(Eh(n)||function(e){return!!(ot["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ot["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ot["Letterlike Symbols"](e)||ot["Number Forms"](e)||ot["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ot["Control Pictures"](e)&&e!==9251||ot["Optical Character Recognition"](e)||ot["Enclosed Alphanumerics"](e)||ot["Geometric Shapes"](e)||ot["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ot["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ot["CJK Symbols and Punctuation"](e)||ot.Katakana(e)||ot["Private Use Area"](e)||ot["CJK Compatibility Forms"](e)||ot["Small Form Variants"](e)||ot["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function Qp(n){return n>=1424&&n<=2303||ot["Arabic Presentation Forms-A"](n)||ot["Arabic Presentation Forms-B"](n)}function Gg(n,e){return!(!e&&Qp(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||ot.Khmer(n))}function $g(n){for(const e of n)if(Qp(e.charCodeAt(0)))return!0;return!1}const Sh="deferred",Ch="loading",Mh="loaded";let ea=null,h="unavailable",r=null;const l=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(h="error"),ea&&ea(n)};function p(){g.fire(new Jo("pluginStateChange",{pluginStatus:h,pluginURL:r}))}const g=new Za,y=function(){return h},T=function(){if(h!==Sh||!r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");h=Ch,p(),r&&Rs({url:r},n=>{n?l(n):(h=Mh,p())})},E={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>h===Mh||E.applyArabicShaping!=null,isLoading:()=>h===Ch,setState(n){h=n.pluginStatus,r=n.pluginURL},isParsed:()=>E.applyArabicShaping!=null&&E.processBidirectionalText!=null&&E.processStyledBidirectionalText!=null,getPluginURL:()=>r};class M{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,s){for(const c of i)if(!Gg(c.charCodeAt(0),s))return!1;return!0}(e,E.isLoaded())}}class z{constructor(e,i){this.property=e,this.value=i,this.expression=function(s,c){if(ll(s))return new bc(s,c);if(Hs(s)){const d=ul(s,c);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=s;return typeof s=="string"&&c.type==="color"&&(d=Rn.parse(s)),{kind:"constant",evaluate:()=>d}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class k{constructor(e){this.property=e,this.value=new z(e,void 0)}transitioned(e,i){return new N(this.property,this.value,i,hn({},e.transition,this.transition),e.now)}untransitioned(){return new N(this.property,this.value,null,{},0)}}class R{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return yi(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new k(this._values[e].property)),this._values[e].value=new z(this._values[e].property,i===null?void 0:yi(i))}getTransition(e){return yi(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new k(this._values[e].property)),this._values[e].transition=yi(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const s=new Z(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,i._values[c]);return s}untransitioned(){const e=new Z(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class N{constructor(e,i,s,c,d){const f=c.delay||0,_=c.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+f,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const c=e.now||0,d=this.value.possiblyEvaluate(e,i,s),f=this.prior;if(f){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return f.possiblyEvaluate(e,i,s);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,s),d,vn(_))}}return d}}class Z{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const c=new K(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,i,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class X{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return yi(this._values[e].value)}setValue(e,i){this._values[e]=new z(this._values[e].property,i===null?void 0:yi(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const c=new K(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,i,s);return c}}class W{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,c){return this.property.evaluate(this.value,this.parameters,e,i,s,c)}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class B{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const c=nl[this.specification.type];return c?c(e,i,s):e}}class ${constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,c){return new W(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},s,c)}:e.expression,i)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new W(this,{kind:"constant",value:void 0},e.parameters);const c=nl[this.specification.type];return c?new W(this,{kind:"constant",value:c(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,c,d,f){return e.kind==="constant"?e.value:e.evaluate(i,s,c,d,f)}}class Q{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,c){return!!e.expression.evaluate(i,null,{},s,c)}interpolate(){return!1}}class ee{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new M(0,{});for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new z(c,void 0),f=this.defaultTransitionablePropertyValues[s]=new k(c);this.defaultTransitioningPropertyValues[s]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate(i)}}}function he(n,e){return 256*(n=We(Math.floor(n),0,255))+We(Math.floor(e),0,255)}ut($,"DataDrivenProperty"),ut(B,"DataConstantProperty"),ut(Q,"ColorRampProperty");const pe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class de{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ve{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ye(n,e=1){let i=0,s=0;return{members:n.map(c=>{const d=pe[c.type].BYTES_PER_ELEMENT,f=i=Se(i,Math.max(e,d)),_=c.components||1;return s=Math.max(s,d),i+=d*_,{name:c.name,type:c.type,components:_,offset:f}}),size:Se(i,Math.max(s,e)),alignment:e}}function Se(n,e){return Math.ceil(n/e)*e}class $e extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=s,e}}$e.prototype.bytesPerElement=4,ut($e,"StructArrayLayout2i4");class be extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=s,this.int16[d+2]=c,e}}be.prototype.bytesPerElement=6,ut(be,"StructArrayLayout3i6");class Fe extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c)}emplace(e,i,s,c,d){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=c,this.int16[f+3]=d,e}}Fe.prototype.bytesPerElement=8,ut(Fe,"StructArrayLayout4i8");class Me extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,c,d,f,_)}emplace(e,i,s,c,d,f,_,x){const w=6*e,S=12*e,A=3*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.uint8[S+4]=c,this.uint8[S+5]=d,this.uint8[S+6]=f,this.uint8[S+7]=_,this.float32[A+2]=x,e}}Me.prototype.bytesPerElement=12,ut(Me,"StructArrayLayout2i4ub1f12");class Ge extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c)}emplace(e,i,s,c,d){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=c,this.float32[f+3]=d,e}}Ge.prototype.bytesPerElement=16,ut(Ge,"StructArrayLayout4f16");class Ee extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,c,d)}emplace(e,i,s,c,d,f){const _=6*e,x=3*e;return this.uint16[_+0]=i,this.uint16[_+1]=s,this.uint16[_+2]=c,this.uint16[_+3]=d,this.float32[x+2]=f,e}}Ee.prototype.bytesPerElement=12,ut(Ee,"StructArrayLayout4ui1f12");class Re extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c)}emplace(e,i,s,c,d){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=c,this.uint16[f+3]=d,e}}Re.prototype.bytesPerElement=8,ut(Re,"StructArrayLayout4ui8");class qe extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,c,d,f)}emplace(e,i,s,c,d,f,_){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=c,this.int16[x+3]=d,this.int16[x+4]=f,this.int16[x+5]=_,e}}qe.prototype.bytesPerElement=12,ut(qe,"StructArrayLayout6i12");class Ue extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,_,x,w,S,A,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,s,c,d,f,_,x,w,S,A,P)}emplace(e,i,s,c,d,f,_,x,w,S,A,P,D){const L=12*e;return this.int16[L+0]=i,this.int16[L+1]=s,this.int16[L+2]=c,this.int16[L+3]=d,this.uint16[L+4]=f,this.uint16[L+5]=_,this.uint16[L+6]=x,this.uint16[L+7]=w,this.int16[L+8]=S,this.int16[L+9]=A,this.int16[L+10]=P,this.int16[L+11]=D,e}}Ue.prototype.bytesPerElement=24,ut(Ue,"StructArrayLayout4i4ui4i24");class Xe extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,c,d,f)}emplace(e,i,s,c,d,f,_){const x=10*e,w=5*e;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=c,this.float32[w+2]=d,this.float32[w+3]=f,this.float32[w+4]=_,e}}Xe.prototype.bytesPerElement=20,ut(Xe,"StructArrayLayout3i3f20");class ft extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ft.prototype.bytesPerElement=4,ut(ft,"StructArrayLayout1ul4");class Tt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,_,x,w,S,A,P,D){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,s,c,d,f,_,x,w,S,A,P,D)}emplace(e,i,s,c,d,f,_,x,w,S,A,P,D,L){const F=20*e,j=10*e;return this.int16[F+0]=i,this.int16[F+1]=s,this.int16[F+2]=c,this.int16[F+3]=d,this.int16[F+4]=f,this.float32[j+3]=_,this.float32[j+4]=x,this.float32[j+5]=w,this.float32[j+6]=S,this.int16[F+14]=A,this.uint32[j+8]=P,this.uint16[F+18]=D,this.uint16[F+19]=L,e}}Tt.prototype.bytesPerElement=40,ut(Tt,"StructArrayLayout5i4f1i1ul2ui40");class ht extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,c,d,f,_)}emplace(e,i,s,c,d,f,_,x){const w=8*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=c,this.int16[w+4]=d,this.int16[w+5]=f,this.int16[w+6]=_,this.int16[w+7]=x,e}}ht.prototype.bytesPerElement=16,ut(ht,"StructArrayLayout3i2i2i16");class xt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,c,d)}emplace(e,i,s,c,d,f){const _=4*e,x=8*e;return this.float32[_+0]=i,this.float32[_+1]=s,this.float32[_+2]=c,this.int16[x+6]=d,this.int16[x+7]=f,e}}xt.prototype.bytesPerElement=16,ut(xt,"StructArrayLayout2f1f2i16");class Nt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c)}emplace(e,i,s,c,d){const f=12*e,_=3*e;return this.uint8[f+0]=i,this.uint8[f+1]=s,this.float32[_+1]=c,this.float32[_+2]=d,e}}Nt.prototype.bytesPerElement=12,ut(Nt,"StructArrayLayout2ub2f12");class Ot extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=s,this.float32[d+2]=c,e}}Ot.prototype.bytesPerElement=12,ut(Ot,"StructArrayLayout3f12");class pt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=s,this.uint16[d+2]=c,e}}pt.prototype.bytesPerElement=6,ut(pt,"StructArrayLayout3ui6");class en extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,_,x,w,S,A,P,D,L,F,j,Y,oe,J,ie,ae){const se=this.length;return this.resize(se+1),this.emplace(se,e,i,s,c,d,f,_,x,w,S,A,P,D,L,F,j,Y,oe,J,ie,ae)}emplace(e,i,s,c,d,f,_,x,w,S,A,P,D,L,F,j,Y,oe,J,ie,ae,se){const Ce=30*e,Te=15*e,Le=60*e;return this.int16[Ce+0]=i,this.int16[Ce+1]=s,this.int16[Ce+2]=c,this.float32[Te+2]=d,this.float32[Te+3]=f,this.uint16[Ce+8]=_,this.uint16[Ce+9]=x,this.uint32[Te+5]=w,this.uint32[Te+6]=S,this.uint32[Te+7]=A,this.uint16[Ce+16]=P,this.uint16[Ce+17]=D,this.uint16[Ce+18]=L,this.float32[Te+10]=F,this.float32[Te+11]=j,this.uint8[Le+48]=Y,this.uint8[Le+49]=oe,this.uint8[Le+50]=J,this.uint32[Te+13]=ie,this.int16[Ce+28]=ae,this.uint8[Le+58]=se,e}}en.prototype.bytesPerElement=60,ut(en,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class nn extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,_,x,w,S,A,P,D,L,F,j,Y,oe,J,ie,ae,se,Ce,Te,Le,Ze,Ae,Oe,Ve,Ne){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,i,s,c,d,f,_,x,w,S,A,P,D,L,F,j,Y,oe,J,ie,ae,se,Ce,Te,Le,Ze,Ae,Oe,Ve,Ne)}emplace(e,i,s,c,d,f,_,x,w,S,A,P,D,L,F,j,Y,oe,J,ie,ae,se,Ce,Te,Le,Ze,Ae,Oe,Ve,Ne,Ke){const ze=38*e,nt=19*e;return this.int16[ze+0]=i,this.int16[ze+1]=s,this.int16[ze+2]=c,this.float32[nt+2]=d,this.float32[nt+3]=f,this.int16[ze+8]=_,this.int16[ze+9]=x,this.int16[ze+10]=w,this.int16[ze+11]=S,this.int16[ze+12]=A,this.int16[ze+13]=P,this.uint16[ze+14]=D,this.uint16[ze+15]=L,this.uint16[ze+16]=F,this.uint16[ze+17]=j,this.uint16[ze+18]=Y,this.uint16[ze+19]=oe,this.uint16[ze+20]=J,this.uint16[ze+21]=ie,this.uint16[ze+22]=ae,this.uint16[ze+23]=se,this.uint16[ze+24]=Ce,this.uint16[ze+25]=Te,this.uint16[ze+26]=Le,this.uint16[ze+27]=Ze,this.uint16[ze+28]=Ae,this.uint32[nt+15]=Oe,this.float32[nt+16]=Ve,this.float32[nt+17]=Ne,this.float32[nt+18]=Ke,e}}nn.prototype.bytesPerElement=76,ut(nn,"StructArrayLayout3i2f6i15ui1ul3f76");class rn extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}rn.prototype.bytesPerElement=4,ut(rn,"StructArrayLayout1f4");class on extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,c,d)}emplace(e,i,s,c,d,f){const _=5*e;return this.float32[_+0]=i,this.float32[_+1]=s,this.float32[_+2]=c,this.float32[_+3]=d,this.float32[_+4]=f,e}}on.prototype.bytesPerElement=20,ut(on,"StructArrayLayout5f20");class wi extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c)}emplace(e,i,s,c,d){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=s,this.uint16[f+3]=c,this.uint16[f+4]=d,e}}wi.prototype.bytesPerElement=12,ut(wi,"StructArrayLayout1ul3ui12");class ai extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=s,e}}ai.prototype.bytesPerElement=4,ut(ai,"StructArrayLayout2ui4");class ar extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}ar.prototype.bytesPerElement=2,ut(ar,"StructArrayLayout1ui2");class Vr extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=s,e}}Vr.prototype.bytesPerElement=8,ut(Vr,"StructArrayLayout2f8");class wn extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wn.prototype.size=40;class sn extends Tt{get(e){return new wn(this,e)}}ut(sn,"CollisionBoxArray");class Wt extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Wt.prototype.size=60;class Un extends en{get(e){return new Wt(this,e)}}ut(Un,"PlacedSymbolArray");class Pi extends de{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Pi.prototype.size=76;class _n extends nn{get(e){return new Pi(this,e)}}ut(_n,"SymbolInstanceArray");class Ri extends rn{getoffsetX(e){return this.float32[1*e+0]}}ut(Ri,"GlyphOffsetArray");class Pc extends $e{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ut(Pc,"SymbolLineVertexArray");class as extends de{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}as.prototype.size=12;class gl extends wi{get(e){return new as(this,e)}}ut(gl,"FeatureIndexArray");class co extends ai{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ut(co,"FillExtrusionCentroidArray");const zo=ye([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ls=ye([{name:"a_dash",components:4,type:"Uint16"}]);var Ic={exports:{}},_l={exports:{}};_l.exports=function(n,e){var i,s,c,d,f,_,x,w;for(s=n.length-(i=3&n.length),c=e,f=3432918353,_=461845907,w=0;w<s;)x=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24,++w,c=27492+(65535&(d=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*f+(((x>>>16)*f&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(x=0,i){case 3:x^=(255&n.charCodeAt(w+2))<<16;case 2:x^=(255&n.charCodeAt(w+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&n.charCodeAt(w)))*f+(((x>>>16)*f&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return c^=n.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Ah=_l.exports,sx={exports:{}};sx.exports=function(n,e){for(var i,s=n.length,c=e^s,d=0;s>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(d)|(255&n.charCodeAt(++d))<<8|(255&n.charCodeAt(++d))<<16|(255&n.charCodeAt(++d))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),s-=4,++d;switch(s){case 3:c^=(255&n.charCodeAt(d+2))<<16;case 2:c^=(255&n.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&n.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var ax=Ah,zC=sx.exports;Ic.exports=ax,Ic.exports.murmur3=ax,Ic.exports.murmur2=zC;var Zg=le(Ic.exports);class ef{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,s,c){this.ids.push(lx(e)),this.positions.push(i,s,c)}getPositions(e){const i=lx(e);let s=0,c=this.ids.length-1;for(;s<c;){const f=s+c>>1;this.ids[f]>=i?c=f:s=f+1}const d=[];for(;this.ids[s]===i;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(e,i){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return qg(s,c,0,s.length-1),i&&i.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const i=new ef;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function lx(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Zg(String(n))}function qg(n,e,i,s){for(;i<s;){const c=n[i+s>>1];let d=i-1,f=s+1;for(;;){do d++;while(n[d]<c);do f--;while(n[f]>c);if(d>=f)break;tf(n,d,f),tf(e,3*d,3*f),tf(e,3*d+1,3*f+1),tf(e,3*d+2,3*f+2)}f-i<s-f?(qg(n,e,i,f),i=f+1):(qg(n,e,f+1,s),s=f)}}function tf(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}ut(ef,"FeaturePositionMap");class cs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class nf extends cs{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class cx extends cs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class ux extends cs{constructor(e){super(e),this.current=Rn.transparent}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const DC=new Float32Array(16),LC=new Float32Array(9),RC=new Float32Array(4);function Wg(n){return[he(255*n.r,255*n.g),he(255*n.b,255*n.a)]}class Ph{constructor(e,i,s){this.value=e,this.uniformNames=i.map(c=>`u_${c}`),this.type=s}setUniform(e,i,s,c,d){i.set(e,d,c.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new ux(e):new nf(e)}}class kc{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,s,c,d){const f=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;f&&i.set(e,d,f)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new cx(e):new nf(e)}}class us{constructor(e,i,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,s,c,d,f){const _=this.paintVertexArray.length,x=this.expression.evaluate(new M(0),i,{},d,c,f);this.paintVertexArray.resize(e),this._setPaintValue(_,e,x)}updatePaintArray(e,i,s,c,d){const f=this.expression.evaluate({zoom:0},s,c,void 0,d);this._setPaintValue(e,i,f)}_setPaintValue(e,i,s){if(this.type==="color"){const c=Wg(s);for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class uo{constructor(e,i,s,c,d,f){this.expression=e,this.uniformNames=i.map(_=>`u_${_}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map(_=>({name:`a_${_}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,s,c,d,f){const _=this.expression.evaluate(new M(this.zoom),i,{},d,c,f),x=this.expression.evaluate(new M(this.zoom+1),i,{},d,c,f),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,_,x)}updatePaintArray(e,i,s,c,d){const f=this.expression.evaluate({zoom:this.zoom},s,c,void 0,d),_=this.expression.evaluate({zoom:this.zoom+1},s,c,void 0,d);this._setPaintValue(e,i,f,_)}_setPaintValue(e,i,s,c){if(this.type==="color"){const d=Wg(s),f=Wg(c);for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,d[0],d[1],f[0],f[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,c,d){const f=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,_=We(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(e,d,_)}getBinding(e,i){return new nf(e)}}class ta{constructor(e,i,s,c,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(s==="array"?ls:zo).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new c}populatePaintArray(e,i,s){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,c,d,f){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],f)}_setPaintValues(e,i,s,c){if(!c||!s)return;const d=c[s];if(!d)return;const{tl:f,br:_,pixelRatio:x}=d;for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,f[0],f[1],_[0],_[1],x)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class na{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!s(d))continue;const f=e.paint.get(d);if(!(f instanceof W&&Ws(f.property.specification)))continue;const _=FC(d,e.type),x=f.value,w=f.property.specification.type,S=!!f.property.useIntegerZoom,A=d==="line-dasharray"||d.endsWith("pattern"),P=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||P)if(x.kind==="source"||P||A){const D=hx(d,w,"source");this.binders[d]=A?new ta(x,_,w,D,e.id):new us(x,_,w,D),c.push(`/a_${d}`)}else{const D=hx(d,w,"composite");this.binders[d]=new uo(x,_,w,S,i,D),c.push(`/z_${d}`)}else this.binders[d]=A?new kc(x.value,_):new Ph(x.value,_,w),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof us||i instanceof uo?i.maxValue:0}populatePaintArrays(e,i,s,c,d,f){for(const _ in this.binders){const x=this.binders[_];(x instanceof us||x instanceof uo||x instanceof ta)&&x.populatePaintArray(e,i,s,c,d,f)}}setConstantPatternPositions(e){for(const i in this.binders){const s=this.binders[i];s instanceof kc&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,i,s,c,d,f){let _=!1;for(const x in e){const w=i.getPositions(x);for(const S of w){const A=s.feature(S.index);for(const P in this.binders){const D=this.binders[P];if((D instanceof us||D instanceof uo||D instanceof ta)&&D.expression.isStateDependent===!0){const L=c.paint.get(P);D.expression=L.value,D.updatePaintArray(S.start,S.end,A,e[x],d,f),_=!0}}}}return _}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Ph||s instanceof kc)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof us||s instanceof uo||s instanceof ta)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Ph||s instanceof kc||s instanceof uo)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Ph||c instanceof kc||c instanceof uo)for(const d of c.uniformNames)i.push({name:d,property:s,binding:c.getBinding(e,d)})}return i}setUniforms(e,i,s,c,d){for(const{name:f,property:_,binding:x}of s)this.binders[_].setUniform(e,x,d,c.get(_),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof us||i instanceof uo||i instanceof ta)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof us||s instanceof uo||s instanceof ta)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof us||i instanceof uo||i instanceof ta)&&i.destroy()}}}class yl{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new na(c,i,s);this.needsUpload=!1,this._featureMap=new ef,this._bufferOffset=0}populatePaintArrays(e,i,s,c,d,f,_){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,i,c,d,f,_);i.id!==void 0&&this._featureMap.add(i.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,c,d){for(const f of s)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,i,f,c,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const BC={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function FC(n,e){return BC[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const OC={"line-pattern":{source:Ee,composite:Ee},"fill-pattern":{source:Ee,composite:Ee},"fill-extrusion-pattern":{source:Ee,composite:Ee},"line-dasharray":{source:Re,composite:Re}},VC={color:{source:Vr,composite:Ge},number:{source:rn,composite:Vr}};function hx(n,e,i){const s=OC[n];return s&&s[i]||VC[e][i]}ut(Ph,"ConstantBinder"),ut(kc,"PatternConstantBinder"),ut(us,"SourceExpressionBinder"),ut(ta,"PatternCompositeBinder"),ut(uo,"CompositeExpressionBinder"),ut(na,"ProgramConfiguration",{omit:["_buffers"]}),ut(yl,"ProgramConfigurationSet");const dx="-transition";class ho extends Za{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new X(i.layout)),i.paint)){this._transitionablePaint=new R(i.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new K(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,s={}){i!=null&&this._validate(Ug,`layers.${this.id}.layout.${e}`,e,i,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return vr(e,dx)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,s={}){if(i!=null&&this._validate(Vg,`layers.${this.id}.paint.${e}`,e,i,s))return!1;if(vr(e,dx))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const c=this._transitionablePaint._values[e],d=c.value.isDataDriven(),f=c.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const _=this._transitionablePaint._values[e].value,x=_.isDataDriven(),w=vr(e,"pattern")||e==="line-dasharray";return x||d||w||this._handleOverridablePaintPropertyUpdate(e,f,_)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Yr(e,(i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length))}_validate(e,i,s,c,d={}){return(!d||d.validate!==!1)&&Kp(this,e.call(Hp,{key:i,layerType:this.type,objectKey:s,value:c,styleSpec:De,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof W&&Ws(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Sc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const UC=ye([{name:"a_pos",components:2,type:"Int16"}],4),NC=ye([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Nn{constructor(e=[]){this.segments=e}prepareSegment(e,i,s,c){let d=this.segments[this.segments.length-1];return e>Nn.MAX_VERTEX_ARRAY_LENGTH&&En(`Max vertices per segment is ${Nn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Nn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,c){return new Nn([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}Nn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ut(Nn,"SegmentVector");var yt=8192;class ia{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof an?new an(e.lng,e.lat):an.convert(e),this}setSouthWest(e){return this._sw=e instanceof an?new an(e.lng,e.lat):an.convert(e),this}extend(e){const i=this._sw,s=this._ne;let c,d;if(e instanceof an)c=e,d=e;else{if(!(e instanceof ia))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ia.convert(e)):this.extend(an.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(an.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return i||s?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),s.lng=Math.max(d.lng,s.lng),s.lat=Math.max(d.lat,s.lat)):(this._sw=new an(c.lng,c.lat),this._ne=new an(d.lng,d.lat)),this}getCenter(){return new an((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new an(this.getWest(),this.getNorth())}getSouthEast(){return new an(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=an.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return!e||e instanceof ia?e:new ia(e)}}var rf=1e-6,lr=typeof Float32Array<"u"?Float32Array:Array;function px(){var n=new lr(9);return lr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function fx(n,e,i){var s=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],w=e[6],S=e[7],A=e[8],P=i[0],D=i[1],L=i[2],F=i[3],j=i[4],Y=i[5],oe=i[6],J=i[7],ie=i[8];return n[0]=P*s+D*f+L*w,n[1]=P*c+D*_+L*S,n[2]=P*d+D*x+L*A,n[3]=F*s+j*f+Y*w,n[4]=F*c+j*_+Y*S,n[5]=F*d+j*x+Y*A,n[6]=oe*s+J*f+ie*w,n[7]=oe*c+J*_+ie*S,n[8]=oe*d+J*x+ie*A,n}function po(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Xg(n,e){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],w=e[7],S=e[8],A=e[9],P=e[10],D=e[11],L=e[12],F=e[13],j=e[14],Y=e[15],oe=i*_-s*f,J=i*x-c*f,ie=i*w-d*f,ae=s*x-c*_,se=s*w-d*_,Ce=c*w-d*x,Te=S*F-A*L,Le=S*j-P*L,Ze=S*Y-D*L,Ae=A*j-P*F,Oe=A*Y-D*F,Ve=P*Y-D*j,Ne=oe*Ve-J*Oe+ie*Ae+ae*Ze-se*Le+Ce*Te;return Ne?(n[0]=(_*Ve-x*Oe+w*Ae)*(Ne=1/Ne),n[1]=(c*Oe-s*Ve-d*Ae)*Ne,n[2]=(F*Ce-j*se+Y*ae)*Ne,n[3]=(P*se-A*Ce-D*ae)*Ne,n[4]=(x*Ze-f*Ve-w*Le)*Ne,n[5]=(i*Ve-c*Ze+d*Le)*Ne,n[6]=(j*ie-L*Ce-Y*J)*Ne,n[7]=(S*Ce-P*ie+D*J)*Ne,n[8]=(f*Oe-_*Ze+w*Te)*Ne,n[9]=(s*Ze-i*Oe-d*Te)*Ne,n[10]=(L*se-F*ie+Y*oe)*Ne,n[11]=(A*ie-S*se-D*oe)*Ne,n[12]=(_*Le-f*Ae-x*Te)*Ne,n[13]=(i*Ae-s*Le+c*Te)*Ne,n[14]=(F*J-L*ae-j*oe)*Ne,n[15]=(S*ae-A*J+P*oe)*Ne,n):null}function vl(n,e,i){var s=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],w=e[6],S=e[7],A=e[8],P=e[9],D=e[10],L=e[11],F=e[12],j=e[13],Y=e[14],oe=e[15],J=i[0],ie=i[1],ae=i[2],se=i[3];return n[0]=J*s+ie*_+ae*A+se*F,n[1]=J*c+ie*x+ae*P+se*j,n[2]=J*d+ie*w+ae*D+se*Y,n[3]=J*f+ie*S+ae*L+se*oe,n[4]=(J=i[4])*s+(ie=i[5])*_+(ae=i[6])*A+(se=i[7])*F,n[5]=J*c+ie*x+ae*P+se*j,n[6]=J*d+ie*w+ae*D+se*Y,n[7]=J*f+ie*S+ae*L+se*oe,n[8]=(J=i[8])*s+(ie=i[9])*_+(ae=i[10])*A+(se=i[11])*F,n[9]=J*c+ie*x+ae*P+se*j,n[10]=J*d+ie*w+ae*D+se*Y,n[11]=J*f+ie*S+ae*L+se*oe,n[12]=(J=i[12])*s+(ie=i[13])*_+(ae=i[14])*A+(se=i[15])*F,n[13]=J*c+ie*x+ae*P+se*j,n[14]=J*d+ie*w+ae*D+se*Y,n[15]=J*f+ie*S+ae*L+se*oe,n}function Ih(n,e,i){var s,c,d,f,_,x,w,S,A,P,D,L,F=i[0],j=i[1],Y=i[2];return e===n?(n[12]=e[0]*F+e[4]*j+e[8]*Y+e[12],n[13]=e[1]*F+e[5]*j+e[9]*Y+e[13],n[14]=e[2]*F+e[6]*j+e[10]*Y+e[14],n[15]=e[3]*F+e[7]*j+e[11]*Y+e[15]):(c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],w=e[6],S=e[7],A=e[8],P=e[9],D=e[10],L=e[11],n[0]=s=e[0],n[1]=c,n[2]=d,n[3]=f,n[4]=_,n[5]=x,n[6]=w,n[7]=S,n[8]=A,n[9]=P,n[10]=D,n[11]=L,n[12]=s*F+_*j+A*Y+e[12],n[13]=c*F+x*j+P*Y+e[13],n[14]=d*F+w*j+D*Y+e[14],n[15]=f*F+S*j+L*Y+e[15]),n}function xl(n,e,i){var s=i[0],c=i[1],d=i[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Hg(n,e,i){var s=Math.sin(i),c=Math.cos(i),d=e[4],f=e[5],_=e[6],x=e[7],w=e[8],S=e[9],A=e[10],P=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*c+w*s,n[5]=f*c+S*s,n[6]=_*c+A*s,n[7]=x*c+P*s,n[8]=w*c-d*s,n[9]=S*c-f*s,n[10]=A*c-_*s,n[11]=P*c-x*s,n}function of(n,e,i){var s=Math.sin(i),c=Math.cos(i),d=e[0],f=e[1],_=e[2],x=e[3],w=e[8],S=e[9],A=e[10],P=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c-w*s,n[1]=f*c-S*s,n[2]=_*c-A*s,n[3]=x*c-P*s,n[8]=d*s+w*c,n[9]=f*s+S*c,n[10]=_*s+A*c,n[11]=x*s+P*c,n}function mx(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function gx(n,e,i){var s,c,d,f=i[0],_=i[1],x=i[2],w=Math.hypot(f,_,x);return w<rf?null:(f*=w=1/w,_*=w,x*=w,s=Math.sin(e),c=Math.cos(e),n[0]=f*f*(d=1-c)+c,n[1]=_*f*d+x*s,n[2]=x*f*d-_*s,n[3]=0,n[4]=f*_*d-x*s,n[5]=_*_*d+c,n[6]=x*_*d+f*s,n[7]=0,n[8]=f*x*d+_*s,n[9]=_*x*d-f*s,n[10]=x*x*d+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var jC=vl;function Kg(){var n=new lr(3);return lr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function _x(n){var e=new lr(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function kh(n){return Math.hypot(n[0],n[1],n[2])}function zc(n,e,i){var s=new lr(3);return s[0]=n,s[1]=e,s[2]=i,s}function hs(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Yg(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function yx(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function zh(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Dh(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Tr(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Lh(n,e,i,s){return n[0]=e[0]+i[0]*s,n[1]=e[1]+i[1]*s,n[2]=e[2]+i[2]*s,n}function Bi(n,e){var i=e[0],s=e[1],c=e[2],d=i*i+s*s+c*c;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n}function Ur(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Jg(n,e,i){var s=e[0],c=e[1],d=e[2],f=i[0],_=i[1],x=i[2];return n[0]=c*x-d*_,n[1]=d*f-s*x,n[2]=s*_-c*f,n}function Bn(n,e,i){var s=e[0],c=e[1],d=e[2],f=i[3]*s+i[7]*c+i[11]*d+i[15];return n[0]=(i[0]*s+i[4]*c+i[8]*d+i[12])/(f=f||1),n[1]=(i[1]*s+i[5]*c+i[9]*d+i[13])/f,n[2]=(i[2]*s+i[6]*c+i[10]*d+i[14])/f,n}function vx(n,e,i){var s=i[0],c=i[1],d=i[2],f=e[0],_=e[1],x=e[2],w=c*x-d*_,S=d*f-s*x,A=s*_-c*f,P=c*A-d*S,D=d*w-s*A,L=s*S-c*w,F=2*i[3];return S*=F,A*=F,D*=2,L*=2,n[0]=f+(w*=F)+(P*=2),n[1]=_+S+D,n[2]=x+A+L,n}var Rh,fo=Yg,GC=yx,$C=kh;function xx(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function wx(n,e){var i=e[0],s=e[1],c=e[2],d=e[3],f=i*i+s*s+c*c+d*d;return f>0&&(f=1/Math.sqrt(f)),n[0]=i*f,n[1]=s*f,n[2]=c*f,n[3]=d*f,n}function wl(n,e,i){var s=e[0],c=e[1],d=e[2],f=e[3];return n[0]=i[0]*s+i[4]*c+i[8]*d+i[12]*f,n[1]=i[1]*s+i[5]*c+i[9]*d+i[13]*f,n[2]=i[2]*s+i[6]*c+i[10]*d+i[14]*f,n[3]=i[3]*s+i[7]*c+i[11]*d+i[15]*f,n}function bx(){var n=new lr(4);return lr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Tx(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Ex(n,e,i){i*=.5;var s=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(i),x=Math.cos(i);return n[0]=s*x+f*_,n[1]=c*x+d*_,n[2]=d*x-c*_,n[3]=f*x-s*_,n}function Sx(n,e,i){i*=.5;var s=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(i),x=Math.cos(i);return n[0]=s*x-d*_,n[1]=c*x+f*_,n[2]=d*x+s*_,n[3]=f*x-c*_,n}Kg(),Rh=new lr(4),lr!=Float32Array&&(Rh[0]=0,Rh[1]=0,Rh[2]=0,Rh[3]=0);var ZC=wx;Kg(),zc(1,0,0),zc(0,1,0),bx(),bx(),px();const qC=ye([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Cx}=qC,Mx=ye([{name:"a_pos_3",components:3,type:"Int16"}]);var Bh=ye([{name:"a_pos",type:"Int16",components:2}]);class Qg{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const c=Ur(i,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return s[0]=this.pos[0]+this.dir[0]*d,s[1]=this.pos[1]+this.dir[1]*d,s[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,s){if(function(D,L){var F=D[0],j=D[1],Y=D[2],oe=L[0],J=L[1],ie=L[2];return Math.abs(F-oe)<=rf*Math.max(1,Math.abs(F),Math.abs(oe))&&Math.abs(j-J)<=rf*Math.max(1,Math.abs(j),Math.abs(J))&&Math.abs(Y-ie)<=rf*Math.max(1,Math.abs(Y),Math.abs(ie))}(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[c,d,f]=this.dir,_=this.pos[0]-e[0],x=this.pos[1]-e[1],w=this.pos[2]-e[2],S=c*c+d*d+f*f,A=2*(_*c+x*d+w*f),P=A*A-4*S*(_*_+x*x+w*w-i*i);if(P<0){const D=Math.max(-A/2,0),L=_+c*D,F=x+d*D,j=w+f*D,Y=Math.hypot(L,F,j);return s[0]=L*i/Y,s[1]=F*i/Y,s[2]=j*i/Y,!1}{const D=(-A-Math.sqrt(P))/(2*S);if(D<0){const L=Math.hypot(_,x,w);return s[0]=_*i/L,s[1]=x*i/L,s[2]=w*i/L,!1}return s[0]=_+c*D,s[1]=x+d*D,s[2]=w+f*D,!0}}}class e_{constructor(e,i,s,c,d){this.TL=e,this.TR=i,this.BR=s,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(e,i,s){const c=[-1,1,1],d=[1,1,1],f=[1,-1,1],_=[-1,-1,1],x=Bn(c,c,e),w=Bn(d,d,e),S=Bn(f,f,e),A=Bn(_,_,e);return new e_(x,w,S,A,i/s)}}class t_{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,s,c){const d=Math.pow(2,s),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const w=wl([],x,e),S=1/w[3]/i*d;return function(A,P,D){return A[0]=P[0]*D[0],A[1]=P[1]*D[1],A[2]=P[2]*D[2],A[3]=P[3]*D[3],A}(w,w,[S,S,c?1/w[3]:S,S])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const w=Bi([],Jg([],fo([],f[x[0]],f[x[1]]),fo([],f[x[2]],f[x[1]]))),S=-Ur(w,f[x[1]]);return w.concat(S)});return new t_(f,_)}}class Fi{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const c of e)zh(i,i,c),Dh(s,s,c);return new Fi(i,s)}static applyTransform(e,i){const s=e.getCorners();for(let c=0;c<s.length;++c)Bn(s[c],s[c],i);return Fi.fromPoints(s)}constructor(e,i){this.min=e,this.max=i,this.center=Tr([],hs([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=_x(this.min),c=_x(this.max);for(let d=0;d<i.length;d++)s[d]=i[d]?this.min[d]:this.center[d],c[d]=i[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new Fi(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let s=!0;for(let c=0;c<e.planes.length;c++){const d=e.planes[c];let f=0;for(let _=0;_<i.length;_++)f+=Ur(d,i[_])+d[3]>=0;if(f===0)return 0;f!==i.length&&(s=!1)}if(s)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let _=0;_<e.points.length;_++){const x=e.points[_][c]-this.min[c];d=Math.min(d,x),f=Math.max(f,x)}if(f<0||d>this.max[c]-this.min[c])return 0}return 1}}const n_=5,Ax=6,Do=yt/Math.PI/2,WC=16383,bl=64,Fh=[bl,32,16],Nr=-Do,jr=Do,XC=[new Fi([Nr,Nr,Nr],[jr,jr,jr]),new Fi([Nr,Nr,Nr],[0,0,jr]),new Fi([0,Nr,Nr],[jr,0,jr]),new Fi([Nr,0,Nr],[0,jr,jr]),new Fi([0,0,Nr],[jr,jr,jr])];function sf(n){return n*Do/Uh}function Px(n,e,i,s=!0){const c=Tr([],n._camera.position,n.worldSize),d=[e,i,1,1];wl(d,d,n.pixelMatrixInverse),xx(d,d,1/d[3]);const f=Bi([],fo([],d,c)),_=n.globeMatrix,x=[_[12],_[13],_[14]],w=fo([],x,c),S=kh(w),A=Bi([],w),P=n.worldSize/(2*Math.PI),D=Ur(A,f),L=Math.asin(P/S);if(L<Math.acos(D)){if(!s)return null;const Ze=[],Ae=[];Tr(Ze,f,S/D),Bi(Ae,fo(Ae,Ze,w)),Bi(f,hs(f,w,Tr(f,Ae,Math.tan(L)*S)))}const F=[];new Qg(c,f).closestPointOnSphere(x,P,F);const j=Bi([],Mo(_,0)),Y=Bi([],Mo(_,1)),oe=Bi([],Mo(_,2)),J=Ur(j,F),ie=Ur(Y,F),ae=Ur(oe,F),se=Jt(Math.asin(-ie/P));let Ce=Jt(Math.atan2(J,ae));Ce=n.center.lng+function(Ze,Ae){const Oe=(Ae-Ze+180)%360-180;return Oe<-180?Oe+360:Oe}(n.center.lng,Ce);const Te=Ro(Ce),Le=We(Bo(se),0,1);return new Bc(Te,Le)}class HC{constructor(e,i,s){this.a=fo([],e,s),this.b=fo([],i,s),this.center=s;const c=Bi([],this.a),d=Bi([],this.b);this.angle=Math.acos(Ur(c,d))}}function i_(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(s,c,d,f){const _=Math.sin(d);return s*(Math.sin((1-f)*d)/_)+c*(Math.sin(f*d)/_)}(n.a[e],n.b[e],n.angle,We(i,0,1))+n.center[e]}function Lo(n){if(n.z<=1)return XC[n.z+2*n.y+n.x];const e=r_(af(n));return Fi.fromPoints(e)}function Tl(n,e,i){return Tr(n,n,1-i),Lh(n,n,e,i)}function Ix(n,e){const i=Rc(e.zoom);if(i===0)return Lo(n);const s=af(n),c=r_(s),d=Ro(s.getWest())*e.worldSize,f=Ro(s.getEast())*e.worldSize,_=Bo(s.getNorth())*e.worldSize,x=Bo(s.getSouth())*e.worldSize,w=[d,_,0],S=[f,_,0],A=[d,x,0],P=[f,x,0],D=Xg([],e.globeMatrix);return Bn(w,w,D),Bn(S,S,D),Bn(A,A,D),Bn(P,P,D),c[0]=Tl(c[0],A,i),c[1]=Tl(c[1],P,i),c[2]=Tl(c[2],S,i),c[3]=Tl(c[3],w,i),Fi.fromPoints(c)}function kx(n,e,i){for(const s of n)Bn(s,s,e),Tr(s,s,i)}function KC(n,e,i){const s=e/n.worldSize,c=n.globeMatrix;if(i.z<=1){const Te=Lo(i).getCorners();return kx(Te,c,s),Fi.fromPoints(Te)}const d=af(i),f=r_(d);kx(f,c,s);const _=Number.MAX_VALUE,x=[-_,-_,-_],w=[_,_,_];if(d.contains(n.center)){for(const Ze of f)zh(w,w,Ze),Dh(x,x,Ze);x[2]=0;const Te=n.point,Le=[Te.x*s,Te.y*s,0];return zh(w,w,Le),Dh(x,x,Le),new Fi(w,x)}const S=[c[12]*s,c[13]*s,c[14]*s],A=d.getCenter(),P=We(n.center.lat,-Ti,Ti),D=We(A.lat,-Ti,Ti),L=Ro(n.center.lng),F=Bo(P);let j=L-Ro(A.lng);const Y=F-Bo(D);j>.5?j-=1:j<-.5&&(j+=1);let oe=0;Math.abs(j)>Math.abs(Y)?oe=j>=0?1:3:(oe=Y>=0?0:2,Lh(S,S,[c[4]*s,c[5]*s,c[6]*s],-Math.sin(bt(Y>=0?d.getSouth():d.getNorth()))*Do));const J=f[oe],ie=f[(oe+1)%4],ae=new HC(J,ie,S),se=[i_(ae,0)||J[0],i_(ae,1)||J[1],i_(ae,2)||J[2]],Ce=Rc(n.zoom);if(Ce>0){const Te=function({x:Ze,y:Ae,z:Oe},Ve,Ne,Ke,ze){const nt=1/(1<<Oe);let dt=Ze*nt,rt=dt+nt,Ct=Ae*nt,Ye=Ct+nt,mt=0;const Mt=(dt+rt)/2-Ke;return Mt>.5?mt=-1:Mt<-.5&&(mt=1),dt=((dt+mt)*Ve-(Ke*=Ve))*Ne+Ke,rt=((rt+mt)*Ve-Ke)*Ne+Ke,Ct=(Ct*Ve-(ze*=Ve))*Ne+ze,Ye=(Ye*Ve-ze)*Ne+ze,[[dt,Ye,0],[rt,Ye,0],[rt,Ct,0],[dt,Ct,0]]}(i,e,n._pixelsPerMercatorPixel,L,F);for(let Ze=0;Ze<f.length;Ze++)Tl(f[Ze],Te[Ze],Ce);const Le=hs([],Te[oe],Te[(oe+1)%4]);Tr(Le,Le,.5),Tl(se,Le,Ce)}for(const Te of f)zh(w,w,Te),Dh(x,x,Te);return w[2]=Math.min(J[2],ie[2]),zh(w,w,se),Dh(x,x,se),new Fi(w,x)}function af({x:n,y:e,z:i}){const s=1/(1<<i),c=new an(Er(n*s),bi((e+1)*s)),d=new an(Er((n+1)*s),bi(e*s));return new ia(c,d)}function r_(n){const e=bt(n.getNorth()),i=bt(n.getSouth()),s=Math.cos(e),c=Math.cos(i),d=Math.sin(e),f=Math.sin(i),_=n.getWest(),x=n.getEast();return[Dc(c,f,_),Dc(c,f,x),Dc(s,d,x),Dc(s,d,_)]}function Dc(n,e,i,s=Do){return i=bt(i),[n*Math.sin(i)*s,-e*s,n*Math.cos(i)*s]}function Lc(n,e,i){return Dc(Math.cos(bt(n)),Math.sin(bt(n)),e,i)}function Oh(n,e,i,s){const c=1<<i.z,d=(n/yt+i.x)/c;return Lc(bi((e/yt+i.y)/c),Er(d),s)}function lf({min:n,max:e}){return WC/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const zx=new Float64Array(16);function Vh(n){const e=lf(n),i=mx(zx,[e,e,e]);return Ih(i,i,((s=[])[0]=-(c=n.min)[0],s[1]=-c[1],s[2]=-c[2],s));var s,c}function o_(n){const e=(s=n.min,(i=zx)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const c=1/lf(n);return xl(e,e,[c,c,c])}function Dx(n,e,i,s,c){const d=function(x){const w=yt/(2*Math.PI);return x/(2*Math.PI)/w}(i),f=[n,e,-i/(2*Math.PI)],_=po(new Float64Array(16));return Ih(_,_,f),xl(_,_,[d,d,d]),Hg(_,_,bt(-c)),of(_,_,bt(-s)),_}function Rc(n){return Et(n_,Ax,n)}function Lx(n,e){const i=Lc(e.lat,e.lng),s=function(L){const F=Lc(L._center.lat,L._center.lng);let j=Jg([],zc(0,1,0),F);const Y=gx([],-L.angle,F);j=Bn(j,j,Y),gx(Y,-L._pitch,j);const oe=Bi([],F);return Tr(oe,oe,sf(L.cameraToCenterDistance/L.pixelsPerMeter)),Bn(oe,oe,Y),hs([],F,oe)}(n);return f=(c=Yg([],s,i))[0],_=c[1],x=c[2],w=(d=i)[0],S=d[1],A=d[2],D=(P=Math.sqrt(f*f+_*_+x*x)*Math.sqrt(w*w+S*S+A*A))&&Ur(c,d)/P,Math.acos(Math.min(Math.max(D,-1),1));var c,d,f,_,x,w,S,A,P,D}function s_(n,e){return Lx(n,e)>Math.PI/2*1.01}const Rx=bt(85),YC=Math.cos(Rx),JC=Math.sin(Rx),Uh=63710088e-1,Bx=2*Math.PI*Uh;class ra{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ra(vt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,c=e.lat*i,d=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return Uh*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new ia(new ra(this.lng-s,this.lat-i),new ra(this.lng+s,this.lat+i))}toEcef(e){const i=sf(e);return Lc(this.lat,this.lng,Do+i)}static convert(e){if(e instanceof ra)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ra(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ra(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var an=ra;function a_(n){return Bx*Math.cos(n*Math.PI/180)}function Ro(n){return(180+n)/360}function Bo(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function mo(n,e){return n/a_(e)}function Er(n){return 360*n-180}function bi(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Fx(n,e){return n*a_(bi(e))}const Ti=85.051129;function Ox(n){return 1/Math.cos(n*Math.PI/180)}class Bc{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=an.convert(e);return new Bc(Ro(s.lng),Bo(s.lat),mo(i,s.lat))}toLngLat(){return new an(Er(this.x),bi(this.y))}toAltitude(){return Fx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bx*Ox(bi(this.y))}}function l_(n,e,i,s,c,d,f,_,x){const w=(e+s)/2,S=(i+c)/2,A=new Be(w,S);_(A),function(P,D,L,F,j,Y){const oe=L-j,J=F-Y;return Math.abs((F-D)*oe-(L-P)*J)/Math.hypot(oe,J)}(A.x,A.y,d.x,d.y,f.x,f.y)>=x?(l_(n,e,i,w,S,d,A,_,x),l_(n,w,S,s,c,A,f,_,x)):n.push(f)}function Vx(n,e,i){let s=n[0],c=s.x,d=s.y;e(s);const f=[s];for(let _=1;_<n.length;_++){const x=n[_],{x:w,y:S}=x;e(x),l_(f,c,d,w,S,s,x,e,i),c=w,d=S,s=x}return f}function c_(n,e,i,s){if(s(e,i)){const c=e.add(i)._mult(.5);c_(n,e,c,s),c_(n,c,i,s)}else n.push(i)}function QC(n,e){let i=n[0];const s=[i];for(let c=1;c<n.length;c++){const d=n[c];c_(s,i,d,e),i=d}return s}const u_=Math.pow(2,14)-1,Ux=-u_-1;function eM(n,e){const i=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=We(i,Ux,u_),n.y=We(s,Ux,u_),(i<n.x||i>n.x+1||s<n.y||s>n.y+1)&&En("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function ds(n,e,i){const s=n.loadGeometry(),c=n.extent,d=yt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:_,x,y:w,projection:S}=i,A=P=>{const D=Er((e.x+P.x/c)/f),L=bi((e.y+P.y/c)/f),F=S.project(D,L);P.x=(F.x*_-x)*c,P.y=(F.y*_-w)*c};for(let P=0;P<s.length;P++)if(n.type!==1)s[P]=Vx(s[P],A,1);else{const D=[];for(const L of s[P])L.x<0||L.x>=c||L.y<0||L.y>=c||(A(L),D.push(L));s[P]=D}}for(const f of s)for(const _ of f)eM(_,d);return s}function El(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?ds(n):[]}}function cf(n,e,i,s,c){n.emplaceBack(2*e+(s+1)/2,2*i+(c+1)/2)}function uf(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class h_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new $e,this.indexArray=new pt,this.segments=new Nn,this.programConfigurations=new yl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,c){const d=this.layers[0],f=[];let _=null;d.type==="circle"&&(_=d.layout.get("circle-sort-key"));for(const{feature:w,id:S,index:A,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,L=El(w,D);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),L,s))continue;const F=_?_.evaluate(L,{},s):void 0,j={id:S,properties:w.properties,type:w.type,sourceLayerIndex:P,index:A,geometry:D?L.geometry:ds(w,s,c),patterns:{},sortKey:F};f.push(j)}_&&f.sort((w,S)=>w.sortKey-S.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new qe,x=c.projection);for(const w of f){const{geometry:S,index:A,sourceLayerIndex:P}=w,D=e[A].feature;this.addFeature(w,S,A,i.availableImages,s,x),i.featureIndex.insert(D,S,A,P,this.index)}}update(e,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,UC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,NC.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,c,d,f){for(const _ of i)for(const x of _){const w=x.x,S=x.y;if(w<0||w>=yt||S<0||S>=yt)continue;if(f){const D=f.projectTilePoint(w,S,d),L=f.upVector(d,w,S),F=this.globeExtVertexArray;uf(F,D,L),uf(F,D,L),uf(F,D,L),uf(F,D,L)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=A.vertexLength;cf(this.layoutVertexArray,w,S,-1,-1),cf(this.layoutVertexArray,w,S,1,-1),cf(this.layoutVertexArray,w,S,1,1),cf(this.layoutVertexArray,w,S,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,d)}}function Nx(n,e){for(let i=0;i<n.length;i++)if(Sl(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Sl(n,e[i]))return!0;return!!d_(n,e)}function tM(n,e,i){return!!Sl(n,e)||!!p_(e,n,i)}function jx(n,e){if(n.length===1)return $x(e,n[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let c=0;c<s.length;c++)if(Sl(n,s[c]))return!0}for(let i=0;i<n.length;i++)if($x(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(d_(n,e[i]))return!0;return!1}function nM(n,e,i){if(n.length>1){if(d_(n,e))return!0;for(let s=0;s<e.length;s++)if(p_(e[s],n,i))return!0}for(let s=0;s<n.length;s++)if(p_(n[s],e,i))return!0;return!1}function d_(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const s=n[i],c=n[i+1];for(let d=0;d<e.length-1;d++)if(iM(s,c,e[d],e[d+1]))return!0}return!1}function iM(n,e,i,s){return tr(n,i,s)!==tr(e,i,s)&&tr(n,e,i)!==tr(n,e,s)}function p_(n,e,i){const s=i*i;if(e.length===1)return n.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(Gx(n,e[c-1],e[c])<s)return!0;return!1}function Gx(n,e,i){const s=e.distSqr(i);if(s===0)return n.distSqr(e);const c=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/s;return n.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function $x(n,e){let i,s,c,d=!1;for(let f=0;f<n.length;f++){i=n[f];for(let _=0,x=i.length-1;_<i.length;x=_++)s=i[_],c=i[x],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(d=!d)}return d}function Sl(n,e){let i=!1;for(let s=0,c=n.length-1;s<n.length;c=s++){const d=n[s],f=n[c];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(i=!i)}return i}function Zx(n,e,i,s,c){for(const f of n)if(e<=f.x&&i<=f.y&&s>=f.x&&c>=f.y)return!0;const d=[new Be(e,i),new Be(e,c),new Be(s,c),new Be(s,i)];if(n.length>2){for(const f of d)if(Sl(n,f))return!0}for(let f=0;f<n.length-1;f++)if(rM(n[f],n[f+1],d))return!0;return!1}function rM(n,e,i){const s=i[0],c=i[2];if(n.x<s.x&&e.x<s.x||n.x>c.x&&e.x>c.x||n.y<s.y&&e.y<s.y||n.y>c.y&&e.y>c.y)return!1;const d=tr(n,e,i[0]);return d!==tr(n,e,i[1])||d!==tr(n,e,i[2])||d!==tr(n,e,i[3])}function Fc(n,e,i){const s=e.paint.get(n).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(n)}function hf(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function qx(n,e,i,s,c){if(!e[0]&&!e[1])return n;const d=Be.convert(e)._mult(c);i==="viewport"&&d._rotate(-s);const f=[];for(let _=0;_<n.length;_++)f.push(n[_].sub(d));return f}function Wx(n,e,i,s){const c=Be.convert(n)._mult(s);return e==="viewport"&&c._rotate(-i),c}ut(h_,"CircleBucket",{omit:["layers"]});const oM=new ee({"circle-sort-key":new $(De.layout_circle["circle-sort-key"])});var sM={paint:new ee({"circle-radius":new $(De.paint_circle["circle-radius"]),"circle-color":new $(De.paint_circle["circle-color"]),"circle-blur":new $(De.paint_circle["circle-blur"]),"circle-opacity":new $(De.paint_circle["circle-opacity"]),"circle-translate":new B(De.paint_circle["circle-translate"]),"circle-translate-anchor":new B(De.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new B(De.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new B(De.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $(De.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $(De.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $(De.paint_circle["circle-stroke-opacity"])}),layout:oM};function Xx(n,e,i,s,c,d,f,_,x){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(x*=n.pixelToTileUnitsFactor);const w=n.tileID.canonical,S=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const A of e)for(const P of A){const D=P.add(_),L=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(D.x,D.y,!0):0,F=i.projection.projectTilePoint(D.x,D.y,w);if(L>0){const J=i.projection.upVector(w,D.x,D.y);F.x+=J[0]*S*L,F.y+=J[1]*S*L,F.z+=J[2]*S*L}const j=d?D:aM(F.x,F.y,F.z,s),Y=d?n.tilespaceRays.map(J=>cM(J,L)):n.queryGeometry.screenGeometry,oe=wl([],[F.x,F.y,F.z,1],s);if(!f&&d?x*=oe[3]/i.cameraToCenterDistance:f&&!d&&(x*=i.cameraToCenterDistance/oe[3]),d){const J=bi((P.y/yt+w.y)/(1<<w.z));x/=i.projection.pixelsPerMeter(J,1)/mo(1,J)}if(tM(Y,j,x))return!0}return!1}function aM(n,e,i,s){const c=wl([],[n,e,i,1],s);return new Be(c[0]/c[3],c[1]/c[3])}const Hx=zc(0,0,0),lM=zc(0,0,1);function cM(n,e){const i=Kg();return Hx[2]=e,n.intersectsPlane(Hx,lM,i),new Be(i[0],i[1])}class Kx extends h_{}function Yx(n,{width:e,height:i},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*s);return n.width=e,n.height=i,n.data=c,n}function Jx(n,e,i){const{width:s,height:c}=e;s===n.width&&c===n.height||(f_(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,c)},i),n.width=s,n.height=c,n.data=e.data)}function f_(n,e,i,s,c,d){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||i.x>n.width-c.width||i.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const f=n.data,_=e.data;for(let x=0;x<c.height;x++){const w=((i.y+x)*n.width+i.x)*d,S=((s.y+x)*e.width+s.x)*d;for(let A=0;A<c.width*d;A++)_[S+A]=f[w+A]}return e}ut(Kx,"HeatmapBucket",{omit:["layers"]});class ps{constructor(e,i){Yx(this,e,1,i)}resize(e){Jx(this,new ps(e),1)}clone(){return new ps({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,c,d){f_(e,i,s,c,d,1)}}class cr{constructor(e,i){Yx(this,e,4,i)}resize(e){Jx(this,new cr(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new cr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,c,d){f_(e,i,s,c,d,4)}}ut(ps,"AlphaImage"),ut(cr,"RGBAImage");var uM={paint:new ee({"heatmap-radius":new $(De.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $(De.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new B(De.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Q(De.paint_heatmap["heatmap-color"]),"heatmap-opacity":new B(De.paint_heatmap["heatmap-opacity"])})};function m_(n){const e={},i=n.resolution||256,s=n.clips?n.clips.length:1,c=n.image||new cr({width:i,height:s}),d=(f,_,x)=>{e[n.evaluationKey]=x;const w=n.expression.evaluate(e);c.data[f+_+0]=Math.floor(255*w.r/w.a),c.data[f+_+1]=Math.floor(255*w.g/w.a),c.data[f+_+2]=Math.floor(255*w.b/w.a),c.data[f+_+3]=Math.floor(255*w.a)};if(n.clips)for(let f=0,_=0;f<s;++f,_+=4*i)for(let x=0,w=0;x<i;x++,w+=4){const S=x/(i-1),{start:A,end:P}=n.clips[f];d(_,w,A*(1-S)+P*S)}else for(let f=0,_=0;f<i;f++,_+=4)d(0,_,f/(i-1));return c}var hM={paint:new ee({"hillshade-illumination-direction":new B(De.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new B(De.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new B(De.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new B(De.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new B(De.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new B(De.paint_hillshade["hillshade-accent-color"])})};const dM=ye([{name:"a_pos",components:2,type:"Int16"}],4),{members:pM}=dM;var g_={exports:{}};function df(n,e,i){i=i||2;var s,c,d,f,_,x,w,S=e&&e.length,A=S?e[0]*i:n.length,P=Qx(n,0,A,i,!0),D=[];if(!P||P.next===P.prev)return D;if(S&&(P=function(F,j,Y,oe){var J,ie,ae,se=[];for(J=0,ie=j.length;J<ie;J++)(ae=Qx(F,j[J]*oe,J<ie-1?j[J+1]*oe:F.length,oe,!1))===ae.next&&(ae.steiner=!0),se.push(wM(ae));for(se.sort(yM),J=0;J<se.length;J++)Y=vM(se[J],Y);return Y}(n,e,P,i)),n.length>80*i){s=d=n[0],c=f=n[1];for(var L=i;L<A;L+=i)(_=n[L])<s&&(s=_),(x=n[L+1])<c&&(c=x),_>d&&(d=_),x>f&&(f=x);w=(w=Math.max(d-s,f-c))!==0?32767/w:0}return Nh(P,D,i,s,c,w,0),D}function Qx(n,e,i,s,c){var d,f;if(c===v_(n,e,i,s)>0)for(d=e;d<i;d+=s)f=n1(d,n[d],n[d+1],f);else for(d=i-s;d>=e;d-=s)f=n1(d,n[d],n[d+1],f);return f&&pf(f,f.next)&&(Gh(f),f=f.next),f}function Cl(n,e){if(!n)return n;e||(e=n);var i,s=n;do if(i=!1,s.steiner||!pf(s,s.next)&&jn(s.prev,s,s.next)!==0)s=s.next;else{if(Gh(s),(s=e=s.prev)===s.next)break;i=!0}while(i||s!==e);return e}function Nh(n,e,i,s,c,d,f){if(n){!f&&d&&function(S,A,P,D){var L=S;do L.z===0&&(L.z=__(L.x,L.y,A,P,D)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==S);L.prevZ.nextZ=null,L.prevZ=null,function(F){var j,Y,oe,J,ie,ae,se,Ce,Te=1;do{for(Y=F,F=null,ie=null,ae=0;Y;){for(ae++,oe=Y,se=0,j=0;j<Te&&(se++,oe=oe.nextZ);j++);for(Ce=Te;se>0||Ce>0&&oe;)se!==0&&(Ce===0||!oe||Y.z<=oe.z)?(J=Y,Y=Y.nextZ,se--):(J=oe,oe=oe.nextZ,Ce--),ie?ie.nextZ=J:F=J,J.prevZ=ie,ie=J;Y=oe}ie.nextZ=null,Te*=2}while(ae>1)}(L)}(n,s,c,d);for(var _,x,w=n;n.prev!==n.next;)if(_=n.prev,x=n.next,d?mM(n,s,c,d):fM(n))e.push(_.i/i|0),e.push(n.i/i|0),e.push(x.i/i|0),Gh(n),n=x.next,w=x.next;else if((n=x)===w){f?f===1?Nh(n=gM(Cl(n),e,i),e,i,s,c,d,2):f===2&&_M(n,e,i,s,c,d):Nh(Cl(n),e,i,s,c,d,1);break}}}function fM(n){var e=n.prev,i=n,s=n.next;if(jn(e,i,s)>=0)return!1;for(var c=e.x,d=i.x,f=s.x,_=e.y,x=i.y,w=s.y,S=c<d?c<f?c:f:d<f?d:f,A=_<x?_<w?_:w:x<w?x:w,P=c>d?c>f?c:f:d>f?d:f,D=_>x?_>w?_:w:x>w?x:w,L=s.next;L!==e;){if(L.x>=S&&L.x<=P&&L.y>=A&&L.y<=D&&Oc(c,_,d,x,f,w,L.x,L.y)&&jn(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function mM(n,e,i,s){var c=n.prev,d=n,f=n.next;if(jn(c,d,f)>=0)return!1;for(var _=c.x,x=d.x,w=f.x,S=c.y,A=d.y,P=f.y,D=_<x?_<w?_:w:x<w?x:w,L=S<A?S<P?S:P:A<P?A:P,F=_>x?_>w?_:w:x>w?x:w,j=S>A?S>P?S:P:A>P?A:P,Y=__(D,L,e,i,s),oe=__(F,j,e,i,s),J=n.prevZ,ie=n.nextZ;J&&J.z>=Y&&ie&&ie.z<=oe;){if(J.x>=D&&J.x<=F&&J.y>=L&&J.y<=j&&J!==c&&J!==f&&Oc(_,S,x,A,w,P,J.x,J.y)&&jn(J.prev,J,J.next)>=0||(J=J.prevZ,ie.x>=D&&ie.x<=F&&ie.y>=L&&ie.y<=j&&ie!==c&&ie!==f&&Oc(_,S,x,A,w,P,ie.x,ie.y)&&jn(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;J&&J.z>=Y;){if(J.x>=D&&J.x<=F&&J.y>=L&&J.y<=j&&J!==c&&J!==f&&Oc(_,S,x,A,w,P,J.x,J.y)&&jn(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;ie&&ie.z<=oe;){if(ie.x>=D&&ie.x<=F&&ie.y>=L&&ie.y<=j&&ie!==c&&ie!==f&&Oc(_,S,x,A,w,P,ie.x,ie.y)&&jn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function gM(n,e,i){var s=n;do{var c=s.prev,d=s.next.next;!pf(c,d)&&e1(c,s,s.next,d)&&jh(c,d)&&jh(d,c)&&(e.push(c.i/i|0),e.push(s.i/i|0),e.push(d.i/i|0),Gh(s),Gh(s.next),s=n=d),s=s.next}while(s!==n);return Cl(s)}function _M(n,e,i,s,c,d){var f=n;do{for(var _=f.next.next;_!==f.prev;){if(f.i!==_.i&&bM(f,_)){var x=t1(f,_);return f=Cl(f,f.next),x=Cl(x,x.next),Nh(f,e,i,s,c,d,0),void Nh(x,e,i,s,c,d,0)}_=_.next}f=f.next}while(f!==n)}function yM(n,e){return n.x-e.x}function vM(n,e){var i=function(c,d){var f,_=d,x=c.x,w=c.y,S=-1/0;do{if(w<=_.y&&w>=_.next.y&&_.next.y!==_.y){var A=_.x+(w-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(A<=x&&A>S&&(S=A,f=_.x<_.next.x?_:_.next,A===x))return f}_=_.next}while(_!==d);if(!f)return null;var P,D=f,L=f.x,F=f.y,j=1/0;_=f;do x>=_.x&&_.x>=L&&x!==_.x&&Oc(w<F?x:S,w,L,F,w<F?S:x,w,_.x,_.y)&&(P=Math.abs(w-_.y)/(x-_.x),jh(_,c)&&(P<j||P===j&&(_.x>f.x||_.x===f.x&&xM(f,_)))&&(f=_,j=P)),_=_.next;while(_!==D);return f}(n,e);if(!i)return e;var s=t1(i,n);return Cl(s,s.next),Cl(i,i.next)}function xM(n,e){return jn(n.prev,n,e.prev)<0&&jn(e.next,n,n.next)<0}function __(n,e,i,s,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wM(n){var e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function Oc(n,e,i,s,c,d,f,_){return(c-f)*(e-_)>=(n-f)*(d-_)&&(n-f)*(s-_)>=(i-f)*(e-_)&&(i-f)*(d-_)>=(c-f)*(s-_)}function bM(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,s){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==s.i&&c.next.i!==s.i&&e1(c,c.next,i,s))return!0;c=c.next}while(c!==i);return!1}(n,e)&&(jh(n,e)&&jh(e,n)&&function(i,s){var c=i,d=!1,f=(i.x+s.x)/2,_=(i.y+s.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&f<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==i);return d}(n,e)&&(jn(n.prev,n,e.prev)||jn(n,e.prev,e))||pf(n,e)&&jn(n.prev,n,n.next)>0&&jn(e.prev,e,e.next)>0)}function jn(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function pf(n,e){return n.x===e.x&&n.y===e.y}function e1(n,e,i,s){var c=mf(jn(n,e,i)),d=mf(jn(n,e,s)),f=mf(jn(i,s,n)),_=mf(jn(i,s,e));return c!==d&&f!==_||!(c!==0||!ff(n,i,e))||!(d!==0||!ff(n,s,e))||!(f!==0||!ff(i,n,s))||!(_!==0||!ff(i,e,s))}function ff(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function mf(n){return n>0?1:n<0?-1:0}function jh(n,e){return jn(n.prev,n,n.next)<0?jn(n,e,n.next)>=0&&jn(n,n.prev,e)>=0:jn(n,e,n.prev)<0||jn(n,n.next,e)<0}function t1(n,e){var i=new y_(n.i,n.x,n.y),s=new y_(e.i,e.x,e.y),c=n.next,d=e.prev;return n.next=e,e.prev=n,i.next=c,c.prev=i,s.next=i,i.prev=s,d.next=s,s.prev=d,s}function n1(n,e,i,s){var c=new y_(n,e,i);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function Gh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function y_(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function v_(n,e,i,s){for(var c=0,d=e,f=i-s;d<i;d+=s)c+=(n[f]-n[d])*(n[d+1]+n[f+1]),f=d;return c}g_.exports=df,g_.exports.default=df,df.deviation=function(n,e,i,s){var c=e&&e.length,d=Math.abs(v_(n,0,c?e[0]*i:n.length,i));if(c)for(var f=0,_=e.length;f<_;f++)d-=Math.abs(v_(n,e[f]*i,f<_-1?e[f+1]*i:n.length,i));var x=0;for(f=0;f<s.length;f+=3){var w=s[f]*i,S=s[f+1]*i,A=s[f+2]*i;x+=Math.abs((n[w]-n[A])*(n[S+1]-n[w+1])-(n[w]-n[S])*(n[A+1]-n[w+1]))}return d===0&&x===0?0:Math.abs((x-d)/d)},df.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,c=0;c<n.length;c++){for(var d=0;d<n[c].length;d++)for(var f=0;f<e;f++)i.vertices.push(n[c][d][f]);c>0&&i.holes.push(s+=n[c-1].length)}return i};var x_=le(g_.exports);function TM(n,e,i,s,c){i1(n,e,i||0,s||n.length-1,c||EM)}function i1(n,e,i,s,c){for(;s>i;){if(s-i>600){var d=s-i+1,f=e-i+1,_=Math.log(d),x=.5*Math.exp(2*_/3),w=.5*Math.sqrt(_*x*(d-x)/d)*(f-d/2<0?-1:1);i1(n,e,Math.max(i,Math.floor(e-f*x/d+w)),Math.min(s,Math.floor(e+(d-f)*x/d+w)),c)}var S=n[e],A=i,P=s;for($h(n,i,e),c(n[s],S)>0&&$h(n,i,s);A<P;){for($h(n,A,P),A++,P--;c(n[A],S)<0;)A++;for(;c(n[P],S)>0;)P--}c(n[i],S)===0?$h(n,i,P):$h(n,++P,s),P<=e&&(i=P+1),e<=P&&(s=P-1)}}function $h(n,e,i){var s=n[e];n[e]=n[i],n[i]=s}function EM(n,e){return n<e?-1:n>e?1:0}function w_(n,e){const i=n.length;if(i<=1)return[n];const s=[];let c,d;for(let f=0;f<i;f++){const _=Yl(n[f]);_!==0&&(n[f].area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(c&&s.push(c),c=[n[f]]):c.push(n[f]))}if(c&&s.push(c),e>1)for(let f=0;f<s.length;f++)s[f].length<=e||(TM(s[f],e,1,s[f].length-1,SM),s[f]=s[f].slice(0,e));return s}function SM(n,e){return e.area-n.area}function b_(n,e,i){const s=i.patternDependencies;let c=!1;for(const d of e){const f=d.paint.get(`${n}-pattern`);f.isConstant()||(c=!0);const _=f.constantOr(null);_&&(c=!0,s[_]=!0)}return c}function T_(n,e,i,s,c){const d=c.patternDependencies;for(const f of e){const _=f.paint.get(`${n}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:s},i,{},c.availableImages);x=x&&x.name?x.name:x,d[x]=!0,i.patterns[f.id]=x}}return i}class gf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $e,this.indexArray=new pt,this.indexArray2=new ai,this.programConfigurations=new yl(e.layers,e.zoom),this.segments=new Nn,this.segments2=new Nn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,s,c){this.hasPattern=b_("fill",this.layers,i);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:_,id:x,index:w,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,P=El(_,A);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),P,s))continue;const D=d?d.evaluate(P,{},s,i.availableImages):void 0,L={id:x,properties:_.properties,type:_.type,sourceLayerIndex:S,index:w,geometry:A?P.geometry:ds(_,s,c),patterns:{},sortKey:D};f.push(L)}d&&f.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of f){const{geometry:x,index:w,sourceLayerIndex:S}=_;if(this.hasPattern){const A=T_("fill",this.layers,_,this.zoom,i);this.patternFeatures.push(A)}else this.addFeature(_,x,w,s,{},i.availableImages);i.featureIndex.insert(e[w].feature,x,w,S,this.index)}}update(e,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,c)}addFeatures(e,i,s,c,d){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pM),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,c,d,f=[]){for(const _ of w_(i,500)){let x=0;for(const L of _)x+=L.length;const w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),S=w.vertexLength,A=[],P=[];for(const L of _){if(L.length===0)continue;L!==_[0]&&P.push(A.length/2);const F=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),j=F.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(j+L.length-1,j),A.push(L[0].x),A.push(L[0].y);for(let Y=1;Y<L.length;Y++)this.layoutVertexArray.emplaceBack(L[Y].x,L[Y].y),this.indexArray2.emplaceBack(j+Y-1,j+Y),A.push(L[Y].x),A.push(L[Y].y);F.vertexLength+=L.length,F.primitiveLength+=L.length}const D=x_(A,P);for(let L=0;L<D.length;L+=3)this.indexArray.emplaceBack(S+D[L],S+D[L+1],S+D[L+2]);w.vertexLength+=x,w.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,c)}}ut(gf,"FillBucket",{omit:["layers","patternFeatures"]});const CM=new ee({"fill-sort-key":new $(De.layout_fill["fill-sort-key"])});var MM={paint:new ee({"fill-antialias":new B(De.paint_fill["fill-antialias"]),"fill-opacity":new $(De.paint_fill["fill-opacity"]),"fill-color":new $(De.paint_fill["fill-color"]),"fill-outline-color":new $(De.paint_fill["fill-outline-color"]),"fill-translate":new B(De.paint_fill["fill-translate"]),"fill-translate-anchor":new B(De.paint_fill["fill-translate-anchor"]),"fill-pattern":new $(De.paint_fill["fill-pattern"])}),layout:CM};const AM=ye([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),PM=ye([{name:"a_centroid_pos",components:2,type:"Uint16"}]),IM=ye([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:kM}=AM;var _f={},zM=it,r1=Vc;function Vc(n,e,i,s,c){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=c,n.readFields(DM,this,e)}function DM(n,e,i){n==1?e.id=i.readVarint():n==2?function(s,c){for(var d=s.readVarint()+s.pos;s.pos<d;){var f=c._keys[s.readVarint()],_=c._values[s.readVarint()];c.properties[f]=_}}(i,e):n==3?e.type=i.readVarint():n==4&&(e._geometry=i.pos)}function LM(n){for(var e,i,s=0,c=0,d=n.length,f=d-1;c<d;f=c++)s+=((i=n[f]).x-(e=n[c]).x)*(e.y+i.y);return s}Vc.types=["Unknown","Point","LineString","Polygon"],Vc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,s=1,c=0,d=0,f=0,_=[];n.pos<i;){if(c<=0){var x=n.readVarint();s=7&x,c=x>>3}if(c--,s===1||s===2)d+=n.readSVarint(),f+=n.readSVarint(),s===1&&(e&&_.push(e),e=[]),e.push(new zM(d,f));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Vc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,s=0,c=0,d=0,f=1/0,_=-1/0,x=1/0,w=-1/0;n.pos<e;){if(s<=0){var S=n.readVarint();i=7&S,s=S>>3}if(s--,i===1||i===2)(c+=n.readSVarint())<f&&(f=c),c>_&&(_=c),(d+=n.readSVarint())<x&&(x=d),d>w&&(w=d);else if(i!==7)throw new Error("unknown command "+i)}return[f,x,_,w]},Vc.prototype.toGeoJSON=function(n,e,i){var s,c,d=this.extent*Math.pow(2,i),f=this.extent*n,_=this.extent*e,x=this.loadGeometry(),w=Vc.types[this.type];function S(D){for(var L=0;L<D.length;L++){var F=D[L];D[L]=[360*(F.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(s=0;s<x.length;s++)A[s]=x[s][0];S(x=A);break;case 2:for(s=0;s<x.length;s++)S(x[s]);break;case 3:for(x=function(D){var L=D.length;if(L<=1)return[D];for(var F,j,Y=[],oe=0;oe<L;oe++){var J=LM(D[oe]);J!==0&&(j===void 0&&(j=J<0),j===J<0?(F&&Y.push(F),F=[D[oe]]):F.push(D[oe]))}return F&&Y.push(F),Y}(x),s=0;s<x.length;s++)for(c=0;c<x[s].length;c++)S(x[s][c])}x.length===1?x=x[0]:w="Multi"+w;var P={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(P.id=this.id),P};var RM=r1,o1=s1;function s1(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(BM,this,e),this.length=this._features.length}function BM(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push(function(s){for(var c=null,d=s.readVarint()+s.pos;s.pos<d;){var f=s.readVarint()>>3;c=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}return c}(i))}s1.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new RM(this._pbf,e,this.extent,this._keys,this._values)};var FM=o1;function OM(n,e,i){if(n===3){var s=new FM(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}var E_=_f.VectorTile=function(n,e){this.layers=n.readFields(OM,{},e)},yf=_f.VectorTileFeature=r1;function vf(n,e,i,s){const c=[],d=s===0?(f,_,x,w,S,A)=>{f.push(new Be(A,x+(A-_)/(w-_)*(S-x)))}:(f,_,x,w,S,A)=>{f.push(new Be(_+(A-x)/(S-x)*(w-_),A))};for(const f of n){const _=[];for(const x of f){if(x.length<=2)continue;const w=[];for(let P=0;P<x.length-1;P++){const D=x[P].x,L=x[P].y,F=x[P+1].x,j=x[P+1].y,Y=s===0?D:L,oe=s===0?F:j;Y<e?oe>e&&d(w,D,L,F,j,e):Y>i?oe<i&&d(w,D,L,F,j,i):w.push(x[P]),oe<e&&Y>=e&&d(w,D,L,F,j,e),oe>i&&Y<=i&&d(w,D,L,F,j,i)}let S=x[x.length-1];const A=s===0?S.x:S.y;A>=e&&A<=i&&w.push(S),w.length&&(S=w[w.length-1],w[0].x===S.x&&w[0].y===S.y||w.push(w[0]),_.push(w))}_.length&&c.push(_)}return c}_f.VectorTileLayer=o1;const VM=yf.types,UM=Math.pow(2,13);function Zh(n,e,i,s,c,d,f,_){n.emplaceBack((e<<1)+f,(i<<1)+d,(Math.floor(s*UM)<<1)+c,Math.round(_))}function qh(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class a1{constructor(){this.acc=new Be(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Be(e.x,e.y),this.max=new Be(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,c=this.max;e.x<s.x?s.x=e.x:e.x>c.x&&(c.x=e.x),e.y<s.y?s.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===yt)&&e.x===i.x)!=((e.y===0||e.y===yt)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,$t(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>yt!=e.x>yt&&this.addBorderIntersection(1,$t(i.y,e.y,(yt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,$t(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>yt!=e.y>yt&&this.addBorderIntersection(3,$t(i.x,e.x,(yt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((i,s)=>i+s.edges,0);return e!==0?this.acc.div(e)._round():new Be(0,0)}span(){return new Be(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Wh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Fe,this.centroidVertexArray=new co,this.indexArray=new pt,this.programConfigurations=new yl(e.layers,e.zoom),this.segments=new Nn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,s,c){this.features=[],this.hasPattern=b_("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(d){const f=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*f/(f*f+1)/yt/(1<<d.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:f,index:_,sourceLayerIndex:x}of e){const w=this.layers[0]._featureFilter.needGeometry,S=El(d,w);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),S,s))continue;const A={id:f,sourceLayerIndex:x,index:_,geometry:w?S.geometry:ds(d,s,c),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(T_("fill-extrusion",this.layers,A,this.zoom,i)):this.addFeature(A,A.geometry,_,s,{},i.availableImages,c),i.featureIndex.insert(d,A.geometry,_,x,this.index,P)}this.sortBorders()}addFeatures(e,i,s,c,d){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,i,s,c,d)}this.sortBorders()}update(e,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kM),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,IM.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,PM.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,c,d,f,_){const x=[new Be(0,0),new Be(yt,yt)],w=_.projection,S=w.name==="globe",A=this.enableTerrain&&!S?new a1:null,P=VM[e.type]==="Polygon";S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new qe);const D=w_(i,500);for(let Y=D.length-1;Y>=0;Y--){const oe=D[Y];(oe.length===0||(L=oe[0]).every(J=>J.x<=0)||L.every(J=>J.x>=yt)||L.every(J=>J.y<=0)||L.every(J=>J.y>=yt))&&D.splice(Y,1)}var L;let F;if(S)F=f1(D,x,c);else{F=[];for(const Y of D)F.push({polygon:Y,bounds:x})}const j=P?this.edgeRadius:0;for(const{polygon:Y,bounds:oe}of F){let J=0,ie=0;for(const se of Y)P&&!se[0].equals(se[se.length-1])&&se.push(se[0]),ie+=P?se.length-1:se.length;const ae=this.segments.prepareSegment((P?5:4)*ie,this.layoutVertexArray,this.indexArray);if(P){const se=[],Ce=[];J=ae.vertexLength;for(const Le of Y){let Ze,Ae;Le.length&&Le!==Y[0]&&Ce.push(se.length/2),Ze=Le[1].sub(Le[0])._perp()._unit();for(let Oe=1;Oe<Le.length;Oe++){const Ve=Le[Oe],Ne=Le[Oe===Le.length-1?1:Oe+1];let{x:Ke,y:ze}=Ve;if(j){Ae=Ne.sub(Ve)._perp()._unit();const nt=Ze.add(Ae)._unit(),dt=j*Math.min(4,1/(Ze.x*nt.x+Ze.y*nt.y));Ke+=dt*nt.x,ze+=dt*nt.y,Ze=Ae}Zh(this.layoutVertexArray,Ke,ze,0,0,1,1,0),ae.vertexLength++,se.push(Ve.x,Ve.y),S&&qh(this.layoutVertexExtArray,w.projectTilePoint(Ke,ze,c),w.upVector(c,Ke,ze))}}const Te=x_(se,Ce);for(let Le=0;Le<Te.length;Le+=3)this.indexArray.emplaceBack(J+Te[Le],J+Te[Le+2],J+Te[Le+1]),ae.primitiveLength++}for(const se of Y){A&&se.length&&A.startRing(se[0]);let Ce,Te,Le,Ze=se.length>4&&h1(se[se.length-2],se[0],se[1]),Ae=j?NM(se[se.length-2],se[0],se[1],j):0;Te=se[1].sub(se[0])._perp()._unit();let Oe=!0;for(let Ve=1,Ne=0;Ve<se.length;Ve++){let Ke=se[Ve-1],ze=se[Ve];const nt=se[Ve===se.length-1?1:Ve+1];if(A&&P&&A.currentPolyCount.top++,u1(ze,Ke,oe)){j&&(Te=nt.sub(ze)._perp()._unit(),Oe=!Oe);continue}A&&A.append(ze,Ke);const dt=ze.sub(Ke)._perp(),rt=dt.x/(Math.abs(dt.x)+Math.abs(dt.y)),Ct=dt.y>0?1:0,Ye=Ke.dist(ze);if(Ne+Ye>32768&&(Ne=0),j){Le=nt.sub(ze)._perp()._unit();let At=c1(Ke,ze,nt,l1(Te,Le),j);isNaN(At)&&(At=0);const wt=ze.sub(Ke)._unit();Ke=Ke.add(wt.mult(Ae))._round(),ze=ze.add(wt.mult(-At))._round(),Ae=At,Te=Le}const mt=ae.vertexLength,Mt=se.length>4&&h1(Ke,ze,nt);let qt=d1(Ne,Ze,Oe);if(Zh(this.layoutVertexArray,Ke.x,Ke.y,rt,Ct,0,0,qt),Zh(this.layoutVertexArray,Ke.x,Ke.y,rt,Ct,0,1,qt),Ne+=Ye,qt=d1(Ne,Mt,!Oe),Ze=Mt,Zh(this.layoutVertexArray,ze.x,ze.y,rt,Ct,0,0,qt),Zh(this.layoutVertexArray,ze.x,ze.y,rt,Ct,0,1,qt),ae.vertexLength+=4,this.indexArray.emplaceBack(mt+0,mt+1,mt+2),this.indexArray.emplaceBack(mt+1,mt+3,mt+2),ae.primitiveLength+=2,j){const At=J+(Ve===1?se.length-2:Ve-2),wt=Ve===1?J:At+1;if(this.indexArray.emplaceBack(mt+1,At,mt+3),this.indexArray.emplaceBack(At,wt,mt+3),ae.primitiveLength+=2,Ce===void 0&&(Ce=mt),!u1(nt,se[Ve],oe)){const gn=Ve===se.length-1?Ce:ae.vertexLength;this.indexArray.emplaceBack(mt+2,mt+3,gn),this.indexArray.emplaceBack(mt+3,gn+1,gn),this.indexArray.emplaceBack(mt+3,wt,gn+1),ae.primitiveLength+=3}Oe=!Oe}if(S){const At=this.layoutVertexExtArray,wt=w.projectTilePoint(Ke.x,Ke.y,c),gn=w.projectTilePoint(ze.x,ze.y,c),zt=w.upVector(c,Ke.x,Ke.y),Dt=w.upVector(c,ze.x,ze.y);qh(At,wt,zt),qh(At,wt,zt),qh(At,gn,Dt),qh(At,gn,Dt)}}P&&(J+=se.length-1)}}if(A&&A.polyCount.length>0){if(A.borders){A.vertexArrayOffset=this.centroidVertexArray.length;const Y=A.borders,oe=this.featuresOnBorder.push(A)-1;for(let J=0;J<4;J++)Y[J][0]!==Number.MAX_VALUE&&this.borders[J].push(oe)}this.encodeCentroid(A.borders?void 0:A.centroid(),A)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,i,s=!0){let c,d;if(e)if(e.y!==0){const _=i.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(_.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(_.y/10))}else c=Math.ceil(7*(e.x+450)),d=0;else c=0,d=+s;let f=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const _ of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*_.edges+_.top);for(let x=0;x<_.top;x++)this.centroidVertexArray.emplace(f++,c,d);for(let x=0;x<2*_.edges;x++)this.centroidVertexArray.emplace(f++,0,d),this.centroidVertexArray.emplace(f++,c,d)}}}function l1(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function NM(n,e,i,s){const c=e.sub(n)._perp()._unit(),d=i.sub(e)._perp()._unit();return c1(n,e,i,l1(c,d),s)}function c1(n,e,i,s,c){const d=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(i)/3,c*d/s)}function u1(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function h1(n,e,i){if(n.x<0||n.x>=yt||e.x<0||e.x>=yt||i.x<0||i.x>=yt)return!1;const s=i.sub(e),c=s.perp(),d=n.sub(e);return(s.x*d.x+s.y*d.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(d.x*d.x+d.y*d.y))>-.866&&c.x*d.x+c.y*d.y<0}function d1(n,e,i){const s=e?2|n:-3&n;return i?1|s:-2&s}function p1(){const n=Math.PI/32,e=Math.tan(n),i=Uh;return i*Math.sqrt(1+2*e*e)-i}function f1(n,e,i){const s=1<<i.z,c=Er(i.x/s),d=Er((i.x+1)/s),f=bi(i.y/s),_=bi((i.y+1)/s);return function(x,w,S,A,P=0,D){const L=[];if(!x.length||!S||!A)return L;const F=(se,Ce)=>{for(const Te of se)L.push({polygon:Te,bounds:Ce})},j=Math.ceil(Math.log2(S)),Y=Math.ceil(Math.log2(A)),oe=j-Y,J=[];for(let se=0;se<Math.abs(oe);se++)J.push(oe>0?0:1);for(let se=0;se<Math.min(j,Y);se++)J.push(0),J.push(1);let ie=x;if(ie=vf(ie,w[0].y-P,w[1].y+P,1),ie=vf(ie,w[0].x-P,w[1].x+P,0),!ie.length)return L;const ae=[];for(J.length?ae.push({polygons:ie,bounds:w,depth:0}):F(ie,w);ae.length;){const se=ae.pop(),Ce=se.depth,Te=J[Ce],Le=se.bounds[0],Ze=se.bounds[1],Ae=Te===0?Le.x:Le.y,Oe=Te===0?Ze.x:Ze.y,Ve=D?D(Te,Ae,Oe):.5*(Ae+Oe),Ne=vf(se.polygons,Ae-P,Ve+P,Te),Ke=vf(se.polygons,Ve-P,Oe+P,Te);if(Ne.length){const ze=[Le,new Be(Te===0?Ve:Ze.x,Te===1?Ve:Ze.y)];J.length>Ce+1?ae.push({polygons:Ne,bounds:ze,depth:Ce+1}):F(Ne,ze)}if(Ke.length){const ze=[new Be(Te===0?Ve:Le.x,Te===1?Ve:Le.y),Ze];J.length>Ce+1?ae.push({polygons:Ke,bounds:ze,depth:Ce+1}):F(Ke,ze)}}return L}(n,e,Math.ceil((d-c)/11.25),Math.ceil((f-_)/11.25),1,(x,w,S)=>{if(x===0)return .5*(w+S);{const A=bi((i.y+w/yt)/s);return(Bo(.5*(bi((i.y+S/yt)/s)+A))*s-i.y)*yt}})}ut(Wh,"FillExtrusionBucket",{omit:["layers","features"]}),ut(a1,"PartMetadata");const jM=new ee({"fill-extrusion-edge-radius":new B(De["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var GM={paint:new ee({"fill-extrusion-opacity":new B(De["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $(De["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new B(De["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new B(De["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $(De["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $(De["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $(De["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new B(De["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new B(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new B(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new B(De["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:jM};function m1(n,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class xf{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Xh(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=function(d,f,_){var x=m1(256*d,256*(f=Math.pow(2,_)-f-1),_),w=m1(256*(d+1),256*(f+1),_);return x[0]+","+x[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),c=function(d,f,_){let x,w="";for(let S=d;S>0;S--)x=1<<S-1,w+=(f&x?1:0)+(_&x?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class g1{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Xh(e,i.z,i.z,i.x,i.y)}}class Oi{constructor(e,i,s,c,d){this.overscaledZ=e,this.wrap=i,this.canonical=new xf(s,+c,+d),this.key=i===0&&e===s?this.canonical.key:Xh(i,e,s,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Oi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Oi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Xh(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Xh(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Oi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new Oi(i,this.wrap,i,s,c),new Oi(i,this.wrap,i,s+1,c),new Oi(i,this.wrap,i,s,c+1),new Oi(i,this.wrap,i,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Oi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Oi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new g1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xh(n,e,i,s,c){const d=1<<Math.min(i,22);let f=d*(c%d)+s%d;return n&&i<22&&(f+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}ut(xf,"CanonicalTileID"),ut(Oi,"OverscaledTileID",{omit:["projMatrix"]});class Uc extends Be{constructor(e,i,s){super(e,i),this.z=s}}function Hh(n,e){return n.x*e.x+n.y*e.y}function _1(n,e){if(n.length===1){let i=0;const s=e[i++];let c;for(;!c||s.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const d=e[i],f=n[0],_=c.sub(s),x=d.sub(s),w=f.sub(s),S=Hh(_,_),A=Hh(_,x),P=Hh(x,x),D=Hh(w,_),L=Hh(w,x),F=S*P-A*A,j=(P*D-A*L)/F,Y=(S*L-A*D)/F,oe=s.z*(1-j-Y)+c.z*j+d.z*Y;if(isFinite(oe))return oe}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function y1(n,e,i,s,c,d,f,_){const x=f*c.getElevationAt(n,e,!0,!0),w=d[0]!==0,S=w?d[1]===0?f*(d[0]/7-450):f*function(A,P,D){const L=Math.floor(P[0]/8),F=Math.floor(P[1]/8),j=10*(P[0]-8*L),Y=10*(P[1]-8*F),oe=A.getElevationAt(L,F,!0,!0),J=A.getMeterToDEM(D),ie=Math.floor(.5*(j*J-1)),ae=Math.floor(.5*(Y*J-1)),se=A.tileCoordToPixel(L,F),Ce=2*ie+1,Te=2*ae+1,Le=function(Ke,ze,nt,dt,rt){return[Ke.getElevationAtPixel(ze,nt,!0),Ke.getElevationAtPixel(ze+rt,nt,!0),Ke.getElevationAtPixel(ze,nt+rt,!0),Ke.getElevationAtPixel(ze+dt,nt+rt,!0)]}(A,se.x-ie,se.y-ae,Ce,Te),Ze=Math.abs(Le[0]-Le[1]),Ae=Math.abs(Le[2]-Le[3]),Oe=Math.abs(Le[0]-Le[2])+Math.abs(Le[1]-Le[3]),Ve=Math.min(.25,.5*J*(Ze+Ae)/Ce),Ne=Math.min(.25,.5*J*Oe/Te);return oe+Math.max(Ve*j,Ne*Y)}(c,d,_):x;return{base:x+(i===0)?-1:i,top:w?Math.max(S+s,x+i+2):x+s}}const $M=ye([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ZM}=$M,qM=ye([{name:"a_packed",components:4,type:"Float32"}]),{members:WM}=qM,XM=yf.types,HM=Math.cos(Math.PI/180*37.5);class wf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Me,this.layoutVertexArray2=new Ge,this.indexArray=new pt,this.programConfigurations=new yl(e.layers,e.zoom),this.segments=new Nn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,c){this.hasPattern=b_("line",this.layers,i);const d=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:S,id:A,index:P,sourceLayerIndex:D}of e){const L=this.layers[0]._featureFilter.needGeometry,F=El(S,L);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),F,s))continue;const j=d?d.evaluate(F,{},s):void 0,Y={id:A,properties:S.properties,type:S.type,sourceLayerIndex:D,index:P,geometry:L?F.geometry:ds(S,s,c),patterns:{},sortKey:j};f.push(Y)}d&&f.sort((S,A)=>S.sortKey-A.sortKey);const{lineAtlas:_,featureIndex:x}=i,w=this.addConstantDashes(_);for(const S of f){const{geometry:A,index:P,sourceLayerIndex:D}=S;if(w&&this.addFeatureDashes(S,_),this.hasPattern){const L=T_("line",this.layers,S,this.zoom,i);this.patternFeatures.push(L)}else this.addFeature(S,A,P,s,_.positions,i.availableImages);x.insert(e[P].feature,A,P,D,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,d=s.layout.get("line-cap").value;if(c.kind!=="constant"||d.kind!=="constant")i=!0;else{const f=d.value,_=c.value;if(!_)continue;e.addDash(_,f)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let _,x;if(d.kind==="constant"){if(_=d.value,!_)continue}else _=d.evaluate({zoom:s},e);x=f.kind==="constant"?f.value:f.evaluate({zoom:s},e),i.addDash(_,x),e.patterns[c.id]=i.getKey(_,x)}}update(e,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,c)}addFeatures(e,i,s,c,d){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,WM)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ZM),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,c,d,f){const _=this.layers[0].layout,x=_.get("line-join").evaluate(e,{}),w=_.get("line-cap").evaluate(e,{}),S=_.get("line-miter-limit"),A=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of i)this.addLine(P,e,x,w,S,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,c)}addLine(e,i,s,c,d,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=XM[i.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let w=0;for(;w<x-1&&e[w].equals(e[w+1]);)w++;if(x<(_?3:2))return;s==="bevel"&&(d=1.05);const S=this.overscaling<=16?15*yt/(512*this.overscaling):0,A=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let P,D,L,F,j;this.e1=this.e2=-1,_&&(P=e[x-2],j=e[w].sub(P)._unit()._perp());for(let Y=w;Y<x;Y++){if(L=Y===x-1?_?e[w+1]:void 0:e[Y+1],L&&e[Y].equals(L))continue;j&&(F=j),P&&(D=P),P=e[Y],j=L?L.sub(P)._unit()._perp():F,F=F||j;let oe=F.add(j);oe.x===0&&oe.y===0||oe._unit();const J=F.x*j.x+F.y*j.y,ie=oe.x*j.x+oe.y*j.y,ae=ie!==0?1/ie:1/0,se=2*Math.sqrt(2-2*ie),Ce=ie<HM&&D&&L,Te=F.x*j.y-F.y*j.x>0;if(Ce&&Y>w){const Ae=P.dist(D);if(Ae>2*S){const Oe=P.sub(P.sub(D)._mult(S/Ae)._round());this.updateDistance(D,Oe),this.addCurrentVertex(Oe,F,0,0,A),D=Oe}}const Le=D&&L;let Ze=Le?s:_?"butt":c;if(Le&&Ze==="round"&&(ae<f?Ze="miter":ae<=2&&(Ze="fakeround")),Ze==="miter"&&ae>d&&(Ze="bevel"),Ze==="bevel"&&(ae>2&&(Ze="flipbevel"),ae<d&&(Ze="miter")),D&&this.updateDistance(D,P),Ze==="miter")oe._mult(ae),this.addCurrentVertex(P,oe,0,0,A);else if(Ze==="flipbevel"){if(ae>100)oe=j.mult(-1);else{const Ae=ae*F.add(j).mag()/F.sub(j).mag();oe._perp()._mult(Ae*(Te?-1:1))}this.addCurrentVertex(P,oe,0,0,A),this.addCurrentVertex(P,oe.mult(-1),0,0,A)}else if(Ze==="bevel"||Ze==="fakeround"){const Ae=-Math.sqrt(ae*ae-1),Oe=Te?Ae:0,Ve=Te?0:Ae;if(D&&this.addCurrentVertex(P,F,Oe,Ve,A),Ze==="fakeround"){const Ne=Math.round(180*se/Math.PI/20);for(let Ke=1;Ke<Ne;Ke++){let ze=Ke/Ne;if(ze!==.5){const dt=ze-.5;ze+=ze*dt*(ze-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*dt*dt+(.848013+J*(.215638*J-1.06021)))}const nt=j.sub(F)._mult(ze)._add(F)._unit()._mult(Te?-1:1);this.addHalfVertex(P,nt.x,nt.y,!1,Te,0,A)}}L&&this.addCurrentVertex(P,j,-Oe,-Ve,A)}else if(Ze==="butt")this.addCurrentVertex(P,oe,0,0,A);else if(Ze==="square"){const Ae=D?1:-1;D||this.addCurrentVertex(P,oe,Ae,Ae,A),this.addCurrentVertex(P,oe,0,0,A),D&&this.addCurrentVertex(P,oe,Ae,Ae,A)}else Ze==="round"&&(D&&(this.addCurrentVertex(P,F,0,0,A),this.addCurrentVertex(P,F,1,1,A,!0)),L&&(this.addCurrentVertex(P,j,-1,-1,A,!0),this.addCurrentVertex(P,j,0,0,A)));if(Ce&&Y<x-1){const Ae=P.dist(L);if(Ae>2*S){const Oe=P.add(L.sub(P)._mult(S/Ae)._round());this.updateDistance(P,Oe),this.addCurrentVertex(Oe,j,0,0,A),P=Oe}}}}addCurrentVertex(e,i,s,c,d,f=!1){const _=i.y*c-i.x,x=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*s,i.y-i.x*s,f,!1,s,d),this.addHalfVertex(e,_,x,f,!0,-c,d)}addHalfVertex({x:e,y:i},s,c,d,f,_,x){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),x.primitiveLength++),f?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}ut(wf,"LineBucket",{omit:["layers","patternFeatures"]});const KM=new ee({"line-cap":new $(De.layout_line["line-cap"]),"line-join":new $(De.layout_line["line-join"]),"line-miter-limit":new B(De.layout_line["line-miter-limit"]),"line-round-limit":new B(De.layout_line["line-round-limit"]),"line-sort-key":new $(De.layout_line["line-sort-key"])});var v1={paint:new ee({"line-opacity":new $(De.paint_line["line-opacity"]),"line-color":new $(De.paint_line["line-color"]),"line-translate":new B(De.paint_line["line-translate"]),"line-translate-anchor":new B(De.paint_line["line-translate-anchor"]),"line-width":new $(De.paint_line["line-width"]),"line-gap-width":new $(De.paint_line["line-gap-width"]),"line-offset":new $(De.paint_line["line-offset"]),"line-blur":new $(De.paint_line["line-blur"]),"line-dasharray":new $(De.paint_line["line-dasharray"]),"line-pattern":new $(De.paint_line["line-pattern"]),"line-gradient":new Q(De.paint_line["line-gradient"]),"line-trim-offset":new B(De.paint_line["line-trim-offset"])}),layout:KM};const x1=new class extends ${possiblyEvaluate(n,e){return e=new M(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,s){return e=hn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,s)}}(v1.paint.properties["line-width"].specification);function w1(n,e){return e>0?e+2*n:n}x1.useIntegerZoom=!0;const YM=ye([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),JM=ye([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),QM=ye([{name:"a_projected_pos",components:4,type:"Float32"}],4);ye([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eA=ye([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tA=ye([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const b1=ye([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nA=ye([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ye([{name:"triangle",components:3,type:"Uint16"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ye([{type:"Float32",name:"offsetX"}]),ye([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fi=24;const go=128;function S_(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new M(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=i;let d=0;for(;d<s.length&&s[d]<=n;)d++;d=Math.max(0,d-1);let f=d;for(;f<s.length&&s[f]<n+1;)f++;f=Math.min(s.length-1,f);const _=s[d],x=s[f];return i.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:x,minSize:i.evaluate(new M(_)),maxSize:i.evaluate(new M(x)),interpolationType:c}}}function bf(n,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:c}){return n.kind==="source"?s/go:n.kind==="composite"?$t(s/go,c/go,i):e}function Nc(n,e){let i=0,s=0;if(n.kind==="constant")s=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:f}=n,_=c?We(Fr.interpolationFactor(c,e,d,f),0,1):0;n.kind==="camera"?s=$t(n.minSize,n.maxSize,_):i=_}return{uSizeT:i,uSize:s}}var iA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:go,evaluateSizeForFeature:bf,evaluateSizeForZoom:Nc,getSizeData:S_});function rA(n,e,i){return n.sections.forEach(s=>{s.text=function(c,d,f){const _=d.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),E.applyArabicShaping&&(c=E.applyArabicShaping(c)),c}(s.text,e,i)}),n}const Kh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function oA(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function sA(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var T1=dn,E1=function(n,e,i,s,c){var d,f,_=8*c-s-1,x=(1<<_)-1,w=x>>1,S=-7,A=i?c-1:0,P=i?-1:1,D=n[e+A];for(A+=P,d=D&(1<<-S)-1,D>>=-S,S+=_;S>0;d=256*d+n[e+A],A+=P,S-=8);for(f=d&(1<<-S)-1,d>>=-S,S+=s;S>0;f=256*f+n[e+A],A+=P,S-=8);if(d===0)d=1-w;else{if(d===x)return f?NaN:1/0*(D?-1:1);f+=Math.pow(2,s),d-=w}return(D?-1:1)*f*Math.pow(2,d-s)},S1=function(n,e,i,s,c,d){var f,_,x,w=8*d-c-1,S=(1<<w)-1,A=S>>1,P=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=s?0:d-1,L=s?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,f=S):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+A>=1?P/x:P*Math.pow(2,1-A))*x>=2&&(f++,x/=2),f+A>=S?(_=0,f=S):f+A>=1?(_=(e*x-1)*Math.pow(2,c),f+=A):(_=e*Math.pow(2,A-1)*Math.pow(2,c),f=0));c>=8;n[i+D]=255&_,D+=L,_/=256,c-=8);for(f=f<<c|_,w+=c;w>0;n[i+D]=255&f,D+=L,f/=256,w-=8);n[i+D-L]|=128*F};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function dn(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}dn.Varint=0,dn.Fixed64=1,dn.Bytes=2,dn.Fixed32=5;var C_=4294967296,C1=1/C_,M1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function fs(n){return n.type===dn.Bytes?n.readVarint()+n.pos:n.pos+1}function jc(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function A1(n,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(var c=i.pos-1;c>=n;c--)i.buf[c+s]=i.buf[c]}function aA(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function lA(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function cA(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function uA(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function hA(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function dA(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function pA(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function fA(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function mA(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function Tf(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Gc(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function P1(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}dn.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),c=s>>3,d=this.pos;this.type=7&s,n(c,e,this),this.pos===d&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Tf(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=P1(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Tf(this.buf,this.pos)+Tf(this.buf,this.pos+4)*C_;return this.pos+=8,n},readSFixed64:function(){var n=Tf(this.buf,this.pos)+P1(this.buf,this.pos+4)*C_;return this.pos+=8,n},readFloat:function(){var n=E1(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=E1(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,s=this.buf;return e=127&(i=s[this.pos++]),i<128?e:(e|=(127&(i=s[this.pos++]))<<7,i<128?e:(e|=(127&(i=s[this.pos++]))<<14,i<128?e:(e|=(127&(i=s[this.pos++]))<<21,i<128?e:function(c,d,f){var _,x,w=f.buf;if(_=(112&(x=w[f.pos++]))>>4,x<128||(_|=(127&(x=w[f.pos++]))<<3,x<128)||(_|=(127&(x=w[f.pos++]))<<10,x<128)||(_|=(127&(x=w[f.pos++]))<<17,x<128)||(_|=(127&(x=w[f.pos++]))<<24,x<128)||(_|=(1&(x=w[f.pos++]))<<31,x<128))return jc(c,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&M1?function(i,s,c){return M1.decode(i.subarray(s,c))}(this.buf,e,n):function(i,s,c){for(var d="",f=s;f<c;){var _,x,w,S=i[f],A=null,P=S>239?4:S>223?3:S>191?2:1;if(f+P>c)break;P===1?S<128&&(A=S):P===2?(192&(_=i[f+1]))==128&&(A=(31&S)<<6|63&_)<=127&&(A=null):P===3?(x=i[f+2],(192&(_=i[f+1]))==128&&(192&x)==128&&((A=(15&S)<<12|(63&_)<<6|63&x)<=2047||A>=55296&&A<=57343)&&(A=null)):P===4&&(x=i[f+2],w=i[f+3],(192&(_=i[f+1]))==128&&(192&x)==128&&(192&w)==128&&((A=(15&S)<<18|(63&_)<<12|(63&x)<<6|63&w)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,P=1):A>65535&&(A-=65536,d+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),d+=String.fromCharCode(A),f+=P}return d}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==dn.Bytes)return n.push(this.readVarint(e));var i=fs(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==dn.Bytes)return n.push(this.readSVarint());var e=fs(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==dn.Bytes)return n.push(this.readBoolean());var e=fs(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==dn.Bytes)return n.push(this.readFloat());var e=fs(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==dn.Bytes)return n.push(this.readDouble());var e=fs(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==dn.Bytes)return n.push(this.readFixed32());var e=fs(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==dn.Bytes)return n.push(this.readSFixed32());var e=fs(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==dn.Bytes)return n.push(this.readFixed64());var e=fs(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==dn.Bytes)return n.push(this.readSFixed64());var e=fs(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===dn.Varint)for(;this.buf[this.pos++]>127;);else if(e===dn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===dn.Fixed32)this.pos+=4;else{if(e!==dn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Gc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Gc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Gc(this.buf,-1&n,this.pos),Gc(this.buf,Math.floor(n*C1),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Gc(this.buf,-1&n,this.pos),Gc(this.buf,Math.floor(n*C1),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(d,f,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(s,0,i),function(d,f){var _=(7&d)<<4;f.buf[f.pos++]|=_|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(c,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,c,d){for(var f,_,x=0;x<c.length;x++){if((f=c.charCodeAt(x))>55295&&f<57344){if(!_){f>56319||x+1===c.length?(s[d++]=239,s[d++]=191,s[d++]=189):_=f;continue}if(f<56320){s[d++]=239,s[d++]=191,s[d++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(s[d++]=239,s[d++]=191,s[d++]=189,_=null);f<128?s[d++]=f:(f<2048?s[d++]=f>>6|192:(f<65536?s[d++]=f>>12|224:(s[d++]=f>>18|240,s[d++]=f>>12&63|128),s[d++]=f>>6&63|128),s[d++]=63&f|128)}return d}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&A1(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),S1(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),S1(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var s=this.pos-i;s>=128&&A1(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,i){this.writeTag(n,dn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,aA,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,lA,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,hA,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,cA,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,uA,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,dA,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,pA,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,fA,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,mA,e)},writeBytesField:function(n,e){this.writeTag(n,dn.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,dn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,dn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,dn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,dn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,dn.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,dn.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,dn.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,dn.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,dn.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var Ef=le(T1);const M_=3;function gA(n,e,i){e.glyphs=[],n===1&&i.readMessage(_A,e)}function _A(n,e,i){if(n===3){const{id:s,bitmap:c,width:d,height:f,left:_,top:x,advance:w}=i.readMessage(yA,{});e.glyphs.push({id:s,bitmap:new ps({width:d+2*M_,height:f+2*M_},c),metrics:{width:d,height:f,left:_,top:x,advance:w}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function yA(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const I1=M_;function A_(n){let e=0,i=0;for(const f of n)e+=f.w*f.h,i=Math.max(i,f.w);n.sort((f,_)=>_.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,d=0;for(const f of n)for(let _=s.length-1;_>=0;_--){const x=s[_];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,d=Math.max(d,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===x.w&&f.h===x.h){const w=s.pop();_<s.length&&(s[_]=w)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(s.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}const Hi=1;class P_{constructor(e,{pixelRatio:i,version:s,stretchX:c,stretchY:d,content:f}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=d,this.content=f,this.version=s}get tl(){return[this.paddedRect.x+Hi,this.paddedRect.y+Hi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Hi,this.paddedRect.y+this.paddedRect.h-Hi]}get displaySize(){return[(this.paddedRect.w-2*Hi)/this.pixelRatio,(this.paddedRect.h-2*Hi)/this.pixelRatio]}}class k1{constructor(e,i){const s={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,s,d),this.addImages(i,c,d);const{w:f,h:_}=A_(d),x=new cr({width:f||1,height:_||1});for(const w in e){const S=e[w],A=s[w].paddedRect;cr.copy(S.data,x,{x:0,y:0},{x:A.x+Hi,y:A.y+Hi},S.data)}for(const w in i){const S=i[w],A=c[w].paddedRect,P=A.x+Hi,D=A.y+Hi,L=S.data.width,F=S.data.height;cr.copy(S.data,x,{x:0,y:0},{x:P,y:D},S.data),cr.copy(S.data,x,{x:0,y:F-1},{x:P,y:D-1},{width:L,height:1}),cr.copy(S.data,x,{x:0,y:0},{x:P,y:D+F},{width:L,height:1}),cr.copy(S.data,x,{x:L-1,y:0},{x:P-1,y:D},{width:1,height:F}),cr.copy(S.data,x,{x:0,y:0},{x:P+L,y:D},{width:1,height:F})}this.image=x,this.iconPositions=s,this.patternPositions=c}addImages(e,i,s){for(const c in e){const d=e[c],f={x:0,y:0,w:d.data.width+2*Hi,h:d.data.height+2*Hi};s.push(f),i[c]=new P_(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,d]=e.tl;s.update(i.data,void 0,{x:c,y:d})}}ut(P_,"ImagePosition"),ut(k1,"ImageAtlas");const Sr={horizontal:1,vertical:2,horizontalOnly:3},z1=-17;class Yh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new Yh;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Yh;return i.imageName=e,i}}class $c{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new $c;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?s.addImageSection(d):s.addTextSection(d,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,s){let c="";for(let d=0;d<i.length;d++){const f=i.charCodeAt(d+1)||null,_=i.charCodeAt(d-1)||null;c+=!s&&(f&&Jp(f)&&!Kh[i[d+1]]||_&&Jp(_)&&!Kh[i[d-1]])||!Kh[i[d]]?i[d]:Kh[i[d]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Sf[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Sf[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new $c;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Yh.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void En("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Yh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):En("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function I_(n,e,i,s,c,d,f,_,x,w,S,A,P,D,L){const F=$c.fromFeature(n,c);A===Sr.vertical&&F.verticalizePunctuation(P);let j=[];const Y=function(se,Ce,Te,Le,Ze,Ae){if(!se)return[];const Oe=[],Ve=function(nt,dt,rt,Ct,Ye,mt){let Mt=0;for(let qt=0;qt<nt.length();qt++){const At=nt.getSection(qt);Mt+=D1(nt.getCharCode(qt),At,Ct,Ye,dt,mt)}return Mt/Math.max(1,Math.ceil(Mt/rt))}(se,Ce,Te,Le,Ze,Ae),Ne=se.text.indexOf("​")>=0;let Ke=0;for(let nt=0;nt<se.length();nt++){const dt=se.getSection(nt),rt=se.getCharCode(nt);if(Sf[rt]||(Ke+=D1(rt,dt,Le,Ze,Ce,Ae)),nt<se.length()-1){const Ct=!((ze=rt)<11904||!(ot["Bopomofo Extended"](ze)||ot.Bopomofo(ze)||ot["CJK Compatibility Forms"](ze)||ot["CJK Compatibility Ideographs"](ze)||ot["CJK Compatibility"](ze)||ot["CJK Radicals Supplement"](ze)||ot["CJK Strokes"](ze)||ot["CJK Symbols and Punctuation"](ze)||ot["CJK Unified Ideographs Extension A"](ze)||ot["CJK Unified Ideographs"](ze)||ot["Enclosed CJK Letters and Months"](ze)||ot["Halfwidth and Fullwidth Forms"](ze)||ot.Hiragana(ze)||ot["Ideographic Description Characters"](ze)||ot["Kangxi Radicals"](ze)||ot["Katakana Phonetic Extensions"](ze)||ot.Katakana(ze)||ot["Vertical Forms"](ze)||ot["Yi Radicals"](ze)||ot["Yi Syllables"](ze)));(vA[rt]||Ct||dt.imageName)&&Oe.push(R1(nt+1,Ke,Ve,Oe,xA(rt,se.getCharCode(nt+1),Ct&&Ne),!1))}}var ze;return B1(R1(se.length(),Ke,Ve,Oe,0,!0))}(F,w,d,e,s,D),{processBidirectionalText:oe,processStyledBidirectionalText:J}=E;if(oe&&F.sections.length===1){const se=oe(F.toString(),Y);for(const Ce of se){const Te=new $c;Te.text=Ce,Te.sections=F.sections;for(let Le=0;Le<Ce.length;Le++)Te.sectionIndex.push(0);j.push(Te)}}else if(J){const se=J(F.text,F.sectionIndex,Y);for(const Ce of se){const Te=new $c;Te.text=Ce[0],Te.sectionIndex=Ce[1],Te.sections=F.sections,j.push(Te)}}else j=function(se,Ce){const Te=[],Le=se.text;let Ze=0;for(const Ae of Ce)Te.push(se.substring(Ze,Ae)),Ze=Ae;return Ze<Le.length&&Te.push(se.substring(Ze,Le.length)),Te}(F,Y);const ie=[],ae={positionedLines:ie,text:F.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,Ce,Te,Le,Ze,Ae,Oe,Ve,Ne,Ke,ze,nt){let dt=0,rt=0,Ct=0;const Ye=Ve==="right"?1:Ve==="left"?0:.5;let mt=!1;for(const zt of Ze){const Dt=zt.getSections();for(const ln of Dt){if(ln.imageName)continue;const pn=Ce[ln.fontStack];if(pn&&(mt=pn.ascender!==void 0&&pn.descender!==void 0,!mt))break}if(!mt)break}let Mt=0;for(const zt of Ze){zt.trim();const Dt=zt.getMaxScale(),ln=(Dt-1)*fi,pn={positionedGlyphs:[],lineOffset:0};se.positionedLines[Mt]=pn;const fn=pn.positionedGlyphs;let cn=0;if(!zt.length()){rt+=Ae,++Mt;continue}let Cn=0,In=0;for(let un=0;un<zt.length();un++){const Jn=zt.getSection(un),$n=zt.getSectionIndex(un),Mn=zt.getCharCode(un);let Xt=Jn.scale,Zn=null,mn=null,Vi=null,qn=fi,mi=0;const li=!(Ne===Sr.horizontal||!ze&&!Eh(Mn)||ze&&(Sf[Mn]||(qt=Mn,ot.Arabic(qt)||ot["Arabic Supplement"](qt)||ot["Arabic Extended-A"](qt)||ot["Arabic Presentation Forms-A"](qt)||ot["Arabic Presentation Forms-B"](qt))));if(Jn.imageName){const Ui=Le[Jn.imageName];if(!Ui)continue;Vi=Jn.imageName,se.iconsInText=se.iconsInText||!0,mn=Ui.paddedRect;const ci=Ui.displaySize;Xt=Xt*fi/nt,Zn={width:ci[0],height:ci[1],left:Hi,top:-I1,advance:li?ci[1]:ci[0],localGlyph:!1},mi=mt?-Zn.height*Xt:z1+Dt*fi-ci[1]*Xt,qn=Zn.advance;const vo=(li?ci[0]:ci[1])*Xt-fi*Dt;vo>0&&vo>cn&&(cn=vo)}else{const Ui=Te[Jn.fontStack];if(!Ui)continue;Ui[Mn]&&(mn=Ui[Mn]);const ci=Ce[Jn.fontStack];if(!ci)continue;const vo=ci.glyphs[Mn];if(!vo)continue;if(Zn=vo.metrics,qn=Mn!==8203?fi:0,mt){const Yc=ci.ascender!==void 0?Math.abs(ci.ascender):0,ad=ci.descender!==void 0?Math.abs(ci.descender):0,ld=(Yc+ad)*Xt;Cn<ld&&(Cn=ld,In=(Yc-ad)/2*Xt),mi=-Yc*Xt}else mi=z1+(Dt-Xt)*fi}li?(se.verticalizable=!0,fn.push({glyph:Mn,imageName:Vi,x:dt,y:rt+mi,vertical:li,scale:Xt,localGlyph:Zn.localGlyph,fontStack:Jn.fontStack,sectionIndex:$n,metrics:Zn,rect:mn}),dt+=qn*Xt+Ke):(fn.push({glyph:Mn,imageName:Vi,x:dt,y:rt+mi,vertical:li,scale:Xt,localGlyph:Zn.localGlyph,fontStack:Jn.fontStack,sectionIndex:$n,metrics:Zn,rect:mn}),dt+=Zn.advance*Xt+Ke)}fn.length!==0&&(Ct=Math.max(dt-Ke,Ct),mt?F1(fn,Ye,cn,In,Ae*Dt/2):F1(fn,Ye,cn,0,Ae/2)),dt=0;const Gn=Ae*Dt+cn;pn.lineOffset=Math.max(cn,ln),rt+=Gn,++Mt}var qt;const At=rt,{horizontalAlign:wt,verticalAlign:gn}=k_(Oe);(function(zt,Dt,ln,pn,fn,cn){const Cn=(Dt-ln)*fn,In=-cn*pn;for(const Gn of zt)for(const un of Gn.positionedGlyphs)un.x+=Cn,un.y+=In})(se.positionedLines,Ye,wt,gn,Ct,At),se.top+=-gn*At,se.bottom=se.top+At,se.left+=-wt*Ct,se.right=se.left+Ct,se.hasBaseline=mt}(ae,e,i,s,j,f,_,x,A,w,P,L),!function(se){for(const Ce of se)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(ie)&&ae}const Sf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function D1(n,e,i,s,c,d){if(e.imageName){const f=s[e.imageName];return f?f.displaySize[0]*e.scale*fi/d+c:0}{const f=i[e.fontStack],_=f&&f.glyphs[n];return _?_.metrics.advance*e.scale+c:0}}function L1(n,e,i,s){const c=Math.pow(n-e,2);return s?n<e?c/2:2*c:c+Math.abs(i)*i}function xA(n,e,i){let s=0;return n===10&&(s-=1e4),i&&(s+=150),n!==40&&n!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function R1(n,e,i,s,c,d){let f=null,_=L1(e,i,c,d);for(const x of s){const w=L1(e-x.x,i,c,d)+x.badness;w<=_&&(f=x,_=w)}return{index:n,x:e,priorBreak:f,badness:_}}function B1(n){return n?B1(n.priorBreak).concat(n.index):[]}function k_(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function F1(n,e,i,s,c){if(!(e||i||s||c))return;const d=n.length-1,f=n[d],_=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=d;x++)n[x].x-=_,n[x].y+=i+s+c}function wA(n,e,i){const{horizontalAlign:s,verticalAlign:c}=k_(i),d=e[0]-n.displaySize[0]*s,f=e[1]-n.displaySize[1]*c;return{image:n,top:f,bottom:f+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function O1(n,e,i,s,c,d){const f=n.image;let _;if(f.content){const j=f.content,Y=f.pixelRatio||1;_=[j[0]/Y,j[1]/Y,f.displaySize[0]-j[2]/Y,f.displaySize[1]-j[3]/Y]}const x=e.left*d,w=e.right*d;let S,A,P,D;i==="width"||i==="both"?(D=c[0]+x-s[3],A=c[0]+w+s[1]):(D=c[0]+(x+w-f.displaySize[0])/2,A=D+f.displaySize[0]);const L=e.top*d,F=e.bottom*d;return i==="height"||i==="both"?(S=c[1]+L-s[0],P=c[1]+F+s[2]):(S=c[1]+(L+F-f.displaySize[1])/2,P=S+f.displaySize[1]),{image:f,top:S,right:A,bottom:P,left:D,collisionPadding:_}}class ms extends Be{constructor(e,i,s,c,d){super(e,i),this.angle=c,this.z=s,d!==void 0&&(this.segment=d)}clone(){return new ms(this.x,this.y,this.z,this.angle,this.segment)}}function V1(n,e,i,s,c){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,_=0;for(;_>-i/2;){if(f--,f<0)return!1;_-=n[f].dist(d),d=n[f]}_+=n[f].dist(n[f+1]),f++;const x=[];let w=0;for(;_<i/2;){const S=n[f],A=n[f+1];if(!A)return!1;let P=n[f-1].angleTo(S)-S.angleTo(A);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:P}),w+=P;_-x[0].distance>s;)w-=x.shift().angleDelta;if(w>c)return!1;f++,_+=S.dist(A)}return!0}function U1(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function N1(n,e,i){return n?.6*e*i:0}function j1(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function bA(n,e,i,s,c,d){const f=N1(i,c,d),_=j1(i,s)*d;let x=0;const w=U1(n)/2;for(let S=0;S<n.length-1;S++){const A=n[S],P=n[S+1],D=A.dist(P);if(x+D>w){const L=(w-x)/D,F=$t(A.x,P.x,L),j=$t(A.y,P.y,L),Y=new ms(F,j,0,P.angleTo(A),S);return!f||V1(n,Y,_,f,e)?Y:void 0}x+=D}}function TA(n,e,i,s,c,d,f,_,x){const w=N1(s,d,f),S=j1(s,c),A=S*f,P=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-A<e/4&&(e=A+e/4),G1(n,P?e/2*_%e:(S/2+2*d)*f*_%e,e,w,i,A,P,!1,x)}function G1(n,e,i,s,c,d,f,_,x){const w=d/2,S=U1(n);let A=0,P=e-i,D=[];for(let L=0;L<n.length-1;L++){const F=n[L],j=n[L+1],Y=F.dist(j),oe=j.angleTo(F);for(;P+i<A+Y;){P+=i;const J=(P-A)/Y,ie=$t(F.x,j.x,J),ae=$t(F.y,j.y,J);if(ie>=0&&ie<x&&ae>=0&&ae<x&&P-w>=0&&P+w<=S){const se=new ms(ie,ae,0,oe,L);se._round(),s&&!V1(n,se,d,s,c)||D.push(se)}}A+=Y}return _||D.length||f||(D=G1(n,A/2,i,s,c,d,f,!0,x)),D}function $1(n,e,i,s,c){const d=[];for(let f=0;f<n.length;f++){const _=n[f];let x;for(let w=0;w<_.length-1;w++){let S=_[w],A=_[w+1];S.x<e&&A.x<e||(S.x<e?S=new Be(e,S.y+(e-S.x)/(A.x-S.x)*(A.y-S.y))._round():A.x<e&&(A=new Be(e,S.y+(e-S.x)/(A.x-S.x)*(A.y-S.y))._round()),S.y<i&&A.y<i||(S.y<i?S=new Be(S.x+(i-S.y)/(A.y-S.y)*(A.x-S.x),i)._round():A.y<i&&(A=new Be(S.x+(i-S.y)/(A.y-S.y)*(A.x-S.x),i)._round()),S.x>=s&&A.x>=s||(S.x>=s?S=new Be(s,S.y+(s-S.x)/(A.x-S.x)*(A.y-S.y))._round():A.x>=s&&(A=new Be(s,S.y+(s-S.x)/(A.x-S.x)*(A.y-S.y))._round()),S.y>=c&&A.y>=c||(S.y>=c?S=new Be(S.x+(c-S.y)/(A.y-S.y)*(A.x-S.x),c)._round():A.y>=c&&(A=new Be(S.x+(c-S.y)/(A.y-S.y)*(A.x-S.x),c)._round()),x&&S.equals(x[x.length-1])||(x=[S],d.push(x)),x.push(A)))))}}return d}ut(ms,"Anchor");const Jh=1e20;function Z1(n,e,i,s,c,d,f,_,x){for(let w=e;w<e+s;w++)q1(n,i*d+w,d,c,f,_,x);for(let w=i;w<i+c;w++)q1(n,w*d+e,1,s,f,_,x)}function q1(n,e,i,s,c,d,f){d[0]=0,f[0]=-Jh,f[1]=Jh,c[0]=n[e];for(let _=1,x=0,w=0;_<s;_++){c[_]=n[e+_*i];const S=_*_;do{const A=d[x];w=(c[_]-c[A]+S-A*A)/(_-A)/2}while(w<=f[x]&&--x>-1);x++,d[x]=_,f[x]=w,f[x+1]=Jh}for(let _=0,x=0;_<s;_++){for(;f[x+1]<_;)x++;const w=d[x],S=_-w;n[e+_*i]=c[w]+S*S}}const _o=2,z_={none:0,ideographs:1,all:2};class Zc{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[];for(const c in e)for(const d of e[c])s.push({stack:c,id:d});gt(s,({stack:c,id:d},f)=>{let _=this.entries[c];_||(_=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=_.glyphs[d];if(x!==void 0)return void f(null,{stack:c,id:d,glyph:x});if(x=this._tinySDF(_,c,d),x)return _.glyphs[d]=x,void f(null,{stack:c,id:d,glyph:x});const w=Math.floor(d/256);if(256*w>65535)return void f(new Error("glyphs > 65535 not supported"));if(_.ranges[w])return void f(null,{stack:c,id:d,glyph:x});let S=_.requests[w];S||(S=_.requests[w]=[],Zc.loadGlyphRange(c,w,this.url,this.requestManager,(A,P)=>{if(P){_.ascender=P.ascender,_.descender=P.descender;for(const D in P.glyphs)this._doesCharSupportLocalGlyph(+D)||(_.glyphs[+D]=P.glyphs[+D]);_.ranges[w]=!0}for(const D of S)D(A,P);delete _.requests[w]})),S.push((A,P)=>{A?f(A):P&&f(null,{stack:c,id:d,glyph:P.glyphs[d]||null})})},(c,d)=>{if(c)i(c);else if(d){const f={};for(const{stack:_,id:x,glyph:w}of d)f[_]===void 0&&(f[_]={}),f[_].glyphs===void 0&&(f[_].glyphs={}),f[_].glyphs[x]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},f[_].ascender=this.entries[_].ascender,f[_].descender=this.entries[_].descender;i(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==z_.none&&(this.localGlyphMode===z_.all?!!this.localFontFamily:!!this.localFontFamily&&(ot["CJK Unified Ideographs"](e)||ot["Hangul Syllables"](e)||ot.Hiragana(e)||ot.Katakana(e)||ot["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let d=e.tinySDF;if(!d){let F="400";/bold/i.test(i)?F="900":/medium/i.test(i)?F="500":/light/i.test(i)&&(F="200"),d=e.tinySDF=new Zc.TinySDF({fontFamily:c,fontWeight:F,fontSize:24*_o,buffer:3*_o,radius:8*_o}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][s])return this.localGlyphs[d.fontWeight][s];const f=String.fromCharCode(s),{data:_,width:x,height:w,glyphWidth:S,glyphHeight:A,glyphLeft:P,glyphTop:D,glyphAdvance:L}=d.draw(f);return this.localGlyphs[d.fontWeight][s]={id:s,bitmap:new ps({width:x,height:w},_),metrics:{width:S/_o,height:A/_o,left:P/_o,top:D/_o-27,advance:L/_o,localGlyph:!0}}}}Zc.loadGlyphRange=function(n,e,i,s,c){const d=256*e,f=d+255,_=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${d}-${f}`),Ho.Glyphs);Rs(_,(x,w)=>{if(x)c(x);else if(w){const S={},A=function(P){return new Ef(P).readFields(gA,{})}(w);for(const P of A.glyphs)S[P.id]=P;c(null,{glyphs:S,ascender:A.ascender,descender:A.descender})}})},Zc.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const _=this.size=n+4*e,x=this._createCanvas(_),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${f} ${d} ${n}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(n),f=Math.ceil(i),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),x=Math.min(this.size-this.buffer,f+Math.ceil(s)),w=_+2*this.buffer,S=x+2*this.buffer,A=Math.max(w*S,0),P=new Uint8ClampedArray(A),D={data:P,width:w,height:S,glyphWidth:_,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||x===0)return D;const{ctx:L,buffer:F,gridInner:j,gridOuter:Y}=this;L.clearRect(F,F,_,x),L.fillText(n,F,F+f);const oe=L.getImageData(F,F,_,x);Y.fill(Jh,0,A),j.fill(0,0,A);for(let J=0;J<x;J++)for(let ie=0;ie<_;ie++){const ae=oe.data[4*(J*_+ie)+3]/255;if(ae===0)continue;const se=(J+F)*w+ie+F;if(ae===1)Y[se]=0,j[se]=Jh;else{const Ce=.5-ae;Y[se]=Ce>0?Ce*Ce:0,j[se]=Ce<0?Ce*Ce:0}}Z1(Y,0,0,w,S,w,this.f,this.v,this.z),Z1(j,F,F,_,x,w,this.f,this.v,this.z);for(let J=0;J<A;J++){const ie=Math.sqrt(Y[J])-Math.sqrt(j[J]);P[J]=Math.round(255-255*(ie/this.radius+this.cutoff))}return D}};const qc=Hi;function W1(n,e,i,s){const c=[],d=n.image,f=d.pixelRatio,_=d.paddedRect.w-2*qc,x=d.paddedRect.h-2*qc,w=n.right-n.left,S=n.bottom-n.top,A=d.stretchX||[[0,_]],P=d.stretchY||[[0,x]],D=(Ae,Oe)=>Ae+Oe[1]-Oe[0],L=A.reduce(D,0),F=P.reduce(D,0),j=_-L,Y=x-F;let oe=0,J=L,ie=0,ae=F,se=0,Ce=j,Te=0,Le=Y;if(d.content&&s){const Ae=d.content;oe=Cf(A,0,Ae[0]),ie=Cf(P,0,Ae[1]),J=Cf(A,Ae[0],Ae[2]),ae=Cf(P,Ae[1],Ae[3]),se=Ae[0]-oe,Te=Ae[1]-ie,Ce=Ae[2]-Ae[0]-J,Le=Ae[3]-Ae[1]-ae}const Ze=(Ae,Oe,Ve,Ne)=>{const Ke=Mf(Ae.stretch-oe,J,w,n.left),ze=Af(Ae.fixed-se,Ce,Ae.stretch,L),nt=Mf(Oe.stretch-ie,ae,S,n.top),dt=Af(Oe.fixed-Te,Le,Oe.stretch,F),rt=Mf(Ve.stretch-oe,J,w,n.left),Ct=Af(Ve.fixed-se,Ce,Ve.stretch,L),Ye=Mf(Ne.stretch-ie,ae,S,n.top),mt=Af(Ne.fixed-Te,Le,Ne.stretch,F),Mt=new Be(Ke,nt),qt=new Be(rt,nt),At=new Be(rt,Ye),wt=new Be(Ke,Ye),gn=new Be(ze/f,dt/f),zt=new Be(Ct/f,mt/f),Dt=e*Math.PI/180;if(Dt){const fn=Math.sin(Dt),cn=Math.cos(Dt),Cn=[cn,-fn,fn,cn];Mt._matMult(Cn),qt._matMult(Cn),wt._matMult(Cn),At._matMult(Cn)}const ln=Ae.stretch+Ae.fixed,pn=Oe.stretch+Oe.fixed;return{tl:Mt,tr:qt,bl:wt,br:At,tex:{x:d.paddedRect.x+qc+ln,y:d.paddedRect.y+qc+pn,w:Ve.stretch+Ve.fixed-ln,h:Ne.stretch+Ne.fixed-pn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gn,pixelOffsetBR:zt,minFontScaleX:Ce/f/w,minFontScaleY:Le/f/S,isSDF:i}};if(s&&(d.stretchX||d.stretchY)){const Ae=X1(A,j,L),Oe=X1(P,Y,F);for(let Ve=0;Ve<Ae.length-1;Ve++){const Ne=Ae[Ve],Ke=Ae[Ve+1];for(let ze=0;ze<Oe.length-1;ze++)c.push(Ze(Ne,Oe[ze],Ke,Oe[ze+1]))}}else c.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return c}function Cf(n,e,i){let s=0;for(const c of n)s+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return s}function X1(n,e,i){const s=[{fixed:-qc,stretch:0}];for(const[c,d]of n){const f=s[s.length-1];s.push({fixed:c-f.stretch,stretch:f.stretch}),s.push({fixed:c-f.stretch,stretch:f.stretch+(d-c)})}return s.push({fixed:e+qc,stretch:i}),s}function Mf(n,e,i,s){return n/e*i+s}function Af(n,e,i,s){return n-e*i/s}function EA(n,e,i,s){const c=e+n.positionedLines[s].lineOffset;return s===0?i+c/2:i+(c+(e+n.positionedLines[s-1].lineOffset))/2}class SA{constructor(e=[],i=CA){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,c=i[e];for(;e>0;){const d=e-1>>1,f=i[d];if(s(c,f)>=0)break;i[e]=f,e=d}i[e]=c}_down(e){const{data:i,compare:s}=this,c=this.length>>1,d=i[e];for(;e<c;){let f=1+(e<<1),_=i[f];const x=f+1;if(x<this.length&&s(i[x],_)<0&&(f=x,_=i[x]),s(_,d)>=0)break;i[e]=_,e=f}i[e]=d}}function CA(n,e){return n<e?-1:n>e?1:0}function MA(n,e=1,i=!1){let s=1/0,c=1/0,d=-1/0,f=-1/0;const _=n[0];for(let D=0;D<_.length;D++){const L=_[D];(!D||L.x<s)&&(s=L.x),(!D||L.y<c)&&(c=L.y),(!D||L.x>d)&&(d=L.x),(!D||L.y>f)&&(f=L.y)}const x=Math.min(d-s,f-c);let w=x/2;const S=new SA([],AA);if(x===0)return new Be(s,c);for(let D=s;D<d;D+=x)for(let L=c;L<f;L+=x)S.push(new Wc(D+w,L+w,w,n));let A=function(D){let L=0,F=0,j=0;const Y=D[0];for(let oe=0,J=Y.length,ie=J-1;oe<J;ie=oe++){const ae=Y[oe],se=Y[ie],Ce=ae.x*se.y-se.x*ae.y;F+=(ae.x+se.x)*Ce,j+=(ae.y+se.y)*Ce,L+=3*Ce}return new Wc(F/L,j/L,0,D)}(n),P=S.length;for(;S.length;){const D=S.pop();(D.d>A.d||!A.d)&&(A=D,i&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,P)),D.max-A.d<=e||(w=D.h/2,S.push(new Wc(D.p.x-w,D.p.y-w,w,n)),S.push(new Wc(D.p.x+w,D.p.y-w,w,n)),S.push(new Wc(D.p.x-w,D.p.y+w,w,n)),S.push(new Wc(D.p.x+w,D.p.y+w,w,n)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${A.d}`)),A.p}function AA(n,e){return e.max-n.max}class Wc{constructor(e,i,s,c){this.p=new Be(e,i),this.h=s,this.d=function(d,f){let _=!1,x=1/0;for(let w=0;w<f.length;w++){const S=f[w];for(let A=0,P=S.length,D=P-1;A<P;D=A++){const L=S[A],F=S[D];L.y>d.y!=F.y>d.y&&d.x<(F.x-L.x)*(d.y-L.y)/(F.y-L.y)+L.x&&(_=!_),x=Math.min(x,Gx(d,L,F))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const Xc=7,D_=Number.POSITIVE_INFINITY,PA=Math.sqrt(2);function H1(n,[e,i]){let s=0,c=0;if(i===D_){e<0&&(e=0);const d=e/PA;switch(n){case"top-right":case"top-left":c=d-Xc;break;case"bottom-right":case"bottom-left":c=-d+Xc;break;case"bottom":c=-e+Xc;break;case"top":c=e-Xc}switch(n){case"top-right":case"bottom-right":s=-d;break;case"top-left":case"bottom-left":s=d;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":c=i-Xc;break;case"bottom-right":case"bottom-left":case"bottom":c=-i+Xc}switch(n){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,c]}function IA(n,e,i,s,c,d,f,_,x,w){n.createArrays(),n.tilePixelRatio=yt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const S=n.layers[0].layout,A=n.layers[0]._unevaluatedLayout._values,P={};if(n.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=n.textSizeData;P.compositeTextSizes=[A["text-size"].possiblyEvaluate(new M(F),_),A["text-size"].possiblyEvaluate(new M(j),_)]}if(n.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=n.iconSizeData;P.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new M(F),_),A["icon-size"].possiblyEvaluate(new M(j),_)]}P.layoutTextSize=A["text-size"].possiblyEvaluate(new M(x+1),_),P.layoutIconSize=A["icon-size"].possiblyEvaluate(new M(x+1),_),P.textMaxSize=A["text-size"].possiblyEvaluate(new M(18),_);const D=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",L=S.get("text-size");for(const F of n.features){const j=S.get("text-font").evaluate(F,{},_).join(","),Y=L.evaluate(F,{},_),oe=P.layoutTextSize.evaluate(F,{},_),J=(P.layoutIconSize.evaluate(F,{},_),{horizontal:{},vertical:void 0}),ie=F.text;let ae,se=[0,0];if(ie){const Le=ie.toString(),Ze=S.get("text-letter-spacing").evaluate(F,{},_)*fi,Ae=S.get("text-line-height").evaluate(F,{},_)*fi,Oe=jg(Le)?Ze:0,Ve=S.get("text-anchor").evaluate(F,{},_),Ne=S.get("text-variable-anchor");if(!Ne){const rt=S.get("text-radial-offset").evaluate(F,{},_);se=rt?H1(Ve,[rt*fi,D_]):S.get("text-offset").evaluate(F,{},_).map(Ct=>Ct*fi)}let Ke=D?"center":S.get("text-justify").evaluate(F,{},_);const ze=S.get("symbol-placement")==="point",nt=ze?S.get("text-max-width").evaluate(F,{},_)*fi:1/0,dt=rt=>{n.allowVerticalPlacement&&Th(Le)&&(J.vertical=I_(ie,e,i,c,j,nt,Ae,Ve,rt,Oe,se,Sr.vertical,!0,oe,Y))};if(!D&&Ne){const rt=Ke==="auto"?Ne.map(Ye=>L_(Ye)):[Ke];let Ct=!1;for(let Ye=0;Ye<rt.length;Ye++){const mt=rt[Ye];if(!J.horizontal[mt])if(Ct)J.horizontal[mt]=J.horizontal[0];else{const Mt=I_(ie,e,i,c,j,nt,Ae,"center",mt,Oe,se,Sr.horizontal,!1,oe,Y);Mt&&(J.horizontal[mt]=Mt,Ct=Mt.positionedLines.length===1)}}dt("left")}else{if(Ke==="auto"&&(Ke=L_(Ve)),ze||S.get("text-writing-mode").indexOf("horizontal")>=0||!Th(Le)){const rt=I_(ie,e,i,c,j,nt,Ae,Ve,Ke,Oe,se,Sr.horizontal,!1,oe,Y);rt&&(J.horizontal[Ke]=rt)}dt(ze?"left":Ke)}}let Ce=!1;if(F.icon&&F.icon.name){const Le=s[F.icon.name];Le&&(ae=wA(c[F.icon.name],S.get("icon-offset").evaluate(F,{},_),S.get("icon-anchor").evaluate(F,{},_)),Ce=Le.sdf,n.sdfIcons===void 0?n.sdfIcons=Le.sdf:n.sdfIcons!==Le.sdf&&En("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Le.pixelRatio!==n.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const Te=Y1(J.horizontal)||J.vertical;n.iconsInText||(n.iconsInText=!!Te&&Te.iconsInText),(Te||ae)&&kA(n,F,J,ae,s,P,oe,0,se,Ce,f,_,w)}d&&n.generateCollisionDebugBuffers(x,n.collisionBoxArray)}function L_(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kA(n,e,i,s,c,d,f,_,x,w,S,A,P){let D=d.textMaxSize.evaluate(e,{},A);D===void 0&&(D=f);const L=n.layers[0].layout,F=L.get("icon-offset").evaluate(e,{},A),j=Y1(i.horizontal)||i.vertical,Y=P.name==="globe",oe=fi,J=f/oe,ie=n.tilePixelRatio*D/oe,ae=(Ve=n.overscaling,n.zoom>18&&Ve>2&&(Ve>>=1),Math.max(yt/(512*Ve),1)*L.get("symbol-spacing")),se=L.get("text-padding")*n.tilePixelRatio,Ce=L.get("icon-padding")*n.tilePixelRatio,Te=bt(L.get("text-max-angle")),Le=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ze=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ae=L.get("symbol-placement"),Oe=ae/2;var Ve;const Ne=L.get("icon-text-fit");let Ke;s&&Ne!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Ke=O1(s,i.vertical,Ne,L.get("icon-text-fit-padding"),F,J)),j&&(s=O1(s,j,Ne,L.get("icon-text-fit-padding"),F,J)));const ze=(nt,dt,rt)=>{if(dt.x<0||dt.x>=yt||dt.y<0||dt.y>=yt)return;let Ct=null;if(Y){const{x:Ye,y:mt,z:Mt}=P.projectTilePoint(dt.x,dt.y,rt);Ct={anchor:new ms(Ye,mt,Mt,0,void 0),up:P.upVector(rt,dt.x,dt.y)}}(function(Ye,mt,Mt,qt,At,wt,gn,zt,Dt,ln,pn,fn,cn,Cn,In,Gn,un,Jn,$n,Mn,Xt,Zn,mn,Vi,qn){const mi=Ye.addToLineVertexArray(mt,qt);let li,Ui,ci,vo,Yc,ad,ld,Iw=0,kw=0,zw=0,Dw=0,H_=-1,K_=-1;const Uo={};let Lw=Zg("");const Pl=Mt?Mt.anchor:mt;let Y_=0,J_=0;if(Dt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Y_,J_]=Dt.layout.get("text-offset").evaluate(Xt,{},qn).map(ur=>ur*fi):(Y_=Dt.layout.get("text-radial-offset").evaluate(Xt,{},qn)*fi,J_=D_),Ye.allowVerticalPlacement&&At.vertical){const ur=At.vertical;if(In)ad=R_(ur),zt&&(ld=R_(zt));else{const hr=Dt.layout.get("text-rotate").evaluate(Xt,{},qn)+90;ci=Pf(ln,Pl,mt,pn,fn,cn,ur,Cn,hr,Gn),zt&&(vo=Pf(ln,Pl,mt,pn,fn,cn,zt,Jn,hr))}}if(wt){const ur=Dt.layout.get("icon-rotate").evaluate(Xt,{},qn),hr=Dt.layout.get("icon-text-fit")!=="none",cd=W1(wt,ur,mn,hr),ey=zt?W1(zt,ur,mn,hr):void 0;Ui=Pf(ln,Pl,mt,pn,fn,cn,wt,Jn,ur),Iw=4*cd.length;const Rw=Ye.iconSizeData;let Il=null;Rw.kind==="source"?(Il=[go*Dt.layout.get("icon-size").evaluate(Xt,{},qn)],Il[0]>oa&&En(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${Qh}. Reduce your "icon-size".`)):Rw.kind==="composite"&&(Il=[go*Zn.compositeIconSizes[0].evaluate(Xt,{},qn),go*Zn.compositeIconSizes[1].evaluate(Xt,{},qn)],(Il[0]>oa||Il[1]>oa)&&En(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${Qh}. Reduce your "icon-size".`)),Ye.addSymbols(Ye.icon,cd,Il,Mn,$n,Xt,!1,Mt,mt,mi.lineStartIndex,mi.lineLength,-1,Vi,qn),H_=Ye.icon.placedSymbolArray.length-1,ey&&(kw=4*ey.length,Ye.addSymbols(Ye.icon,ey,Il,Mn,$n,Xt,Sr.vertical,Mt,mt,mi.lineStartIndex,mi.lineLength,-1,Vi,qn),K_=Ye.icon.placedSymbolArray.length-1)}for(const ur in At.horizontal){const hr=At.horizontal[ur];li||(Lw=Zg(hr.text),In?Yc=R_(hr):li=Pf(ln,Pl,mt,pn,fn,cn,hr,Cn,Dt.layout.get("text-rotate").evaluate(Xt,{},qn),Gn));const cd=hr.positionedLines.length===1;if(zw+=K1(Ye,Mt,mt,hr,gn,Dt,In,Xt,Gn,mi,At.vertical?Sr.horizontal:Sr.horizontalOnly,cd?Object.keys(At.horizontal):[ur],Uo,H_,Zn,Vi,qn),cd)break}At.vertical&&(Dw+=K1(Ye,Mt,mt,At.vertical,gn,Dt,In,Xt,Gn,mi,Sr.vertical,["vertical"],Uo,K_,Zn,Vi,qn));let ha=-1;const Q_=(ur,hr)=>ur?Math.max(ur,hr):hr;ha=Q_(Yc,ha),ha=Q_(ad,ha),ha=Q_(ld,ha);const oP=ha>-1?1:0;Ye.glyphOffsetArray.length>=aa.MAX_GLYPHS&&En("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xt.sortKey!==void 0&&Ye.addToSortKeyRanges(Ye.symbolInstances.length,Xt.sortKey),Ye.symbolInstances.emplaceBack(Pl.x,Pl.y,Pl.z,mt.x,mt.y,Uo.right>=0?Uo.right:-1,Uo.center>=0?Uo.center:-1,Uo.left>=0?Uo.left:-1,Uo.vertical>=0?Uo.vertical:-1,H_,K_,Lw,li!==void 0?li:Ye.collisionBoxArray.length,li!==void 0?li+1:Ye.collisionBoxArray.length,ci!==void 0?ci:Ye.collisionBoxArray.length,ci!==void 0?ci+1:Ye.collisionBoxArray.length,Ui!==void 0?Ui:Ye.collisionBoxArray.length,Ui!==void 0?Ui+1:Ye.collisionBoxArray.length,vo||Ye.collisionBoxArray.length,vo?vo+1:Ye.collisionBoxArray.length,pn,zw,Dw,Iw,kw,oP,0,Y_,J_,ha)})(n,dt,Ct,nt,i,s,c,Ke,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,se,Le,x,0,Ce,Ze,F,e,d,w,S,A)};if(Ae==="line")for(const nt of $1(e.geometry,0,0,yt,yt)){const dt=TA(nt,ae,Te,i.vertical||j,s,oe,ie,n.overscaling,yt);for(const rt of dt)j&&zA(n,j.text,Oe,rt)||ze(nt,rt,A)}else if(Ae==="line-center"){for(const nt of e.geometry)if(nt.length>1){const dt=bA(nt,Te,i.vertical||j,s,oe,ie);dt&&ze(nt,dt,A)}}else if(e.type==="Polygon")for(const nt of w_(e.geometry,0)){const dt=MA(nt,16);ze(nt[0],new ms(dt.x,dt.y,0,0,void 0),A)}else if(e.type==="LineString")for(const nt of e.geometry)ze(nt,new ms(nt[0].x,nt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const nt of e.geometry)for(const dt of nt)ze([dt],new ms(dt.x,dt.y,0,0,void 0),A)}const Qh=255,oa=Qh*go;function K1(n,e,i,s,c,d,f,_,x,w,S,A,P,D,L,F,j){const Y=function(ie,ae,se,Ce,Te,Le,Ze,Ae){const Oe=[];if(ae.positionedLines.length===0)return Oe;const Ve=Ce.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,Ne=function(rt){const Ct=rt[0],Ye=rt[1],mt=Ct*Ye;return mt>0?[Ct,-Ye]:mt<0?[-Ct,Ye]:Ct===0?[Ye,Ct]:[Ye,-Ct]}(se);let Ke=Math.abs(ae.top-ae.bottom);for(const rt of ae.positionedLines)Ke-=rt.lineOffset;const ze=ae.positionedLines.length,nt=Ke/ze;let dt=ae.top-se[1];for(let rt=0;rt<ze;++rt){const Ct=ae.positionedLines[rt];dt=EA(ae,nt,dt,rt);for(const Ye of Ct.positionedGlyphs){if(!Ye.rect)continue;const mt=Ye.rect||{};let Mt=I1+1,qt=!0,At=1,wt=0;if(Ye.imageName){const mn=Ze[Ye.imageName];if(!mn)continue;if(mn.sdf){En("SDF images are not supported in formatted text and will be ignored.");continue}qt=!1,At=mn.pixelRatio,Mt=Hi/At}const gn=(Te||Ae)&&Ye.vertical,zt=Ye.metrics.advance*Ye.scale/2,Dt=Ye.metrics,ln=Ye.rect;if(ln===null)continue;Ae&&ae.verticalizable&&(wt=Ye.imageName?zt-Ye.metrics.width*Ye.scale/2:0);const pn=Te?[Ye.x+zt,Ye.y]:[0,0];let fn=[0,0],cn=[0,0],Cn=!1;Te||(gn?(cn=[Ye.x+zt+Ne[0],Ye.y+Ne[1]-wt],Cn=!0):fn=[Ye.x+zt+se[0],Ye.y+se[1]-wt]);const In=ln.w*Ye.scale/(At*(Ye.localGlyph?_o:1)),Gn=ln.h*Ye.scale/(At*(Ye.localGlyph?_o:1));let un,Jn,$n,Mn;if(gn){const mn=Ye.y-dt,Vi=new Be(-zt,zt-mn),qn=-Math.PI/2,mi=new Be(...cn);un=new Be(-zt+fn[0],fn[1]),un._rotateAround(qn,Vi)._add(mi),un.x+=-mn+zt,un.y-=(Dt.left-Mt)*Ye.scale;const li=Ye.imageName?Dt.advance*Ye.scale:fi*Ye.scale,Ui=String.fromCharCode(Ye.glyph);oA(Ui)?un.x+=(1-Mt)*Ye.scale:sA(Ui)?un.x+=li-Dt.height*Ye.scale+(-Mt-1)*Ye.scale:un.x+=Ye.imageName||Dt.width+2*Mt===ln.w&&Dt.height+2*Mt===ln.h?(li-Gn)/2:(li-(Dt.height+2*Mt)*Ye.scale)/2,Jn=new Be(un.x,un.y-In),$n=new Be(un.x+Gn,un.y),Mn=new Be(un.x+Gn,un.y-In)}else{const mn=(Dt.left-Mt)*Ye.scale-zt+fn[0],Vi=(-Dt.top-Mt)*Ye.scale+fn[1],qn=mn+In,mi=Vi+Gn;un=new Be(mn,Vi),Jn=new Be(qn,Vi),$n=new Be(mn,mi),Mn=new Be(qn,mi)}if(Ve){let mn;mn=Te?new Be(0,0):Cn?new Be(Ne[0],Ne[1]):new Be(se[0],se[1]),un._rotateAround(Ve,mn),Jn._rotateAround(Ve,mn),$n._rotateAround(Ve,mn),Mn._rotateAround(Ve,mn)}const Xt=new Be(0,0),Zn=new Be(0,0);Oe.push({tl:un,tr:Jn,bl:$n,br:Mn,tex:mt,writingMode:ae.writingMode,glyphOffset:pn,sectionIndex:Ye.sectionIndex,isSDF:qt,pixelOffsetTL:Xt,pixelOffsetBR:Zn,minFontScaleX:0,minFontScaleY:0})}}return Oe}(0,s,x,d,f,_,c,n.allowVerticalPlacement),oe=n.textSizeData;let J=null;oe.kind==="source"?(J=[go*d.layout.get("text-size").evaluate(_,{},j)],J[0]>oa&&En(`${n.layerIds[0]}: Value for "text-size" is >= ${Qh}. Reduce your "text-size".`)):oe.kind==="composite"&&(J=[go*L.compositeTextSizes[0].evaluate(_,{},j),go*L.compositeTextSizes[1].evaluate(_,{},j)],(J[0]>oa||J[1]>oa)&&En(`${n.layerIds[0]}: Value for "text-size" is >= ${Qh}. Reduce your "text-size".`)),n.addSymbols(n.text,Y,J,x,f,_,S,e,i,w.lineStartIndex,w.lineLength,D,F,j);for(const ie of A)P[ie]=n.text.placedSymbolArray.length-1;return 4*Y.length}function Y1(n){for(const e in n)return n[e];return null}function Pf(n,e,i,s,c,d,f,_,x,w){let S=f.top,A=f.bottom,P=f.left,D=f.right;const L=f.collisionPadding;if(L&&(P-=L[0],S-=L[1],D+=L[2],A+=L[3]),x){const F=new Be(P,S),j=new Be(D,S),Y=new Be(P,A),oe=new Be(D,A),J=bt(x);let ie=new Be(0,0);w&&(ie=new Be(w[0],w[1])),F._rotateAround(J,ie),j._rotateAround(J,ie),Y._rotateAround(J,ie),oe._rotateAround(J,ie),P=Math.min(F.x,j.x,Y.x,oe.x),D=Math.max(F.x,j.x,Y.x,oe.x),S=Math.min(F.y,j.y,Y.y,oe.y),A=Math.max(F.y,j.y,Y.y,oe.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,P,S,D,A,_,s,c,d),n.length-1}function R_(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function zA(n,e,i,s){const c=n.compareText;if(e in c){const d=c[e];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<i)return!0}else c[e]=[];return c[e].push(s),!1}function J1(n,e){const i=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),d=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),f=Math.sin(n._pitch)*d+c;return Math.min(1.01*f,c*(1/n._horizonShift))}function Ml(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),s=n.x*i,c=(n.x+1)*i,d=n.y*i,f=(n.y+1)*i,_=Er(s),x=Er(c),w=bi(d),S=bi(f),A=e.project(_,w),P=e.project(x,w),D=e.project(x,S),L=e.project(_,S);let F=Math.min(A.x,P.x,D.x,L.x),j=Math.min(A.y,P.y,D.y,L.y),Y=Math.max(A.x,P.x,D.x,L.x),oe=Math.max(A.y,P.y,D.y,L.y);const J=i/16;function ie(se,Ce,Te,Le,Ze,Ae){const Oe=(Te+Ze)/2,Ve=(Le+Ae)/2,Ne=e.project(Er(Oe),bi(Ve)),Ke=Math.max(0,F-Ne.x,j-Ne.y,Ne.x-Y,Ne.y-oe);F=Math.min(F,Ne.x),Y=Math.max(Y,Ne.x),j=Math.min(j,Ne.y),oe=Math.max(oe,Ne.y),Ke>J&&(ie(se,Ne,Te,Le,Oe,Ve),ie(Ne,Ce,Oe,Ve,Ze,Ae))}ie(A,P,s,d,c,d),ie(P,D,c,d,c,f),ie(D,L,c,f,s,f),ie(L,A,s,f,s,d),F-=J,j-=J,Y+=J,oe+=J;const ae=1/Math.max(Y-F,oe-j);return{scale:ae,x:F*ae,y:j*ae,x2:Y*ae,y2:oe*ae,projection:e}}const DA=po(new Float32Array(16));class sa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new an(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s=!0){return e._coordinatePoint(e.locationCoordinate(i),s)}pixelsPerMeter(e,i){return mo(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return J1(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,c){const d=e.horizonLineFromTop(!1),f=new Be(i,Math.max(d,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,c))}pointCoordinate3D(e,i,s){const c=new Be(i,s);if(e.elevation)return e.elevation.pointCoordinate(c);{const d=this.pointCoordinate(e,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return DA}createTileMatrix(e,i,s){let c,d,f;const _=s.canonical,x=po(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Ml(_,this);c=1,d=w.x+s.wrap*w.scale,f=w.y,xl(x,x,[c/w.scale,c/w.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*s.wrap)*c,f=_.y*c;return Ih(x,x,[d,f,0]),xl(x,x,[c/yt,c/yt,1]),x}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class LA extends sa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(bt(i));this.n=(c+Math.sin(bt(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c,r0:d}=this,f=bt(e-this.center[0]),_=bt(i),x=Math.sqrt(c-2*s*Math.sin(_))/s;return{x:x*Math.sin(f*s),y:x*Math.cos(f*s)-d,z:0}}unproject(e,i){const{n:s,c,r0:d}=this,f=d+i;let _=Math.atan2(e,Math.abs(f))*Math.sign(f);f*s<0&&(_-=Math.PI*Math.sign(e)*Math.sign(f));const x=bt(this.center[0])*s;_=vt(_,-Math.PI-x,Math.PI-x);const w=We(Jt(_/s)+this.center[0],-180,180),S=Math.asin(We((c-(e*e+f*f)*s*s)/(2*s),-1,1)),A=We(Jt(S),-Ti,Ti);return new an(w,A)}}const ed=1.340264,td=-.081106,nd=893e-6,id=.003796,If=Math.sqrt(3)/2;class RA extends sa{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(If*Math.sin(i)),c=s*s,d=c*c*c;return{x:.5*(e*Math.cos(s)/(If*(ed+3*td*c+d*(7*nd+9*id*c)))/Math.PI+.5),y:1-.5*(s*(ed+td*c+d*(nd+id*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=s*s,d=c*c*c;for(let S,A,P,D=0;D<12&&(A=s*(ed+td*c+d*(nd+id*c))-i,P=ed+3*td*c+d*(7*nd+9*id*c),S=A/P,s=We(s-S,-Math.PI/3,Math.PI/3),c=s*s,d=c*c*c,!(Math.abs(S)<1e-12));++D);const f=If*e*(ed+3*td*c+d*(7*nd+9*id*c))/Math.cos(s),_=Math.asin(Math.sin(s)/If),x=We(180*f/Math.PI,-180,180),w=We(180*_/Math.PI,-Ti,Ti);return new an(x,w)}}class BA extends sa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),c=We(360*(.5-i),-Ti,Ti);return new an(s,c)}}const Hc=Math.PI/2;function kf(n){return Math.tan((Hc+n)/2)}class FA extends sa{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let c=bt(i),d=bt(s);this.southernCenter=c+d<0,this.southernCenter&&(c=-c,d=-d);const f=Math.cos(c),_=kf(c);this.n=c===d?Math.sin(c):Math.log(f/Math.cos(d))/Math.log(kf(d)/_),this.f=f*Math.pow(kf(c),this.n)/this.n}project(e,i){i=bt(i),this.southernCenter&&(i=-i),e=bt(e-this.center[0]);const s=1e-6,{n:c,f:d}=this;d>0?i<-Hc+s&&(i=-Hc+s):i>Hc-s&&(i=Hc-s);const f=d/Math.pow(kf(i),c);let _=f*Math.sin(c*e),x=d-f*Math.cos(c*e);return _=.5*(_/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:_,y:this.southernCenter?x:1-x,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:c}=this,d=c-i,f=Math.sign(d),_=Math.sign(s)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*f;d*s<0&&(x-=Math.PI*Math.sign(e)*f);const w=We(Jt(x/s)+this.center[0],-180,180),S=We(Jt(2*Math.atan(Math.pow(c/_,1/s))-Hc),-Ti,Ti);return new an(w,this.southernCenter?-S:S)}}class Q1 extends sa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Ro(e),y:Bo(i),z:0}}unproject(e,i){const s=Er(e),c=bi(i);return new an(s,c)}}const ew=bt(Ti);class OA extends sa{project(e,i){const s=(i=bt(i))*i,c=s*s;return{x:.5*((e=bt(e))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=25,d=0,f=s*s;do{f=s*s;const w=f*f;d=(s*(1.007226+f*(.015085+w*(.028874*f-.044475-.005916*w)))-i)/(1.007226+f*(.045255+w*(.259866*f-.311325-.005916*11*w))),s=We(s-d,-ew,ew)}while(Math.abs(d)>1e-6&&--c>0);f=s*s;const _=We(Jt(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=Jt(s);return new an(_,x)}}const tw=bt(Ti);class VA extends sa{project(e,i){i=bt(i),e=bt(e);const s=Math.cos(i),c=2/Math.PI,d=Math.acos(s*Math.cos(e/2)),f=Math.sin(d)/d,_=.5*(e*c+2*s*Math.sin(e/2)/f)||0,x=.5*(i+Math.sin(i)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,d=25;const f=1e-6;let _=0,x=0;do{const w=Math.cos(c),S=Math.sin(c),A=2*S*w,P=S*S,D=w*w,L=Math.cos(s/2),F=Math.sin(s/2),j=2*L*F,Y=F*F,oe=1-D*L*L,J=oe?1/oe:0,ie=oe?Math.acos(w*L)*Math.sqrt(1/oe):0,ae=.5*(2*ie*w*F+2*s/Math.PI)-e,se=.5*(ie*S+c)-i,Ce=.5*J*(D*Y+ie*w*L*P)+1/Math.PI,Te=J*(j*A/4-ie*S*F),Le=.125*J*(A*F-ie*S*D*j),Ze=.5*J*(P*L+ie*Y*w)+.5,Ae=Te*Le-Ze*Ce;_=(se*Te-ae*Ze)/Ae,x=(ae*Le-se*Ce)/Ae,s=We(s-_,-Math.PI,Math.PI),c=We(c-x,-tw,tw)}while((Math.abs(_)>f||Math.abs(x)>f)&&--d>0);return new an(Jt(s),Jt(c))}}class nw extends sa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(bt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:c}=this;return{x:bt(e)*c*s+.5,y:-Math.sin(bt(i))/c*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:c}=this,d=-(i-.5)/s,f=We(Jt((e-.5)/s)/c,-180,180),_=Math.asin(We(d*c,-1,1)),x=We(Jt(_),-Ti,Ti);return new an(f,x)}}class UA extends Q1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const c=Oh(e,i,s);return Bn(c,c,Vh(Lo(s))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i){const s=Lc(i.lat,i.lng),c=Bi([],s),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Lh(s,s,c,mo(1,0)*yt*d);const f=po(new Float64Array(16));return vl(f,e.pixelMatrix,e.globeMatrix),Bn(s,s,f),new Be(s[0],s[1])}pixelsPerMeter(e,i){return mo(1,0)*i}pixelSpaceConversion(e,i,s){const c=mo(1,e)*i,d=$t(mo(1,45)*i,c,s);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,s){const c=o_(Lo(s.canonical));return vl(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:s}=e,c=Vh(Lo(i));return of(c,c,bt(s.lng)),Hg(c,c,bt(s.lat)),xl(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,s,c){return Px(e,i,s,!0)||new Bc(0,0)}pointCoordinate3D(e,i,s){const c=this.pointCoordinate(e,i,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!Px(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,d){const f=c.cameraToCenterDistance,_=c._centerAltitude*d,x=c._camera,w=c._camera.forward(),S=hs([],Tr([],w,-f),[0,0,_]),A=c.worldSize/(2*Math.PI),P=[0,0,-A],D=c.width/c.height,L=Math.tan(c.fovAboveCenter),F=Tr([],x.up(),L),j=Tr([],x.right(),L*D),Y=Bi([],hs([],hs([],w,F),j)),oe=[];let J;if(new Qg(S,Y).closestPointOnSphere(P,A,oe)){const ie=hs([],oe,P),ae=fo([],ie,S);J=Math.cos(c.fovAboveCenter)*kh(ae)}else{const ie=fo([],S,P),ae=fo([],P,S);Bi(ae,ae);const se=kh(ie)-A;J=Math.sqrt(se*(se+2*A));const Ce=Math.acos(J/(A+se))-Math.acos(Ur(w,ae));J*=Math.cos(Ce)}return 1.01*J}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Rc(e.zoom);if(s>0){const c=J1(e,mo(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return $t(i,c+d*(1-Math.cos(f)),Math.pow(s,10))}return i}upVector(e,i,s){return Oh(i,s,e,1)}upVectorScale(e){return{metersToTile:sf(lf(Lo(e)))}}}function iw(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Q1(n);case"equirectangular":return new BA(n);case"naturalEarth":return new OA(n);case"equalEarth":return new RA(n);case"winkelTripel":return new VA(n);case"albers":return i?new nw(n):new LA(n);case"lambertConformalConic":return i?new nw(n):new FA(n);case"globe":return new UA(n)}throw new Error(`Invalid projection name: ${n.name}`)}const NA=yf.types,jA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zf(n,e,i,s,c,d,f,_,x,w,S,A,P){const D=_?Math.min(oa,Math.round(_[0])):0,L=_?Math.min(oa,Math.round(_[1])):0;n.emplaceBack(e,i,Math.round(32*s),Math.round(32*c),d,f,(D<<1)+(x?1:0),L,16*w,16*S,256*A,256*P)}function Df(n,e,i,s,c,d,f){n.emplaceBack(e,i,s,c,d,f)}function Lf(n,e,i,s,c){n.emplaceBack(e,i,s,c),n.emplaceBack(e,i,s,c),n.emplaceBack(e,i,s,c),n.emplaceBack(e,i,s,c)}function GA(n){for(const e of n.sections)if($g(e.text))return!0;return!1}class B_{constructor(e){this.layoutVertexArray=new Ue,this.indexArray=new pt,this.programConfigurations=e,this.segments=new Nn,this.dynamicLayoutVertexArray=new Ge,this.opacityVertexArray=new ft,this.placedSymbolArray=new Un,this.globeExtVertexArray=new Xe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,QM.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,jA,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,JM.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ut(B_,"SymbolBuffers");class F_{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Nn,this.collisionVertexArray=new Nt,this.collisionVertexArrayExt=new Ot}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,eA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,tA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ut(F_,"CollisionBuffers");class aa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=po([]),this.placementViewportMatrix=po([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=S_(this.zoom,i["text-size"]),this.iconSizeData=S_(this.zoom,i["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(f=>Sr[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new B_(new yl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new B_(new yl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ri,this.lineVertexArray=new Pc,this.symbolInstances=new _n}calculateGlyphDependencies(e,i,s,c,d){for(let f=0;f<e.length;f++)if(i[e.charCodeAt(f)]=!0,c&&d){const _=Kh[e.charAt(f)];_&&(i[_.charCodeAt(0)]=!0)}}populate(e,i,s,c){const d=this.layers[0],f=d.layout,_=this.projection.name==="globe",x=f.get("text-font"),w=f.get("text-field"),S=f.get("icon-image"),A=(w.value.kind!=="constant"||w.value.value instanceof Li&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),P=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,D=f.get("symbol-sort-key");if(this.features=[],!A&&!P)return;const L=i.iconDependencies,F=i.glyphDependencies,j=i.availableImages,Y=new M(this.zoom);for(const{feature:oe,id:J,index:ie,sourceLayerIndex:ae}of e){const se=d._featureFilter.needGeometry,Ce=El(oe,se);if(!d._featureFilter.filter(Y,Ce,s))continue;if(se||(Ce.geometry=ds(oe,s,c)),_&&oe.type!==1&&s.z<=5){const Ae=Ce.geometry,Oe=.98078528056,Ve=(Ne,Ke)=>Ur(Oh(Ne.x,Ne.y,s,1),Oh(Ke.x,Ke.y,s,1))<Oe;for(let Ne=0;Ne<Ae.length;Ne++)Ae[Ne]=QC(Ae[Ne],Ve)}let Te,Le;if(A){const Ae=d.getValueAndResolveTokens("text-field",Ce,s,j),Oe=Li.factory(Ae);GA(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||y()==="unavailable"||this.hasRTLText&&E.isParsed())&&(Te=rA(Oe,d,Ce))}if(P){const Ae=d.getValueAndResolveTokens("icon-image",Ce,s,j);Le=Ae instanceof rr?Ae:rr.fromString(Ae)}if(!Te&&!Le)continue;const Ze=this.sortFeaturesByKey?D.evaluate(Ce,{},s):void 0;if(this.features.push({id:J,text:Te,icon:Le,index:ie,sourceLayerIndex:ae,geometry:Ce.geometry,properties:oe.properties,type:NA[oe.type],sortKey:Ze}),Le&&(L[Le.name]=!0),Te){const Ae=x.evaluate(Ce,{},s).join(","),Oe=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Sr.vertical)>=0;for(const Ve of Te.sections)if(Ve.image)L[Ve.image.name]=!0;else{const Ne=Th(Te.toString()),Ke=Ve.fontStack||Ae,ze=F[Ke]=F[Ke]||{};this.calculateGlyphDependencies(Ve.text,ze,Oe,this.allowVerticalPlacement,Ne)}}}f.get("symbol-placement")==="line"&&(this.features=function(oe){const J={},ie={},ae=[];let se=0;function Ce(Ae){ae.push(oe[Ae]),se++}function Te(Ae,Oe,Ve){const Ne=ie[Ae];return delete ie[Ae],ie[Oe]=Ne,ae[Ne].geometry[0].pop(),ae[Ne].geometry[0]=ae[Ne].geometry[0].concat(Ve[0]),Ne}function Le(Ae,Oe,Ve){const Ne=J[Oe];return delete J[Oe],J[Ae]=Ne,ae[Ne].geometry[0].shift(),ae[Ne].geometry[0]=Ve[0].concat(ae[Ne].geometry[0]),Ne}function Ze(Ae,Oe,Ve){const Ne=Ve?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Ae}:${Ne.x}:${Ne.y}`}for(let Ae=0;Ae<oe.length;Ae++){const Oe=oe[Ae],Ve=Oe.geometry,Ne=Oe.text?Oe.text.toString():null;if(!Ne){Ce(Ae);continue}const Ke=Ze(Ne,Ve),ze=Ze(Ne,Ve,!0);if(Ke in ie&&ze in J&&ie[Ke]!==J[ze]){const nt=Le(Ke,ze,Ve),dt=Te(Ke,ze,ae[nt].geometry);delete J[Ke],delete ie[ze],ie[Ze(Ne,ae[dt].geometry,!0)]=dt,ae[nt].geometry=null}else Ke in ie?Te(Ke,ze,Ve):ze in J?Le(Ke,ze,Ve):(Ce(Ae),J[Ke]=se-1,ie[ze]=se-1)}return ae.filter(Ae=>Ae.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,J)=>oe.sortKey-J.sortKey)}update(e,i,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,s,c),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,s,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=iw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:d}of i)this.lineVertexArray.emplaceBack(c,d);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,c,d,f,_,x,w,S,A,P,D,L){const F=e.indexArray,j=e.layoutVertexArray,Y=e.globeExtVertexArray,oe=e.segments.prepareSegment(4*i.length,j,F,this.canOverlap?f.sortKey:void 0),J=this.glyphOffsetArray.length,ie=oe.vertexLength,ae=this.allowVerticalPlacement&&_===Sr.vertical?Math.PI/2:0,se=f.text&&f.text.sections;for(let Te=0;Te<i.length;Te++){const{tl:Le,tr:Ze,bl:Ae,br:Oe,tex:Ve,pixelOffsetTL:Ne,pixelOffsetBR:Ke,minFontScaleX:ze,minFontScaleY:nt,glyphOffset:dt,isSDF:rt,sectionIndex:Ct}=i[Te],Ye=oe.vertexLength,mt=dt[1];if(zf(j,w.x,w.y,Le.x,mt+Le.y,Ve.x,Ve.y,s,rt,Ne.x,Ne.y,ze,nt),zf(j,w.x,w.y,Ze.x,mt+Ze.y,Ve.x+Ve.w,Ve.y,s,rt,Ke.x,Ne.y,ze,nt),zf(j,w.x,w.y,Ae.x,mt+Ae.y,Ve.x,Ve.y+Ve.h,s,rt,Ne.x,Ke.y,ze,nt),zf(j,w.x,w.y,Oe.x,mt+Oe.y,Ve.x+Ve.w,Ve.y+Ve.h,s,rt,Ke.x,Ke.y,ze,nt),x){const{x:Mt,y:qt,z:At}=x.anchor,[wt,gn,zt]=x.up;Df(Y,Mt,qt,At,wt,gn,zt),Df(Y,Mt,qt,At,wt,gn,zt),Df(Y,Mt,qt,At,wt,gn,zt),Df(Y,Mt,qt,At,wt,gn,zt),Lf(e.dynamicLayoutVertexArray,Mt,qt,At,ae)}else Lf(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ae);F.emplaceBack(Ye,Ye+1,Ye+2),F.emplaceBack(Ye+1,Ye+2,Ye+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),Te!==i.length-1&&Ct===i[Te+1].sectionIndex||e.programConfigurations.populatePaintArrays(j.length,f,f.index,{},D,L,se&&se[Ct])}const Ce=x?x.anchor:w;e.placedSymbolArray.emplaceBack(Ce.x,Ce.y,Ce.z,w.x,w.y,J,this.glyphOffsetArray.length-J,ie,S,A,w.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],_,0,!1,0,P,0)}_commitLayoutVertex(e,i,s,c,d,f,_){e.emplaceBack(i,s,c,d,f,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,i,s,c,d,f,_){const x=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=x.vertexLength,S=_.tileAnchorX,A=_.tileAnchorY;for(let D=0;D<4;D++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,S,A,new Be(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,S,A,new Be(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,S,A,new Be(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,S,A,new Be(e.x1,e.y2)),x.vertexLength+=4;const P=s.indexArray;P.emplaceBack(w,w+1),P.emplaceBack(w+1,w+2),P.emplaceBack(w+2,w+3),P.emplaceBack(w+3,w),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,c,d,f){for(let _=c;_<d;_++){const x=s.get(_),w=this.getSymbolInstanceTextSize(e,f,i,_);this._addCollisionDebugVertices(x,w,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,s,c,d,f){for(let _=c;_<d;_++){const x=s.get(_),w=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(x,w,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new F_(ht,b1.members,ai),this.iconCollisionBox=new F_(ht,b1.members,ai);const s=Nc(this.iconSizeData,e),c=Nc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,i,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(c,e,i,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,i,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,i,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,i,s,c){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),f=bf(this.textSizeData,e,d)/fi;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,s){const c=this.icon.placedSymbolArray.get(s),d=bf(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,s){e.emplaceBack(i,-s,-s),e.emplaceBack(i,s,-s),e.emplaceBack(i,s,s),e.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(e,i,s,c,d,f){for(let _=c;_<d;_++){const x=s.get(_),w=this.getSymbolInstanceTextSize(e,f,i,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,x.padding)}}_updateIconDebugCollisionBoxes(e,i,s,c,d,f){for(let _=c;_<d;_++){const x=s.get(_),w=this.getSymbolInstanceIconSize(e,i,f);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Nc(this.iconSizeData,e),c=Nc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,i,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(c,e,i,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(s,e,i,f.iconBoxStartIndex,f.iconBoxEndIndex,f.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,i,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,c,d,f,_,x,w){const S={};if(i<s){const{x1:A,y1:P,x2:D,y2:L,padding:F,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:oe,tileAnchorX:J,tileAnchorY:ie,featureIndex:ae}=e.get(i);S.textBox={x1:A,y1:P,x2:D,y2:L,padding:F,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:oe,tileAnchorX:J,tileAnchorY:ie},S.textFeatureIndex=ae}if(c<d){const{x1:A,y1:P,x2:D,y2:L,padding:F,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:oe,tileAnchorX:J,tileAnchorY:ie,featureIndex:ae}=e.get(c);S.verticalTextBox={x1:A,y1:P,x2:D,y2:L,padding:F,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:oe,tileAnchorX:J,tileAnchorY:ie},S.verticalTextFeatureIndex=ae}if(f<_){const{x1:A,y1:P,x2:D,y2:L,padding:F,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:oe,tileAnchorX:J,tileAnchorY:ie,featureIndex:ae}=e.get(f);S.iconBox={x1:A,y1:P,x2:D,y2:L,padding:F,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:oe,tileAnchorX:J,tileAnchorY:ie},S.iconFeatureIndex=ae}if(x<w){const{x1:A,y1:P,x2:D,y2:L,padding:F,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:oe,tileAnchorX:J,tileAnchorY:ie,featureIndex:ae}=e.get(x);S.verticalIconBox={x1:A,y1:P,x2:D,y2:L,padding:F,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:oe,tileAnchorX:J,tileAnchorY:ie},S.verticalIconFeatureIndex=ae}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),c=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),c=[],d=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);const x=this.symbolInstances.get(_);c.push(0|Math.round(i*x.tileAnchorX+s*x.tileAnchorY)),d.push(x.featureIndex)}return f.sort((_,x)=>c[_]-c[x]||d[x]-d[_]),f}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:w}=s;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&f!==d&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ut(aa,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),aa.MAX_GLYPHS=65535,aa.addDynamicAttributes=Lf;const $A=new ee({"symbol-placement":new B(De.layout_symbol["symbol-placement"]),"symbol-spacing":new B(De.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new B(De.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $(De.layout_symbol["symbol-sort-key"]),"symbol-z-order":new B(De.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new B(De.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new B(De.layout_symbol["icon-ignore-placement"]),"icon-optional":new B(De.layout_symbol["icon-optional"]),"icon-rotation-alignment":new B(De.layout_symbol["icon-rotation-alignment"]),"icon-size":new $(De.layout_symbol["icon-size"]),"icon-text-fit":new B(De.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new B(De.layout_symbol["icon-text-fit-padding"]),"icon-image":new $(De.layout_symbol["icon-image"]),"icon-rotate":new $(De.layout_symbol["icon-rotate"]),"icon-padding":new B(De.layout_symbol["icon-padding"]),"icon-keep-upright":new B(De.layout_symbol["icon-keep-upright"]),"icon-offset":new $(De.layout_symbol["icon-offset"]),"icon-anchor":new $(De.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new B(De.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new B(De.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new B(De.layout_symbol["text-rotation-alignment"]),"text-field":new $(De.layout_symbol["text-field"]),"text-font":new $(De.layout_symbol["text-font"]),"text-size":new $(De.layout_symbol["text-size"]),"text-max-width":new $(De.layout_symbol["text-max-width"]),"text-line-height":new $(De.layout_symbol["text-line-height"]),"text-letter-spacing":new $(De.layout_symbol["text-letter-spacing"]),"text-justify":new $(De.layout_symbol["text-justify"]),"text-radial-offset":new $(De.layout_symbol["text-radial-offset"]),"text-variable-anchor":new B(De.layout_symbol["text-variable-anchor"]),"text-anchor":new $(De.layout_symbol["text-anchor"]),"text-max-angle":new B(De.layout_symbol["text-max-angle"]),"text-writing-mode":new B(De.layout_symbol["text-writing-mode"]),"text-rotate":new $(De.layout_symbol["text-rotate"]),"text-padding":new B(De.layout_symbol["text-padding"]),"text-keep-upright":new B(De.layout_symbol["text-keep-upright"]),"text-transform":new $(De.layout_symbol["text-transform"]),"text-offset":new $(De.layout_symbol["text-offset"]),"text-allow-overlap":new B(De.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new B(De.layout_symbol["text-ignore-placement"]),"text-optional":new B(De.layout_symbol["text-optional"])});var O_={paint:new ee({"icon-opacity":new $(De.paint_symbol["icon-opacity"]),"icon-color":new $(De.paint_symbol["icon-color"]),"icon-halo-color":new $(De.paint_symbol["icon-halo-color"]),"icon-halo-width":new $(De.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $(De.paint_symbol["icon-halo-blur"]),"icon-translate":new B(De.paint_symbol["icon-translate"]),"icon-translate-anchor":new B(De.paint_symbol["icon-translate-anchor"]),"text-opacity":new $(De.paint_symbol["text-opacity"]),"text-color":new $(De.paint_symbol["text-color"],{runtimeType:Wi,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new $(De.paint_symbol["text-halo-color"]),"text-halo-width":new $(De.paint_symbol["text-halo-width"]),"text-halo-blur":new $(De.paint_symbol["text-halo-blur"]),"text-translate":new B(De.paint_symbol["text-translate"]),"text-translate-anchor":new B(De.paint_symbol["text-translate-anchor"])}),layout:$A};class rw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Fs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ut(rw,"FormatSectionOverride",{omit:["defaultValue"]});class Rf extends ho{constructor(e){super(e,O_)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const d of s)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,s,c){const d=this.layout.get(e).evaluate(i,{},s,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Hs(f.value)||!d?d:function(_,x){return x.replace(/{([^{}]+)}/g,(w,S)=>S in _?String(_[S]):"")}(i.properties,d)}createBucket(e){return new aa(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of O_.paint.overridableProperties){if(!Rf.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new rw(i),c=new wc(s,i.property.specification);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new dh("source",c):new cl("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new W(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&Rf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),c=O_.paint.properties[i];let d=!1;const f=_=>{for(const x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Li)f(s.value.value.sections);else if(s.value.kind==="source"){const _=w=>{d||(w instanceof es&&Pn(w.value)===qa?f(w.value.sections):w instanceof Io?f(w.sections):w.eachChild(_))},x=s.value;x._styleExpression&&_(x._styleExpression.expression)}return d}getProgramConfiguration(e){return new na(this,e)}}var ZA={paint:new ee({"background-color":new B(De.paint_background["background-color"]),"background-pattern":new B(De.paint_background["background-pattern"]),"background-opacity":new B(De.paint_background["background-opacity"])})},qA={paint:new ee({"raster-opacity":new B(De.paint_raster["raster-opacity"]),"raster-hue-rotate":new B(De.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new B(De.paint_raster["raster-brightness-min"]),"raster-brightness-max":new B(De.paint_raster["raster-brightness-max"]),"raster-saturation":new B(De.paint_raster["raster-saturation"]),"raster-contrast":new B(De.paint_raster["raster-contrast"]),"raster-resampling":new B(De.paint_raster["raster-resampling"]),"raster-fade-duration":new B(De.paint_raster["raster-fade-duration"])})};class WA extends ho{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var XA={paint:new ee({"sky-type":new B(De.paint_sky["sky-type"]),"sky-atmosphere-sun":new B(De.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new B(De.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new B(De.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new B(De.paint_sky["sky-gradient-radius"]),"sky-gradient":new Q(De.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new B(De.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new B(De.paint_sky["sky-atmosphere-color"]),"sky-opacity":new B(De.paint_sky["sky-opacity"])})};function V_(n,e,i){const s=[0,0,1],c=Tx([]);return Sx(c,c,i?-bt(n)+Math.PI:bt(n)),Ex(c,c,-bt(e)),vx(s,s,c),Bi(s,s)}const HA={circle:class extends ho{constructor(n){super(n,sM)}createBucket(n){return new h_(n)}queryRadius(n){const e=n;return Fc("circle-radius",this,e)+Fc("circle-stroke-width",this,e)+hf(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,s,c,d,f,_){const x=Wx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Xx(n,s,d,f,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,w)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new na(this,n)}},heatmap:class extends ho{createBucket(n){return new Kx(n)}constructor(n){super(n,uM),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=m_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Fc("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,s,c,d,f,_){const x=this.paint.get("heatmap-radius").evaluate(e,i);return Xx(n,s,d,f,_,!0,!0,new Be(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new na(this,n)}},hillshade:class extends ho{constructor(n){super(n,hM)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ho{constructor(n){super(n,MM)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new na(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new gf(n)}queryRadius(){return hf(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,s,c,d){return!n.queryGeometry.isAboveHorizon&&jx(qx(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends ho{constructor(n){super(n,GM)}createBucket(n){return new Wh(n)}queryRadius(){return hf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new na(this,n)}queryIntersectsFeature(n,e,i,s,c,d,f,_,x){const w=Wx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,i),A=this.paint.get("fill-extrusion-base").evaluate(e,i),P=[0,0],D=_&&d.elevation,L=d.elevation?d.elevation.exaggeration():1,F=n.tile.getBucket(this);if(D&&F instanceof Wh){const ie=F.centroidVertexArray,ae=x+1;ae<ie.length&&(P[0]=ie.geta_centroid_pos0(ae),P[1]=ie.geta_centroid_pos1(ae))}if(P[0]===0&&P[1]===1)return!1;d.projection.name==="globe"&&(s=f1([s],[new Be(0,0),new Be(yt,yt)],n.tileID.canonical).map(ie=>ie.polygon).flat());const j=D?_:null,[Y,oe]=function(ie,ae,se,Ce,Te,Le,Ze,Ae,Oe,Ve,Ne){return ie.projection.name==="globe"?function(Ke,ze,nt,dt,rt,Ct,Ye,mt,Mt,qt,At){const wt=[],gn=[],zt=Ke.projection.upVectorScale(At,Ke.center.lat,Ke.worldSize).metersToTile,Dt=[0,0,0,1],ln=[0,0,0,1],pn=(cn,Cn,In,Gn)=>{cn[0]=Cn,cn[1]=In,cn[2]=Gn,cn[3]=1},fn=p1();nt>0&&(nt+=fn),dt+=fn;for(const cn of ze){const Cn=[],In=[];for(const Gn of cn){const un=Gn.x+rt.x,Jn=Gn.y+rt.y,$n=Ke.projection.projectTilePoint(un,Jn,At),Mn=Ke.projection.upVector(At,Gn.x,Gn.y);let Xt=nt,Zn=dt;if(Ye){const mn=y1(un,Jn,nt,dt,Ye,mt,Mt,qt);Xt+=mn.base,Zn+=mn.top}nt!==0?pn(Dt,$n.x+Mn[0]*zt*Xt,$n.y+Mn[1]*zt*Xt,$n.z+Mn[2]*zt*Xt):pn(Dt,$n.x,$n.y,$n.z),pn(ln,$n.x+Mn[0]*zt*Zn,$n.y+Mn[1]*zt*Zn,$n.z+Mn[2]*zt*Zn),Bn(Dt,Dt,Ct),Bn(ln,ln,Ct),Cn.push(new Uc(Dt[0],Dt[1],Dt[2])),In.push(new Uc(ln[0],ln[1],ln[2]))}wt.push(Cn),gn.push(In)}return[wt,gn]}(ie,ae,se,Ce,Te,Le,Ze,Ae,Oe,Ve,Ne):Ze?function(Ke,ze,nt,dt,rt,Ct,Ye,mt,Mt){const qt=[],At=[],wt=[0,0,0,1];for(const gn of Ke){const zt=[],Dt=[];for(const ln of gn){const pn=ln.x+dt.x,fn=ln.y+dt.y,cn=y1(pn,fn,ze,nt,Ct,Ye,mt,Mt);wt[0]=pn,wt[1]=fn,wt[2]=cn.base,wt[3]=1,wl(wt,wt,rt),wt[3]=Math.max(wt[3],1e-5);const Cn=new Uc(wt[0]/wt[3],wt[1]/wt[3],wt[2]/wt[3]);wt[0]=pn,wt[1]=fn,wt[2]=cn.top,wt[3]=1,wl(wt,wt,rt),wt[3]=Math.max(wt[3],1e-5);const In=new Uc(wt[0]/wt[3],wt[1]/wt[3],wt[2]/wt[3]);zt.push(Cn),Dt.push(In)}qt.push(zt),At.push(Dt)}return[qt,At]}(ae,se,Ce,Te,Le,Ze,Ae,Oe,Ve):function(Ke,ze,nt,dt,rt){const Ct=[],Ye=[],mt=rt[8]*ze,Mt=rt[9]*ze,qt=rt[10]*ze,At=rt[11]*ze,wt=rt[8]*nt,gn=rt[9]*nt,zt=rt[10]*nt,Dt=rt[11]*nt;for(const ln of Ke){const pn=[],fn=[];for(const cn of ln){const Cn=cn.x+dt.x,In=cn.y+dt.y,Gn=rt[0]*Cn+rt[4]*In+rt[12],un=rt[1]*Cn+rt[5]*In+rt[13],Jn=rt[2]*Cn+rt[6]*In+rt[14],$n=rt[3]*Cn+rt[7]*In+rt[15],Mn=Gn+mt,Xt=un+Mt,Zn=Jn+qt,mn=Math.max($n+At,1e-5),Vi=Gn+wt,qn=un+gn,mi=Jn+zt,li=Math.max($n+Dt,1e-5);pn.push(new Uc(Mn/mn,Xt/mn,Zn/mn)),fn.push(new Uc(Vi/li,qn/li,mi/li))}Ct.push(pn),Ye.push(fn)}return[Ct,Ye]}(ae,se,Ce,Te,Le)}(d,s,A,S,w,f,j,P,L,d.center.lat,n.tileID.canonical),J=n.queryGeometry;return function(ie,ae,se){let Ce=1/0;jx(se,ae)&&(Ce=_1(se,ae[0]));for(let Te=0;Te<ae.length;Te++){const Le=ae[Te],Ze=ie[Te];for(let Ae=0;Ae<Le.length-1;Ae++){const Oe=Le[Ae],Ve=[Oe,Le[Ae+1],Ze[Ae+1],Ze[Ae],Oe];Nx(se,Ve)&&(Ce=Math.min(Ce,_1(se,Ve)))}}return Ce!==1/0&&Ce}(Y,oe,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends ho{constructor(n){super(n,v1),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Qu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=x1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new wf(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new na(this,n)}queryRadius(n){const e=n,i=w1(Fc("line-width",this,e),Fc("line-gap-width",this,e)),s=Fc("line-offset",this,e);return i/2+Math.abs(s)+hf(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,s,c,d){if(n.queryGeometry.isAboveHorizon)return!1;const f=qx(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),_=n.pixelToTileUnitsFactor/2*w1(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),x=this.paint.get("line-offset").evaluate(e,i);return x&&(s=function(w,S){const A=[],P=new Be(0,0);for(let D=0;D<w.length;D++){const L=w[D],F=[];for(let j=0;j<L.length;j++){const Y=L[j],oe=L[j+1],J=j===0?P:Y.sub(L[j-1])._unit()._perp(),ie=j===L.length-1?P:oe.sub(Y)._unit()._perp(),ae=J._add(ie)._unit();ae._mult(1/(ae.x*ie.x+ae.y*ie.y)),F.push(ae._mult(S)._add(Y))}A.push(F)}return A}(s,x*n.pixelToTileUnitsFactor)),function(w,S,A){for(let P=0;P<S.length;P++){const D=S[P];if(w.length>=3){for(let L=0;L<D.length;L++)if(Sl(w,D[L]))return!0}if(nM(w,D,A))return!0}return!1}(f,s,_)}isTileClipped(){return!0}},symbol:Rf,background:class extends ho{constructor(n){super(n,ZA)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ho{constructor(n){super(n,qA)}getProgramIds(){return["raster"]}},sky:class extends ho{constructor(n){super(n,XA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=m_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),c=!s,d=n.style.light,f=d.properties.get("position");return c&&d.properties.get("anchor")==="viewport"&&En("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?V_(f.azimuthal,90-f.polar,e):V_(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return V_(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class rd{constructor(e,i,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,s){const{width:c,height:d}=e,{context:f}=this,{gl:_}=f,{HTMLImageElement:x,HTMLCanvasElement:w,HTMLVideoElement:S,ImageData:A,ImageBitmap:P}=I;if(_.bindTexture(_.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!i||i.premultiply!==!1)),s||this.size&&this.size[0]===c&&this.size[1]===d){const{x:D,y:L}=s||{x:0,y:0};e instanceof x||e instanceof w||e instanceof S||e instanceof A||P&&e instanceof P?_.texSubImage2D(_.TEXTURE_2D,0,D,L,_.RGBA,_.UNSIGNED_BYTE,e):_.texSubImage2D(_.TEXTURE_2D,0,D,L,c,d,_.RGBA,_.UNSIGNED_BYTE,e.data)}else this.size=[c,d],e instanceof x||e instanceof w||e instanceof S||e instanceof A||P&&e instanceof P?_.texImage2D(_.TEXTURE_2D,0,this.format,this.format,_.UNSIGNED_BYTE,e):_.texImage2D(_.TEXTURE_2D,0,this.format,c,d,0,this.format,_.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class KA{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class YA{constructor(){this.tasks={},this.taskQueue=[],yr(["process"],this),this.invoker=new KA(this.process),this.nextId=0}add(e,i){const s=this.nextId++,c=function({type:d,isSymbolTile:f,zoom:_}){return _=_||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-_:d==="maybePrepare"&&f?400-_:500:200-_:100-_}(i);if(c===0){Jr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:i,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Jr();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<i&&(i=d.priority,e=c)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class ow{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const JA=["tile","layer","source","sourceLayer","state"];class sw{constructor(e,i,s,c,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=c,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of JA)this[i]!==void 0&&(e[i]=this[i]);return e}}const Gr=32,Fo=33,la=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,s=0,c=0,d=0,f=0,_=0;for(1&e?c=d=f=Gr:i=s=_=Gr;(e>>=1)>1;){const w=i+c>>1,S=s+d>>1;1&e?(c=i,d=s,i=f,s=_):(i=c,s=d,c=f,d=_),f=w,_=S}const x=4*n;la[x+0]=i,la[x+1]=s,la[x+2]=c,la[x+3]=d}const Oo=new Uint16Array(2178),ca=new Uint8Array(1089),Bf=new Uint16Array(1089);function aw(n){return n===0?-.03125:n===32?.03125:0}var lw=ye([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const cw={type:2,extent:yt,loadGeometry:()=>[[new Be(0,0),new Be(yt+1,0),new Be(yt+1,yt+1),new Be(0,yt+1),new Be(0,0)]]};class U_{constructor(e,i,s,c,d){this.tileID=e,this.uid=Zi(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Qr.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ml(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const f={};if(!d)return f;for(const _ of c){const x=_.layerIds.map(w=>d.getLayer(w)).filter(Boolean);if(x.length!==0){_.layers=x,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(w=>x.filter(S=>S.id===w)[0]));for(const w of x)f[w.id]=_}}return f}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof aa){if(this.hasSymbolBuckets=!0,!s)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof aa&&d.hasRTLText){this.hasRTLText=!0,E.isLoading()||E.isLoaded()||y()!=="deferred"||T();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new sn}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const c=this.buckets[s];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new rd(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new rd(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new rd(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,s,c,d,f,_,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:_,transform:f,params:d,tileTransform:this.tileTransform},e,i,s):{}}querySourceFeatures(e,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),d=i?i.sourceLayer:"",f=c._geojsonTileLayer||c[d];if(!f)return;const _=Sc(i&&i.filter),{z:x,x:w,y:S}=this.tileID.canonical,A={z:x,x:w,y:S};for(let P=0;P<f.length;P++){const D=f.feature(P);if(_.needGeometry){const j=El(D,!0);if(!_.filter(new M(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!_.filter(new M(this.tileID.overscaledZ),D))continue;const L=s.getId(D,d),F=new sw(D,x,w,S,L);F.tile=A,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const s=qi(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const d=this.expirationTime-i;d?this.expirationTime=s+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages();for(const d in this.buckets){if(!i.style.hasLayer(d))continue;const f=this.buckets[d],_=f.layers[0].sourceLayer||"_geojsonTileLayer",x=s[_],w=e[_];if(!x||!w||Object.keys(w).length===0)continue;if(f.update(w,x,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),f instanceof wf||f instanceof gf){const A=i.style._getSourceCache(f.layers[0].source);i._terrain&&i._terrain.enabled&&A&&f.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(A.id,this.tileID)}const S=i&&i.style&&i.style.getLayer(d);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Qr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Qr.now()+e}setTexture(e,i){const s=i.context,c=s.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new rd(s,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,i){const s={};for(const c of i)s[c]=!0;this.dependencies[e]=s}hasDependency(e,i){for(const s of e){const c=this.dependencies[s];if(c){for(const d of i)if(c[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const s=ds(cw,this.tileID.canonical,this.tileTransform)[0],c=new $e,d=new ar;for(let f=0;f<s.length;f++){const{x:_,y:x}=s[f];c.emplaceBack(_,x),d.emplaceBack(f)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,Bh.members),this._tileDebugSegments=Nn.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const s=ds(cw,this.tileID.canonical,this.tileTransform)[0];let c,d;if(this.isRaster){const f=function(_,x){const w=Ml(_,x),S=Math.pow(2,_.z);for(let j=0;j<Fo;j++)for(let Y=0;Y<Fo;Y++){const oe=Er((_.x+(Y+aw(Y))/Gr)/S),J=bi((_.y+(j+aw(j))/Gr)/S),ie=x.project(oe,J),ae=j*Fo+Y;Oo[2*ae+0]=Math.round((ie.x*w.scale-w.x)*yt),Oo[2*ae+1]=Math.round((ie.y*w.scale-w.y)*yt)}ca.fill(0),Bf.fill(0);for(let j=2045;j>=0;j--){const Y=4*j,oe=la[Y+0],J=la[Y+1],ie=la[Y+2],ae=la[Y+3],se=oe+ie>>1,Ce=J+ae>>1,Te=se+Ce-J,Le=Ce+oe-se,Ze=J*Fo+oe,Ae=ae*Fo+ie,Oe=Ce*Fo+se,Ve=Math.hypot((Oo[2*Ze+0]+Oo[2*Ae+0])/2-Oo[2*Oe+0],(Oo[2*Ze+1]+Oo[2*Ae+1])/2-Oo[2*Oe+1])>=16;ca[Oe]=ca[Oe]||(Ve?1:0),j<1022&&(ca[Oe]=ca[Oe]||ca[(J+Le>>1)*Fo+(oe+Te>>1)]||ca[(ae+Le>>1)*Fo+(ie+Te>>1)])}const A=new Fe,P=new pt;let D=0;function L(j,Y){const oe=Y*Fo+j;return Bf[oe]===0&&(A.emplaceBack(Oo[2*oe+0],Oo[2*oe+1],j*yt/Gr,Y*yt/Gr),Bf[oe]=++D),Bf[oe]-1}function F(j,Y,oe,J,ie,ae){const se=j+oe>>1,Ce=Y+J>>1;if(Math.abs(j-ie)+Math.abs(Y-ae)>1&&ca[Ce*Fo+se])F(ie,ae,j,Y,se,Ce),F(oe,J,ie,ae,se,Ce);else{const Te=L(j,Y),Le=L(oe,J),Ze=L(ie,ae);P.emplaceBack(Te,Le,Ze)}}return F(0,0,Gr,Gr,Gr,0),F(Gr,Gr,0,0,0,Gr),{vertices:A,indices:P}}(this.tileID.canonical,i);c=f.vertices,d=f.indices}else{c=new Fe,d=new pt;for(const{x:_,y:x}of s)c.emplaceBack(_,x,0,0);const f=x_(c.int16,void 0,4);for(let _=0;_<f.length;_+=3)d.emplaceBack(f[_],f[_+1],f[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,lw.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Nn.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugBuffers(e,i){const s=i.projection;if(!s||s.name!=="globe"||i.freezeTileCoverage)return;const c=this.tileID.canonical,d=Vh(Ix(c,i)),f=Rc(i.zoom);let _;f>0&&(_=Xg(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,i,d,_,f),this._makeGlobeTileDebugTextBuffer(e,c,i,d,_,f)}_globePoint(e,i,s,c,d,f,_){let x=Oh(e,i,s);if(f){const w=1<<s.z,S=Ro(c.center.lng),A=Bo(c.center.lat),P=(s.x+.5)/w-S;let D=0;P>.5?D=-1:P<-.5&&(D=1);let L=(e/yt+s.x)/w+D,F=(i/yt+s.y)/w;L=(L-S)*c._pixelsPerMercatorPixel+S,F=(F-A)*c._pixelsPerMercatorPixel+A;const j=[L*c.worldSize,F*c.worldSize,0];Bn(j,j,f),x=Tl(x,j,_)}return Bn(x,x,d)}_makeGlobeTileDebugBorderBuffer(e,i,s,c,d,f){const _=new $e,x=new ar,w=new be,S=(P,D,L,F,j)=>{const Y=(L-P)/(j-1),oe=(F-D)/(j-1),J=_.length;for(let ie=0;ie<j;ie++){const ae=P+ie*Y,se=D+ie*oe;_.emplaceBack(ae,se);const Ce=this._globePoint(ae,se,i,s,c,d,f);w.emplaceBack(Ce[0],Ce[1],Ce[2]),x.emplaceBack(J+ie)}},A=yt;S(0,0,A,0,16),S(A,0,A,A,16),S(A,A,0,A,16),S(0,A,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(_,Bh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,Mx.members),this._tileDebugSegments=Nn.simpleSegment(0,0,_.length,x.length)}_makeGlobeTileDebugTextBuffer(e,i,s,c,d,f){const _=yt/4,x=new $e,w=new pt,S=new be,A=25;w.reserve(32),x.reserve(A),S.reserve(A);const P=(D,L)=>A*D+L;for(let D=0;D<A;D++){const L=D*_;for(let F=0;F<A;F++){const j=F*_;x.emplaceBack(j,L);const Y=this._globePoint(j,L,i,s,c,d,f);S.emplaceBack(Y[0],Y[1],Y[2])}}for(let D=0;D<4;D++)for(let L=0;L<4;L++){const F=P(D,L),j=P(D,L+1),Y=P(D+1,L),oe=P(D+1,L+1);w.emplaceBack(F,j,Y),w.emplaceBack(Y,j,oe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(x,Bh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(S,Mx.members),this._tileDebugTextSegments=Nn.simpleSegment(0,0,A,32)}}class QA{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,s){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},hn(this.stateChanges[e][c],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])s[d]||(this.deletedStates[e][c][d]=null)}else for(const d in s)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,i,s){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const s=String(i),c=hn({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][i];if(d===null)return{};for(const f in d)delete c[f]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const f in this.stateChanges[c])this.state[c][f]||(this.state[c][f]={}),hn(this.state[c][f],this.stateChanges[c][f]),d[f]=this.state[c][f];s[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const f in this.state[c])d[f]={},this.state[c][f]={};else for(const f in this.deletedStates[c]){if(this.deletedStates[c][f]===null)this.state[c][f]={};else if(this.state[c][f])for(const _ of Object.keys(this.deletedStates[c][f]))delete this.state[c][f][_];d[f]=this.state[c][f]}s[c]=s[c]||{},hn(s[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const c in e)e[c].setFeatureState(s,i)}}class uw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function hw(n,e,i,s){let c=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(s[f])<1e-15){if(i[f]<n[f]||i[f]>e[f])return null}else{const _=1/s[f];let x=(n[f]-i[f])*_,w=(e[f]-i[f])*_;if(x>w){const S=x;x=w,w=S}if(x>c&&(c=x),w<d&&(d=w),c>d)return null}return c}function dw(n,e,i,s,c,d,f,_,x,w,S){const A=s-n,P=c-e,D=d-i,L=f-n,F=_-e,j=x-i,Y=S[1]*j-S[2]*F,oe=S[2]*L-S[0]*j,J=S[0]*F-S[1]*L,ie=A*Y+P*oe+D*J;if(Math.abs(ie)<1e-15)return null;const ae=1/ie,se=w[0]-n,Ce=w[1]-e,Te=w[2]-i,Le=(se*Y+Ce*oe+Te*J)*ae;if(Le<0||Le>1)return null;const Ze=Ce*D-Te*P,Ae=Te*A-se*D,Oe=se*P-Ce*A,Ve=(S[0]*Ze+S[1]*Ae+S[2]*Oe)*ae;return Ve<0||Le+Ve>1?null:(L*Ze+F*Ae+j*Oe)*ae}function pw(n,e,i){return(n-e)/(i-e)}function fw(n,e,i,s,c,d,f,_,x){const w=1<<i,S=d-s,A=f-c,P=(n+1)/w*S+s,D=(e+0)/w*A+c,L=(e+1)/w*A+c;_[0]=(n+0)/w*S+s,_[1]=D,x[0]=P,x[1]=L}class mw{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const f=Math.ceil(Math.log2(d.dim/8)),_=[];let x=Math.ceil(Math.pow(2,f));const w=1/x,S=(D,L,F,j,Y)=>{const oe=j?1:0,J=(D+1)*F-oe,ie=L*F,ae=(L+1)*F-oe;Y[0]=D*F,Y[1]=ie,Y[2]=J,Y[3]=ae};let A=new uw(x);const P=[];for(let D=0;D<x*x;D++){S(D%x,Math.floor(D/x),w,!1,P);const L=ua(P[0],P[1],d),F=ua(P[2],P[1],d),j=ua(P[2],P[3],d),Y=ua(P[0],P[3],d);A.minimums.push(Math.min(L,F,j,Y)),A.maximums.push(Math.max(L,F,j,Y)),A.leaves.push(1)}for(_.push(A),x/=2;x>=1;x/=2){const D=_[_.length-1];A=new uw(x);for(let L=0;L<x*x;L++){S(L%x,Math.floor(L/x),2,!0,P);const F=D.getElevation(P[0],P[1]),j=D.getElevation(P[2],P[1]),Y=D.getElevation(P[2],P[3]),oe=D.getElevation(P[0],P[3]),J=D.isLeaf(P[0],P[1]),ie=D.isLeaf(P[2],P[1]),ae=D.isLeaf(P[2],P[3]),se=D.isLeaf(P[0],P[3]),Ce=Math.min(F.min,j.min,Y.min,oe.min),Te=Math.max(F.max,j.max,Y.max,oe.max),Le=J&&ie&&ae&&se;A.maximums.push(Te),A.minimums.push(Ce),A.leaves.push(Te-Ce<=5&&Le?1:0)}_.push(A)}return _}(this.dem),s=i.length-1,c=i[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,c,d,f,_=1){return hw([e,i,-100],[s,c,this.maximums[0]*_],d,f)}raycast(e,i,s,c,d,f,_=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,i,s,c,d,f,_);if(x==null)return null;const w=[],S=[],A=[],P=[],D=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:L,t:F,nodex:j,nodey:Y,depth:oe}=D.pop();if(this.leaves[L]){fw(j,Y,oe,e,i,s,c,A,P);const ie=1<<oe,ae=(j+0)/ie,se=(j+1)/ie,Ce=(Y+0)/ie,Te=(Y+1)/ie,Le=ua(ae,Ce,this.dem)*_,Ze=ua(se,Ce,this.dem)*_,Ae=ua(se,Te,this.dem)*_,Oe=ua(ae,Te,this.dem)*_,Ve=dw(A[0],A[1],Le,P[0],A[1],Ze,P[0],P[1],Ae,d,f),Ne=dw(P[0],P[1],Ae,A[0],P[1],Oe,A[0],A[1],Le,d,f),Ke=Math.min(Ve!==null?Ve:Number.MAX_VALUE,Ne!==null?Ne:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{const ze=Lh([],d,f,F);if(gw(Le,Ze,Oe,Ae,pw(ze[0],A[0],P[0]),pw(ze[1],A[1],P[1]))>=ze[2])return F}continue}let J=0;for(let ie=0;ie<this._siblingOffset.length;ie++){fw((j<<1)+this._siblingOffset[ie][0],(Y<<1)+this._siblingOffset[ie][1],oe+1,e,i,s,c,A,P),A[2]=-100,P[2]=this.maximums[this.childOffsets[L]+ie]*_;const ae=hw(A,P,d,f);if(ae!=null){const se=ae;w[ie]=se;let Ce=!1;for(let Te=0;Te<J&&!Ce;Te++)se>=w[S[Te]]&&(S.splice(Te,0,ie),Ce=!0);Ce||(S[J]=ie),J++}}for(let ie=0;ie<J;ie++){const ae=S[ie];D.push({idx:this.childOffsets[L]+ae,t:w[ae],nodex:(j<<1)+this._siblingOffset[ae][0],nodey:(Y<<1)+this._siblingOffset[ae][1],depth:oe+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,c,d){if(e[c].isLeaf(i,s)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=c-1,_=e[f];let x=0,w=0;for(let S=0;S<this._siblingOffset.length;S++){const A=2*i+this._siblingOffset[S][0],P=2*s+this._siblingOffset[S][1],D=_.getElevation(A,P),L=_.isLeaf(A,P),F=this._addNode(D.min,D.max,L);L&&(x|=1<<S),w||(w=F)}for(let S=0;S<this._siblingOffset.length;S++)x&1<<S||this._construct(e,2*i+this._siblingOffset[S][0],2*s+this._siblingOffset[S][1],f,w+S)}}function gw(n,e,i,s,c,d){return $t($t(n,i,d),$t(e,s,d),c)}function ua(n,e,i){const s=i.dim,c=We(n*s-.5,0,s-1),d=We(e*s-.5,0,s-1),f=Math.floor(c),_=Math.floor(d),x=Math.min(f+1,s-1),w=Math.min(_+1,s-1);return gw(i.get(f,_),i.get(x,_),i.get(f,w),i.get(x,w),c-f,d-_)}const _w={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function eP(n,e,i){return(256*n*256+256*e+i)/10-1e4}function tP(n,e,i){return 256*n+e+i/256-32768}class Ff{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,c=!1,d=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return En(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,_=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=c,!c){for(let x=0;x<f;x++)_[this._idx(-1,x)]=_[this._idx(0,x)],_[this._idx(f,x)]=_[this._idx(f-1,x)],_[this._idx(x,-1)]=_[this._idx(x,0)],_[this._idx(x,f)]=_[this._idx(x,f-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(f,-1)]=_[this._idx(f-1,0)],_[this._idx(-1,f)]=_[this._idx(0,f-1)],_[this._idx(f,f)]=_[this._idx(f-1,f-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new mw(this)}get(e,i,s=!1){s&&(e=We(e,-1,this.dim),i=We(i,-1,this.dim));const c=4*this._idx(e,i);return(this.encoding==="terrarium"?tP:eP)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return _w[e]}get unpackVector(){return _w[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],c=Ff.getUnpackVector(i);let d=Math.floor((e+c[3])/c[2]);return s[2]=d%256,d=Math.floor(d/256),s[1]=d%256,d=Math.floor(d/256),s[0]=d,s}getPixels(){return new cr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,d=i*this.dim+this.dim,f=s*this.dim,_=s*this.dim+this.dim;switch(i){case-1:c=d-1;break;case 1:d=c+1}switch(s){case-1:f=_-1;break;case 1:_=f+1}const x=-i*this.dim,w=-s*this.dim;for(let S=f;S<_;S++)for(let A=c;A<d;A++){const P=4*this._idx(A,S),D=4*this._idx(A+x,S+w);this.pixels[P+0]=e.pixels[D+0],this.pixels[P+1]=e.pixels[D+1],this.pixels[P+2]=e.pixels[D+2],this.pixels[P+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ut(Ff,"DEMData"),ut(mw,"DemMinMaxQuadTree",{omit:["dem"]});class nP{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,s){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:i,timeout:void 0};if(s!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},s)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const s=e.wrapped().key,c=i===void 0?0:this.data[s].indexOf(i),d=this.data[s][c];return this.data[s].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(d.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const s in this.data)for(const c of this.data[s])e(c.value)||i.push(c);for(const s of i)this.remove(s.value.tileID,s)}}class Kc{constructor(e,i,s){this.func=e,this.mask=i,this.range=s}}Kc.ReadOnly=!1,Kc.ReadWrite=!0,Kc.disabled=new Kc(519,Kc.ReadOnly,[0,1]);const N_=7680;class j_{constructor(e,i,s,c,d,f){this.test=e,this.ref=i,this.mask=s,this.fail=c,this.depthFail=d,this.pass=f}}j_.disabled=new j_({func:519,mask:0},0,0,N_,N_,N_);class Vo{constructor(e,i,s){this.blendFunction=e,this.blendColor=i,this.mask=s}}Vo.Replace=[1,0],Vo.disabled=new Vo(Vo.Replace,Rn.transparent,[!1,!1,!1,!1]),Vo.unblended=new Vo(Vo.Replace,Rn.transparent,[!0,!0,!0,!0]),Vo.alphaBlended=new Vo([1,771],Rn.transparent,[!0,!0,!0,!0]);const G_=1029,$_=2305;class yo{constructor(e,i,s){this.enable=e,this.mode=i,this.frontFace=s}}yo.disabled=new yo(!1,G_,$_),yo.backCCW=new yo(!0,G_,$_),yo.backCW=new yo(!0,G_,2304),yo.frontCW=new yo(!0,1028,2304),yo.frontCCW=new yo(!0,1028,$_);class Al extends Za{constructor(e,i,s){super(),this.id=e,this._onlySymbols=s,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new nP(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new QA,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const s=this._tiles[i];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Qt(this._tiles).map(e=>e.tileID).sort(yw).map(e=>e.key)}getRenderableIds(e){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&i.push(this._tiles[s]);return e?i.sort((s,c)=>{const d=s.tileID,f=c.tileID,_=new Be(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),x=new Be(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-f.overscaledZ||x.y-_.y||x.x-_.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(yw).map(s=>s.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,e,i)))}_tileLoaded(e,i,s,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new eo(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Qr.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Jo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const d=i[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const f=this.getTileByID(d);s(e,f),s(f,e)}}function s(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let f=d.tileID.canonical.x-c.tileID.canonical.x;const _=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),w=d.tileID.key;f===0&&_===0||Math.abs(_)>1||(Math.abs(f)>1&&(Math.abs(f+x)===1?f+=x:Math.abs(f-x)===1&&(f-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,f,_),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,s,c){for(const d in this._tiles){let f=this._tiles[d];if(c[d]||!f.hasData()||f.tileID.overscaledZ<=i||f.tileID.overscaledZ>s)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>i+1;){const w=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[w.key],f&&f.hasData()&&(_=w)}let x=_;for(;x.overscaledZ>i;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){c[_.key]=_;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=e.overscaledZ-1;s>=i;s--){const c=e.scaledTo(s),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const s=Math.ceil(e.width/i)+1,c=Math.ceil(e.height/i)+1,d=Math.floor(s*c*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const s={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+i),s[d.tileID.key]=d}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,i,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(_=>new Oi(_.canonical.z,_.wrap,_.canonical.z,_.canonical.x,_.canonical.y)):(c=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(_=>this._source.hasTile(_)))):c=[];const d=this._updateRetainedTiles(c);if(vw(this._source.type)&&c.length!==0){const _={},x={},w=Object.keys(d);for(const A of w){const P=d[A],D=this._tiles[A];if(!D||D.fadeEndTime&&D.fadeEndTime<=Qr.now())continue;const L=this.findLoadedParent(P,Math.max(P.overscaledZ-Al.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),_[L.tileID.key]=L.tileID),x[A]=P}const S=c[c.length-1].overscaledZ;for(const A in this._tiles){const P=this._tiles[A];if(d[A]||!P.hasData())continue;let D=P.tileID;for(;D.overscaledZ>S;){D=D.scaledTo(D.overscaledZ-1);const L=this._tiles[D.key];if(L&&L.hasData()&&x[D.key]){d[A]=P.tileID;break}}}for(const A in _)d[A]||(this._coveredTiles[A]=!0,d[A]=_[A])}for(const _ in d)this._tiles[_].clearFadeHold();const f=function(_,x){const w=[];for(const S in _)S in x||w.push(S);return w}(this._tiles,d);for(const _ of f){const x=this._tiles[_];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+_)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const s={},c=e.reduce((w,S)=>Math.min(w,S.overscaledZ),1/0),d=e[0].overscaledZ,f=Math.max(d-Al.maxOverzooming,this._source.minzoom),_=Math.max(d+Al.maxUnderzooming,this._source.minzoom),x={};for(const w of e){const S=this._addTile(w);i[w.key]=w,S.hasData()||c<this._source.maxzoom&&(x[w.key]=w)}this._retainLoadedChildren(x,c,_,i);for(const w of e){let S=this._tiles[w.key];if(S.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const P=w.children(this._source.maxzoom)[0],D=this.getTile(P);if(D&&D.hasData()){i[P.key]=P;continue}}else{const P=w.children(this._source.maxzoom);if(i[P[0].key]&&i[P[1].key]&&i[P[2].key]&&i[P[3].key])continue}let A=S.wasRequested();for(let P=w.overscaledZ-1;P>=f;--P){const D=w.scaledTo(P);if(s[D.key]||(s[D.key]=!0,S=this.getTile(D),!S&&A&&(S=this._addTile(D)),S&&(i[D.key]=D,A=S.wasRequested(),S.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}i.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(d),s)break;c=d}for(const d of i)this._loadedParentTiles[d]=s}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const s=!!i;if(!s){const c=this.map?this.map.painter:null;i=new U_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,s||this._source.fire(new Jo("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=i.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,s){const c=[],d=this.transform;if(!d)return c;const f=d.projection.name==="globe",_=Ro(d.center.lng);for(const x in this._tiles){const w=this._tiles[x];if(s&&w.clearQueryDebugViz(),w.holdingForFade())continue;let S;if(f){const A=w.tileID.canonical;if(A.z===0){const P=[Math.abs(We(_,...od(A,-1))-_),Math.abs(We(_,...od(A,1))-_)];S=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(We(_,...od(A,-1))-_),Math.abs(We(_,...od(A,0))-_),Math.abs(We(_,...od(A,1))-_)];S=[P.indexOf(Math.min(...P))-1]}}else S=[0];for(const A of S){const P=e.containsTile(w,d,i,A);P&&c.push(P)}}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(vw(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Qr.now())return!0}return!1}setFeatureState(e,i,s){this._state.updateState(e=e||"_geojsonTileLayer",i,s)}removeFeatureState(e,i,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,s)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,s){const c=this._tiles[e];c&&c.setDependencies(i,s)}reloadTilesForDependencies(e,i){for(const s in this._tiles)this._tiles[s].hasDependency(e,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,i))};return void this._source.on("data",_)}const s=new Map,c=Array.isArray(e)?e:[e],d=this.map.painter.terrain,f=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const _ of c){const x=_.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of x)s.set(w.key,w);this.usedForTerrain&&_.updateElevation(!1)}gt(Array.from(s.values()),(_,x)=>{const w=new U_(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,S=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),x(S,w)})},i)}}function yw(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function vw(n){return n==="raster"||n==="image"||n==="video"||n==="custom"}function od(n,e){const i=1<<n.z;return[n.x/i+e,(n.x+1)/i+e]}Al.maxOverzooming=10,Al.maxUnderzooming=3;class Of{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const c=s||e.findDEMTileFor(i);if(!c||!c.dem)return;const d=c.dem,f=c.tileID,_=1<<i.canonical.z-f.canonical.z;return new Of(c,c.tileSize/yt/_,[(i.canonical.x/_-f.canonical.x)*d.dim,(i.canonical.y/_-f.canonical.y)*d.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(s);return new Be(c,d)}getElevationAt(e,i,s,c){const d=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],_=Math.floor(d),x=Math.floor(f),w=this._dem;return c=!!c,s?$t($t(w.get(_,x,c),w.get(_,x+1,c),f-x),$t(w.get(_+1,x,c),w.get(_+1,x+1,c),f-x),d-_):w.get(_,x,c)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*mo(1,e)*this._dem.stride}}class xw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new os(yt,16,0),this.featureIndexArray=new gl,this.promoteId=i}insert(e,i,s,c,d,f=0){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,d,f);const x=this.grid;for(let w=0;w<i.length;w++){const S=i[w],A=[1/0,1/0,-1/0,-1/0];for(let P=0;P<S.length;P++){const D=S[P];A[0]=Math.min(A[0],D.x),A[1]=Math.min(A[1],D.y),A[2]=Math.max(A[2],D.x),A[3]=Math.max(A[3],D.y)}A[0]<yt&&A[1]<yt&&A[2]>=0&&A[3]>=0&&x.insert(_,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new E_(new Ef(this.rawTileData)).layers,this.sourceLayerCoder=new ow(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s,c){this.loadVTLayers();const d=e.params||{},f=Sc(d.filter),_=e.tileResult,x=e.transform,w=_.bufferedTilespaceBounds,S=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(L,F,j,Y)=>Zx(_.bufferedTilespaceGeometry,L,F,j,Y));S.sort(iP);let A=null;x.elevation&&S.length>0&&(A=Of.create(x.elevation,this.tileID));const P={};let D;for(let L=0;L<S.length;L++){const F=S[L];if(F===D)continue;D=F;const j=this.featureIndexArray.get(F);let Y=null;this.loadMatchingFeature(P,j,f,d.layers,d.availableImages,i,s,c,(oe,J,ie,ae=0)=>(Y||(Y=ds(oe,this.tileID.canonical,e.tileTransform)),J.queryIntersectsFeature(_,oe,ie,Y,this.z,e.transform,e.pixelPosMatrix,A,ae)))}return P}loadMatchingFeature(e,i,s,c,d,f,_,x,w){const{featureIndex:S,bucketIndex:A,sourceLayerIndex:P,layoutVertexArrayOffset:D}=i,L=this.bucketLayerIDs[A];if(c&&!function(oe,J){for(let ie=0;ie<oe.length;ie++)if(J.indexOf(oe[ie])>=0)return!0;return!1}(c,L))return;const F=this.sourceLayerCoder.decode(P),j=this.vtLayers[F].feature(S);if(s.needGeometry){const oe=El(j,!0);if(!s.filter(new M(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!s.filter(new M(this.tileID.overscaledZ),j))return;const Y=this.getId(j,F);for(let oe=0;oe<L.length;oe++){const J=L[oe];if(c&&c.indexOf(J)<0)continue;const ie=f[J];if(!ie)continue;let ae={};Y!==void 0&&x&&(ae=x.getState(ie.sourceLayer||"_geojsonTileLayer",Y));const se=hn({},_[J]);se.paint=ww(se.paint,ie.paint,j,ae,d),se.layout=ww(se.layout,ie.layout,j,ae,d);const Ce=!w||w(j,ie,ae,D);if(!Ce)continue;const Te=new sw(j,this.z,this.x,this.y,Y);Te.layer=se;let Le=e[J];Le===void 0&&(Le=e[J]=[]),Le.push({featureIndex:S,feature:Te,intersectionZ:Ce})}}lookupSymbolFeatures(e,i,s,c,d,f,_,x){const w={};this.loadVTLayers();const S=Sc(d);for(const A of e)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:c,featureIndex:A,layoutVertexArrayOffset:0},S,f,_,x,i);return w}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),d=this.vtFeatures[c];if(d[i])return d[i];const f=this.vtLayers[c].feature(i);return d[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];c!=null&&(s=e.properties[c]),typeof s=="boolean"&&(s=Number(s))}return s}}function ww(n,e,i,s,c){return Pt(n,(d,f)=>{const _=e instanceof K?e.get(f):null;return _&&_.evaluate?_.evaluate(i,s,c):_})}function iP(n,e){return e-n}ut(xw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class bw{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new ps({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=di(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const c=[];let d=e.length%2==1?-e[e.length-1]*s:0,f=e[0]*s,_=!0;c.push({left:d,right:f,isDash:_,zeroLength:e[0]===0});let x=e[0];for(let w=1;w<e.length;w++){_=!_;const S=e[w];d=x*s,x+=S,f=x*s,c.push({left:d,right:f,isDash:_,zeroLength:S===0})}return c}addRoundDash(e,i,s){const c=i/2;for(let d=-s;d<=s;d++){const f=this.width*(this.nextRow+s+d);let _=0,x=e[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++_]);const S=Math.abs(w-x.left),A=Math.abs(w-x.right),P=Math.min(S,A);let D;const L=d/s*(c+1);if(x.isDash){const F=c-Math.abs(L);D=Math.sqrt(P*P+F*F)}else D=c-Math.sqrt(P*P+L*L);this.image.data[f+w]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,i){for(let x=e.length-1;x>=0;--x){const w=e[x],S=e[x+1];w.zeroLength?e.splice(x,1):S&&S.isDash===w.isDash&&(S.left=w.left,e.splice(x,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const d=this.width*this.nextRow;let f=0,_=e[f];for(let x=0;x<this.width;x++){x/_.right>1&&(_=e[++f]);const w=Math.abs(x-_.left),S=Math.abs(x-_.right),A=Math.min(w,S);this.image.data[d+x]=Math.max(0,Math.min(255,(_.isDash?A:-A)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const c=i==="round",d=c?7:0,f=2*d+1;if(this.nextRow+f>this.height)return En("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let S=0;S<e.length;S++)e[S]<0&&(En("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),_+=e[S];if(_!==0){const S=this.width/_,A=this.getDashRanges(e,this.width,S);c?this.addRoundDash(A,S,d):this.addRegularDash(A,i==="square"?.5*S:0)}const x=this.nextRow+d;this.nextRow+=f;const w={tl:[x,d],br:[_,0]};return this.positions[s]=w,w}}ut(bw,"LineAtlas");const Tw=1*_o;class Ew{constructor(e){const i={},s=[];for(const _ in e){const x=e[_],w=i[_]={};for(const S in x.glyphs){const A=x.glyphs[+S];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const P=A.metrics.localGlyph?Tw:1,D={x:0,y:0,w:A.bitmap.width+2*P,h:A.bitmap.height+2*P};s.push(D),w[S]=D}}const{w:c,h:d}=A_(s),f=new ps({width:c||1,height:d||1});for(const _ in e){const x=e[_];for(const w in x.glyphs){const S=x.glyphs[+w];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const A=i[_][w],P=S.metrics.localGlyph?Tw:1;ps.copy(S.bitmap,f,{x:0,y:0},{x:A.x+P,y:A.y+P},S.bitmap)}}this.image=f,this.positions=i}}ut(Ew,"GlyphAtlas");class rP{constructor(e){this.tileID=new Oi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ml(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,s,c,d){this.status="parsing",this.data=e,this.collisionBoxArray=new sn;const f=new ow(Object.keys(e.layers).sort()),_=new xw(this.tileID,this.promoteId);_.bucketLayerIDs=[];const x={},w=new bw(256,256),S={featureIndex:_,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:s},A=i.familiesBySource[this.source];for(const ae in A){const se=e.layers[ae];if(!se)continue;let Ce=!1,Te=!1;for(const Ae of A[ae])Ae[0].type==="symbol"?Ce=!0:Te=!0;if(this.isSymbolTile===!0&&!Ce||this.isSymbolTile===!1&&!Te)continue;se.version===1&&En(`Vector tile source "${this.source}" layer "${ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Le=f.encode(ae),Ze=[];for(let Ae=0;Ae<se.length;Ae++){const Oe=se.feature(Ae),Ve=_.getId(Oe,ae);Ze.push({feature:Oe,id:Ve,index:Ae,sourceLayerIndex:Le})}for(const Ae of A[ae]){const Oe=Ae[0];this.isSymbolTile!==void 0&&Oe.type==="symbol"!==this.isSymbolTile||Oe.minzoom&&this.zoom<Math.floor(Oe.minzoom)||Oe.maxzoom&&this.zoom>=Oe.maxzoom||Oe.visibility!=="none"&&(Z_(Ae,this.zoom,s),(x[Oe.id]=Oe.createBucket({index:_.bucketLayerIDs.length,layers:Ae,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Le,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(Ze,S,this.tileID.canonical,this.tileTransform),_.bucketLayerIDs.push(Ae.map(Ve=>Ve.id)))}}let P,D,L,F;w.trim();const j={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Y=()=>{if(P)return d(P);if(D&&L&&F){const ae=new Ew(D),se=new k1(L,F);for(const Ce in x){const Te=x[Ce];Te instanceof aa?(Z_(Te.layers,this.zoom,s),IA(Te,D,ae.positions,L,se.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Te.hasPattern&&(Te instanceof wf||Te instanceof gf||Te instanceof Wh)&&(Z_(Te.layers,this.zoom,s),Te.addFeatures(S,this.tileID.canonical,se.patternPositions,s,this.tileTransform))}this.status="done",d(null,{buckets:Qt(x).filter(Ce=>!Ce.isEmpty()),featureIndex:_,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ae.image,lineAtlas:w,imageAtlas:se,glyphMap:this.returnDependencies?D:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?ae.positions:null})}},oe=Pt(S.glyphDependencies,ae=>Object.keys(ae).map(Number));Object.keys(oe).length?c.send("getGlyphs",{uid:this.uid,stacks:oe},(ae,se)=>{P||(P=ae,D=se,Y())},void 0,!1,j):D={};const J=Object.keys(S.iconDependencies);J.length?c.send("getImages",{icons:J,source:this.source,tileID:this.tileID,type:"icons"},(ae,se)=>{P||(P=ae,L=se,Y())},void 0,!1,j):L={};const ie=Object.keys(S.patternDependencies);ie.length?c.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(ae,se)=>{P||(P=ae,F=se,Y())},void 0,!1,j):F={},Y()}}function Z_(n,e,i){const s=new M(e);for(const c of n)c.recalculate(s,i)}class Sw{constructor(e){this.entries={},this.scheduler=e}request(e,i,s,c){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[f,_]=d.result;return this.scheduler?this.scheduler.add(()=>{c(f,_)},i):c(f,_),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=s((f,_)=>{d.result=[f,_];for(const x of d.callbacks)this.scheduler?this.scheduler.add(()=>{x(f,_)},i):x(f,_);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(f=>f!==c),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function Cw(n,e,i){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const d=Rs(n.request,(f,_,x,w)=>{f?c(f):_&&c(null,{vectorTile:i?void 0:new E_(new Ef(_)),rawData:_,cacheControl:x,expires:w})});return()=>{d.cancel(),c()}},e)}const Mw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class q_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const d=Mw[15&s];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new q_(_,f,d,e)}constructor(e,i=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=Mw.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return W_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:_}=this,x=[0,d.length-1,0],w=[];for(;x.length;){const S=x.pop()||0,A=x.pop()||0,P=x.pop()||0;if(A-P<=_){for(let j=P;j<=A;j++){const Y=f[2*j],oe=f[2*j+1];Y>=e&&Y<=s&&oe>=i&&oe<=c&&w.push(d[j])}continue}const D=P+A>>1,L=f[2*D],F=f[2*D+1];L>=e&&L<=s&&F>=i&&F<=c&&w.push(d[D]),(S===0?e<=L:i<=F)&&(x.push(P),x.push(D-1),x.push(1-S)),(S===0?s>=L:c>=F)&&(x.push(D+1),x.push(A),x.push(1-S))}return w}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:f}=this,_=[0,c.length-1,0],x=[],w=s*s;for(;_.length;){const S=_.pop()||0,A=_.pop()||0,P=_.pop()||0;if(A-P<=f){for(let j=P;j<=A;j++)Pw(d[2*j],d[2*j+1],e,i)<=w&&x.push(c[j]);continue}const D=P+A>>1,L=d[2*D],F=d[2*D+1];Pw(L,F,e,i)<=w&&x.push(c[D]),(S===0?e-s<=L:i-s<=F)&&(_.push(P),_.push(D-1),_.push(1-S)),(S===0?e+s>=L:i+s>=F)&&(_.push(D+1),_.push(A),_.push(1-S))}return x}}function W_(n,e,i,s,c,d){if(c-s<=i)return;const f=s+c>>1;Aw(n,e,f,s,c,d),W_(n,e,i,s,f-1,1-d),W_(n,e,i,f+1,c,1-d)}function Aw(n,e,i,s,c,d){for(;c>s;){if(c-s>600){const w=c-s+1,S=i-s+1,A=Math.log(w),P=.5*Math.exp(2*A/3),D=.5*Math.sqrt(A*P*(w-P)/w)*(S-w/2<0?-1:1);Aw(n,e,i,Math.max(s,Math.floor(i-S*P/w+D)),Math.min(c,Math.floor(i+(w-S)*P/w+D)),d)}const f=e[2*i+d];let _=s,x=c;for(sd(n,e,s,i),e[2*c+d]>f&&sd(n,e,s,c);_<x;){for(sd(n,e,_,x),_++,x--;e[2*_+d]<f;)_++;for(;e[2*x+d]>f;)x--}e[2*s+d]===f?sd(n,e,s,x):(x++,sd(n,e,x,c)),x<=i&&(s=x+1),i<=x&&(c=x-1)}}function sd(n,e,i,s){X_(n,i,s),X_(e,2*i,2*s),X_(e,2*i+1,2*s+1)}function X_(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function Pw(n,e,i,s){const c=n-i,d=e-s;return c*c+d*d}a.ARRAY_TYPE=lr,a.AUTH_ERR_MSG=ce,a.Aabb=Fi,a.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},yr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Jr()?n:I,this.scheduler=new YA}send(n,e,i,s,c=!1,d){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=d,this.callbacks[f]=i);const _=zs(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:n,hasCallback:!!i,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:Qs(e,_)},_),{cancel:()=>{i&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(e.mustQueue||Jr()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),s&&s.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if(e.type==="<response>"){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(ss(e.error)):i(null,ss(e.data)))}else{const i=zs(this.globalScope)?void 0:[],s=e.hasCallback?(d,f)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:d?Qs(d):null,data:Qs(f,i)},i)}:d=>{},c=ss(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,s);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],c.source)[d[1]](c,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=xf,a.Color=Rn,a.ColorMode=Vo,a.CullFaceMode=yo,a.DEMData=Ff,a.DataConstantProperty=B,a.DedupedRequest=Sw,a.DepthMode=Kc,a.EXTENT=yt,a.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,c=Math.floor(n.x),d=Math.floor((n.x-c)*s),f=Math.floor(n.y*s),_=this.findDEMTileFor(new Oi(i,c,i,d,f));return!(!_||!_.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const c=s.getSource().maxzoom,d=1<<c,f=Math.floor(n.x),_=n.x-f,x=new Oi(c,f,c,Math.floor(_*d),Math.floor(n.y*d)),w=this.findDEMTileFor(x);if(!w||!w.dem)return e;const S=w.dem,A=1<<w.tileID.canonical.z,P=(_*A-w.tileID.canonical.x)*S.dim,D=(n.y*A-w.tileID.canonical.y)*S.dim,L=Math.floor(P),F=Math.floor(D);return(i?this.exaggeration():1)*$t($t(S.get(L,F),S.get(L,F+1),D-F),$t(S.get(L+1,F),S.get(L+1,F+1),D-F),P-L)}getAtTileOffset(n,e,i){const s=1<<n.canonical.z;return this.getAtPointOrZero(new Bc(n.wrap+(n.canonical.x+e/yt)/s,(n.canonical.y+i/yt)/s))}getAtTileOffsetFunc(n,e,i,s){return c=>{const d=this.getAtTileOffset(n,c.x,c.y),f=s.upVector(n.canonical,c.x,c.y);return Tr(f,f,d*s.upVectorScale(n.canonical,e,i).metersToTile),f}}getForTilePoints(n,e,i,s){if(this.isUsingMockSource())return!1;const c=Of.create(this,n,s);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,c=1<<n.canonical.z-s.canonical.z;let d=n.canonical.x/c-s.canonical.x,f=n.canonical.y/c-s.canonical.y,_=0;for(let x=0;x<n.canonical.z-s.canonical.z&&!i.leaves[_];x++){d*=2,f*=2;const w=2*Math.floor(f)+Math.floor(d);_=i.childOffsets[_]+w,d%=1,f%=1}return{min:this.exaggeration()*i.minimums[_],max:this.exaggeration()*i.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=eo,a.EvaluationParameters=M,a.Event=Jo,a.Evented=Za,a.FillExtrusionBucket=Wh,a.Frustum=t_,a.FrustumCorners=e_,a.GLOBE_RADIUS=Do,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=Ax,a.GLOBE_ZOOM_THRESHOLD_MIN=n_,a.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_fillGridMeshWithLods(n,e){const i=new $e,s=new pt,c=[],d=n+1+2,f=e[0]+1,_=e[0]+1+(1+e.length),x=(w,S,A)=>{let P=w===d-1?w-2:w===0?w:w-1;return P+=A?24575:0,[P,S]};for(let w=0;w<d;++w)i.emplaceBack(...x(w,0,!0));for(let w=0;w<f;++w)for(let S=0;S<d;++S)i.emplaceBack(...x(S,w,(S===0||S===d-1)&&!0));for(let w=0;w<e.length;++w){const S=e[w];for(let A=0;A<d;++A)i.emplaceBack(...x(A,S,!0))}for(let w=0;w<e.length;++w){const S=s.length,A=e[w]+1+2,P=new pt;for(let F=0;F<A-1;F++){const j=F===A-2,Y=j?d*(_-e.length+w-F):d;for(let oe=0;oe<d-1;oe++){const J=F*d+oe;F===0||j||oe===0||oe===d-2?(P.emplaceBack(J+1,J,J+Y),P.emplaceBack(J+Y,J+Y+1,J+1)):(s.emplaceBack(J+1,J,J+Y),s.emplaceBack(J+Y,J+Y+1,J+1))}}const D=Nn.simpleSegment(0,S,i.length,s.length-S);for(let F=0;F<P.uint16.length;F+=3)s.emplaceBack(P.uint16[F],P.uint16[F+1],P.uint16[F+2]);const L=Nn.simpleSegment(0,S,i.length,s.length-S);c.push({withoutSkirts:D,withSkirts:L})}return{vertices:i,indices:s,segments:c}}_createGrid(n){const e=this._fillGridMeshWithLods(bl,Fh);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Bh.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new pt;for(let c=0;c<=bl;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new on,s=new on;this._poleSegments=[];for(let c=0,d=0;c<n_;c++){const f=360/(1<<c);i.emplaceBack(0,-Do,0,.5,0),s.emplaceBack(0,-Do,0,.5,1);for(let _=0;_<=bl;_++){const x=_/bl,w=$t(0,f,x),[S,A,P]=Dc(YC,JC,w,Do);i.emplaceBack(S,A,P,x,0),s.emplaceBack(S,A,P,x,1)}this._poleSegments.push(Nn.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Cx,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,Cx,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const i=new ai,s=bl,c=s+1+2,d=1;this._wireframeSegments=[];for(let f=0,_=0;f<Fh.length;f++){const x=Fh[f];for(let S=d;S<x+d;S++)for(let A=d;A<s+d;A++){const P=S*c+A;i.emplaceBack(P,P+1),i.emplaceBack(P,P+c),i.emplaceBack(P,P+c+1)}const w=x*s*3;this._wireframeSegments.push(Nn.simpleSegment(0,_,(x+1)*c,w)),_+=w}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},a.GlyphManager=Zc,a.ImagePosition=P_,a.KDBush=q_,a.LivePerformanceUtils=bg,a.LngLat=an,a.LngLatBounds=ia,a.LocalGlyphMode=z_,a.MAX_MERCATOR_LATITUDE=Ti,a.MercatorCoordinate=Bc,a.ONE_EM=fi,a.OverscaledTileID=Oi,a.PerformanceMarkers=Bs,a.Point=Be,a.Properties=ee,a.RGBAImage=cr,a.Ray=Qg,a.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ne,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!ge(n))return n;const i=et(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!ge(n))return n;const i=et(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e,i,s){if(!ge(n))return n;const c=et(n);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),i&&c.params.push(`language=${i}`),s&&c.params.push(`worldview=${s}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,s){const c=et(n);return ge(n)?(c.path=`/styles/v1${c.path}/sprite${e}${i}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${e}${i}`,He(c))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!ge(n))return n;const s=et(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&s.authority!=="raster"&&i===512?"@2x":""}${H.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${G.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${G.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(d){for(const f of d){const _=f.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(s.params)||G.ACCESS_TOKEN;return G.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(n,e){const i=et(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${G.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${G.TILE_URL_VERSION}/`,"")}`;let c=i.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(n,e){const i=!!e&&ge(e),s=[];for(const c of n.tiles||[])we(c)?s.push(this.canonicalizeTileURL(c,i)):s.push(c);return s}_makeAPIURL(n,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=et(G.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,n.protocol==="http"){const c=n.params.indexOf("secure");c>=0&&n.params.splice(c,1)}if(s.path!=="/"&&(n.path=`${s.path}${n.path}`),!G.REQUIRE_ACCESS_TOKEN)return He(n);if(e=e||G.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(c=>c.indexOf("access_token")===-1),n.params.push(`access_token=${e||""}`),He(n)}},a.ResourceType=Ho,a.SegmentVector=Nn,a.SourceCache=Al,a.StencilMode=j_,a.StructArrayLayout1ui2=ar,a.StructArrayLayout2f1f2i16=xt,a.StructArrayLayout2i4=$e,a.StructArrayLayout2ui4=ai,a.StructArrayLayout3f12=Ot,a.StructArrayLayout3ui6=pt,a.StructArrayLayout4i8=Fe,a.StructArrayLayout5f20=on,a.Texture=rd,a.Tile=U_,a.Transitionable=R,a.Uniform1f=nf,a.Uniform1i=class extends cs{constructor(n){super(n),this.current=0}set(n,e,i){this.fetchUniformLocation(n,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends cs{constructor(n){super(n),this.current=[0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},a.Uniform3f=class extends cs{constructor(n){super(n),this.current=[0,0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},a.Uniform4f=cx,a.UniformColor=ux,a.UniformMatrix2f=class extends cs{constructor(n){super(n),this.current=RC}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let s=0;s<4;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},a.UniformMatrix3f=class extends cs{constructor(n){super(n),this.current=LC}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},a.UniformMatrix4f=class extends cs{constructor(n){super(n),this.current=DC}set(n,e,i){if(this.fetchUniformLocation(n,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let s=1;s<16;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},a.UnwrappedTileID=g1,a.ValidationError=lt,a.VectorTileFeature=yf,a.VectorTileWorkerSource=class extends Za{constructor(n,e,i,s,c){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=c||Cw,this.loading={},this.loaded={},this.deduped=new Sw(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,s=n&&n.request,c=s&&s.collectResourceTiming,d=this.loading[i]=new rP(n);d.abort=this.loadVectorData(n,(f,_)=>{const x=!this.loading[i];if(delete this.loading[i],x||f||!_)return d.status="done",x||(this.loaded[i]=d),e(f);const w=_.rawData,S={};_.expires&&(S.expires=_.expires),_.cacheControl&&(S.cacheControl=_.cacheControl),d.vectorTile=_.vectorTile||new E_(new Ef(w));const A=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,D)=>{if(P||!D)return e(P);const L={};if(c){const F=Du(s);F.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(F)))}e(null,hn({rawTileData:w.slice(0)},D,S,L))})};this.isSpriteLoaded?A():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(A,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):A()}),this.loaded=this.loaded||{},this.loaded[i]=d})}reloadTile(n,e){const i=this.loaded,s=n.uid,c=this;if(i&&i[s]){const d=i[s];d.showCollisionBoxes=n.showCollisionBoxes,d.enableTerrain=!!n.enableTerrain,d.projection=n.projection,d.tileTransform=Ml(n.tileID.canonical,n.projection);const f=(_,x)=>{const w=d.reloadCallback;w&&(delete d.reloadCallback,d.parse(d.vectorTile,c.layerIndex,this.availableImages,c.actor,w)),e(_,x)};d.status==="parsing"?d.reloadCallback=f:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}}abortTile(n,e){const i=n.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,s=n.uid;i&&i[s]&&delete i[s],e()}},a.WritingMode=Sr,a.ZoomDependentExpression=cl,a.add=hs,a.addDynamicAttributes=Lf,a.adjoint=function(n,e){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],w=e[7],S=e[8];return n[0]=f*S-_*w,n[1]=c*w-s*S,n[2]=s*_-c*f,n[3]=_*x-d*S,n[4]=i*S-c*x,n[5]=c*d-i*_,n[6]=d*w-f*x,n[7]=s*x-i*w,n[8]=i*f-s*d,n},a.asyncAll=gt,a.bezier=ii,a.bindAll=yr,a.boundsAttributes=lw,a.bufferConvexPolygon=function(n,e){const i=[];for(let s=0;s<n.length;s++){const c=vt(s-1,-1,n.length-1),d=vt(s+1,-1,n.length-1),f=n[s],_=n[d],x=n[c].sub(f).unit(),w=_.sub(f).unit(),S=w.angleWithSep(x.x,x.y),A=x.add(w).unit().mult(-1*e/Math.sin(S/2));i.push(f.add(A))}return i},a.cacheEntryPossiblyAdded=function(n){Ga++,Ga>Ql&&(n.getActor().send("enforceCacheSizeLimit",Jl),Ga=0)},a.calculateGlobeLabelMatrix=function(n,e){const{x:i,y:s}=n.point,c=Dx(i,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return vl(c,c,o_(Lo(e)))},a.calculateGlobeMatrix=function(n){const{x:e,y:i}=n.point,{lng:s,lat:c}=n._center;return Dx(e,i,n.worldSize,s,c)},a.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,i=e/mo(1,n.center.lat),s=po(new Float64Array(16));return Ih(s,s,[n.point.x,n.point.y,0]),xl(s,s,[i,i,e]),Float32Array.from(s)},a.circumferenceAtLatitude=a_,a.clamp=We,a.clearTileCache=function(n){if(!ja())return;const e=I.caches.delete(Ds);n&&e.catch(n).then(()=>n())},a.clipLine=$1,a.clone=function(n){var e=new lr(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},a.clone$1=yi,a.collisionCircleLayout=nA,a.config=G,a.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},a.create=function(){var n=new lr(16);return lr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},a.create$1=px,a.createExpression=Ks,a.createLayout=ye,a.createStyleLayer=function(n){return n.type==="custom"?new WA(n):new HA[n.type](n)},a.cross=Jg,a.degToRad=bt,a.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},a.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},a.dot=Ur,a.earthRadius=Uh,a.ease=Mi,a.easeCubicInOut=vn,a.ecefToLatLng=function([n,e,i]){const s=Math.hypot(n,e,i),c=Math.atan2(n,i),d=.5*Math.PI-Math.acos(-e/s);return new an(Jt(c),Jt(d))},a.emitValidationErrors=Kp,a.endsWith=vr,a.enforceCacheSizeLimit=function(n){Xo(),nr&&nr.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-n;s++)e.delete(i[s])})})},a.evaluateSizeForFeature=bf,a.evaluateSizeForZoom=Nc,a.evaluateVariableOffset=H1,a.evented=g,a.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},a.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},a.exported=Qr,a.exported$1=H,a.extend=hn,a.extend$1=to,a.fillExtrusionHeightLift=p1,a.filterObject=Yr,a.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},a.fromQuat=function(n,e){var i=e[0],s=e[1],c=e[2],d=e[3],f=i+i,_=s+s,x=c+c,w=i*f,S=s*f,A=s*_,P=c*f,D=c*_,L=c*x,F=d*f,j=d*_,Y=d*x;return n[0]=1-A-L,n[1]=S+Y,n[2]=P-j,n[3]=0,n[4]=S-Y,n[5]=1-w-L,n[6]=D+F,n[7]=0,n[8]=P+j,n[9]=D-F,n[10]=1-w-A,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},a.fromRotation=function(n,e){var i=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},a.fromScaling=mx,a.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Tn[e]},a.getAABBPointSquareDist=function(n,e,i){let s=0;for(let c=0;c<2;++c){const d=i?i[c]:0;n[c]>d&&(s+=(n[c]-d)*(n[c]-d)),e[c]<d&&(s+=(d-e[c])*(d-e[c]))}return s},a.getAnchorAlignment=k_,a.getAnchorJustification=L_,a.getBounds=function(n){let e=1/0,i=1/0,s=-1/0,c=-1/0;for(const d of n)e=Math.min(e,d.x),i=Math.min(i,d.y),s=Math.max(s,d.x),c=Math.max(c,d.y);return{min:new Be(e,i),max:new Be(s,c)}},a.getColumn=Mo,a.getDefaultExportFromCjs=le,a.getGridMatrix=function(n,e,i,s){const c=e.getNorth(),d=e.getSouth(),f=e.getWest(),_=e.getEast(),x=1<<n.z,w=_-f,S=c-d,A=w/bl,P=-S/Fh[i],D=[0,A,0,P,0,0,c,f,0];if(n.z>0){const L=180/s;fx(D,D,[L/w+1,0,0,0,L/S+1,0,-.5*L/A,.5*L/P,1])}return D[2]=x,D[5]=n.x,D[8]=n.y,D},a.getImage=te,a.getJSON=function(n,e){return Yo(hn(n,{type:"json"}),e)},a.getLatitudinalLod=function(n){const e=Ti-5;n=We(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(bt(n))),3);return Math.round(i*(Fh.length-1))},a.getMapSessionAPI=ri,a.getPerformanceMeasurement=Du,a.getProjection=iw,a.getRTLTextPluginStatus=y,a.getReferrer=Ko,a.getTilePoint=function(n,{x:e,y:i},s=0){return new Be(((e-s)*n.scale-n.x)*yt,(i*n.scale-n.y)*yt)},a.getTileVec3=function(n,e,i=0){return zc(((e.x-i)*n.scale-n.x)*yt,(e.y*n.scale-n.y)*yt,Fx(e.z,e.y))},a.getVideo=function(n,e){const i=I.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<n.length;s++){const c=I.document.createElement("source");ec(n[s])||(i.crossOrigin="Anonymous"),c.src=n[s],i.appendChild(c)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(n){const e=[0,0,0],i=po(new Float64Array(16));return vl(i,n.pixelMatrix,n.globeMatrix),Bn(e,e,i),new Be(e[0],e[1])},a.globeDenormalizeECEF=o_,a.globeECEFOrigin=function(n,e){const i=[0,0,0];return Bn(i,i,Vh(Lo(e.canonical))),Bn(i,i,n),i},a.globeMetersToEcef=sf,a.globeNormalizeECEF=Vh,a.globePixelsToTileUnits=function(n,e){return yt/(512*Math.pow(2,n))*lf(Lo(e))},a.globePoleMatrixForTile=function(n,e,i){const s=po(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return of(s,i.globeMatrix,c),Float32Array.from(s)},a.globeTileBounds=Lo,a.globeTiltAtLngLat=Lx,a.globeToMercatorTransition=Rc,a.globeUseCustomAntiAliasing=function(n,e,i){const s=Rc(i.zoom),c=n.style.map._antialias,d=!!e.extStandardDerivatives,f=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return s===0&&!c&&!f&&d},a.identity=po,a.identity$1=Tx,a.invert=Xg,a.isFullscreen=function(){return!!I.document.fullscreenElement||!!I.document.webkitFullscreenElement},a.isLngLatBehindGlobe=s_,a.isMapAuthenticated=function(n){return Ai.has(n)},a.isMapboxURL=ge,a.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!zs(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=bi,a.latLngToECEF=Lc,a.len=$C,a.length=kh,a.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},a.lngFromMercatorX=Er,a.loadVectorTile=Cw,a.makeRequest=Yo,a.mapValue=function(n,e,i,s,c){return We((n-e)/(i-e)*(c-s)+s,s,c)},a.mercatorScale=Ox,a.mercatorXfromLng=Ro,a.mercatorYfromLat=Bo,a.mercatorZfromAltitude=mo,a.mul=jC,a.mul$1=GC,a.multiply=vl,a.multiply$1=fx,a.multiply$2=yx,a.nextPowerOfTwo=di,a.normalize=Bi,a.normalize$1=ZC,a.normalize$2=wx,a.number=$t,a.ortho=function(n,e,i,s,c,d,f){var _=1/(e-i),x=1/(s-c),w=1/(d-f);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(e+i)*_,n[13]=(c+s)*x,n[14]=(f+d)*w,n[15]=1,n},a.pbf=T1,a.perspective=function(n,e,i,s,c){var d,f=1/Math.tan(e/2);return n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+s)*(d=1/(s-c)),n[14]=2*c*s*d):(n[10]=-1,n[14]=-2*s),n},a.pick=function(n,e){const i={};for(let s=0;s<e.length;s++){const c=e[s];c in n&&(i[c]=n[c])}return i},a.plugin=E,a.pointGeometry=it,a.polesInViewport=function(n){const e=po(new Float64Array(16));vl(e,n.pixelMatrix,n.globeMatrix);const i=[0,Nr,0],s=[0,jr,0];return Bn(i,i,e),Bn(s,s,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!s_(n,new an(n.center.lat,90)),s[0]>0&&s[0]<=n.width&&s[1]>0&&s[1]<=n.height&&!s_(n,new an(n.center.lat,-90))]},a.polygonContainsPoint=Sl,a.polygonIntersectsBox=Zx,a.polygonIntersectsPolygon=Nx,a.polygonizeBounds=function(n,e,i=0,s=!0){const c=new Be(i,i),d=n.sub(c),f=e.add(c),_=[d,new Be(f.x,d.y),f,new Be(d.x,f.y)];return s&&_.push(d.clone()),_},a.posAttributes=Bh,a.postMapLoadEvent=On,a.postPerformanceEvent=Yn,a.postTurnstileEvent=Gt,a.potpack=A_,a.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},a.radToDeg=Jt,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(n){return n({pluginStatus:h,pluginURL:r}),g.on("pluginStateChange",n),n},a.removeAuthState=function(n){Ai.delete(n)},a.renderColorRamp=m_,a.resample=Vx,a.rotateX=Hg,a.rotateX$1=Ex,a.rotateY=of,a.rotateY$1=Sx,a.rotateZ=function(n,e,i){var s=Math.sin(i),c=Math.cos(i),d=e[0],f=e[1],_=e[2],x=e[3],w=e[4],S=e[5],A=e[6],P=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c+w*s,n[1]=f*c+S*s,n[2]=_*c+A*s,n[3]=x*c+P*s,n[4]=w*c-d*s,n[5]=S*c-f*s,n[6]=A*c-_*s,n[7]=P*c-x*s,n},a.rotateZ$1=function(n,e,i){i*=.5;var s=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(i),x=Math.cos(i);return n[0]=s*x+c*_,n[1]=c*x-s*_,n[2]=d*x+f*_,n[3]=f*x-d*_,n},a.scale=xl,a.scale$1=xx,a.scale$2=Tr,a.scaleAndAdd=Lh,a.set=function(n,e,i,s){return n[0]=e,n[1]=i,n[2]=s,n},a.setCacheLimits=function(n,e){Jl=n,Ql=e},a.setColumn=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},a.setRTLTextPlugin=function(n,e,i=!1){if(h===Sh||h===Ch||h===Mh)throw new Error("setRTLTextPlugin cannot be called multiple times.");r=Qr.resolveURL(n),h=Sh,ea=e,p(),i||T()},a.smoothstep=Et,a.spec=De,a.squaredLength=function(n){var e=n[0],i=n[1],s=n[2];return e*e+i*i+s*s},a.storeAuthState=function(n,e){e?Ai.add(n):Ai.delete(n)},a.sub=fo,a.subtract=Yg,a.symbolSize=iA,a.tileAABB=function(n,e,i,s,c,d,f,_,x){if(x.name==="globe")return KC(n,e,new xf(i,s,c));const w=Ml({z:i,x:s,y:c},x);return new Fi([(d+w.x/w.scale)*e,e*(w.y/w.scale),f],[(d+w.x2/w.scale)*e,e*(w.y2/w.scale),_])},a.tileCornersToBounds=af,a.tileTransform=Ml,a.transformMat3=function(n,e,i){var s=e[0],c=e[1],d=e[2];return n[0]=s*i[0]+c*i[3]+d*i[6],n[1]=s*i[1]+c*i[4]+d*i[7],n[2]=s*i[2]+c*i[5]+d*i[8],n},a.transformMat4=Bn,a.transformMat4$1=wl,a.transformQuat=vx,a.transitionTileAABBinECEF=Ix,a.translate=Ih,a.transpose=function(n,e){if(n===e){var i=e[1],s=e[2],c=e[5];n[1]=e[3],n[2]=e[6],n[3]=i,n[5]=e[7],n[6]=s,n[7]=c}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},a.triggerPluginCompletionEvent=l,a.uniqueId=Zi,a.updateGlobeVertexNormal=function(n,e,i,s,c){const d=5*e+2;n.float32[d+0]=i,n.float32[d+1]=s,n.float32[d+2]=c},a.validateCustomStyleLayer=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFilter=n=>sr(fl(n)),a.validateFog=n=>sr(Wp(n)),a.validateLayer=n=>sr(Gp(n)),a.validateLight=n=>sr(qp(n)),a.validateSource=n=>sr(Zp(n)),a.validateStyle=Hp,a.validateTerrain=n=>sr(xh(n)),a.values=Qt,a.vectorTile=_f,a.version=O,a.warnOnce=En,a.window=I,a.wrap=vt}),b(["./shared"],function(a){function I(re){if(typeof re=="number"||typeof re=="boolean"||typeof re=="string"||re==null)return JSON.stringify(re);if(Array.isArray(re)){let U="[";for(const te of re)U+=`${I(te)},`;return`${U}]`}let V="{";for(const U of Object.keys(re).sort())V+=`${U}:${I(re[U])},`;return`${V}}`}function O(re){let V="";for(const U of a.refProperties)V+=`/${I(re[U])}`;return V}class q{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,U){for(const ce of V)this._layerConfigs[ce.id]=ce,(this._layers[ce.id]=a.createStyleLayer(ce)).compileFilter(),this.keyCache[ce.id]&&delete this.keyCache[ce.id];for(const ce of U)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const te=function(ce,ge){const we={};for(let fe=0;fe<ce.length;fe++){const Pe=ge&&ge[ce[fe].id]||O(ce[fe]);ge&&(ge[ce[fe].id]=Pe);let Je=we[Pe];Je||(Je=we[Pe]=[]),Je.push(ce[fe])}const xe=[];for(const fe in we)xe.push(we[fe]);return xe}(a.values(this._layerConfigs),this.keyCache);for(const ce of te){const ge=ce.map(et=>this._layers[et.id]),we=ge[0];if(we.visibility==="none")continue;const xe=we.source||"";let fe=this.familiesBySource[xe];fe||(fe=this.familiesBySource[xe]={});const Pe=we.sourceLayer||"_geojsonTileLayer";let Je=fe[Pe];Je||(Je=fe[Pe]=[]),Je.push(ge)}}}class G{loadTile(V,U){const{uid:te,encoding:ce,rawImageData:ge,padding:we,buildQuadTree:xe}=V,fe=a.window.ImageBitmap&&ge instanceof a.window.ImageBitmap?this.getImageData(ge,we):ge;U(null,new a.DEMData(te,fe,ce,we<1,xe))}getImageData(V,U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const te=this.offscreenCanvasContext.getImageData(-U,-U,V.width+2*U,V.height+2*U);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),te}}function H(re,V){if(re.length!==0){ue(re[0],V);for(var U=1;U<re.length;U++)ue(re[U],!V)}}function ue(re,V){for(var U=0,te=0,ce=0,ge=re.length,we=ge-1;ce<ge;we=ce++){var xe=(re[ce][0]-re[we][0])*(re[we][1]+re[ce][1]),fe=U+xe;te+=Math.abs(U)>=Math.abs(xe)?U-fe+xe:xe-fe+U,U=fe}U+te>=0!=!!V&&re.reverse()}var _e=a.getDefaultExportFromCjs(function re(V,U){var te,ce=V&&V.type;if(ce==="FeatureCollection")for(te=0;te<V.features.length;te++)re(V.features[te],U);else if(ce==="GeometryCollection")for(te=0;te<V.geometries.length;te++)re(V.geometries[te],U);else if(ce==="Feature")re(V.geometry,U);else if(ce==="Polygon")H(V.coordinates,U);else if(ce==="MultiPolygon")for(te=0;te<V.coordinates.length;te++)H(V.coordinates[te],U);return V});const Ie=a.VectorTileFeature.prototype.toGeoJSON;var at={exports:{}},me=a.pointGeometry,ne=a.vectorTile.VectorTileFeature,le=ke;function ke(re,V){this.options=V||{},this.features=re,this.length=re.length}function je(re,V){this.id=typeof re.id=="number"?re.id:void 0,this.type=re.type,this.rawGeometry=re.type===1?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=V||4096}ke.prototype.feature=function(re){return new je(this.features[re],this.options.extent)},je.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var V=0;V<re.length;V++){for(var U=re[V],te=[],ce=0;ce<U.length;ce++)te.push(new me(U[ce][0],U[ce][1]));this.geometry.push(te)}return this.geometry},je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,V=1/0,U=-1/0,te=1/0,ce=-1/0,ge=0;ge<re.length;ge++)for(var we=re[ge],xe=0;xe<we.length;xe++){var fe=we[xe];V=Math.min(V,fe.x),U=Math.max(U,fe.x),te=Math.min(te,fe.y),ce=Math.max(ce,fe.y)}return[V,te,U,ce]},je.prototype.toGeoJSON=ne.prototype.toGeoJSON;var ct=a.pbf,it=le;function Qe(re){var V=new ct;return function(U,te){for(var ce in U.layers)te.writeMessage(3,Be,U.layers[ce])}(re,V),V.finish()}function Be(re,V){var U;V.writeVarintField(15,re.version||1),V.writeStringField(1,re.name||""),V.writeVarintField(5,re.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<re.length;U++)te.feature=re.feature(U),V.writeMessage(2,St,te);var ce=te.keys;for(U=0;U<ce.length;U++)V.writeStringField(3,ce[U]);var ge=te.values;for(U=0;U<ge.length;U++)V.writeMessage(4,vn,ge[U])}function St(re,V){var U=re.feature;U.id!==void 0&&V.writeVarintField(1,U.id),V.writeMessage(2,bn,re),V.writeVarintField(3,U.type),V.writeMessage(4,Tn,U)}function bn(re,V){var U=re.feature,te=re.keys,ce=re.values,ge=re.keycache,we=re.valuecache;for(var xe in U.properties){var fe=U.properties[xe],Pe=ge[xe];if(fe!==null){Pe===void 0&&(te.push(xe),ge[xe]=Pe=te.length-1),V.writeVarint(Pe);var Je=typeof fe;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(fe=JSON.stringify(fe));var et=Je+":"+fe,He=we[et];He===void 0&&(ce.push(fe),we[et]=He=ce.length-1),V.writeVarint(He)}}}function bt(re,V){return(V<<3)+(7&re)}function Jt(re){return re<<1^re>>31}function Tn(re,V){for(var U=re.loadGeometry(),te=re.type,ce=0,ge=0,we=U.length,xe=0;xe<we;xe++){var fe=U[xe],Pe=1;te===1&&(Pe=fe.length),V.writeVarint(bt(1,Pe));for(var Je=te===3?fe.length-1:fe.length,et=0;et<Je;et++){et===1&&te!==1&&V.writeVarint(bt(2,Je-1));var He=fe[et].x-ce,It=fe[et].y-ge;V.writeVarint(Jt(He)),V.writeVarint(Jt(It)),ce+=He,ge+=It}te===3&&V.writeVarint(bt(7,1))}}function vn(re,V){var U=typeof re;U==="string"?V.writeStringField(1,re):U==="boolean"?V.writeBooleanField(7,re):U==="number"&&(re%1!=0?V.writeDoubleField(3,re):re<0?V.writeSVarintField(6,re):V.writeVarintField(5,re))}at.exports=Qe,at.exports.fromVectorTileJs=Qe,at.exports.fromGeojsonVt=function(re,V){V=V||{};var U={};for(var te in re)U[te]=new it(re[te].features,V),U[te].name=te,U[te].version=V.version,U[te].extent=V.extent;return Qe({layers:U})},at.exports.GeoJSONWrapper=it;var ii=a.getDefaultExportFromCjs(at.exports);const Mi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},We=Math.fround||(Et=new Float32Array(1),re=>(Et[0]=+re,Et[0]));var Et;const vt=3,gt=5,Qt=6;class hn{constructor(V){this.options=Object.assign(Object.create(Mi),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:U,minZoom:te,maxZoom:ce}=this.options;U&&console.time("total time");const ge=`prepare ${V.length} points`;U&&console.time(ge),this.points=V;const we=[];for(let fe=0;fe<V.length;fe++){const Pe=V[fe];if(!Pe.geometry)continue;const[Je,et]=Pe.geometry.coordinates,He=We(Ln(Je)),It=We(di(et));we.push(He,It,1/0,fe,-1,1),this.options.reduce&&we.push(0)}let xe=this.trees[ce+1]=this._createTree(we);U&&console.timeEnd(ge);for(let fe=ce;fe>=te;fe--){const Pe=+Date.now();xe=this.trees[fe]=this._createTree(this._cluster(xe,fe)),U&&console.log("z%d: %d clusters in %dms",fe,xe.numItems,+Date.now()-Pe)}return U&&console.timeEnd("total time"),this}getClusters(V,U){let te=((V[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,V[1]));let ge=V[2]===180?180:((V[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)te=-180,ge=180;else if(te>ge){const et=this.getClusters([te,ce,180,we],U),He=this.getClusters([-180,ce,ge,we],U);return et.concat(He)}const xe=this.trees[this._limitZoom(U)],fe=xe.range(Ln(te),di(we),Ln(ge),di(ce)),Pe=xe.data,Je=[];for(const et of fe){const He=this.stride*et;Je.push(Pe[He+gt]>1?ti(Pe,He,this.clusterProps):this.points[Pe[He+vt]])}return Je}getChildren(V){const U=this._getOriginId(V),te=this._getOriginZoom(V),ce="No cluster with the specified id.",ge=this.trees[te];if(!ge)throw new Error(ce);const we=ge.data;if(U*this.stride>=we.length)throw new Error(ce);const xe=this.options.radius/(this.options.extent*Math.pow(2,te-1)),fe=ge.within(we[U*this.stride],we[U*this.stride+1],xe),Pe=[];for(const Je of fe){const et=Je*this.stride;we[et+4]===V&&Pe.push(we[et+gt]>1?ti(we,et,this.clusterProps):this.points[we[et+vt]])}if(Pe.length===0)throw new Error(ce);return Pe}getLeaves(V,U,te){const ce=[];return this._appendLeaves(ce,V,U=U||10,te=te||0,0),ce}getTile(V,U,te){const ce=this.trees[this._limitZoom(V)],ge=Math.pow(2,V),{extent:we,radius:xe}=this.options,fe=xe/we,Pe=(te-fe)/ge,Je=(te+1+fe)/ge,et={features:[]};return this._addTileFeatures(ce.range((U-fe)/ge,Pe,(U+1+fe)/ge,Je),ce.data,U,te,ge,et),U===0&&this._addTileFeatures(ce.range(1-fe/ge,Pe,1,Je),ce.data,ge,te,ge,et),U===ge-1&&this._addTileFeatures(ce.range(0,Pe,fe/ge,Je),ce.data,-1,te,ge,et),et.features.length?et:null}getClusterExpansionZoom(V){let U=this._getOriginZoom(V)-1;for(;U<=this.options.maxZoom;){const te=this.getChildren(V);if(U++,te.length!==1)break;V=te[0].properties.cluster_id}return U}_appendLeaves(V,U,te,ce,ge){const we=this.getChildren(U);for(const xe of we){const fe=xe.properties;if(fe&&fe.cluster?ge+fe.point_count<=ce?ge+=fe.point_count:ge=this._appendLeaves(V,fe.cluster_id,te,ce,ge):ge<ce?ge++:V.push(xe),V.length===te)break}return ge}_createTree(V){const U=new a.KDBush(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<V.length;te+=this.stride)U.add(V[te],V[te+1]);return U.finish(),U.data=V,U}_addTileFeatures(V,U,te,ce,ge,we){for(const xe of V){const fe=xe*this.stride,Pe=U[fe+gt]>1;let Je,et,He;if(Pe)Je=Zi(U,fe,this.clusterProps),et=U[fe],He=U[fe+1];else{const kt=this.points[U[fe+vt]];Je=kt.properties;const[Ft,Gt]=kt.geometry.coordinates;et=Ln(Ft),He=di(Gt)}const It={type:1,geometry:[[Math.round(this.options.extent*(et*ge-te)),Math.round(this.options.extent*(He*ge-ce))]],tags:Je};let Bt;Bt=Pe||this.options.generateId?U[fe+vt]:this.points[U[fe+vt]].id,Bt!==void 0&&(It.id=Bt),we.features.push(It)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,U){const{radius:te,extent:ce,reduce:ge,minPoints:we}=this.options,xe=te/(ce*Math.pow(2,U)),fe=V.data,Pe=[],Je=this.stride;for(let et=0;et<fe.length;et+=Je){if(fe[et+2]<=U)continue;fe[et+2]=U;const He=fe[et],It=fe[et+1],Bt=V.within(fe[et],fe[et+1],xe),kt=fe[et+gt];let Ft=kt;for(const Gt of Bt){const Sn=Gt*Je;fe[Sn+2]>U&&(Ft+=fe[Sn+gt])}if(Ft>kt&&Ft>=we){let Gt,Sn=He*kt,On=It*kt,vi=-1;const Yn=((et/Je|0)<<5)+(U+1)+this.points.length;for(const Dr of Bt){const ri=Dr*Je;if(fe[ri+2]<=U)continue;fe[ri+2]=U;const Ai=fe[ri+gt];Sn+=fe[ri]*Ai,On+=fe[ri+1]*Ai,fe[ri+4]=Yn,ge&&(Gt||(Gt=this._map(fe,et,!0),vi=this.clusterProps.length,this.clusterProps.push(Gt)),ge(Gt,this._map(fe,ri)))}fe[et+4]=Yn,Pe.push(Sn/Ft,On/Ft,1/0,Yn,-1,Ft),ge&&Pe.push(vi)}else{for(let Gt=0;Gt<Je;Gt++)Pe.push(fe[et+Gt]);if(Ft>1)for(const Gt of Bt){const Sn=Gt*Je;if(!(fe[Sn+2]<=U)){fe[Sn+2]=U;for(let On=0;On<Je;On++)Pe.push(fe[Sn+On])}}}}return Pe}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,U,te){if(V[U+gt]>1){const we=this.clusterProps[V[U+Qt]];return te?Object.assign({},we):we}const ce=this.points[V[U+vt]].properties,ge=this.options.map(ce);return te&&ge===ce?Object.assign({},ge):ge}}function ti(re,V,U){return{type:"Feature",id:re[V+vt],properties:Zi(re,V,U),geometry:{type:"Point",coordinates:[(te=re[V],360*(te-.5)),ks(re[V+1])]}};var te}function Zi(re,V,U){const te=re[V+gt],ce=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,ge=re[V+Qt],we=ge===-1?{}:Object.assign({},U[ge]);return Object.assign(we,{cluster:!0,cluster_id:re[V+vt],point_count:te,point_count_abbreviated:ce})}function Ln(re){return re/360+.5}function di(re){const V=Math.sin(re*Math.PI/180),U=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return U<0?0:U>1?1:U}function ks(re){const V=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function yr(re,V,U,te){for(var ce,ge=te,we=U-V>>1,xe=U-V,fe=re[V],Pe=re[V+1],Je=re[U],et=re[U+1],He=V+3;He<U;He+=3){var It=vr(re[He],re[He+1],fe,Pe,Je,et);if(It>ge)ce=He,ge=It;else if(It===ge){var Bt=Math.abs(He-we);Bt<xe&&(ce=He,xe=Bt)}}ge>te&&(ce-V>3&&yr(re,V,ce,te),re[ce+2]=ge,U-ce>3&&yr(re,ce,U,te))}function vr(re,V,U,te,ce,ge){var we=ce-U,xe=ge-te;if(we!==0||xe!==0){var fe=((re-U)*we+(V-te)*xe)/(we*we+xe*xe);fe>1?(U=ce,te=ge):fe>0&&(U+=we*fe,te+=xe*fe)}return(we=re-U)*we+(xe=V-te)*xe}function Pt(re,V,U,te){var ce={id:re===void 0?null:re,type:V,geometry:U,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var we=ge.geometry,xe=ge.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Yr(ge,we);else if(xe==="Polygon"||xe==="MultiLineString")for(var fe=0;fe<we.length;fe++)Yr(ge,we[fe]);else if(xe==="MultiPolygon")for(fe=0;fe<we.length;fe++)for(var Pe=0;Pe<we[fe].length;Pe++)Yr(ge,we[fe][Pe])}(ce),ce}function Yr(re,V){for(var U=0;U<V.length;U+=3)re.minX=Math.min(re.minX,V[U]),re.minY=Math.min(re.minY,V[U+1]),re.maxX=Math.max(re.maxX,V[U]),re.maxY=Math.max(re.maxY,V[U+1])}function yi(re,V,U,te){if(V.geometry){var ce=V.geometry.coordinates,ge=V.geometry.type,we=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),xe=[],fe=V.id;if(U.promoteId?fe=V.properties[U.promoteId]:U.generateId&&(fe=te||0),ge==="Point")Va(ce,xe);else if(ge==="MultiPoint")for(var Pe=0;Pe<ce.length;Pe++)Va(ce[Pe],xe);else if(ge==="LineString")En(ce,xe,we,!1);else if(ge==="MultiLineString"){if(U.lineMetrics){for(Pe=0;Pe<ce.length;Pe++)En(ce[Pe],xe=[],we,!1),re.push(Pt(fe,"LineString",xe,V.properties));return}tr(ce,xe,we,!1)}else if(ge==="Polygon")tr(ce,xe,we,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(Pe=0;Pe<V.geometry.geometries.length;Pe++)yi(re,{id:fe,geometry:V.geometry.geometries[Pe],properties:V.properties},U,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Pe=0;Pe<ce.length;Pe++){var Je=[];tr(ce[Pe],Je,we,!0),xe.push(Je)}}re.push(Pt(fe,ge,xe,V.properties))}}function Va(re,V){V.push(Yl(re[0])),V.push(Jr(re[1])),V.push(0)}function En(re,V,U,te){for(var ce,ge,we=0,xe=0;xe<re.length;xe++){var fe=Yl(re[xe][0]),Pe=Jr(re[xe][1]);V.push(fe),V.push(Pe),V.push(0),xe>0&&(we+=te?(ce*Pe-fe*ge)/2:Math.sqrt(Math.pow(fe-ce,2)+Math.pow(Pe-ge,2))),ce=fe,ge=Pe}var Je=V.length-3;V[2]=1,yr(V,0,Je,U),V[Je+2]=1,V.size=Math.abs(we),V.start=0,V.end=V.size}function tr(re,V,U,te){for(var ce=0;ce<re.length;ce++){var ge=[];En(re[ce],ge,U,te),V.push(ge)}}function Yl(re){return re/360+.5}function Jr(re){var V=Math.sin(re*Math.PI/180),U=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return U<0?0:U>1?1:U}function qi(re,V,U,te,ce,ge,we,xe){if(te/=V,ge>=(U/=V)&&we<te)return re;if(we<U||ge>=te)return null;for(var fe=[],Pe=0;Pe<re.length;Pe++){var Je=re[Pe],et=Je.geometry,He=Je.type,It=ce===0?Je.minX:Je.minY,Bt=ce===0?Je.maxX:Je.maxY;if(It>=U&&Bt<te)fe.push(Je);else if(!(Bt<U||It>=te)){var kt=[];if(He==="Point"||He==="MultiPoint")Ua(et,kt,U,te,ce);else if(He==="LineString")zs(et,kt,U,te,ce,!1,xe.lineMetrics);else if(He==="MultiLineString")Mo(et,kt,U,te,ce,!1);else if(He==="Polygon")Mo(et,kt,U,te,ce,!0);else if(He==="MultiPolygon")for(var Ft=0;Ft<et.length;Ft++){var Gt=[];Mo(et[Ft],Gt,U,te,ce,!0),Gt.length&&kt.push(Gt)}if(kt.length){if(xe.lineMetrics&&He==="LineString"){for(Ft=0;Ft<kt.length;Ft++)fe.push(Pt(Je.id,He,kt[Ft],Je.tags));continue}He!=="LineString"&&He!=="MultiLineString"||(kt.length===1?(He="LineString",kt=kt[0]):He="MultiLineString"),He!=="Point"&&He!=="MultiPoint"||(He=kt.length===3?"Point":"MultiPoint"),fe.push(Pt(Je.id,He,kt,Je.tags))}}}return fe.length?fe:null}function Ua(re,V,U,te,ce){for(var ge=0;ge<re.length;ge+=3){var we=re[ge+ce];we>=U&&we<=te&&(V.push(re[ge]),V.push(re[ge+1]),V.push(re[ge+2]))}}function zs(re,V,U,te,ce,ge,we){for(var xe,fe,Pe=Na(re),Je=ce===0?Jl:Ql,et=re.start,He=0;He<re.length-3;He+=3){var It=re[He],Bt=re[He+1],kt=re[He+2],Ft=re[He+3],Gt=re[He+4],Sn=ce===0?It:Bt,On=ce===0?Ft:Gt,vi=!1;we&&(xe=Math.sqrt(Math.pow(It-Ft,2)+Math.pow(Bt-Gt,2))),Sn<U?On>U&&(fe=Je(Pe,It,Bt,Ft,Gt,U),we&&(Pe.start=et+xe*fe)):Sn>te?On<te&&(fe=Je(Pe,It,Bt,Ft,Gt,te),we&&(Pe.start=et+xe*fe)):Ds(Pe,It,Bt,kt),On<U&&Sn>=U&&(fe=Je(Pe,It,Bt,Ft,Gt,U),vi=!0),On>te&&Sn<=te&&(fe=Je(Pe,It,Bt,Ft,Gt,te),vi=!0),!ge&&vi&&(we&&(Pe.end=et+xe*fe),V.push(Pe),Pe=Na(re)),we&&(et+=xe)}var Yn=re.length-3;It=re[Yn],Bt=re[Yn+1],kt=re[Yn+2],(Sn=ce===0?It:Bt)>=U&&Sn<=te&&Ds(Pe,It,Bt,kt),Yn=Pe.length-3,ge&&Yn>=3&&(Pe[Yn]!==Pe[0]||Pe[Yn+1]!==Pe[1])&&Ds(Pe,Pe[0],Pe[1],Pe[2]),Pe.length&&V.push(Pe)}function Na(re){var V=[];return V.size=re.size,V.start=re.start,V.end=re.end,V}function Mo(re,V,U,te,ce,ge){for(var we=0;we<re.length;we++)zs(re[we],V,U,te,ce,ge,!1)}function Ds(re,V,U,te){re.push(V),re.push(U),re.push(te)}function Jl(re,V,U,te,ce,ge){var we=(ge-V)/(te-V);return re.push(ge),re.push(U+(ce-U)*we),re.push(1),we}function Ql(re,V,U,te,ce,ge){var we=(ge-U)/(ce-U);return re.push(V+(te-V)*we),re.push(ge),re.push(1),we}function nr(re,V){for(var U=[],te=0;te<re.length;te++){var ce,ge=re[te],we=ge.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")ce=Ao(ge.geometry,V);else if(we==="MultiLineString"||we==="Polygon"){ce=[];for(var xe=0;xe<ge.geometry.length;xe++)ce.push(Ao(ge.geometry[xe],V))}else if(we==="MultiPolygon")for(ce=[],xe=0;xe<ge.geometry.length;xe++){for(var fe=[],Pe=0;Pe<ge.geometry[xe].length;Pe++)fe.push(Ao(ge.geometry[xe][Pe],V));ce.push(fe)}U.push(Pt(ge.id,we,ce,ge.tags))}return U}function Ao(re,V){var U=[];U.size=re.size,re.start!==void 0&&(U.start=re.start,U.end=re.end);for(var te=0;te<re.length;te+=3)U.push(re[te]+V,re[te+1],re[te+2]);return U}function ja(re,V){if(re.transformed)return re;var U,te,ce,ge=1<<re.z,we=re.x,xe=re.y;for(U=0;U<re.features.length;U++){var fe=re.features[U],Pe=fe.geometry,Je=fe.type;if(fe.geometry=[],Je===1)for(te=0;te<Pe.length;te+=2)fe.geometry.push(Xo(Pe[te],Pe[te+1],V,ge,we,xe));else for(te=0;te<Pe.length;te++){var et=[];for(ce=0;ce<Pe[te].length;ce+=2)et.push(Xo(Pe[te][ce],Pe[te][ce+1],V,ge,we,xe));fe.geometry.push(et)}}return re.transformed=!0,re}function Xo(re,V,U,te,ce,ge){return[Math.round(U*(re*te-ce)),Math.round(U*(V*te-ge))]}function Ls(re,V,U,te,ce){for(var ge=V===ce.maxZoom?0:ce.tolerance/((1<<V)*ce.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:te,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xe=0;xe<re.length;xe++){we.numFeatures++,Ga(we,re[xe],ge,ce);var fe=re[xe].minX,Pe=re[xe].minY,Je=re[xe].maxX,et=re[xe].maxY;fe<we.minX&&(we.minX=fe),Pe<we.minY&&(we.minY=Pe),Je>we.maxX&&(we.maxX=Je),et>we.maxY&&(we.maxY=et)}return we}function Ga(re,V,U,te){var ce=V.geometry,ge=V.type,we=[];if(ge==="Point"||ge==="MultiPoint")for(var xe=0;xe<ce.length;xe+=3)we.push(ce[xe]),we.push(ce[xe+1]),re.numPoints++,re.numSimplified++;else if(ge==="LineString")Ho(we,ce,re,U,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(xe=0;xe<ce.length;xe++)Ho(we,ce[xe],re,U,ge==="Polygon",xe===0);else if(ge==="MultiPolygon")for(var fe=0;fe<ce.length;fe++){var Pe=ce[fe];for(xe=0;xe<Pe.length;xe++)Ho(we,Pe[xe],re,U,!0,xe===0)}if(we.length){var Je=V.tags||null;if(ge==="LineString"&&te.lineMetrics){for(var et in Je={},V.tags)Je[et]=V.tags[et];Je.mapbox_clip_start=ce.start/ce.size,Je.mapbox_clip_end=ce.end/ce.size}var He={geometry:we,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:Je};V.id!==null&&(He.id=V.id),re.features.push(He)}}function Ho(re,V,U,te,ce,ge){var we=te*te;if(te>0&&V.size<(ce?we:te))U.numPoints+=V.length/3;else{for(var xe=[],fe=0;fe<V.length;fe+=3)(te===0||V[fe+2]>we)&&(U.numSimplified++,xe.push(V[fe]),xe.push(V[fe+1])),U.numPoints++;ce&&function(Pe,Je){for(var et=0,He=0,It=Pe.length,Bt=It-2;He<It;Bt=He,He+=2)et+=(Pe[He]-Pe[Bt])*(Pe[He+1]+Pe[Bt+1]);if(et>0===Je)for(He=0,It=Pe.length;He<It/2;He+=2){var kt=Pe[He],Ft=Pe[He+1];Pe[He]=Pe[It-2-He],Pe[He+1]=Pe[It-1-He],Pe[It-2-He]=kt,Pe[It-1-He]=Ft}}(xe,ge),re.push(xe)}}function Po(re,V){var U=(V=this.options=function(ce,ge){for(var we in ge)ce[we]=ge[we];return ce}(Object.create(this.options),V)).debug;if(U&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var te=function(ce,ge){var we=[];if(ce.type==="FeatureCollection")for(var xe=0;xe<ce.features.length;xe++)yi(we,ce.features[xe],ge,xe);else yi(we,ce.type==="Feature"?ce:{geometry:ce},ge);return we}(re,V);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(ce,ge){var we=ge.buffer/ge.extent,xe=ce,fe=qi(ce,1,-1-we,we,0,-1,2,ge),Pe=qi(ce,1,1-we,2+we,0,-1,2,ge);return(fe||Pe)&&(xe=qi(ce,1,-we,1+we,0,-1,2,ge)||[],fe&&(xe=nr(fe,1).concat(xe)),Pe&&(xe=xe.concat(nr(Pe,-1)))),xe}(te,V),te.length&&this.splitTile(te,0,0,0),U&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ko(re,V,U){return 32*((1<<re)*U+V)+re}function Yo(re,V){const U=re.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const te=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!te)return V(null,null);const ce=new class{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=we.length,this._features=we}feature(we){return new class{constructor(xe){this._feature=xe,this.extent=a.EXTENT,this.type=xe.type,this.properties=xe.tags,"id"in xe&&!isNaN(xe.id)&&(this.id=parseInt(xe.id,10))}loadGeometry(){if(this._feature.type===1){const xe=[];for(const fe of this._feature.geometry)xe.push([new a.Point(fe[0],fe[1])]);return xe}{const xe=[];for(const fe of this._feature.geometry){const Pe=[];for(const Je of fe)Pe.push(new a.Point(Je[0],Je[1]));xe.push(Pe)}return xe}}toGeoJSON(xe,fe,Pe){return Ie.call(this,xe,fe,Pe)}}(this._features[we])}}(te.features);let ge=ii(ce);ge.byteOffset===0&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),V(null,{vectorTile:ce,rawData:ge.buffer})}Po.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Po.prototype.splitTile=function(re,V,U,te,ce,ge,we){for(var xe=[re,V,U,te],fe=this.options,Pe=fe.debug;xe.length;){te=xe.pop(),U=xe.pop(),V=xe.pop(),re=xe.pop();var Je=1<<V,et=Ko(V,U,te),He=this.tiles[et];if(!He&&(Pe>1&&console.time("creation"),He=this.tiles[et]=Ls(re,V,U,te,fe),this.tileCoords.push({z:V,x:U,y:te}),Pe)){Pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,U,te,He.numFeatures,He.numPoints,He.numSimplified),console.timeEnd("creation"));var It="z"+V;this.stats[It]=(this.stats[It]||0)+1,this.total++}if(He.source=re,ce){if(V===fe.maxZoom||V===ce)continue;var Bt=1<<ce-V;if(U!==Math.floor(ge/Bt)||te!==Math.floor(we/Bt))continue}else if(V===fe.indexMaxZoom||He.numPoints<=fe.indexMaxPoints)continue;if(He.source=null,re.length!==0){Pe>1&&console.time("clipping");var kt,Ft,Gt,Sn,On,vi,Yn=.5*fe.buffer/fe.extent,Dr=.5-Yn,ri=.5+Yn,Ai=1+Yn;kt=Ft=Gt=Sn=null,On=qi(re,Je,U-Yn,U+ri,0,He.minX,He.maxX,fe),vi=qi(re,Je,U+Dr,U+Ai,0,He.minX,He.maxX,fe),re=null,On&&(kt=qi(On,Je,te-Yn,te+ri,1,He.minY,He.maxY,fe),Ft=qi(On,Je,te+Dr,te+Ai,1,He.minY,He.maxY,fe),On=null),vi&&(Gt=qi(vi,Je,te-Yn,te+ri,1,He.minY,He.maxY,fe),Sn=qi(vi,Je,te+Dr,te+Ai,1,He.minY,He.maxY,fe),vi=null),Pe>1&&console.timeEnd("clipping"),xe.push(kt||[],V+1,2*U,2*te),xe.push(Ft||[],V+1,2*U,2*te+1),xe.push(Gt||[],V+1,2*U+1,2*te),xe.push(Sn||[],V+1,2*U+1,2*te+1)}}},Po.prototype.getTile=function(re,V,U){var te=this.options,ce=te.extent,ge=te.debug;if(re<0||re>24)return null;var we=1<<re,xe=Ko(re,V=(V%we+we)%we,U);if(this.tiles[xe])return ja(this.tiles[xe],ce);ge>1&&console.log("drilling down to z%d-%d-%d",re,V,U);for(var fe,Pe=re,Je=V,et=U;!fe&&Pe>0;)Pe--,Je=Math.floor(Je/2),et=Math.floor(et/2),fe=this.tiles[Ko(Pe,Je,et)];return fe&&fe.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Pe,Je,et),ge>1&&console.time("drilling down"),this.splitTile(fe.source,Pe,Je,et,re,V,U),ge>1&&console.timeEnd("drilling down"),this.tiles[xe]?ja(this.tiles[xe],ce):null):null};class Rs extends a.VectorTileWorkerSource{constructor(V,U,te,ce,ge){super(V,U,te,ce,Yo),ge&&(this.loadGeoJSON=ge)}loadData(V,U){const te=V&&V.request,ce=te&&te.collectResourceTiming;this.loadGeoJSON(V,(ge,we)=>{if(ge||!we)return U(ge);if(typeof we!="object")return U(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{_e(we,!0);try{if(V.filter){const fe=a.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(fe.result==="error")throw new Error(fe.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(Je=>fe.value.evaluate({zoom:0},Je))}}this._geoJSONIndex=V.cluster?new hn(function({superclusterOptions:fe,clusterProperties:Pe}){if(!Pe||!fe)return fe;const Je={},et={},He={accumulated:null,zoom:0},It={properties:null},Bt=Object.keys(Pe);for(const kt of Bt){const[Ft,Gt]=Pe[kt],Sn=a.createExpression(Gt),On=a.createExpression(typeof Ft=="string"?[Ft,["accumulated"],["get",kt]]:Ft);Je[kt]=Sn.value,et[kt]=On.value}return fe.map=kt=>{It.properties=kt;const Ft={};for(const Gt of Bt)Ft[Gt]=Je[Gt].evaluate(He,It);return Ft},fe.reduce=(kt,Ft)=>{It.properties=Ft;for(const Gt of Bt)He.accumulated=kt[Gt],kt[Gt]=et[Gt].evaluate(He,It)},fe}(V)).load(we.features):function(fe,Pe){return new Po(fe,Pe)}(we,V.geojsonVtOptions)}catch(fe){return U(fe)}this.loaded={};const xe={};if(ce){const fe=a.getPerformanceMeasurement(te);fe&&(xe.resourceTiming={},xe.resourceTiming[V.source]=JSON.parse(JSON.stringify(fe)))}U(null,xe)}})}reloadTile(V,U){const te=this.loaded;return te&&te[V.uid]?super.reloadTile(V,U):this.loadTile(V,U)}loadGeoJSON(V,U){if(V.request)a.getJSON(V.request,U);else{if(typeof V.data!="string")return U(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse(V.data))}catch{return U(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(te){U(te)}}getClusterChildren(V,U){try{U(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(te){U(te)}}getClusterLeaves(V,U){try{U(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(te){U(te)}}}class ec{constructor(V){this.self=V,this.actor=new a.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:Rs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,te)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=te},this.self.registerRTLTextPlugin=U=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=U.applyArabicShaping,a.plugin.processBidirectionalText=U.processBidirectionalText,a.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}clearCaches(V,U,te){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],te()}checkIfReady(V,U,te){te()}setReferrer(V,U){this.referrer=U}spriteLoaded(V,U){this.isSpriteLoaded[V]=U;for(const te in this.workerSources[V]){const ce=this.workerSources[V][te];for(const ge in ce)ce[ge]instanceof a.VectorTileWorkerSource&&(ce[ge].isSpriteLoaded=U,ce[ge].fire(new a.Event("isSpriteLoaded")))}}setImages(V,U,te){this.availableImages[V]=U;for(const ce in this.workerSources[V]){const ge=this.workerSources[V][ce];for(const we in ge)ge[we].availableImages=U}te()}enableTerrain(V,U,te){this.terrain=U,te()}setProjection(V,U){this.projections[V]=a.getProjection(U)}setLayers(V,U,te){this.getLayerIndex(V).replace(U),te()}updateLayers(V,U,te){this.getLayerIndex(V).update(U.layers,U.removedIds),te()}loadTile(V,U,te){const ce=this.enableTerrain?a.extend({enableTerrain:this.terrain},U):U;ce.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,U.type,U.source).loadTile(ce,te)}loadDEMTile(V,U,te){const ce=this.enableTerrain?a.extend({buildQuadTree:this.terrain},U):U;this.getDEMWorkerSource(V,U.source).loadTile(ce,te)}reloadTile(V,U,te){const ce=this.enableTerrain?a.extend({enableTerrain:this.terrain},U):U;ce.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,U.type,U.source).reloadTile(ce,te)}abortTile(V,U,te){this.getWorkerSource(V,U.type,U.source).abortTile(U,te)}removeTile(V,U,te){this.getWorkerSource(V,U.type,U.source).removeTile(U,te)}removeSource(V,U,te){if(!this.workerSources[V]||!this.workerSources[V][U.type]||!this.workerSources[V][U.type][U.source])return;const ce=this.workerSources[V][U.type][U.source];delete this.workerSources[V][U.type][U.source],ce.removeSource!==void 0?ce.removeSource(U,te):te()}loadWorkerSource(V,U,te){try{this.self.importScripts(U.url),te()}catch(ce){te(ce.toString())}}syncRTLPluginState(V,U,te){try{a.plugin.setState(U);const ce=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&ce!=null){this.self.importScripts(ce);const ge=a.plugin.isParsed();te(ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ce}`),ge)}}catch(ce){te(ce.toString())}}getAvailableImages(V){let U=this.availableImages[V];return U||(U=[]),U}getLayerIndex(V){let U=this.layerIndexes[V];return U||(U=this.layerIndexes[V]=new q),U}getWorkerSource(V,U,te){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][U]||(this.workerSources[V][U]={}),!this.workerSources[V][U][te]){const ce={send:(ge,we,xe,fe,Pe,Je)=>{this.actor.send(ge,we,xe,V,Pe,Je)},scheduler:this.actor.scheduler};this.workerSources[V][U][te]=new this.workerSourceTypes[U](ce,this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])}return this.workerSources[V][U][te]}getDEMWorkerSource(V,U){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][U]||(this.demWorkerSources[V][U]=new G),this.demWorkerSources[V][U]}enforceCacheSizeLimit(V,U){a.enforceCacheSizeLimit(U)}getWorkerPerformanceMetrics(V,U,te){te(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ec(self)),ec}),b(["./shared"],function(a){function I(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let l=0;l<h.length;l++)if(!I(h[l],r[l]))return!1;return!0}if(typeof h=="object"&&h!==null&&r!==null){if(typeof r!="object"||Object.keys(h).length!==Object.keys(r).length)return!1;for(const l in h)if(!I(h[l],r[l]))return!1;return!0}return h===r}var O=q;function q(h){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,g,y=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(y);try{g=new Worker(T),p=!0}catch{p=!1}return g&&g.terminate(),URL.revokeObjectURL(T),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var g=p.getContext("2d");if(!g)return!1;var y=g.getImageData(0,0,1,1);return y&&y.width===p.width}()?(G[l=r&&r.failIfMajorPerformanceCaveat]===void 0&&(G[l]=function(p){var g,y=function(T){var E=document.createElement("canvas"),M=Object.create(q.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=T,E.getContext("webgl",M)||E.getContext("experimental-webgl",M)}(p);if(!y)return!1;try{g=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!g||y.isContextLost())&&(y.shaderSource(g,"void main() {}"),y.compileShader(g),y.getShaderParameter(g,y.COMPILE_STATUS)===!0)}(l)),G[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(h)}var G={};function H(h,r,l){const p=a.window.document.createElement(h);return r!==void 0&&(p.className=r),l&&l.appendChild(p),p}function ue(h,r,l){const p=a.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const g of Object.keys(r))p.setAttributeNS(null,g,r[g]);return l&&l.appendChild(p),p}q.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const _e=a.window.document&&a.window.document.documentElement.style,Ie=_e&&_e.userSelect!==void 0?"userSelect":"WebkitUserSelect";let at;function me(){_e&&Ie&&(at=_e[Ie],_e[Ie]="none")}function ne(){_e&&Ie&&(_e[Ie]=at)}function le(h){h.preventDefault(),h.stopPropagation(),a.window.removeEventListener("click",le,!0)}function ke(){a.window.addEventListener("click",le,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",le,!0)},0)}function je(h,r){const l=h.getBoundingClientRect();return Qe(h,l,r)}function ct(h,r){const l=h.getBoundingClientRect(),p=[];for(let g=0;g<r.length;g++)p.push(Qe(h,l,r[g]));return p}function it(h){return a.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Qe(h,r,l){const p=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new a.Point((l.clientX-r.left)*p,(l.clientY-r.top)*p)}function Be(h,r){var l=r[0],p=r[1],g=r[2],y=r[3],T=l*y-g*p;return T?(h[0]=y*(T=1/T),h[1]=-p*T,h[2]=-g*T,h[3]=l*T,h):null}function St(h){const{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class bn extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(const g of r){if(g[0]<p||g[1]<g[0]||l<g[1])return!1;p=g[1]}return!0}_validateContent(r,l){return!(r&&(r.length!==4||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let p=!0;if(!this.isLoaded())for(const g of r)this.images[g]||(p=!1);this.isLoaded()||p?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const p={};for(const g of r){this.images[g]||this.fire(new a.Event("styleimagemissing",{id:g}));const y=this.images[g];y?p[g]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:a.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],p=this.getImage(r);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const g={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new a.ImagePosition(g,p);this.patterns[r]={bin:g,position:y}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture&&this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const y in this.patterns)r.push(this.patterns[y].bin);const{w:l,h:p}=a.potpack(r),g=this.atlasImage;g.resize({width:l||1,height:p||1});for(const y in this.patterns){const{bin:T}=this.patterns[y],E=T.x+1,M=T.y+1,z=this.images[y].data,k=z.width,R=z.height;a.RGBAImage.copy(z,g,{x:0,y:0},{x:E,y:M},{width:k,height:R}),a.RGBAImage.copy(z,g,{x:0,y:R-1},{x:E,y:M-1},{width:k,height:1}),a.RGBAImage.copy(z,g,{x:0,y:0},{x:E,y:M+R},{width:k,height:1}),a.RGBAImage.copy(z,g,{x:k-1,y:0},{x:E-1,y:M},{width:1,height:R}),a.RGBAImage.copy(z,g,{x:0,y:0},{x:E+k,y:M},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];St(p)&&this.updateImage(l,p)}}}const bt=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(h,r){return function([l,p,g]){const y=a.degToRad(p+90),T=a.degToRad(g);return{x:l*Math.cos(y)*Math.sin(T),y:l*Math.sin(y)*Math.sin(T),z:l*Math.cos(T),azimuthal:p,polar:g}}(h.expression.evaluate(r))}interpolate(h,r,l){return{x:a.number(h.x,r.x,l),y:a.number(h.y,r.y,l),z:a.number(h.z,r.z,l),azimuthal:a.number(h.azimuthal,r.azimuthal,l),polar:a.number(h.polar,r.polar,l)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)});class Jt extends a.Evented{constructor(r){super(),this._transitionable=new a.Transitionable(bt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(a.validateLight,r,l))for(const p in r){const g=r[p];a.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),g):this._transitionable.setValue(p,g)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&a.emitValidationErrors(this,r.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Tn=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)});let vn=class extends a.Evented{constructor(h,r){super(),this._transitionable=new a.Transitionable(Tn),this.set(h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(h){for(const r in h){const l=h[r];a.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),l):this._transitionable.setValue(r,l)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}};function ii(h,r,l,p){const g=a.smoothstep(45,65,l),[y,T]=Mi(h,p),E=a.length(r);let M=1-Math.min(1,Math.exp((E-y)/(T-y)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*g*h.alpha}function Mi(h,r){const l=.5/Math.tan(.5*r);return[h.range[0]+l,h.range[1]+l]}const We=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])});class Et extends a.Evented{constructor(r,l){super(),this._transitionable=new a.Transitionable(We),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const r=this._transform,l=r.projection.name==="globe",p=a.globeToMercatorTransition(r.zoom),g=this.properties.get("range"),y=[.5,3];return{range:l?[a.number(y[0],g[0],p),a.number(y[1],g[1],p)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(a.validateFog,r,l)){for(const p of Object.keys(a.spec.fog))r&&r[p]===void 0&&(r[p]=a.spec.fog[p].default);for(const p in r){const g=r[p];a.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),g):this._transitionable.setValue(p,g)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(p,g,y){const T=a.MercatorCoordinate.fromLngLat(g),E=y.elevation?y.elevation.getAtPointOrZero(T):0,M=[T.x,T.y,E];return a.transformMat4(M,M,y.mercatorFogMatrix),ii(p,M,y.pitch,y._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Mi(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&a.emitValidationErrors(this,r.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class vt{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const p=this.workerPool.acquire(this.id);for(let g=0;g<p.length;g++){const y=new vt.Actor(p[g],l,this.id);y.name=`Worker ${g}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,p){a.asyncAll(this.actors,(g,y)=>{g.send(r,l,y)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function gt(h,r,l){return r*(a.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}vt.Actor=a.Actor;class Qt{constructor(r,l,p,g){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(r,l){let p,g;if(r instanceof a.Point||typeof r[0]=="number"){const y=a.Point.convert(r);p=[y],g=l.isPointAboveHorizon(y)}else{const y=a.Point.convert(r[0]),T=a.Point.convert(r[1]);p=[y,T],g=a.polygonizeBounds(y,T).every(E=>l.isPointAboveHorizon(E))}return new Qt(p,l.getCameraPoint(),g,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],g=a.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?g[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(g[3]=this.cameraPoint)),a.bufferConvexPolygon(g,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],g=a.polygonizeBounds(l,p,r),y=this.cameraPoint.clone();switch(3*((y.y>l.y)+(y.y>p.y))+((y.x>l.x)+(y.x>p.x))){case 0:g[0]=y,g[4]=y.clone();break;case 1:g.splice(1,0,y);break;case 2:g[1]=y;break;case 3:g.splice(4,0,y);break;case 5:g.splice(2,0,y);break;case 6:g[3]=y;break;case 7:g.splice(3,0,y);break;case 8:g[2]=y}return g}containsTile(r,l,p,g=0){const y=r.queryPadding/l._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(y,l):this._bufferedScreenMercator(y,l);let E=r.tileID.wrap+(T.unwrapped?g:0);const M=T.polygon.map(K=>a.getTilePoint(r.tileTransform,K,E));if(!a.polygonIntersectsBox(M,0,0,a.EXTENT,a.EXTENT))return;E=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const z=this.screenGeometryMercator.polygon.map(K=>a.getTileVec3(r.tileTransform,K,E)),k=z.map(K=>new a.Point(K[0],K[1])),R=l.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),N=a.getTileVec3(r.tileTransform,R,E),Z=z.map(K=>{const B=a.sub(K,K,N);return a.normalize(B,B),new a.Ray(N,B)}),X=gt(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:Z,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(W=a.getBounds(M),W.min.x=a.clamp(W.min.x,0,a.EXTENT),W.min.y=a.clamp(W.min.y,0,a.EXTENT),W.max.x=a.clamp(W.max.x,0,a.EXTENT),W.max.y=a.clamp(W.max.y,0,a.EXTENT),W),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:X};var W}_bufferedScreenMercator(r,l){const p=Zi(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[p]=g,g}}_bufferedCameraMercator(r,l){const p=Zi(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[p]=g,g}}_projectAndResample(r,l){const p=function(y,T){const E=a.multiply([],T.pixelMatrix,T.globeMatrix),M=[0,-a.GLOBE_RADIUS,0,1],z=[0,a.GLOBE_RADIUS,0,1],k=[0,0,0,1];a.transformMat4$1(M,M,E),a.transformMat4$1(z,z,E),a.transformMat4$1(k,k,E);const R=new a.Point(M[0]/M[3],M[1]/M[3]),N=new a.Point(z[0]/z[3],z[1]/z[3]),Z=a.polygonContainsPoint(y,R)&&M[3]<k[3],X=a.polygonContainsPoint(y,N)&&z[3]<k[3];if(!Z&&!X)return null;const W=function(de,ve,ye){for(let Se=1;Se<de.length;Se++){const $e=ti(ve.pointCoordinate3D(de[Se-1]).x),be=ti(ve.pointCoordinate3D(de[Se]).x);if(ye<0){if($e<be)return{idx:Se,t:-$e/(be-1-$e)}}else if(be<$e)return{idx:Se,t:(1-$e)/(be+1-$e)}}return null}(y,T,Z?-1:1);if(!W)return null;const{idx:K,t:B}=W;let $=K>1?hn(y.slice(0,K),T):[],Q=K<y.length?hn(y.slice(K),T):[];$=$.map(de=>new a.Point(ti(de.x),de.y)),Q=Q.map(de=>new a.Point(ti(de.x),de.y));const ee=[...$];ee.length===0&&ee.push(Q[Q.length-1]);const he=a.number(ee[ee.length-1].y,(Q.length===0?$[0]:Q[0]).y,B);let pe;return pe=Z?[new a.Point(0,he),new a.Point(0,0),new a.Point(1,0),new a.Point(1,he)]:[new a.Point(1,he),new a.Point(1,1),new a.Point(0,1),new a.Point(0,he)],ee.push(...pe),Q.length===0?ee.push($[0]):ee.push(...Q),{polygon:ee.map(de=>new a.MercatorCoordinate(de.x,de.y)),unwrapped:!1}}(r,l);if(p)return p;const g=function(y,T){let E=!1,M=-1/0,z=0;for(let R=0;R<y.length-1;R++)y[R].x>M&&(M=y[R].x,z=R);for(let R=0;R<y.length-1;R++){const N=(z+R)%(y.length-1),Z=y[N],X=y[N+1];Math.abs(Z.x-X.x)>.5&&(Z.x<X.x?(Z.x+=1,N===0&&(y[y.length-1].x+=1)):(X.x+=1,N+1===y.length-1&&(y[0].x+=1)),E=!0)}const k=a.mercatorXfromLng(T.center.lng);return E&&k<Math.abs(k-1)&&y.forEach(R=>{R.x-=1}),{polygon:y,unwrapped:E}}(hn(r,l).map(y=>new a.Point(ti(y.x),y.y)),l);return{polygon:g.polygon.map(y=>new a.MercatorCoordinate(y.x,y.y)),unwrapped:g.unwrapped}}}function hn(h,r){return a.resample(h,l=>{const p=r.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function ti(h){return h<0?1+h%1:h%1}function Zi(h){return 100*h|0}function Ln(h,r,l,p,g){const y=function(T,E){if(T)return g(T);if(E){h.url&&E.tiles&&h.tiles&&delete h.tiles;const M=a.pick(a.extend(E,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(M.vectorLayers=E.vector_layers,M.vectorLayerIds=M.vectorLayers.map(z=>z.id)),M.tiles=r.canonicalizeTileset(M,h.url),g(null,M)}};return h.url?a.getJSON(r.transformRequest(r.normalizeSourceURL(h.url,null,l,p),a.ResourceType.Source),y):a.exported.frame(()=>y(null,h))}class di{constructor(r,l,p){this.bounds=a.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),p=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*l),g=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*l),y=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*l),T=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=p&&r.x<y&&r.y>=g&&r.y<T}}class ks{constructor(r,l,p){this.context=r;const g=r.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const yr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class vr{constructor(r,l,p,g){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=g,this.context=r;const y=r.gl;this.buffer=y.createBuffer(),r.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){const g=l.attributes[this.attributes[p].name];g!==void 0&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,l,p){for(let g=0;g<this.attributes.length;g++){const y=this.attributes[g],T=l.attributes[y.name];T!==void 0&&r.vertexAttribPointer(T,y.components,r[yr[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Pt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yr extends Pt{getDefault(){return a.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class yi extends Pt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Va extends Pt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class En extends Pt{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class tr extends Pt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Yl extends Pt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Jr extends Pt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class qi extends Pt{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Ua extends Pt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class zs extends Pt{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Na extends Pt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Mo extends Pt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Ds extends Pt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class Jl extends Pt{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ql extends Pt{getDefault(){return a.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class nr extends Pt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Ao extends Pt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class ja extends Pt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Xo extends Pt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Ls,Ga=class extends Pt{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class Ho extends Pt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Po extends Pt{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ko extends Pt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Yo extends Pt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Rs extends Pt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ec extends Pt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class re extends Pt{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class V extends Pt{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class U extends Pt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class te extends Pt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class ce extends Pt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class ge extends Pt{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class we extends ge{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class xe extends ge{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class fe extends xe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Pe{constructor(r,l,p,g){this.context=r,this.width=l,this.height=p;const y=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new we(r,y),g&&(this.depthAttachment=new xe(r,y))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class Je{constructor(r,l=!1){if(this.gl=r,this.isWebGL2=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),l){const p=r;this.extVertexArrayObject={createVertexArrayOES:p.createVertexArray.bind(r),deleteVertexArrayOES:p.deleteVertexArray.bind(r),bindVertexArrayOES:p.bindVertexArray.bind(r)}}this.clearColor=new Yr(this),this.clearDepth=new yi(this),this.clearStencil=new Va(this),this.colorMask=new En(this),this.depthMask=new tr(this),this.stencilMask=new Yl(this),this.stencilFunc=new Jr(this),this.stencilOp=new qi(this),this.stencilTest=new Ua(this),this.depthRange=new zs(this),this.depthTest=new Na(this),this.depthFunc=new Mo(this),this.blend=new Ds(this),this.blendFunc=new Jl(this),this.blendColor=new Ql(this),this.blendEquation=new nr(this),this.cullFace=new Ao(this),this.cullFaceSide=new ja(this),this.frontFace=new Xo(this),this.program=new Ga(this),this.activeTexture=new Ho(this),this.viewport=new Po(this),this.bindFramebuffer=new Ko(this),this.bindRenderbuffer=new Yo(this),this.bindTexture=new Rs(this),this.bindVertexBuffer=new ec(this),this.bindElementBuffer=new re(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new V(this),this.pixelStoreUnpack=new U(this),this.pixelStoreUnpackPremultiplyAlpha=new te(this),this.pixelStoreUnpackFlipY=new ce(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),l||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(l||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new ks(this,r,l)}createVertexBuffer(r,l,p){return new vr(this,r,l,p)}createRenderbuffer(r,l,p){const g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),y}createFramebuffer(r,l,p){return new Pe(this,r,l,p)}clear({color:r,depth:l,stencil:p}){const g=this.gl;let y=0;r&&(y|=g.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(y|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(y|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),g.clear(y)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){I(r.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class et extends a.Evented{constructor(r,l,p,g){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(l,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(r){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=Ln(this._options,this.map._requestManager,l,p,(g,y)=>{this._tileJSONRequest=null,this._loaded=!0,g?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new a.ErrorEvent(g))):y&&(a.extend(this,y),y.bounds&&(this.tileBounds=new di(y.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(y.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(g)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(r,l){const p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(p,a.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=l:r.request=r.actor.send("reloadTile",g,y.bind(this));else if(r.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",g,y.bind(this),void 0,!0);else{const T=a.loadVectorTile.call({deduped:this._deduped},g,(E,M)=>{E||!M?y.call(this,E):(g.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},r.actor&&r.actor.send("loadTile",g,y.bind(this),void 0,!0))},!0);r.request={cancel:T}}function y(T,E){return delete r.request,r.aborted?l(null):T&&T.status!==404?l(T):(E&&E.resourceTiming&&(r.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&r.setExpiryData(E),r.loadVectorData(E,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class He extends a.Evented{constructor(r,l,p,g){super(),this.id=r,this.dispatcher=p,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},l),a.extend(this,a.pick(l,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ln(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new a.ErrorEvent(l)):p&&(a.extend(this,p),p.bounds&&(this.tileBounds=new di(p.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(p.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(l)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const p=a.exported.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=a.getImage(this.map._requestManager.transformRequest(g,a.ResourceType.Tile),(y,T,E,M)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):y?(r.state="errored",l(y)):T?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:E,expires:M}),r.setTexture(T,this.map.painter),r.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,p){r.setTexture(l,p)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function It(h,r,l,p,g,y,T,E){const M=[h,l,g,r,p,y,1,1,1],z=[T,E,1],k=a.adjoint([],M),[R,N,Z]=a.transformMat3(z,z,a.transpose(k,k));return a.multiply$1(M,[R,0,0,0,N,0,0,0,Z],M)}class Bt extends a.Evented{constructor(r,l,p,g){super(),this.id=r,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=l,this._dirty=!1}load(r,l){this._loaded=l||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(p,g)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new a.ErrorEvent(p));else if(g){const{HTMLImageElement:y}=a.window;this.image=g instanceof y?a.exported.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const l=r.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let g=1/0,y=1/0,T=-1/0,E=-1/0;for(const R of p)g=Math.min(g,R.x),y=Math.min(y,R.y),T=Math.max(T,R.x),E=Math.max(E,R.y);const M=Math.max(T-g,E-y),z=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),k=Math.pow(2,z);return new a.CanonicalTileID(z,Math.floor((g+T)/2*k),Math.floor((y+E)/2*k))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const M in this.tiles){const z=this.tiles[M];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray)return;const l=a.tileTransform(this.tileID,this.map.transform.projection),[p,g,y,T]=this.coordinates.map(M=>{const z=l.projection.project(M[0],M[1]);return a.getTilePoint(l,z)._round()});this.perspectiveTransform=function(M,z,k,R,N,Z,X,W,K,B){const $=It(0,0,M,0,0,z,M,z),Q=It(k,R,N,Z,X,W,K,B);return a.multiply$1(Q,a.adjoint($,$),Q),[Q[6]/Q[8]*M/a.EXTENT,Q[7]/Q[8]*z/a.EXTENT]}(this.width,this.height,p.x,p.y,g.x,g.y,T.x,T.y,y.x,y.y);const E=this._boundsArray=new a.StructArrayLayout4i8;E.emplaceBack(p.x,p.y,0,0),E.emplaceBack(g.x,g.y,a.EXTENT,0),E.emplaceBack(T.x,T.y,0,a.EXTENT),E.emplaceBack(y.x,y.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(E,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,l=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const kt={vector:et,raster:He,"raster-dem":class extends He{constructor(h,r,l,p){super(h,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(g,y){g&&(h.state="errored",r(g)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=a.getImage(this.map._requestManager.transformRequest(l,a.ResourceType.Tile),(function(g,y,T,E){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(g)h.state="errored",r(g);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:T,expires:E});const M=a.window.ImageBitmap&&y instanceof a.window.ImageBitmap&&(Ls==null&&(Ls=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),Ls),z=1-(y.width-a.prevPowerOfTwo(y.width))/2;z<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const k=M?y:a.exported.getImageData(y,z),R={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:k,encoding:this.encoding,padding:z};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",R,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const r=h.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,g=r.x===0?h.wrap-1:h.wrap,y=(r.x+1+l)%l,T=r.x+1===l?h.wrap+1:h.wrap,E={};return E[new a.OverscaledTileID(h.overscaledZ,g,r.z,p,r.y).key]={backfilled:!1},E[new a.OverscaledTileID(h.overscaledZ,T,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(E[new a.OverscaledTileID(h.overscaledZ,g,r.z,p,r.y-1).key]={backfilled:!1},E[new a.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},E[new a.OverscaledTileID(h.overscaledZ,T,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<l&&(E[new a.OverscaledTileID(h.overscaledZ,g,r.z,p,r.y+1).key]={backfilled:!1},E[new a.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},E[new a.OverscaledTileID(h.overscaledZ,T,r.z,y,r.y+1).key]={backfilled:!1}),E}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends a.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=a.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const g=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*g,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*g,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:a.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*g,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},r),this}getClusterLeaves(h,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:r,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=a.extend({},this.workerOptions),r=this._data;typeof r=="string"?(h.request=this.map._requestManager.transformRequest(a.exported.resolveURL(r),a.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new a.ErrorEvent(l));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(g.resourceTiming=p.resourceTiming[this.id]),this.fire(new a.Event("data",g)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,g)=>(delete h.request,h.unloadVectorData(),h.aborted?r(null):p?r(p):(h.loadVectorData(g,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Bt{constructor(h,r,l,p){super(h,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,a.ResourceType.Source).url);a.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new a.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Bt,canvas:class extends Bt{constructor(h,r,l,p){super(h,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(y=>typeof y!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends a.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new di(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:r,y:l,z:p}=h.canonical;return this._implementation.hasTile({x:r,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){const{x:l,y:p,z:g}=h.tileID.canonical,y=new a.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:g},{signal:y.signal})).then((function(T){return delete h.request,h.aborted?(h.state="unloaded",r(null)):T===void 0?(h.state="errored",r(null)):T===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null)):function(E){return E instanceof a.window.ImageData||E instanceof a.window.HTMLCanvasElement||E instanceof a.window.ImageBitmap||E instanceof a.window.HTMLImageElement}(T)?(this.loadTileData(h,T),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(h.state="errored",r(T))}),h.request.cancel=()=>y.abort()}loadTileData(h,r){He.loadTileData(h,r,this._map.painter)}unloadTileData(h){He.unloadTileData(h,this._map.painter)}unloadTile(h,r){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:p,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:g})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ft=function(h,r,l,p){const g=new kt[r.type](h,r,l,p);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],g),g};function Gt(h,r){const l=a.identity([]);return a.scale(l,l,[.5*h.width,.5*-h.height,1]),a.translate(l,l,[1,-1,0]),a.multiply(l,l,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function Sn(h,r,l,p,g,y,T,E=!1){const M=h.tilesIn(p,T,E);M.sort(vi);const z=[];for(const R of M)z.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(r,l,h._state,R,g,y,Gt(h.transform,R.tile.tileID),E)});const k=function(R){const N={},Z={};for(const X of R){const W=X.queryResults,K=X.wrappedTileID,B=Z[K]=Z[K]||{};for(const $ in W){const Q=W[$],ee=B[$]=B[$]||{},he=N[$]=N[$]||[];for(const pe of Q)ee[pe.featureIndex]||(ee[pe.featureIndex]=!0,he.push(pe))}}return N}(z);for(const R in k)k[R].forEach(N=>{const Z=N.feature,X=Z.layer;X&&X.type!=="background"&&X.type!=="sky"&&(Z.source=X.source,X["source-layer"]&&(Z.sourceLayer=X["source-layer"]),Z.state=Z.id!==void 0?h.getFeatureState(X["source-layer"],Z.id):{})});return k}function On(h,r){const l=h.getRenderableIds().map(y=>h.getTileByID(y)),p=[],g={};for(let y=0;y<l.length;y++){const T=l[y],E=T.tileID.canonical.key;g[E]||(g[E]=!0,T.querySourceFeatures(p,r))}return p}function vi(h,r){const l=h.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function Yn(){return ea.workerClass!=null?new ea.workerClass:new a.window.Worker(ea.workerUrl)}const Dr="mapboxgl_preloaded_worker_pool";class ri{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<ri.workerCount;)this.workers.push(new Yn);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Dr]}numActive(){return Object.keys(this.active).length}}let Ai;function Bs(){return Ai||(Ai=new ri),Ai}function bg(h,r){const l={};for(const p in h)p!=="ref"&&(l[p]=h[p]);return a.refProperties.forEach(p=>{p in r&&(l[p]=r[p])}),l}function pp(h){h=h.slice();const r=Object.create(null);for(let l=0;l<h.length;l++)r[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=bg(h[l],r[h[l].ref]));return h}ri.workerCount=2;const Ht={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Du(h,r,l){l.push({command:Ht.addSource,args:[h,r[h]]})}function $a(h,r,l){r.push({command:Ht.removeSource,args:[h]}),l[h]=!0}function Lu(h,r,l,p){$a(h,l,p),Du(h,r,l)}function tc(h,r,l){let p;for(p in h[l])if(h[l].hasOwnProperty(p)&&p!=="data"&&!I(h[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&p!=="data"&&!I(h[l][p],r[l][p]))return!1;return!0}function Lr(h,r,l,p,g,y){let T;for(T in r=r||{},h=h||{})h.hasOwnProperty(T)&&(I(h[T],r[T])||l.push({command:y,args:[p,T,r[T],g]}));for(T in r)r.hasOwnProperty(T)&&!h.hasOwnProperty(T)&&(I(h[T],r[T])||l.push({command:y,args:[p,T,r[T],g]}))}function Qr(h){return h.id}function Ru(h,r){return h[r.id]=r,h}class Bu{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.clamp(r,0,1);let l=1,p=this._distances[l];const g=r*this.paddedLength+this.padding;for(;p<g&&l<this._distances.length;)p=this._distances[++l];const y=l-1,T=this._distances[y],E=p-T,M=E>0?(g-T)/E:0;return this.points[y].mult(1-M).add(this.points[l].mult(M))}}class Jo{constructor(r,l,p){const g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,g,y){this._forEachCell(l,p,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(r,l,p,g){this._forEachCell(l-g,p-g,l+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(g)}_insertBoxCell(r,l,p,g,y,T){this.boxCells[y].push(T)}_insertCircleCell(r,l,p,g,y,T){this.circleCells[y].push(T)}_query(r,l,p,g,y,T){if(p<0||r>this.width||g<0||l>this.height)return!y&&[];const E=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=g){if(y)return!0;for(let M=0;M<this.boxKeys.length;M++)E.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const z=this.circles[3*M],k=this.circles[3*M+1],R=this.circles[3*M+2];E.push({key:this.circleKeys[M],x1:z-R,y1:k-R,x2:z+R,y2:k+R})}return T?E.filter(T):E}return this._forEachCell(r,l,p,g,this._queryCell,E,{hitTest:y,seenUids:{box:{},circle:{}}},T),y?E.length>0:E}_queryCircle(r,l,p,g,y){const T=r-p,E=r+p,M=l-p,z=l+p;if(E<0||T>this.width||z<0||M>this.height)return!g&&[];const k=[];return this._forEachCell(T,M,E,z,this._queryCellCircle,k,{hitTest:g,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},y),g?k.length>0:k}query(r,l,p,g,y){return this._query(r,l,p,g,!1,y)}hitTest(r,l,p,g,y){return this._query(r,l,p,g,!0,y)}hitTestCircle(r,l,p,g){return this._queryCircle(r,l,p,!0,g)}_queryCell(r,l,p,g,y,T,E,M){const z=E.seenUids,k=this.boxCells[y];if(k!==null){const N=this.bboxes;for(const Z of k)if(!z.box[Z]){z.box[Z]=!0;const X=4*Z;if(r<=N[X+2]&&l<=N[X+3]&&p>=N[X+0]&&g>=N[X+1]&&(!M||M(this.boxKeys[Z]))){if(E.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Z],x1:N[X],y1:N[X+1],x2:N[X+2],y2:N[X+3]})}}}const R=this.circleCells[y];if(R!==null){const N=this.circles;for(const Z of R)if(!z.circle[Z]){z.circle[Z]=!0;const X=3*Z;if(this._circleAndRectCollide(N[X],N[X+1],N[X+2],r,l,p,g)&&(!M||M(this.circleKeys[Z]))){if(E.hitTest)return T.push(!0),!0;{const W=N[X],K=N[X+1],B=N[X+2];T.push({key:this.circleKeys[Z],x1:W-B,y1:K-B,x2:W+B,y2:K+B})}}}}}_queryCellCircle(r,l,p,g,y,T,E,M){const z=E.circle,k=E.seenUids,R=this.boxCells[y];if(R!==null){const Z=this.bboxes;for(const X of R)if(!k.box[X]){k.box[X]=!0;const W=4*X;if(this._circleAndRectCollide(z.x,z.y,z.radius,Z[W+0],Z[W+1],Z[W+2],Z[W+3])&&(!M||M(this.boxKeys[X])))return T.push(!0),!0}}const N=this.circleCells[y];if(N!==null){const Z=this.circles;for(const X of N)if(!k.circle[X]){k.circle[X]=!0;const W=3*X;if(this._circlesCollide(Z[W],Z[W+1],Z[W+2],z.x,z.y,z.radius)&&(!M||M(this.circleKeys[X])))return T.push(!0),!0}}}_forEachCell(r,l,p,g,y,T,E,M){const z=this._convertToXCellCoord(r),k=this._convertToYCellCoord(l),R=this._convertToXCellCoord(p),N=this._convertToYCellCoord(g);for(let Z=z;Z<=R;Z++)for(let X=k;X<=N;X++)if(y.call(this,r,l,p,g,this.xCellCount*X+Z,T,E,M))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,g,y,T){const E=g-r,M=y-l,z=p+T;return z*z>E*E+M*M}_circleAndRectCollide(r,l,p,g,y,T,E){const M=(T-g)/2,z=Math.abs(r-(g+M));if(z>M+p)return!1;const k=(E-y)/2,R=Math.abs(l-(y+k));if(R>k+p)return!1;if(z<=M||R<=k)return!0;const N=z-M,Z=R-k;return N*N+Z*Z<=p*p}}const eo={unknown:0,flipRequired:1,flipNotRequired:2},Za=Math.tan(85*Math.PI/180);function De(h,r,l,p,g,y,T){const E=a.create();if(l)if(y.name==="globe"){const M=a.calculateGlobeLabelMatrix(g,r);a.multiply(E,E,M)}else{const M=Be([],T);E[0]=M[0],E[1]=M[1],E[4]=M[2],E[5]=M[3],p||a.rotateZ(E,E,g.angle)}else a.multiply(E,g.labelPlaneMatrix,h);return E}function to(h,r,l,p,g,y,T){const E=De(h,r,l,p,g,y,T);return y.name==="globe"&&l||(E[2]=E[6]=E[10]=E[14]=0),E}function Vn(h,r,l,p,g,y,T){if(l){if(y.name==="globe"){const E=De(h,r,l,p,g,y,T);return a.invert(E,E),a.multiply(E,h,E),E}{const E=a.clone(h),M=a.identity([]);return M[0]=T[0],M[1]=T[1],M[4]=T[2],M[5]=T[3],a.multiply(E,E,M),p||a.rotateZ(E,E,-g.angle),E}}return g.glCoordMatrix}function oi(h,r,l,p){const g=[h,r,l,1];l?a.transformMat4$1(g,g,p):Ut(g,g,p);const y=g[3];return g[0]/=y,g[1]/=y,g[2]/=y,g}function fp(h,r){return Math.min(.5+h/r*.5,1.5)}function Rr(h,r){const l=h[0]/h[3],p=h[1]/h[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function Fu(h,r,l,p,g,y,T,E,M,z){const k=l.transform,R=p?h.textSizeData:h.iconSizeData,N=a.evaluateSizeForZoom(R,l.transform.zoom),Z=k.projection.name==="globe",X=[256/l.width*2+1,256/l.height*2+1],W=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;W.clear();let K=null;Z&&(K=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const B=h.lineVertexArray,$=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,Q=l.transform.width/l.transform.height;let ee,he=!1;for(let pe=0;pe<$.length;pe++){const de=$.get(pe),{numGlyphs:ve,writingMode:ye}=de;if(ye!==a.WritingMode.vertical||he||ee===a.WritingMode.horizontal||(he=!0),ee=ye,(de.hidden||ye===a.WritingMode.vertical)&&!he){xr(ve,W);continue}he=!1;const Se=new a.Point(de.tileAnchorX,de.tileAnchorY);let{x:$e,y:be,z:Fe}=k.projection.projectTilePoint(Se.x,Se.y,z.canonical);if(M){const[Tt,ht,xt]=M(Se);$e+=Tt,be+=ht,Fe+=xt}const Me=[$e,be,Fe,1];if(a.transformMat4$1(Me,Me,r),!Rr(Me,X)){xr(ve,W);continue}const Ge=fp(l.transform.cameraToCenterDistance,Me[3]),Ee=a.evaluateSizeForFeature(R,N,de),Re=T?Ee/Ge:Ee*Ge,qe=oi($e,be,Fe,g);if(qe[3]<=0){xr(ve,W);continue}let Ue={};const Xe=T?null:M,ft=st(de,Re,!1,E,r,g,y,h.glyphOffsetArray,B,W,K,qe,Se,Ue,Q,Xe,k.projection,z,T);he=ft.useVertical,Xe&&ft.needsFlipping&&(Ue={}),(ft.notEnoughRoom||he||ft.needsFlipping&&st(de,Re,!0,E,r,g,y,h.glyphOffsetArray,B,W,K,qe,Se,Ue,Q,Xe,k.projection,z,T).notEnoughRoom)&&xr(ve,W)}p?(h.text.dynamicLayoutVertexBuffer.updateData(W),K&&h.text.globeExtVertexBuffer.updateData(K)):(h.icon.dynamicLayoutVertexBuffer.updateData(W),K&&h.icon.globeExtVertexBuffer.updateData(K))}function mp(h,r,l,p,g,y,T,E,M,z,k,R,N,Z,X,W){const{lineStartIndex:K,glyphStartIndex:B,segment:$}=E,Q=B+E.numGlyphs,ee=K+E.lineLength,he=r.getoffsetX(B),pe=r.getoffsetX(Q-1),de=Wi(h*he,l,p,g,y,T,$,K,ee,M,z,k,R,N,!0,Z,X,W);if(!de)return null;const ve=Wi(h*pe,l,p,g,y,T,$,K,ee,M,z,k,R,N,!0,Z,X,W);return ve?{first:de,last:ve}:null}function Fs(h,r,l,p){return h===a.WritingMode.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:h===a.WritingMode.vertical?p>0?{needsFlipping:!0}:null:r!==eo.unknown&&function(g,y){return g===0||Math.abs(y/g)>Za}(l,p)?r===eo.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function st(h,r,l,p,g,y,T,E,M,z,k,R,N,Z,X,W,K,B,$){const Q=r/24,ee=h.lineOffsetX*Q,he=h.lineOffsetY*Q,{lineStartIndex:pe,glyphStartIndex:de,numGlyphs:ve,segment:ye,writingMode:Se,flipState:$e}=h,be=pe+h.lineLength,Fe=Me=>{if(k){const[qe,Ue,Xe]=Me.up,ft=z.length;a.updateGlobeVertexNormal(k,ft+0,qe,Ue,Xe),a.updateGlobeVertexNormal(k,ft+1,qe,Ue,Xe),a.updateGlobeVertexNormal(k,ft+2,qe,Ue,Xe),a.updateGlobeVertexNormal(k,ft+3,qe,Ue,Xe)}const[Ge,Ee,Re]=Me.point;a.addDynamicAttributes(z,Ge,Ee,Re,Me.angle)};if(ve>1){const Me=mp(Q,E,ee,he,l,R,N,h,M,y,Z,W,!1,K,B,$);if(!Me)return{notEnoughRoom:!0};if(p&&!l){let[Ge,Ee,Re]=Me.first.point,[qe,Ue,Xe]=Me.last.point;[Ge,Ee]=oi(Ge,Ee,Re,T),[qe,Ue]=oi(qe,Ue,Xe,T);const ft=Fs(Se,$e,(qe-Ge)*X,Ue-Ee);if(h.flipState=ft&&ft.needsFlipping?eo.flipRequired:eo.flipNotRequired,ft)return ft}Fe(Me.first);for(let Ge=de+1;Ge<de+ve-1;Ge++){const Ee=Wi(Q*E.getoffsetX(Ge),ee,he,l,R,N,ye,pe,be,M,y,Z,W,!1,!1,K,B,$);if(!Ee)return z.length-=4*(Ge-de),{notEnoughRoom:!0};Fe(Ee)}Fe(Me.last)}else{if(p&&!l){const Ge=oi(N.x,N.y,0,g),Ee=pe+ye+1,Re=new a.Point(M.getx(Ee),M.gety(Ee)),qe=oi(Re.x,Re.y,0,g),Ue=qe[3]>0?qe:Vt(N,Re,Ge,1,g,void 0,K,B.canonical),Xe=Fs(Se,$e,(Ue[0]-Ge[0])*X,Ue[1]-Ge[1]);if(h.flipState=Xe&&Xe.needsFlipping?eo.flipRequired:eo.flipNotRequired,Xe)return Xe}const Me=Wi(Q*E.getoffsetX(de),ee,he,l,R,N,ye,pe,be,M,y,Z,W,!1,!1,K,B,$);if(!Me)return{notEnoughRoom:!0};Fe(Me)}return{}}function jt(h,r,l,p,g){const{x:y,y:T,z:E}=p.projectTilePoint(h.x,h.y,r);if(!g)return oi(y,T,E,l);const[M,z,k]=g(h);return oi(y+M,T+z,E+k,l)}function Vt(h,r,l,p,g,y,T,E){const M=jt(h.sub(r)._unit()._add(h),E,g,T,y);return a.sub(M,l,M),a.normalize(M,M),a.scaleAndAdd(M,l,M,p)}function Wi(h,r,l,p,g,y,T,E,M,z,k,R,N,Z,X,W,K,B){const $=p?h-r:h+r;let Q=$>0?1:-1,ee=0;p&&(Q*=-1,ee=Math.PI),Q<0&&(ee+=Math.PI);let he=E+T+(Q>0?0:1)|0,pe=g,de=g,ve=0,ye=0;const Se=Math.abs($),$e=[],be=[];let Fe=y,Me=Fe;const Ge=()=>Vt(Me,Fe,de,Se-ve+1,k,N,W,K.canonical);for(;ve+ye<=Se;){if(he+=Q,he<E||he>=M)return null;if(de=pe,Me=Fe,$e.push(de),Z&&be.push(Me),Fe=new a.Point(z.getx(he),z.gety(he)),pe=R[he],!pe){const xt=jt(Fe,K.canonical,k,W,N);pe=xt[3]>0?R[he]=xt:Ge()}ve+=ye,ye=a.distance(de,pe)}X&&N&&(R[he]&&(pe=Ge(),ye=a.distance(de,pe)),R[he]=pe);const Ee=(Se-ve)/ye,Re=Fe.sub(Me)._mult(Ee)._add(Me),qe=a.sub([],pe,de),Ue=a.scaleAndAdd([],de,qe,Ee);let Xe=[0,0,1],ft=qe[0],Tt=qe[1];if(B&&(Xe=W.upVector(K.canonical,Re.x,Re.y),Xe[0]!==0||Xe[1]!==0||Xe[2]!==1)){const xt=[Xe[2],0,-Xe[0]],Nt=a.cross([],Xe,xt);a.normalize(xt,xt),a.normalize(Nt,Nt),ft=a.dot(qe,xt),Tt=a.dot(qe,Nt)}if(l){const xt=a.cross([],Xe,qe);a.normalize(xt,xt),a.scaleAndAdd(Ue,Ue,xt,l*Q)}const ht=ee+Math.atan2(Tt,ft);return $e.push(Ue),Z&&be.push(Re),{point:Ue,angle:ht,path:$e,tilePath:be,up:Xe}}function xr(h,r){const l=r.length,p=l+4*h;r.resize(p),r.float32.fill(-1/0,4*l,4*p)}function Ut(h,r,l){const p=r[0],g=r[1];return h[0]=l[0]*p+l[4]*g+l[12],h[1]=l[1]*p+l[5]*g+l[13],h[3]=l[3]*p+l[7]*g+l[15],h}const Xi=100;class qa{constructor(r,l,p=new Jo(r.width+200,r.height+200,25),g=new Jo(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=g,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Xi,this.screenBottomBoundary=r.height+Xi,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,g,y,T,E,M){let z=p.projectedAnchorX,k=p.projectedAnchorY,R=p.projectedAnchorZ;const N=p.elevation,Z=p.tileID,X=r.getProjection();if(N&&Z){const[pe,de,ve]=X.upVector(Z.canonical,p.tileAnchorX,p.tileAnchorY),ye=X.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=pe*N*ye,k+=de*N*ye,R+=ve*N*ye}const W=this.projectAndGetPerspectiveRatio(E,z,k,R,p.tileID,X.name==="globe"||!!N||this.transform.pitch>0,X),K=T*W.perspectiveRatio,B=(p.x1*l+g.x-p.padding)*K+W.point.x,$=(p.y1*l+g.y-p.padding)*K+W.point.y,Q=(p.x2*l+g.x+p.padding)*K+W.point.x,ee=(p.y2*l+g.y+p.padding)*K+W.point.y,he=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(B,$,Q,ee)||!y&&this.grid.hitTest(B,$,Q,ee,M)||he?{box:[],offscreen:!1,occluded:W.occluded}:{box:[B,$,Q,ee],offscreen:this.isOffscreen(B,$,Q,ee),occluded:!1}}placeCollisionCircles(r,l,p,g,y,T,E,M,z,k,R,N,Z,X,W){const K=[],B=this.transform.elevation,$=r.getProjection(),Q=B?B.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,$):null,ee=new a.Point(p.tileAnchorX,p.tileAnchorY);let{x:he,y:pe,z:de}=$.projectTilePoint(ee.x,ee.y,W.canonical);if(Q){const[Re,qe,Ue]=Q(ee);he+=Re,pe+=qe,de+=Ue}const ve=$.name==="globe",ye=this.projectAndGetPerspectiveRatio(E,he,pe,de,W,ve||!!B||this.transform.pitch>0,$),{perspectiveRatio:Se}=ye,$e=(R?T/Se:T*Se)/a.ONE_EM,be=oi(he,pe,de,M),Fe=ye.signedDistanceFromCamera>0?mp($e,y,p.lineOffsetX*$e,p.lineOffsetY*$e,!1,be,ee,p,g,M,{},B&&!R?Q:null,R&&!!B,$,W,R):null;let Me=!1,Ge=!1,Ee=!0;if(Fe&&!ye.occluded){const Re=.5*Z*Se+X,qe=new a.Point(-100,-100),Ue=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),Xe=new Bu,{first:ft,last:Tt}=Fe,ht=ft.path.length;let xt=[];for(let pt=ht-1;pt>=1;pt--)xt.push(ft.path[pt]);for(let pt=1;pt<Tt.path.length;pt++)xt.push(Tt.path[pt]);const Nt=2.5*Re;z&&(xt=xt.map(([pt,en,nn],rn)=>(Q&&!ve&&(nn=Q(rn<ht-1?ft.tilePath[ht-1-rn]:Tt.tilePath[rn-ht+2])[2]),oi(pt,en,nn,z))),xt.some(pt=>pt[3]<=0)&&(xt=[]));let Ot=[];if(xt.length>0){let pt=1/0,en=-1/0,nn=1/0,rn=-1/0;for(const on of xt)pt=Math.min(pt,on[0]),nn=Math.min(nn,on[1]),en=Math.max(en,on[0]),rn=Math.max(rn,on[1]);en>=qe.x&&pt<=Ue.x&&rn>=qe.y&&nn<=Ue.y&&(Ot=[xt.map(on=>new a.Point(on[0],on[1]))],(pt<qe.x||en>Ue.x||nn<qe.y||rn>Ue.y)&&(Ot=a.clipLine(Ot,qe.x,qe.y,Ue.x,Ue.y)))}for(const pt of Ot){Xe.reset(pt,.25*Re);let en=0;en=Xe.length<=.5*Re?1:Math.ceil(Xe.paddedLength/Nt)+1;for(let nn=0;nn<en;nn++){const rn=nn/Math.max(en-1,1),on=Xe.lerp(rn),wi=on.x+Xi,ai=on.y+Xi;K.push(wi,ai,Re,0);const ar=wi-Re,Vr=ai-Re,wn=wi+Re,sn=ai+Re;if(Ee=Ee&&this.isOffscreen(ar,Vr,wn,sn),Ge=Ge||this.isInsideGrid(ar,Vr,wn,sn),!l&&this.grid.hitTestCircle(wi,ai,Re,N)&&(Me=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Me,occluded:!1}}}}return{circles:!k&&Me||!Ge?[]:K,offscreen:Ee,collisionDetected:Me,occluded:ye.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,g=1/0,y=-1/0,T=-1/0;for(const k of r){const R=new a.Point(k.x+Xi,k.y+Xi);p=Math.min(p,R.x),g=Math.min(g,R.y),y=Math.max(y,R.x),T=Math.max(T,R.y),l.push(R)}const E=this.grid.query(p,g,y,T).concat(this.ignoredGrid.query(p,g,y,T)),M={},z={};for(const k of E){const R=k.key;if(M[R.bucketInstanceId]===void 0&&(M[R.bucketInstanceId]={}),M[R.bucketInstanceId][R.featureIndex])continue;const N=[new a.Point(k.x1,k.y1),new a.Point(k.x2,k.y1),new a.Point(k.x2,k.y2),new a.Point(k.x1,k.y2)];a.polygonIntersectsPolygon(l,N)&&(M[R.bucketInstanceId][R.featureIndex]=!0,z[R.bucketInstanceId]===void 0&&(z[R.bucketInstanceId]=[]),z[R.bucketInstanceId].push(R.featureIndex))}return z}insertCollisionBox(r,l,p,g,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:y},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,g,y){const T=l?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:g,collisionGroupID:y};for(let M=0;M<r.length;M+=4)T.insertCircle(E,r[M],r[M+1],r[M+2])}projectAndGetPerspectiveRatio(r,l,p,g,y,T,E){const M=[l,p,g,1];let z=!1;g||this.transform.pitch>0?(a.transformMat4$1(M,M,r),this.fogState&&y&&E.name!=="globe"&&(z=function(N,Z,X,W,K,B){const $=B.calculateFogTileMatrix(K),Q=[Z,X,W];return a.transformMat4(Q,Q,$),ii(N,Q,B.pitch,B._fov)}(this.fogState,l,p,g,y.toUnwrapped(),this.transform)>.9)):Ut(M,M,r);const k=M[3];return{point:new a.Point((M[0]/k+1)/2*this.transform.width+Xi,(-M[1]/k+1)/2*this.transform.height+Xi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/k*.5,1.5),signedDistanceFromCamera:k,occluded:T&&M[2]>k||z}}isOffscreen(r,l,p,g){return p<Xi||r>=this.screenRightBoundary||g<Xi||l>this.screenBottomBoundary}isInsideGrid(r,l,p,g){return p>=0&&r<this.gridRightBoundary&&g>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=a.identity([]);return a.translate(r,r,[-100,-100,0]),r}}function Qo(h,r,l){const p=r.createTileMatrix(h,h.worldSize,l.toUnwrapped());return a.multiply(new Float32Array(16),h.projMatrix,p)}function ir(h,r,l){if(r.projection.name===l.projection.name)return h.projMatrix;const p=l.clone();return p.setProjection(r.projection),Qo(p,r.getProjection(),h)}function xn(h,r,l){return r.name===l.projection.name?h.projMatrix:Qo(l,r,h)}class gp{constructor(r,l,p,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):g&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class no{constructor(r,l,p,g,y,T=!1){this.text=new gp(r?r.text:null,l,p,y),this.icon=new gp(r?r.icon:null,l,g,y),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wa{constructor(r,l,p,g=!1){this.text=r,this.icon=l,this.skipFade=p,this.clipped=g}}class Xa{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Ou{constructor(r,l,p,g,y){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=y}}class _p{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function Ha(h,r,l,p,g){const{horizontalAlign:y,verticalAlign:T}=a.getAnchorAlignment(h),E=-(y-.5)*r,M=-(T-.5)*l,z=a.evaluateVariableOffset(h,p);return new a.Point(E+z[0]*g,M+z[1]*g)}function Ka(h,r,l,p,g){const y=new a.Point(h,r);return l&&y._rotate(p?g:-g),y}class nc{constructor(r,l,p,g,y){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new qa(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new _p(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,g){const y=p.getBucket(l),T=p.latestFeatureIndex;if(!y||!T||l.id!==y.layerIds[0])return;const E=y.layers[0].layout,M=p.collisionBoxArray,z=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),k=p.tileSize/a.EXTENT,R=p.tileID.toUnwrapped();this.transform.setProjection(y.projection);const N=(Z=p.tileID,X=y.getProjection(),W=this.transform,X.name===this.projection?W.calculateProjMatrix(Z.toUnwrapped()):Qo(W,X,Z));var Z,X,W;const K=E.get("text-pitch-alignment")==="map",B=E.get("text-rotation-alignment")==="map";l.compileFilter();const $=l.dynamicFilter(),Q=l.dynamicFilterNeedsFeature(),ee=this.transform.calculatePixelsToTileUnitsMatrix(p),he=to(N,p.tileID.canonical,K,B,this.transform,y.getProjection(),ee);let pe=null;if(K){const ye=Vn(N,p.tileID.canonical,K,B,this.transform,y.getProjection(),ee);pe=a.multiply([],this.transform.labelPlaneMatrix,ye)}let de=null;$&&p.latestFeatureIndex&&(de={unwrappedTileID:R,dynamicFilter:$,dynamicFilterNeedsFeature:Q,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new Ou(y.bucketInstanceId,T,y.sourceLayerIndex,y.index,p.tileID);const ve={bucket:y,layout:E,posMatrix:N,textLabelPlaneMatrix:he,labelToScreenMatrix:pe,clippingData:de,scale:z,textPixelRatio:k,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(g)for(const ye of y.sortKeyRanges){const{sortKey:Se,symbolInstanceStart:$e,symbolInstanceEnd:be}=ye;r.push({sortKey:Se,symbolInstanceStart:$e,symbolInstanceEnd:be,parameters:ve})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(r,l,p,g,y,T,E,M,z,k,R,N,Z,X,W,K,B,$){const{textOffset0:Q,textOffset1:ee,crossTileID:he}=N,pe=[Q,ee],de=Ha(r,p,g,pe,y),ve=this.collisionIndex.placeCollisionBox(X,y,l,Ka(de.x,de.y,T,E,this.transform.angle),R,M,z,k.predicate);if(K){const ye=X.getSymbolInstanceIconSize($,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,ye,K,Ka(de.x,de.y,T,E,this.transform.angle),R,M,z,k.predicate).box.length===0)return}if(ve.box.length>0){let ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[he]&&this.prevPlacement.placements[he]&&this.prevPlacement.placements[he].text&&(ye=this.prevPlacement.variableOffsets[he].anchor),this.variableOffsets[he]={textOffset:pe,width:p,height:g,anchor:r,textScale:y,prevAnchor:ye},this.markUsedJustification(X,r,N,W),X.allowVerticalPlacement&&(this.markUsedOrientation(X,W,N),this.placedOrientations[he]=W),{shift:de,placedGlyphBoxes:ve}}}placeLayerBucketPart(r,l,p,g){const{bucket:y,layout:T,posMatrix:E,textLabelPlaneMatrix:M,labelToScreenMatrix:z,clippingData:k,textPixelRatio:R,holdingForFade:N,collisionBoxArray:Z,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:W,collisionGroup:K}=r.parameters,B=T.get("text-optional"),$=T.get("icon-optional"),Q=T.get("text-allow-overlap"),ee=T.get("icon-allow-overlap"),he=T.get("text-rotation-alignment")==="map",pe=T.get("text-pitch-alignment")==="map",de=T.get("icon-text-fit")!=="none",ve=T.get("symbol-z-order")==="viewport-y";this.transform.setProjection(y.projection);let ye=Q&&(ee||!y.hasIconData()||$),Se=ee&&(Q||!y.hasTextData()||B);!y.collisionArrays&&Z&&y.deserializeCollisionBoxes(Z),p&&g&&y.updateCollisionDebugBuffers(this.transform.zoom,Z);const $e=(be,Fe,Me)=>{const{crossTileID:Ge,numVerticalGlyphVertices:Ee}=be;if(k){const wn={zoom:this.transform.zoom,pitch:this.transform.pitch};let sn=null;if(k.dynamicFilterNeedsFeature){const Wt=this.retainedQueryData[y.bucketInstanceId];sn=k.featureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:Wt.bucketIndex,sourceLayerIndex:Wt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(wn,sn,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new a.Point(be.tileAnchorX,be.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[Ge]=new Wa(!1,!1,!1,!0),void l.add(Ge)}if(l.has(Ge))return;if(N)return void(this.placements[Ge]=new Wa(!1,!1,!1));let Re=!1,qe=!1,Ue=!0,Xe=!1,ft=!1,Tt=null,ht={box:null,offscreen:null,occluded:null},xt={box:null,offscreen:null,occluded:null},Nt=null,Ot=null,pt=null,en=0,nn=0,rn=0;Me.textFeatureIndex?en=Me.textFeatureIndex:be.useRuntimeCollisionCircles&&(en=be.featureIndex),Me.verticalTextFeatureIndex&&(nn=Me.verticalTextFeatureIndex);const on=wn=>{wn.tileID=this.retainedQueryData[y.bucketInstanceId].tileID;const sn=this.transform.elevation;(sn||wn.elevation)&&(wn.elevation=sn?sn.getAtTileOffset(wn.tileID,wn.tileAnchorX,wn.tileAnchorY):0)},wi=Me.textBox;if(wi){on(wi);const wn=Wt=>{let Un=a.WritingMode.horizontal;if(y.allowVerticalPlacement&&!Wt&&this.prevPlacement){const Pi=this.prevPlacement.placedOrientations[Ge];Pi&&(this.placedOrientations[Ge]=Pi,Un=Pi,this.markUsedOrientation(y,Un,be))}return Un},sn=(Wt,Un)=>{if(y.allowVerticalPlacement&&Ee>0&&Me.verticalTextBox){for(const Pi of y.writingModes)if(Pi===a.WritingMode.vertical?(ht=Un(),xt=ht):ht=Wt(),ht&&ht.box&&ht.box.length)break}else ht=Wt()};if(T.get("text-variable-anchor")){let Wt=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ge]){const _n=this.prevPlacement.variableOffsets[Ge];Wt.indexOf(_n.anchor)>0&&(Wt=Wt.filter(Ri=>Ri!==_n.anchor),Wt.unshift(_n.anchor))}const Un=(_n,Ri,Pc)=>{const as=y.getSymbolInstanceTextSize(X,be,this.transform.zoom,Fe),gl=(_n.x2-_n.x1)*as+2*_n.padding,co=(_n.y2-_n.y1)*as+2*_n.padding,zo=de&&!ee?Ri:null;zo&&on(zo);let ls={box:[],offscreen:!1,occluded:!1};const Ic=Q?2*Wt.length:Wt.length;for(let _l=0;_l<Ic;++_l){const Ah=this.attemptAnchorPlacement(Wt[_l%Wt.length],_n,gl,co,as,he,pe,R,E,K,_l>=Wt.length,be,Fe,y,Pc,zo,X,W);if(Ah&&(ls=Ah.placedGlyphBoxes,ls&&ls.box&&ls.box.length)){Re=!0,Tt=Ah.shift;break}}return ls};sn(()=>Un(wi,Me.iconBox,a.WritingMode.horizontal),()=>{const _n=Me.verticalTextBox;return _n&&on(_n),y.allowVerticalPlacement&&!(ht&&ht.box&&ht.box.length)&&Ee>0&&_n?Un(_n,Me.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ht&&(Re=ht.box,Ue=ht.offscreen,Xe=ht.occluded);const Pi=wn(!(!ht||!ht.box));if(!Re&&this.prevPlacement){const _n=this.prevPlacement.variableOffsets[Ge];_n&&(this.variableOffsets[Ge]=_n,this.markUsedJustification(y,_n.anchor,be,Pi))}}else{const Wt=(Un,Pi)=>{const _n=y.getSymbolInstanceTextSize(X,be,this.transform.zoom,Fe),Ri=this.collisionIndex.placeCollisionBox(y,_n,Un,new a.Point(0,0),Q,R,E,K.predicate);return Ri&&Ri.box&&Ri.box.length&&(this.markUsedOrientation(y,Pi,be),this.placedOrientations[Ge]=Pi),Ri};sn(()=>Wt(wi,a.WritingMode.horizontal),()=>{const Un=Me.verticalTextBox;return y.allowVerticalPlacement&&Ee>0&&Un?(on(Un),Wt(Un,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),wn(!!(ht&&ht.box&&ht.box.length))}}if(Nt=ht,Re=Nt&&Nt.box&&Nt.box.length>0,Ue=Nt&&Nt.offscreen,Xe=Nt&&Nt.occluded,be.useRuntimeCollisionCircles){const wn=y.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex>=0?be.centerJustifiedTextSymbolIndex:be.verticalPlacedTextSymbolIndex),sn=a.evaluateSizeForFeature(y.textSizeData,X,wn),Wt=T.get("text-padding");Ot=this.collisionIndex.placeCollisionCircles(y,Q,wn,y.lineVertexArray,y.glyphOffsetArray,sn,E,M,z,p,pe,K.predicate,be.collisionCircleDiameter*sn/a.ONE_EM,Wt,this.retainedQueryData[y.bucketInstanceId].tileID),Re=Q||Ot.circles.length>0&&!Ot.collisionDetected,Ue=Ue&&Ot.offscreen,Xe=Ot.occluded}if(Me.iconFeatureIndex&&(rn=Me.iconFeatureIndex),Me.iconBox){const wn=sn=>{on(sn);const Wt=de&&Tt?Ka(Tt.x,Tt.y,he,pe,this.transform.angle):new a.Point(0,0),Un=y.getSymbolInstanceIconSize(W,this.transform.zoom,be.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,Un,sn,Wt,ee,R,E,K.predicate)};xt&&xt.box&&xt.box.length&&Me.verticalIconBox?(pt=wn(Me.verticalIconBox),qe=pt.box.length>0):(pt=wn(Me.iconBox),qe=pt.box.length>0),Ue=Ue&&pt.offscreen,ft=pt.occluded}const ai=B||be.numHorizontalGlyphVertices===0&&Ee===0,ar=$||be.numIconVertices===0;if(ai||ar?ar?ai||(qe=qe&&Re):Re=qe&&Re:qe=Re=qe&&Re,Re&&Nt&&Nt.box&&this.collisionIndex.insertCollisionBox(Nt.box,T.get("text-ignore-placement"),y.bucketInstanceId,xt&&xt.box&&nn?nn:en,K.ID),qe&&pt&&this.collisionIndex.insertCollisionBox(pt.box,T.get("icon-ignore-placement"),y.bucketInstanceId,rn,K.ID),Ot&&(Re&&this.collisionIndex.insertCollisionCircles(Ot.circles,T.get("text-ignore-placement"),y.bucketInstanceId,en,K.ID),p)){const wn=y.bucketInstanceId;let sn=this.collisionCircleArrays[wn];sn===void 0&&(sn=this.collisionCircleArrays[wn]=new Xa);for(let Wt=0;Wt<Ot.circles.length;Wt+=4)sn.circles.push(Ot.circles[Wt+0]),sn.circles.push(Ot.circles[Wt+1]),sn.circles.push(Ot.circles[Wt+2]),sn.circles.push(Ot.collisionDetected?1:0)}const Vr=y.projection.name!=="globe";ye=ye&&(Vr||!Xe),Se=Se&&(Vr||!ft),this.placements[Ge]=new Wa(Re||ye,qe||Se,Ue||y.justReloaded),l.add(Ge)};if(ve){const be=y.getSortedSymbolIndexes(this.transform.angle);for(let Fe=be.length-1;Fe>=0;--Fe){const Me=be[Fe];$e(y.symbolInstances.get(Me),Me,y.collisionArrays[Me])}}else for(let be=r.symbolInstanceStart;be<r.symbolInstanceEnd;be++)$e(y.symbolInstances.get(be),be,y.collisionArrays[be]);if(p&&y.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[y.bucketInstanceId];a.invert(be.invProjMatrix,E),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(r,l,p,g){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:M,crossTileID:z}=p,k=a.getAnchorJustification(l),R=g===a.WritingMode.vertical?M:k==="left"?y:k==="center"?T:k==="right"?E:-1;y>=0&&(r.text.placedSymbolArray.get(y).crossTileID=R>=0&&y!==R?0:z),T>=0&&(r.text.placedSymbolArray.get(T).crossTileID=R>=0&&T!==R?0:z),E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=R>=0&&E!==R?0:z),M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=R>=0&&M!==R?0:z)}markUsedOrientation(r,l,p){const g=l===a.WritingMode.horizontal||l===a.WritingMode.horizontalOnly?l:0,y=l===a.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:z}=p,k=r.text.placedSymbolArray;T>=0&&(k.get(T).placedOrientation=g),E>=0&&(k.get(E).placedOrientation=g),M>=0&&(k.get(M).placedOrientation=g),z>=0&&(k.get(z).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const g=l?l.symbolFadeChange(r):1,y=l?l.opacities:{},T=l?l.variableOffsets:{},E=l?l.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],k=y[M];k?(this.opacities[M]=new no(k,g,z.text,z.icon,null,z.clipped),p=p||z.text!==k.text.placed||z.icon!==k.icon.placed):(this.opacities[M]=new no(null,g,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const M in y){const z=y[M];if(!this.opacities[M]){const k=new no(z,g,!1,!1);k.isHidden()||(this.opacities[M]=k,p=p||z.text.placed||z.icon.placed)}}for(const M in T)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=T[M]);for(const M in E)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=E[M]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const p=new Set;for(const g of l){const y=g.getBucket(r);y&&g.latestFeatureIndex&&r.id===y.layerIds[0]&&this.updateBucketOpacities(y,p,g.collisionBoxArray)}}updateBucketOpacities(r,l,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const g=r.layers[0].layout,y=!!r.layers[0].dynamicFilter(),T=new no(null,0,!1,!1,!0),E=g.get("text-allow-overlap"),M=g.get("icon-allow-overlap"),z=g.get("text-variable-anchor"),k=g.get("text-rotation-alignment")==="map",R=g.get("text-pitch-alignment")==="map",N=g.get("icon-text-fit")!=="none",Z=new no(null,0,E&&(M||!r.hasIconData()||g.get("icon-optional")),M&&(E||!r.hasTextData()||g.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const X=(K,B,$)=>{for(let Q=0;Q<B/4;Q++)K.opacityVertexArray.emplaceBack($)};let W=0;for(let K=0;K<r.symbolInstances.length;K++){const B=r.symbolInstances.get(K),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:Q,crossTileID:ee,numIconVertices:he}=B,pe=l.has(ee);let de=this.opacities[ee];pe?de=T:de||(de=Z,this.opacities[ee]=de),l.add(ee);const ve=$>0||Q>0,ye=he>0,Se=this.placedOrientations[ee],$e=Se===a.WritingMode.vertical,be=Se===a.WritingMode.horizontal||Se===a.WritingMode.horizontalOnly;if(!ve&&!ye||de.isHidden()||W++,ve){const Fe=Ya(de.text);X(r.text,$,$e?Pn:Fe),X(r.text,Q,be?Pn:Fe);const Me=de.text.isHidden(),{leftJustifiedTextSymbolIndex:Ge,centerJustifiedTextSymbolIndex:Ee,rightJustifiedTextSymbolIndex:Re,verticalPlacedTextSymbolIndex:qe}=B,Ue=r.text.placedSymbolArray,Xe=Me||$e?1:0;Ge>=0&&(Ue.get(Ge).hidden=Xe),Ee>=0&&(Ue.get(Ee).hidden=Xe),Re>=0&&(Ue.get(Re).hidden=Xe),qe>=0&&(Ue.get(qe).hidden=Me||be?1:0);const ft=this.variableOffsets[ee];ft&&this.markUsedJustification(r,ft.anchor,B,Se);const Tt=this.placedOrientations[ee];Tt&&(this.markUsedJustification(r,"left",B,Tt),this.markUsedOrientation(r,Tt,B))}if(ye){const Fe=Ya(de.icon),{placedIconSymbolIndex:Me,verticalPlacedIconSymbolIndex:Ge}=B,Ee=r.icon.placedSymbolArray,Re=de.icon.isHidden()?1:0;Me>=0&&(X(r.icon,he,$e?Pn:Fe),Ee.get(Me).hidden=Re),Ge>=0&&(X(r.icon,B.numVerticalIconVertices,be?Pn:Fe),Ee.get(Ge).hidden=Re)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Fe=r.collisionArrays[K];if(Fe){let Me=new a.Point(0,0),Ge=!0;if(Fe.textBox||Fe.verticalTextBox){if(z){const Re=this.variableOffsets[ee];Re?(Me=Ha(Re.anchor,Re.width,Re.height,Re.textOffset,Re.textScale),k&&Me._rotate(R?this.transform.angle:-this.transform.angle)):Ge=!1}y&&(Ge=!de.clipped),Fe.textBox&&Os(r.textCollisionBox.collisionVertexArray,de.text.placed,!Ge||$e,Me.x,Me.y),Fe.verticalTextBox&&Os(r.textCollisionBox.collisionVertexArray,de.text.placed,!Ge||be,Me.x,Me.y)}const Ee=Ge&&!!(!be&&Fe.verticalIconBox);Fe.iconBox&&Os(r.iconCollisionBox.collisionVertexArray,de.icon.placed,Ee,N?Me.x:0,N?Me.y:0),Fe.verticalIconBox&&Os(r.iconCollisionBox.collisionVertexArray,de.icon.placed,!Ee,N?Me.x:0,N?Me.y:0)}}}if(r.fullyClipped=W===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=K.invProjMatrix,r.placementViewportMatrix=K.viewportMatrix,r.collisionCircleArray=K.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Os(h,r,l,p,g){h.emplaceBack(r?1:0,l?1:0,p||0,g||0),h.emplaceBack(r?1:0,l?1:0,p||0,g||0),h.emplaceBack(r?1:0,l?1:0,p||0,g||0),h.emplaceBack(r?1:0,l?1:0,p||0,g||0)}const Di=Math.pow(2,25),Rn=Math.pow(2,24),Vu=Math.pow(2,17),Uu=Math.pow(2,16),Li=Math.pow(2,9),rr=Math.pow(2,8),yp=Math.pow(2,1);function Ya(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const r=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Di+r*Rn+l*Vu+r*Uu+l*Li+r*rr+l*yp+r}const Pn=0;class Ja{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,l,p,g,y){const T=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(T,g,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((E,M)=>E.sortKey-M.sortKey));this._currentPartIndex<T.length;){const E=T[this._currentPartIndex];if(l.placeLayerBucketPart(E,this._seenCrossTileIDs,p,E.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class Nu{constructor(r,l,p,g,y,T,E,M){this.placement=new nc(r,y,T,E,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p){const g=a.exported.now(),y=()=>{const T=a.exported.now()-g;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=l[r[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=E)&&(!T.maxzoom||T.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Ja(T)),this._inProgressLayer.continuePlacement(p[T.source],this.placement,this._showCollisionBoxes,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const es=512/a.EXTENT/2;class pi{constructor(r,l,p){this.tileID=r,this.bucketInstanceId=p,this.index=new a.KDBush(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=r.canonical.x*a.EXTENT,y=r.canonical.y*a.EXTENT;for(let T=0;T<l.length;T++){const{key:E,crossTileID:M,tileAnchorX:z,tileAnchorY:k}=l.get(T),R=Math.floor((g+z)*es),N=Math.floor((y+k)*es);this.index.add(R,N),this.keys.push(E),this.crossTileIDs.push(M)}this.index.finish()}findMatches(r,l,p){const g=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),y=es/Math.pow(2,l.canonical.z-this.tileID.canonical.z),T=l.canonical.x*a.EXTENT,E=l.canonical.y*a.EXTENT;for(let M=0;M<r.length;M++){const z=r.get(M);if(z.crossTileID)continue;const{key:k,tileAnchorX:R,tileAnchorY:N}=z,Z=Math.floor((T+R)*y),X=Math.floor((E+N)*y),W=this.index.range(Z-g,X-g,Z+g,X+g);for(const K of W){const B=this.crossTileIDs[K];if(this.keys[K]===k&&!p.has(B)){p.add(B),z.crossTileID=B;break}}}}}class ju{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const p in this.indexes){const g=this.indexes[p],y={};for(const T in g){const E=g[T];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+l),y[E.tileID.key]=E}this.indexes[p]=y}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const g=this.usedCrossTileIDs[r.overscaledZ];for(const y in this.indexes){const T=this.indexes[y];if(Number(y)>r.overscaledZ)for(const E in T){const M=T[E];M.tileID.isChildOf(r)&&M.findMatches(l.symbolInstances,r,g)}else{const E=T[r.scaledTo(Number(y)).key];E&&E.findMatches(l.symbolInstances,r,g)}}for(let y=0;y<l.symbolInstances.length;y++){const T=l.symbolInstances.get(y);T.crossTileID||(T.crossTileID=p.generate(),g.add(T.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new pi(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const p of l.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let l=!1;for(const p in this.indexes){const g=this.indexes[p];for(const y in g)r[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[y]),delete g[y],l=!0)}return l}}class io{constructor(){this.layerIndexes={},this.crossTileIDs=new ju,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p,g){let y=this.layerIndexes[r.id];y===void 0&&(y=this.layerIndexes[r.id]=new Gu);let T=!1;const E={};g.name!=="globe"&&y.handleWrapJump(p);for(const M of l){const z=M.getBucket(r);z&&r.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(M.tileID,z,this.crossTileIDs)&&(T=!0),E[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(T=!0),T}pruneUnusedLayers(r){const l={};r.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const Io=(h,r)=>a.emitValidationErrors(h,r&&r.filter(l=>l.identifier!=="source.canvas")),ic=a.pick(Ht,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Tg=a.pick(Ht,["setCenter","setZoom","setBearing","setPitch"]),$u={version:8,layers:[],sources:{}},Vs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Br extends a.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new vt(Bs(),this),this.imageManager=new bn,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(r._requestManager,l.localFontFamily?a.LocalGlyphMode.all:l.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new io,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const p=this;this._rtlTextPluginCallback=Br.registerForPluginStateChange(g=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(y,T)=>{if(a.triggerPluginCompletionEvent(y),T&&T.every(E=>E))for(const E in p._sourceCaches){const M=p._sourceCaches[E],z=M.getSource().type;z!=="vector"&&z!=="geojson"||M.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const y=this.getSource(g.sourceId);if(y&&y.vectorLayerIds)for(const T in this._layers){const E=this._layers[T];E.source===y.id&&this._validateLayer(E)}})}loadURL(r,l={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!a.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const g=this.map._requestManager.transformRequest(r,a.ResourceType.Style);this._request=a.getJSON(g,(y,T)=>{this._request=null,y?this.fire(new a.ErrorEvent(y)):T&&this._load(T,p)})}loadJSON(r,l={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load($u,!1)}_updateLayerCount(r,l){const p=l?1:-1;r.is3D()&&(this._num3DLayers+=p),r.type==="circle"&&(this._numCircleLayers+=p),r.type==="symbol"&&(this._numSymbolLayers+=p)}_load(r,l){if(l&&Io(this,a.validateStyle(r)))return;this._loaded=!0,this.stylesheet=a.clone$1(r),this._updateMapProjection();for(const g in r.sources)this.addSource(g,r.sources[g],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=pp(this.stylesheet.layers);this._order=p.map(g=>g.id),this._layers={},this._serializedLayers={};for(const g of p){const y=a.createStyleLayer(g);y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Jt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,p,g){let y,T,E;const M=a.exported.devicePixelRatio>1?"@2x":"";let z=a.getJSON(p.transformRequest(p.normalizeSpriteURL(l,M,".json"),a.ResourceType.SpriteJSON),(N,Z)=>{z=null,E||(E=N,y=Z,R())}),k=a.getImage(p.transformRequest(p.normalizeSpriteURL(l,M,".png"),a.ResourceType.SpriteImage),(N,Z)=>{k=null,E||(E=N,T=Z,R())});function R(){if(E)g(E);else if(y&&T){const N=a.exported.getImageData(T),Z={};for(const X in y){const{width:W,height:K,x:B,y:$,sdf:Q,pixelRatio:ee,stretchX:he,stretchY:pe,content:de}=y[X],ve=new a.RGBAImage({width:W,height:K});a.RGBAImage.copy(N,ve,{x:B,y:$},{x:0,y:0},{width:W,height:K}),Z[X]={data:ve,pixelRatio:ee,sdf:Q,stretchX:he,stretchY:pe,content:de}}g(null,Z)}}return{cancel(){z&&(z.cancel(),z=null),k&&(k.cancel(),k=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new a.ErrorEvent(l));else if(p)for(const g in p)this.imageManager.addImage(g,p[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const p=r.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const p of r){const g=this._layers[p];g.type!=="custom"&&l.push(g.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&(typeof r.isLayerDraped=="function"?r.isLayerDraped():Vs[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(g.length||y.length)&&this._updateWorkerLayers(g,y);for(const T in this._updatedSources){const E=this._updatedSources[T];E==="reload"?this._reloadSource(T):E==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const g in this._sourceCaches){const y=this._sourceCaches[g];p[g]=y.used,y.used=!1}for(const g of this._order){const y=this._layers[g];if(y.recalculate(r,this._availableImages),!y.isHidden(r.zoom)){const E=this._getLayerSourceCache(y);E&&(E.used=!0)}const T=this.map.painter;if(T){const E=y.getProgramIds();if(!E)continue;const M=y.getProgramConfiguration(r.zoom);for(const z of E)T.useProgram(z,M)}}for(const g in p){const y=this._sourceCaches[g];p[g]!==y.used&&y.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Io(this,a.validateStyle(r)))return!1;(r=a.clone$1(r)).layers=pp(r.layers);const l=function(g,y){if(!g)return[{command:Ht.setStyle,args:[y]}];let T=[];try{if(!I(g.version,y.version))return[{command:Ht.setStyle,args:[y]}];I(g.center,y.center)||T.push({command:Ht.setCenter,args:[y.center]}),I(g.zoom,y.zoom)||T.push({command:Ht.setZoom,args:[y.zoom]}),I(g.bearing,y.bearing)||T.push({command:Ht.setBearing,args:[y.bearing]}),I(g.pitch,y.pitch)||T.push({command:Ht.setPitch,args:[y.pitch]}),I(g.sprite,y.sprite)||T.push({command:Ht.setSprite,args:[y.sprite]}),I(g.glyphs,y.glyphs)||T.push({command:Ht.setGlyphs,args:[y.glyphs]}),I(g.transition,y.transition)||T.push({command:Ht.setTransition,args:[y.transition]}),I(g.light,y.light)||T.push({command:Ht.setLight,args:[y.light]}),I(g.fog,y.fog)||T.push({command:Ht.setFog,args:[y.fog]}),I(g.projection,y.projection)||T.push({command:Ht.setProjection,args:[y.projection]});const E={},M=[];(function(R,N,Z,X){let W;for(W in N=N||{},R=R||{})R.hasOwnProperty(W)&&(N.hasOwnProperty(W)||$a(W,Z,X));for(W in N){if(!N.hasOwnProperty(W))continue;const K=N[W];R.hasOwnProperty(W)?I(R[W],K)||(R[W].type==="geojson"&&K.type==="geojson"&&tc(R,N,W)?Z.push({command:Ht.setGeoJSONSourceData,args:[W,K.data]}):Lu(W,N,Z,X)):Du(W,N,Z)}})(g.sources,y.sources,M,E);const z=[];g.layers&&g.layers.forEach(R=>{R.source&&E[R.source]?T.push({command:Ht.removeLayer,args:[R.id]}):z.push(R)});let k=g.terrain;k&&E[k.source]&&(T.push({command:Ht.setTerrain,args:[void 0]}),k=void 0),T=T.concat(M),I(k,y.terrain)||T.push({command:Ht.setTerrain,args:[y.terrain]}),function(R,N,Z){N=N||[];const X=(R=R||[]).map(Qr),W=N.map(Qr),K=R.reduce(Ru,{}),B=N.reduce(Ru,{}),$=X.slice(),Q=Object.create(null);let ee,he,pe,de,ve,ye,Se;for(ee=0,he=0;ee<X.length;ee++)pe=X[ee],B.hasOwnProperty(pe)?he++:(Z.push({command:Ht.removeLayer,args:[pe]}),$.splice($.indexOf(pe,he),1));for(ee=0,he=0;ee<W.length;ee++)pe=W[W.length-1-ee],$[$.length-1-ee]!==pe&&(K.hasOwnProperty(pe)?(Z.push({command:Ht.removeLayer,args:[pe]}),$.splice($.lastIndexOf(pe,$.length-he),1)):he++,ye=$[$.length-ee],Z.push({command:Ht.addLayer,args:[B[pe],ye]}),$.splice($.length-ee,0,pe),Q[pe]=!0);for(ee=0;ee<W.length;ee++)if(pe=W[ee],de=K[pe],ve=B[pe],!Q[pe]&&!I(de,ve))if(I(de.source,ve.source)&&I(de["source-layer"],ve["source-layer"])&&I(de.type,ve.type)){for(Se in Lr(de.layout,ve.layout,Z,pe,null,Ht.setLayoutProperty),Lr(de.paint,ve.paint,Z,pe,null,Ht.setPaintProperty),I(de.filter,ve.filter)||Z.push({command:Ht.setFilter,args:[pe,ve.filter]}),I(de.minzoom,ve.minzoom)&&I(de.maxzoom,ve.maxzoom)||Z.push({command:Ht.setLayerZoomRange,args:[pe,ve.minzoom,ve.maxzoom]}),de)de.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?Lr(de[Se],ve[Se],Z,pe,Se.slice(6),Ht.setPaintProperty):I(de[Se],ve[Se])||Z.push({command:Ht.setLayerProperty,args:[pe,Se,ve[Se]]}));for(Se in ve)ve.hasOwnProperty(Se)&&!de.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?Lr(de[Se],ve[Se],Z,pe,Se.slice(6),Ht.setPaintProperty):I(de[Se],ve[Se])||Z.push({command:Ht.setLayerProperty,args:[pe,Se,ve[Se]]}))}else Z.push({command:Ht.removeLayer,args:[pe]}),ye=$[$.lastIndexOf(pe)+1],Z.push({command:Ht.addLayer,args:[ve,ye]})}(z,y.layers,T)}catch(E){console.warn("Unable to compute style diff:",E),T=[{command:Ht.setStyle,args:[y]}]}return T}(this.serialize(),r).filter(g=>!(g.command in Tg));if(l.length===0)return!1;const p=l.filter(g=>!(g.command in ic));if(p.length>0)throw new Error(`Unimplemented: ${p.map(g=>g.command).join(", ")}.`);return l.forEach(g=>{g.command!=="setTransition"&&g.command!=="setProjection"&&this[g.command].apply(this,g.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,p={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(a.validateSource,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const g=Ft(r,l,this.dispatcher,this);g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:g.serialize(),sourceId:r}));const y=T=>{const E=(T?"symbol:":"other:")+r,M=this._sourceCaches[E]=new a.SourceCache(E,g,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[r]=M,M.style=this,M.onAdd(this.map)};y(!1),l.type!=="vector"&&l.type!=="geojson"||y(!0),g.onAdd&&g.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===r)return this.fire(new a.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new a.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const g of p)delete this._sourceCaches[g.id],delete this._updatedSources[g.id],g.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}_getSources(){const r=[];for(const l in this._otherSourceCaches){const p=this._getSourceCache(l);p&&r.push(p.getSource())}return r}addLayer(r,l,p={}){this._checkLoaded();const g=r.id;if(this.getLayer(g))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${g}" already exists on this map`)));let y;if(r.type==="custom"){if(Io(this,a.validateCustomStyleLayer(r)))return;y=a.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(g,r.source),r=a.clone$1(r),r=a.extend(r,{source:g})),this._validate(a.validateLayer,`layers.${g}`,r,{arrayIndex:-1},p))return;y=a.createStyleLayer(r),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const T=l?this._order.indexOf(l):this._order.length;if(l&&T===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(T,0,g),this._layerOrderChanged=!0,this._layers[g]=y;const E=this._getLayerSourceCache(y);if(this._removedLayers[g]&&y.source&&E&&y.type!=="custom"){const M=this._removedLayers[g];delete this._removedLayers[g],M.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const p=this._order.indexOf(r);this._order.splice(p,1);const g=l?this._order.indexOf(l):this._order.length;l&&g===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(g,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();const g=this.getLayer(r);g?g.minzoom===l&&g.maxzoom===p||(l!=null&&(g.minzoom=l),p!=null&&(g.maxzoom=p),this._updateLayer(g)):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,p={}){this._checkLoaded();const g=this.getLayer(r);if(g){if(!I(g.filter,l))return l==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(a.validateFilter,`layers.${g.id}.filter`,l,{layerType:g.type},p)||(g.filter=a.clone$1(l),this._updateLayer(g)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const l=this.getLayer(r);return l&&a.clone$1(l.filter)}setLayoutProperty(r,l,p,g={}){this._checkLoaded();const y=this.getLayer(r);y?I(y.getLayoutProperty(l),p)||(y.setLayoutProperty(l,p,g),this._updateLayer(y)):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const p=this.getLayer(r);if(p)return p.getLayoutProperty(l);this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,p,g={}){this._checkLoaded();const y=this.getLayer(r);y?I(y.getPaintProperty(l),p)||(y.setPaintProperty(l,p,g)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){const p=this.getLayer(r);return p&&p.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const p=r.source,g=r.sourceLayer,y=this.getSource(p);if(!y)return void this.fire(new a.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const T=y.type;if(T==="geojson"&&g)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!g)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(p);for(const M of E)M.setFeatureState(g,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const p=r.source,g=this.getSource(p);if(!g)return void this.fire(new a.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const y=g.type,T=y==="vector"?r.sourceLayer:void 0;if(y==="vector"&&!T)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(p);for(const M of E)M.removeFeatureState(T,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,p=r.sourceLayer,g=this.getSource(l);if(g){if(g.type!=="vector"||p)return r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=T=>this._layers[T].type==="fill-extrusion",p={},g=[];for(let T=this._order.length-1;T>=0;T--){const E=this._order[T];if(l(E)){p[E]=T;for(const M of r){const z=M[E];if(z)for(const k of z)g.push(k)}}}g.sort((T,E)=>E.intersectionZ-T.intersectionZ);const y=[];for(let T=this._order.length-1;T>=0;T--){const E=this._order[T];if(l(E))for(let M=g.length-1;M>=0;M--){const z=g[M].feature;if(p[z.layer.id]<T)break;y.push(z),g.pop()}else for(const M of r){const z=M[E];if(z)for(const k of z)y.push(k.feature)}}return y}queryRenderedFeatures(r,l,p){l&&l.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const g={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of l.layers){const z=this._layers[M];if(!z)return this.fire(new a.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];g[z.source]=!0}}const y=[];l.availableImages=this._availableImages;const T=l&&l.layers?l.layers.some(M=>{const z=this.getLayer(M);return z&&z.is3D()}):this.has3DLayers(),E=Qt.createFromScreenPoints(r,p);for(const M in this._sourceCaches){const z=this._sourceCaches[M].getSource().id;l.layers&&!g[z]||y.push(Sn(this._sourceCaches[M],this._layers,this._serializedLayers,E,l,p,T,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(M,z,k,R,N,Z,X){const W={},K=Z.queryRenderedSymbols(R),B=[];for(const $ of Object.keys(K).map(Number))B.push(X[$]);B.sort(vi);for(const $ of B){const Q=$.featureIndex.lookupSymbolFeatures(K[$.bucketInstanceId],z,$.bucketIndex,$.sourceLayerIndex,N.filter,N.layers,N.availableImages,M);for(const ee in Q){const he=W[ee]=W[ee]||[],pe=Q[ee];pe.sort((de,ve)=>{const ye=$.featureSortOrder;if(ye){const Se=ye.indexOf(de.featureIndex);return ye.indexOf(ve.featureIndex)-Se}return ve.featureIndex-de.featureIndex});for(const de of pe)he.push(de)}}for(const $ in W)W[$].forEach(Q=>{const ee=Q.feature,he=k(M[$]);if(!he)return;const pe=he.getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=pe});return W}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,l){l&&l.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(r);let g=[];for(const y of p)g=g.concat(On(y,l));return g}addSourceType(r,l,p){return Br.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Br.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const T in r)if(!I(r[T],p[T])){g=!0;break}if(!g)return;const y=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let p=r;if(l===1){if(typeof p.source=="object"){const g="terrain-dem-src";this.addSource(g,p.source),p=a.clone$1(p),p=a.extend(p,{source:g})}if(this._validate(a.validateTerrain,"terrain",p))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l)}else{const g=this.terrain,y=g.get();for(const T of Object.keys(a.spec.terrain))!p.hasOwnProperty(T)&&a.spec.terrain[T].default&&(p[T]=a.spec.terrain[T].default);for(const T in p)if(!I(p[T],y[T])){g.set(p),this.stylesheet.terrain=p;const E=this._setTransitionParameters({duration:0});g.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new Et(r,this.map.transform);this.stylesheet.fog=r;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();Object.keys(r).length===0&&l.set(r);for(const g in r)if(!I(r[g],p[g])){l.set(r),this.stylesheet.fog=r;const y=this._setTransitionParameters({duration:0});l.updateTransitions(y);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:a.exported.now(),transition:a.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const p=this.terrain=new vn(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const g=this._setTransitionParameters({duration:0});p.updateTransitions(g)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,p,g,y={}){return(!y||y.validate!==!1)&&Io(this,r.call(a.validateStyle,a.extend({key:l,style:this.serialize(),value:p,styleSpec:a.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const p of l)p.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const p of l)p.resume(),p.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,g,y=!1){let T=!1,E=!1;const M={};for(const z of this._order){const k=this._layers[z];if(k.type!=="symbol")continue;if(!M[k.source]){const N=this._getLayerSourceCache(k);if(!N)continue;M[k.source]=N.getRenderableIds(!0).map(Z=>N.getTileByID(Z)).sort((Z,X)=>X.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(X.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(k,M[k.source],r.center.lng,r.projection);T=T||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),r.zoom))&&(this.pauseablePlacement=new Nu(r,this._order,y,l,p,g,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),E=!0),T&&this.pauseablePlacement.placement.setStale()),E||T)for(const z of this._order){const k=this._layers[z];k.type==="symbol"&&this.placement.updateLayerOpacities(k,M[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const g=y=>{y&&y.setDependencies(l.tileID.key,l.type,l.icons)};g(this._otherSourceCaches[l.source]),g(this._symbolSourceCaches[l.source])}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(r,l,p){return a.makeRequest(l,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this._getSourceCaches(r);return l.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Br.getSourceType=function(h){return kt[h]},Br.setSourceType=function(h,r){kt[h]=r},Br.registerForPluginStateChange=a.registerForPluginStateChange;var Zu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,ts="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ro=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Qa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,oo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let rc={},Us={};const el=[];Ns(Zu,el),Ns(ro,el),Ns(Qa,el),Ns(oo,el),rc=Kt("",ro),Us=Kt(oo,Qa);const vp=Kt(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),oc=Zu,qu=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Wu={background:Kt(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Kt(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Kt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Kt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Kt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Kt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Kt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Kt(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Kt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Kt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Kt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Kt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Kt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Kt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ts),skyboxGradient:Kt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ts),skyboxCapture:Kt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Kt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Kt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ns(h,r){const l=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=p.split(" ");for(const y of g)r.includes(y)||r.push(y)}}function Kt(h,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),g={},y=[...el];return Ns(h,y),Ns(r,y),{fragmentSource:h=h.replace(l,(T,E,M,z,k)=>(g[k]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${k}
varying ${M} ${z} ${k};
#else
uniform ${M} ${z} u_${k};
#endif
`:`
#ifdef HAS_UNIFORM_u_${k}
    ${M} ${z} ${k} = u_${k};
#endif
`)),vertexSource:r=r.replace(l,(T,E,M,z,k)=>{const R=z==="float"?"vec2":"vec4",N=k.match(/color/)?"color":R;return g[k]?E==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${M} ${R} a_${k};
varying ${M} ${z} ${k};
#else
uniform ${M} ${z} u_${k};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${M} ${z} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${N}(a_${k}, u_${k}_t);
#else
    ${M} ${z} ${k} = u_${k};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${M} ${R} a_${k};
#else
uniform ${M} ${z} u_${k};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${M} ${z} ${k} = a_${k};
#else
    ${M} ${z} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${M} ${z} ${k} = unpack_mix_${N}(a_${k}, u_${k}_t);
#else
    ${M} ${z} ${k} = u_${k};
#endif
`}),staticAttributes:p,usedDefines:y}}class Eg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,p,g,y,T,E){this.context=r;let M=this.boundPaintVertexBuffers.length!==g.length;for(let k=0;!M&&k<g.length;k++)this.boundPaintVertexBuffers[k]!==g[k]&&(M=!0);let z=this.boundDynamicVertexBuffers.length!==E.length;for(let k=0;!z&&k<E.length;k++)this.boundDynamicVertexBuffers[k]!==E[k]&&(z=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||M||z||this.boundIndexBuffer!==y||this.boundVertexOffset!==T)this.freshBind(l,p,g,y,T,E);else{r.bindVertexArrayOES.set(this.vao);for(const k of E)k&&k.bind();y&&y.dynamicDraw&&y.bind()}}freshBind(r,l,p,g,y,T){let E;const M=r.numAttributes,z=this.context,k=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),E=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=T;else{E=z.currentNumAttributes||0;for(let R=M;R<E;R++)k.disableVertexAttribArray(R)}l.enableAttributes(k,r),l.bind(),l.setVertexAttribPointers(k,r,y);for(const R of p)R.enableAttributes(k,r),R.bind(),R.setVertexAttribPointers(k,r,y);for(const R of T)R&&(R.enableAttributes(k,r),R.bind(),R.setVertexAttribPointers(k,r,y));g&&g.bind(),z.currentNumAttributes=M}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Xu(h,r){const l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new a.MercatorCoordinate(0,p/l).toLngLat().lat,new a.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function xp(h,r,l,p,g,y,T){const E=h.context,M=E.gl,z=l.fbo;if(!z)return;h.prepareDrawTile();const k=h.useProgram("hillshade");E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,z.colorAttachment.get());const R=((W,K,B,$)=>{const Q=B.paint.get("hillshade-shadow-color"),ee=B.paint.get("hillshade-highlight-color"),he=B.paint.get("hillshade-accent-color");let pe=B.paint.get("hillshade-illumination-direction")*(Math.PI/180);B.paint.get("hillshade-illumination-anchor")==="viewport"&&(pe-=W.transform.angle);const de=!W.options.moving;return{u_matrix:$||W.transform.calculateProjMatrix(K.tileID.toUnwrapped(),de),u_image:0,u_latrange:Xu(0,K.tileID),u_light:[B.paint.get("hillshade-exaggeration"),pe],u_shadow:Q,u_highlight:ee,u_accent:he}})(h,l,p,h.terrain?r.projMatrix:null);h.prepareDrawProgram(E,k,r.toUnwrapped());const{tileBoundsBuffer:N,tileBoundsIndexBuffer:Z,tileBoundsSegments:X}=h.getTileBoundsBuffers(l);k.draw(E,M.TRIANGLES,g,y,T,a.CullFaceMode.disabled,R,p.id,N,Z,X)}function Hu(h,r,l){if(!r.needsDEMTextureUpload)return;const p=h.context,g=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(l.stride);const y=l.getPixels();r.demTexture?r.demTexture.update(y,{premultiply:!1}):r.demTexture=new a.Texture(p,y,g.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function wp(h,r,l,p,g,y){const T=h.context,E=T.gl;if(!r.dem)return;const M=r.dem;if(T.activeTexture.set(E.TEXTURE1),Hu(h,r,M),!r.demTexture)return;r.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const z=M.dim;T.activeTexture.set(E.TEXTURE0);let k=r.fbo;if(!k){const X=new a.Texture(T,{width:z,height:z,data:null},E.RGBA);X.bind(E.LINEAR,E.CLAMP_TO_EDGE),k=r.fbo=T.createFramebuffer(z,z,!0),k.colorAttachment.set(X.texture)}T.bindFramebuffer.set(k.framebuffer),T.viewport.set([0,0,z,z]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:N,tileBoundsSegments:Z}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(T,E.TRIANGLES,p,g,y,a.CullFaceMode.disabled,((X,W)=>{const K=W.stride,B=a.create();return a.ortho(B,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(B,B,[0,-a.EXTENT,0]),{u_matrix:B,u_image:1,u_dimension:[K,K],u_zoom:X.overscaledZ,u_unpack:W.unpackVector}})(r.tileID,M),l.id,R,N,Z),r.needsHillshadePrepare=!1}const Ku=h=>({u_matrix:new a.UniformMatrix4f(h),u_image0:new a.Uniform1i(h),u_skirt_height:new a.Uniform1f(h)}),js=(h,r)=>({u_matrix:h,u_image0:0,u_skirt_height:r}),sc=(h,r,l,p,g,y,T,E,M,z,k,R,N,Z,X)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:g,u_merc_center:y,u_image0:0,u_frustum_tl:T,u_frustum_tr:E,u_frustum_br:M,u_frustum_bl:z,u_globe_pos:k,u_globe_radius:R,u_viewport:N,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:Z});function Gs(h,r){return h!=null&&r!=null&&!(!h.hasData()||!r.hasData())&&h.demTexture!=null&&r.demTexture!=null&&h.tileID.key!==r.tileID.key}const so=new class{constructor(){this.operations={}}newMorphing(h,r,l,p,g){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==l.tileID.key&&(y.queued=l)}else this.operations[h]={startTime:p,phase:0,duration:g,from:r,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(const r in this.operations){const l=this.operations[r];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},ns={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ac(h){return 6*Math.pow(1.5,22-h)}function bp(h,r){const l=1<<h.z;return!r&&(h.x===0||h.x===l-1)||h.y===0||h.y===l-1}const tl=h=>({u_matrix:h});function Yu(h,r,l,p,g){if(g>0){const y=a.exported.now(),T=(y-h.timeAdded)/g,E=r?(y-r.timeAdded)/g:-1,M=l.getSource(),z=p.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),k=!r||Math.abs(r.tileID.overscaledZ-z)>Math.abs(h.tileID.overscaledZ-z),R=k&&h.refreshedUponExpiration?1:a.clamp(k?T:1-E,0,1);return h.refreshedUponExpiration&&T>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class Ju extends a.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new vt(Bs(),null),g=Ft("mock-dem",l,p,r.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class lc extends a.SourceCache{constructor(r){const l=Ft("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new vt(Bs(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;const g=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,T)=>{if(y[T.key]="",!this._tiles[T.key]){const E=new a.Tile(T,this._source.tileSize*T.overscaleFactor(),r.tileZoom);E.state="loaded",this._tiles[T.key]=E}return y},{});for(const y in this._tiles)y in g||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(r){const l=this.proxyCachedFBO[r];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class cc extends a.OverscaledTileID{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class Qu extends a.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,g,y]=function(M){const z=new a.StructArrayLayout2i4,k=new a.StructArrayLayout3ui6,R=131;z.reserve(17161),k.reserve(33800);const N=a.EXTENT/128,Z=a.EXTENT+N/2,X=Z+N;for(let K=-N;K<X;K+=N)for(let B=-N;B<X;B+=N){const $=B<0||B>Z||K<0||K>Z?24575:0,Q=a.clamp(Math.round(B),0,a.EXTENT),ee=a.clamp(Math.round(K),0,a.EXTENT);z.emplaceBack(Q+$,ee)}const W=(K,B)=>{const $=B*R+K;k.emplaceBack($+1,$,$+R),k.emplaceBack($+R,$+R+1,$+1)};for(let K=1;K<129;K++)for(let B=1;B<129;B++)W(B,K);return[0,129].forEach(K=>{for(let B=0;B<130;B++)W(B,K),W(K,B)}),[z,k,32768]}(),T=r.context;this.gridBuffer=T.createVertexBuffer(p,a.posAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(g),this.gridSegments=a.SegmentVector.simpleSegment(0,0,p.length,g.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,p.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new lc(l.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.EXTENT,0,a.EXTENT,0,1);const E=T.gl;this._overlapStencilMode=new a.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ju(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const g=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(g.get("source")),this._exaggeration=g.get("exaggeration");const y=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(l,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=l.getIds().map(M=>{const z=l.getTileByID(M).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(M,z){const k=z.transform.pointCoordinate(z.transform.getCameraPoint()),R=new a.Point(k.x,k.y);M.sort((N,Z)=>{if(Z.overscaledZ-N.overscaledZ)return Z.overscaledZ-N.overscaledZ;const X=new a.Point(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),W=new a.Point(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),K=R.mult(1<<N.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(X)-K.distSqr(W)})})(g,this.painter),this._previousZoom=p.zoom;const y=this.proxyToSource||{};this.proxyToSource={},g.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const M in T){const z=T[M];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,r[M],y),z.usedForTerrain))continue;const k=r[M];z.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[l.id]=g.map(M=>new cc(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const E={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const z=this.terrainTileForTile[M.key];if(!z)continue;const k=z.tileID.key;k in E||(this._visibleDemTiles.push(z),E[k]=k)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const p in this.terrainTileForTile){const g=this.terrainTileForTile[p],y=g.dem;!y||g.demTexture&&!g.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),Hu(this.painter,g,y))}}_prepareDemTileUniforms(r,l,p,g){if(!l||l.demTexture==null)return!1;const y=r.tileID.canonical,T=Math.pow(2,l.tileID.canonical.z-y.z),E=g||"";return p[`u_dem_tl${E}`]=[y.x*T%1,y.y*T%1],p[`u_dem_scale${E}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const p=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(r,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((p,g)=>{if(!g.dem)return p;const y=g.dem.tree.minimums[0];return y>0&&r++,p+y},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),g=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(g,{premultiply:!1}):y=this._emptyDEMTexture=new a.Texture(r,g,l.RGBA,{premultiply:!1}),y}setupElevationDraw(r,l,p){const g=this.painter.context,y=g.gl,T=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var E;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let M=null,z=null,k=1;if(p&&p.morphing&&this._useVertexMorphing){const R=p.morphing.srcDemTile,N=p.morphing.dstDemTile;k=p.morphing.phase,R&&N&&(this._prepareDemTileUniforms(r,R,T,"_prev")&&(z=R),this._prepareDemTileUniforms(r,N,T)&&(M=N))}if(z&&M?(g.activeTexture.set(y.TEXTURE2),M.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),g.activeTexture.set(y.TEXTURE4),z.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),T.u_dem_lerp=k):(M=this.terrainTileForTile[r.tileID.key],g.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(r,M,T)?M.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),g.activeTexture.set(y.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&M){const R=(1<<M.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=R}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(g,T),this.painter.transform.projection.name==="globe"){const R=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(g,R)}}globeUniformValues(r,l,p){const g=r.projection;return{u_tile_tl_up:g.upVector(l,0,0),u_tile_tr_up:g.upVector(l,a.EXTENT,0),u_tile_br_up:g.upVector(l,a.EXTENT,a.EXTENT),u_tile_bl_up:g.upVector(l,0,a.EXTENT),u_tile_up_scale:p?a.globeMetersToEcef(1):g.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,y,T,E,M){if(g.transform.projection.name==="globe")(function(z,k,R,N,Z){const X=z.context,W=X.gl;let K,B;const $=z.options.showTerrainWireframe?2:0,Q=z.transform,ee=a.globeUseCustomAntiAliasing(z,X,Q),he=(Ge,Ee)=>{if(B===Ge)return;const Re=[ns[Ge],"PROJECTION_GLOBE_VIEW"];ee&&Re.push("CUSTOM_ANTIALIASING"),Ee&&Re.push(ns[$]),K=z.useProgram("globeRaster",null,Re),B=Ge},pe=z.colorModeForRenderPass(),de=new a.DepthMode(W.LEQUAL,a.DepthMode.ReadWrite,z.depthRangeFor3D);so.update(Z);const ve=a.calculateGlobeMercatorMatrix(Q),ye=[a.mercatorXfromLng(Q.center.lng),a.mercatorYfromLat(Q.center.lat)],Se=$?[!1,!0]:[!1],$e=z.globeSharedBuffers,be=[Q.width*a.exported.devicePixelRatio,Q.height*a.exported.devicePixelRatio],Fe=Float32Array.from(Q.globeMatrix),Me={useDenormalizedUpVectorScale:!0};if(Se.forEach(Ge=>{const Ee=z.transform,Re=ac(Ee.zoom)*k.exaggeration();B=-1;const qe=Ge?W.LINES:W.TRIANGLES;for(const Ue of N){const Xe=R.getTile(Ue),ft=a.StencilMode.disabled,Tt=k.prevTerrainTileForTile[Ue.key],ht=k.terrainTileForTile[Ue.key];Gs(Tt,ht)&&so.newMorphing(Ue.key,Tt,ht,Z,250),X.activeTexture.set(W.TEXTURE0),Xe.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const xt=so.getMorphValuesForProxy(Ue.key),Nt=xt?1:0;xt&&a.extend$1(Me,{morphing:{srcDemTile:xt.from,dstDemTile:xt.to,phase:a.easeCubicInOut(xt.phase)}});const Ot=a.tileCornersToBounds(Ue.canonical),pt=a.getLatitudinalLod(Ot.getCenter().lat),en=a.getGridMatrix(Ue.canonical,Ot,pt,Ee.worldSize/Ee._pixelsPerMercatorPixel),nn=a.globeNormalizeECEF(a.globeTileBounds(Ue.canonical)),rn=sc(Ee.projMatrix,Fe,ve,nn,a.globeToMercatorTransition(Ee.zoom),ye,Ee.frustumCorners.TL,Ee.frustumCorners.TR,Ee.frustumCorners.BR,Ee.frustumCorners.BL,Ee.globeCenterInViewSpace,Ee.globeRadius,be,Re,en);if(he(Nt,Ge),k.setupElevationDraw(Xe,K,Me),z.prepareDrawProgram(X,K,Ue.toUnwrapped()),$e){const[on,wi,ai]=Ge?$e.getWirefameBuffers(z.context,pt):$e.getGridBuffers(pt,Re!==0);K.draw(X,qe,de,ft,pe,a.CullFaceMode.backCCW,rn,"globe_raster",on,wi,ai)}}}),$e){const Ge=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ee&&Ge.push("CUSTOM_ANTIALIASING"),K=z.useProgram("globeRaster",null,Ge);for(const Ee of N){const{x:Re,y:qe,z:Ue}=Ee.canonical,Xe=qe===0,ft=qe===(1<<Ue)-1,[Tt,ht,xt,Nt]=$e.getPoleBuffers(Ue);if(Nt&&(Xe||ft)){const Ot=R.getTile(Ee);X.activeTexture.set(W.TEXTURE0),Ot.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let pt=a.globePoleMatrixForTile(Ue,Re,Q);const en=a.globeNormalizeECEF(a.globeTileBounds(Ee.canonical)),nn=(rn,on)=>rn.draw(X,W.TRIANGLES,de,a.StencilMode.disabled,pe,a.CullFaceMode.disabled,sc(Q.projMatrix,pt,pt,en,0,ye,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,be,0),"globe_pole_raster",on,xt,Nt);k.setupElevationDraw(Ot,K,Me),z.prepareDrawProgram(X,K,Ee.toUnwrapped()),Xe&&nn(K,Tt),ft&&(pt=a.scale(a.create(),pt,[1,-1,1]),nn(K,ht))}}}})(g,y,T,E,M);else{const z=g.context,k=z.gl;let R,N;const Z=g.options.showTerrainWireframe?2:0,X=(Q,ee)=>{if(N===Q)return;const he=[ns[Q]];ee&&he.push(ns[Z]),R=g.useProgram("terrainRaster",null,he),N=Q},W=g.colorModeForRenderPass(),K=new a.DepthMode(k.LEQUAL,a.DepthMode.ReadWrite,g.depthRangeFor3D);so.update(M);const B=g.transform,$=ac(B.zoom)*y.exaggeration();(Z?[!1,!0]:[!1]).forEach(Q=>{N=-1;const ee=Q?k.LINES:k.TRIANGLES,[he,pe]=Q?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const de of E){const ve=T.getTile(de),ye=a.StencilMode.disabled,Se=y.prevTerrainTileForTile[de.key],$e=y.terrainTileForTile[de.key];Gs(Se,$e)&&so.newMorphing(de.key,Se,$e,M,250),z.activeTexture.set(k.TEXTURE0),ve.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const be=so.getMorphValuesForProxy(de.key),Fe=be?1:0;let Me;be&&(Me={morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:a.easeCubicInOut(be.phase)}});const Ge=js(de.projMatrix,bp(de.canonical,B.renderWorldCopies)?$/10:$);X(Fe,Q),y.setupElevationDraw(ve,R,Me),g.prepareDrawProgram(z,R,de.toUnwrapped()),R.draw(z,ee,K,ye,W,a.CullFaceMode.backCCW,Ge,"terrain_raster",y.gridBuffer,he,pe)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,g=this.proxySourceCache,y=this.proxiedCoords[g.id],T=this._drapedRenderBatches.shift(),E=[],M=l.style.order;let z=0;for(const k of y){const R=g.getTileByID(k.proxyTileKey),N=g.proxyCachedFBO[k.key]?g.proxyCachedFBO[k.key][r]:void 0,Z=N!==void 0?g.renderCache[N]:this.pool[z++],X=N!==void 0;if(R.texture=Z.tex,X&&!Z.dirty){E.push(R.tileID);continue}let W;p.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(p.clear({color:a.Color.transparent,stencil:0}),Z.dirty=!1);for(let K=T.start;K<=T.end;++K){const B=l.style._layers[M[K]];if(B.isHidden(l.transform.zoom))continue;const $=l.style._getLayerSourceCache(B),Q=$?this.proxyToSource[k.key][$.id]:[k];if(!Q)continue;const ee=Q;p.viewport.set([0,0,Z.fb.width,Z.fb.height]),W!==($?$.id:null)&&(this._setupStencil(Z,Q,B,$),W=$?$.id:null),l.renderLayer(l,$,B,ee)}this.renderedToTile?(Z.dirty=!0,E.push(R.tileID)):X||--z,z===5&&(z=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),T.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(l===0)return{efficiency:100};let p,g=0,y=0,T=!1;for(let E=0;E<l;++E){const M=r._layers[r.order[E]];this._style.isLayerDraped(M)?(T&&++g,++y):T||(T=!0,p=M.id)}return y===0?{efficiency:100}:{efficiency:100*(1-g/y),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const T=y.tileID,E=1<<T.overscaledZ,{x:M,y:z}=T.canonical,k=M/E,R=(M+1)/E,N=z/E,Z=(z+1)/E;return{minx:k,miny:N,maxx:R,maxy:Z,t:y.dem.tree.raycastRoot(k,N,R,Z,r,l,p),tile:y}});g.sort((y,T)=>(y.t!==null?y.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const y of g){if(y.t==null)return null;const T=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,r,l,p);if(T!=null)return T}return null}_createFBO(){const r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const g=new a.Texture(r,{width:p[0],height:p[1],data:null},l.RGBA);g.bind(l.LINEAR,l.CLAMP_TO_EDGE);const y=r.createFramebuffer(p[0],p[1],!1);return y.colorAttachment.set(g.texture),y.depthAttachment=new fe(r,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:y,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],p=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const p of this._style._getSources())if(p instanceof et){r=!0;break}if(!r)return;const l={};for(let p=0;p<this._style.order.length;++p){const g=this._style._layers[this._style.order[p]],y=this._style._getLayerSourceCache(g);if(y&&!l[y.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof a.ZoomDependentExpression){l[y.id]=!0;for(const T of this.proxyCoords){const E=this.proxyToSource[T.key][y.id];if(E)for(const M of E)this._clearRenderCacheForTile(y.id,M)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof He){r=!0;break}if(!r)return;const l={};for(let p=0;p<this._style.order.length;++p){const g=this._style._layers[this._style.order[p]],y=this._style._getLayerSourceCache(g);if(!y||l[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const T=g.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const M=this.proxyToSource[E.key][y.id];if(M)for(const z of M){const k=Yu(y.getTile(z),y.findLoadedParent(z,0),y,this.painter.transform,T);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(y.id,z)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(l===0)return;const p=[];let g,y=0,T=this._style._layers[r[y]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++y<l;)T=this._style._layers[r[y]];for(;y<l;++y){const E=this._style._layers[r[y]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?g===void 0&&(g=y):g!==void 0&&(p.push({start:g,end:y-1}),g=void 0))}g!==void 0&&p.push({start:g,end:y-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const T=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let E=0;E<T.length;++E){const M=Object.values(T[E]);l.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,g=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const E=p[T];if(l.getTileByID(E.key),l.proxyCachedFBO[E.key]!==void 0){const M=r[E.key],z=this.proxyToSource[E.key];let k=0;for(const R in z){const N=z[R],Z=M[R];if(!Z||Z.length!==N.length||N.some((X,W)=>X!==Z[W]||g[R]&&g[R].hasOwnProperty(X.key))){k=-1;break}++k}for(const R in l.proxyCachedFBO[E.key])l.renderCache[l.proxyCachedFBO[E.key][R]].dirty=k<0||k!==Object.values(M).length}}const y=[...this._drapedRenderBatches];y.sort((T,E)=>E.end-E.start-(T.end-T.start));for(const T of y)for(const E of p){if(l.proxyCachedFBO[E.key])continue;let M=l.renderCachePool.pop();M===void 0&&l.renderCache.length<50&&(M=l.renderCache.length,l.renderCache.push(this._createFBO())),M!==void 0&&(l.proxyCachedFBO[E.key]={},l.proxyCachedFBO[E.key][T.start]=M,l.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,T=y.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let E;if(p.isTileClipped())E=l.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(r,l){const p=this.painter,g=this.painter.context,y=g.gl;p._tileClippingMaskIDs={},g.setColorMode(a.ColorMode.disabled),g.setDepthMode(a.DepthMode.disabled);const T=p.useProgram("clippingMask");for(const E of r){const M=p._tileClippingMaskIDs[E.key]=--l;T.draw(g,y.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,tl(E.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const p=[r.x,r.y,1,1];a.transformMat4$1(p,p,l.pixelMatrixInverse),a.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const g=l._camera.position,y=a.mercatorZfromAltitude(1,l.center.lat),T=[g[0],g[1],g[2]/y,0],E=a.subtract([],p.slice(0,3),T);a.normalize(E,E);const M=this.raycast(T,E,this._exaggeration);return M!==null&&M?(a.scaleAndAdd(T,T,E,M),T[3]=T[2],T[2]*=y,T):null}drawDepth(){const r=this.painter,l=r.context,p=this.proxySourceCache,g=Math.ceil(r.width),y=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===g&&this._depthFBO.height===y||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=l.gl,E=l.createFramebuffer(g,y,!0);l.activeTexture.set(T.TEXTURE0);const M=new a.Texture(l,{width:g,height:y,data:null},T.RGBA);M.bind(T.NEAREST,T.CLAMP_TO_EDGE),E.colorAttachment.set(M.texture);const z=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,g,y);E.depthAttachment.set(z),this._depthFBO=E,this._depthTexture=M}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,g,y]),function(T,E,M,z){if(T.transform.projection.name==="globe")return;const k=T.context,R=k.gl;k.clear({depth:1});const N=T.useProgram("terrainDepth"),Z=new a.DepthMode(R.LESS,a.DepthMode.ReadWrite,T.depthRangeFor3D);for(const X of z){const W=M.getTile(X),K=js(X.projMatrix,0);E.setupElevationDraw(W,N),N.draw(k,R.TRIANGLES,Z,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,K,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof Bt)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const g=this.proxiedCoords[r.id]=[],y=this.proxyCoords;for(let E=0;E<y.length;E++){const M=y[E],z=this._findTileCoveringTileID(M,r);if(z){const k=this._createProxiedId(M,z,p[M.key]&&p[M.key][r.id]);g.push(k),this.proxyToSource[M.key][r.id]=[k]}}let T=!1;for(let E=0;E<l.length;E++){const M=r.getTile(l[E]);if(!M||!M.hasData())continue;const z=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==M.tileID.canonical.z){const k=this.proxyToSource[z.tileID.key][r.id],R=this._createProxiedId(z.tileID,M,p[z.tileID.key]&&p[z.tileID.key][r.id]);k?k.splice(k.length-1,0,R):this.proxyToSource[z.tileID.key][r.id]=[R],g.push(R),T=!0}}this._sourceTilesOverlap[r.id]=T}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;const g=this.proxiedCoords[r.id]=[],y=this.proxyCoords,T=r.getSource(),E=new a.Point(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),M=T.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((k,R)=>(k.min.x=Math.min(k.min.x,R.x-E.x),k.min.y=Math.min(k.min.y,R.y-E.y),k.max.x=Math.max(k.max.x,R.x-E.x),k.max.y=Math.max(k.max.y,R.y-E.y),k),{min:new a.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(k,R)=>{const N=k.wrap+k.canonical.x/(1<<k.canonical.z),Z=k.canonical.y/(1<<k.canonical.z),X=a.EXTENT/(1<<k.canonical.z),W=R.wrap+R.canonical.x/(1<<R.canonical.z),K=R.canonical.y/(1<<R.canonical.z);return N+X<W+M.min.x||N>W+M.max.x||Z+X<K+M.min.y||Z>K+M.max.y};for(let k=0;k<y.length;k++){const R=y[k];for(let N=0;N<l.length;N++){const Z=r.getTile(l[N]);if(!Z||!Z.hasData()||z(R,Z.tileID))continue;const X=this._createProxiedId(R,Z,p[R.key]&&p[R.key][r.id]),W=this.proxyToSource[R.key][r.id];W?W.push(X):this.proxyToSource[R.key][r.id]=[X],g.push(X)}}}_createProxiedId(r,l,p){let g=this.orthoMatrix;if(p){const y=p.find(T=>T.key===l.tileID.key);if(y)return y}if(l.tileID.key!==r.key){const y=r.canonical.z-l.tileID.canonical.z;let T,E,M;g=a.create();const z=l.tileID.wrap-r.wrap<<r.overscaledZ;y>0?(T=a.EXTENT>>y,E=T*((l.tileID.canonical.x<<y)-r.canonical.x+z),M=T*((l.tileID.canonical.y<<y)-r.canonical.y)):(T=a.EXTENT<<-y,E=a.EXTENT*(l.tileID.canonical.x-(r.canonical.x+z<<-y)),M=a.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-y))),a.ortho(g,0,T,0,T,0,1),a.translate(g,g,[E,M,0])}return new cc(l.tileID,r.key,g)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;const g=this._findCoveringTileCache[l.id],y=g[r.key];if(p=y?l.getTileByID(y):null,p&&p.hasData()||y===null)return p;let T=p?p.tileID:r,E=T.overscaledZ;const M=l.getSource().minzoom,z=[];if(!y){const R=l.getSource().maxzoom;if(r.canonical.z>=R){const N=r.canonical.z-R;l.getSource().reparseOverscaled?(E=Math.max(r.canonical.z+2,l.transform.tileZoom),T=new a.OverscaledTileID(E,r.wrap,R,r.canonical.x>>N,r.canonical.y>>N)):N!==0&&(E=R,T=new a.OverscaledTileID(E,r.wrap,R,r.canonical.x>>N,r.canonical.y>>N))}T.key!==r.key&&(z.push(T.key),p=l.getTile(T))}const k=R=>{z.forEach(N=>{g[N]=R}),z.length=0};for(E-=1;E>=M&&(!p||!p.hasData());E--){p&&k(p.tileID.key);const R=T.calculateScaledKey(E);if(p=l.getTileByID(R),p&&p.hasData())break;const N=g[R];if(N===null)break;N===void 0?z.push(R):p=l.getTileByID(N)}return k(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let p=0;const g=new a.StructArrayLayout2ui4,y=131;for(let T=1;T<129;T++){for(let E=1;E<129;E++)p=T*y+E,g.emplaceBack(p,p+1),g.emplaceBack(p,p+y),g.emplaceBack(p+1,p+y),T===128&&g.emplaceBack(p+y,p+y+1);g.emplaceBack(p+1,p+1+y)}return g}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class $t{static cacheKey(r,l,p,g){let y=`${l}${g?g.cacheKey:""}`;for(const T of p)r.usedDefines.includes(T)&&(y+=`/${T}`);return y}constructor(r,l,p,g,y,T){const E=r.gl;this.program=E.createProgram();const M=function(B){const $=[];for(let Q=0;Q<B.length;Q++){if(B[Q]===null)continue;const ee=B[Q].split(" ");$.push(ee.pop())}return $}(p.staticAttributes),z=g?g.getBinderAttributes():[],k=M.concat(z);let R=g?g.defines():[];R=R.concat(T.map(B=>`#define ${B}`));const N=r.isWebGL2?`#version 300 es
`:"",Z=N+R.concat(r.extStandardDerivatives&&N.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(qu):qu,qu,oc,vp.fragmentSource,Us.fragmentSource,p.fragmentSource).join(`
`),X=N+R.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,oc,vp.vertexSource,Us.vertexSource,rc.vertexSource,p.vertexSource).join(`
`),W=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(W,Z),E.compileShader(W),E.attachShader(this.program,W);const K=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(K,X),E.compileShader(K),E.attachShader(this.program,K),this.attributes={},this.numAttributes=k.length;for(let B=0;B<this.numAttributes;B++)k[B]&&(E.bindAttribLocation(this.program,B,k[B]),this.attributes[k[B]]=B);E.linkProgram(this.program),E.deleteShader(K),E.deleteShader(W),this.fixedUniforms=y(r),this.binderUniforms=g?g.getUniforms(r):[],T.includes("TERRAIN")&&(this.terrainUniforms=(B=>({u_dem:new a.Uniform1i(B),u_dem_prev:new a.Uniform1i(B),u_dem_unpack:new a.Uniform4f(B),u_dem_tl:new a.Uniform2f(B),u_dem_scale:new a.Uniform1f(B),u_dem_tl_prev:new a.Uniform2f(B),u_dem_scale_prev:new a.Uniform1f(B),u_dem_size:new a.Uniform1f(B),u_dem_lerp:new a.Uniform1f(B),u_exaggeration:new a.Uniform1f(B),u_depth:new a.Uniform1i(B),u_depth_size_inv:new a.Uniform2f(B),u_meter_to_dem:new a.Uniform1f(B),u_label_plane_matrix_inv:new a.UniformMatrix4f(B)}))(r)),T.includes("GLOBE")&&(this.globeUniforms=(B=>({u_tile_tl_up:new a.Uniform3f(B),u_tile_tr_up:new a.Uniform3f(B),u_tile_br_up:new a.Uniform3f(B),u_tile_bl_up:new a.Uniform3f(B),u_tile_up_scale:new a.Uniform1f(B)}))(r)),T.includes("FOG")&&(this.fogUniforms=(B=>({u_fog_matrix:new a.UniformMatrix4f(B),u_fog_range:new a.Uniform2f(B),u_fog_color:new a.Uniform4f(B),u_fog_horizon_blend:new a.Uniform1f(B),u_fog_temporal_offset:new a.Uniform1f(B),u_frustum_tl:new a.Uniform3f(B),u_frustum_tr:new a.Uniform3f(B),u_frustum_br:new a.Uniform3f(B),u_frustum_bl:new a.Uniform3f(B),u_globe_pos:new a.Uniform3f(B),u_globe_radius:new a.Uniform1f(B),u_globe_transition:new a.Uniform1f(B),u_is_globe:new a.Uniform1i(B),u_viewport:new a.Uniform2f(B)}))(r))}}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const g in l)p[g]&&p[g].set(this.program,g,l[g])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const g in l)p[g]&&p[g].set(this.program,g,l[g])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const g in l)p[g].set(this.program,g,l[g])}}draw(r,l,p,g,y,T,E,M,z,k,R,N,Z,X,W){const K=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(g),r.setColorMode(y),r.setCullFace(T);for(const $ of Object.keys(this.fixedUniforms))this.fixedUniforms[$].set(this.program,$,E[$]);X&&X.setUniforms(this.program,r,this.binderUniforms,N,{zoom:Z});const B={[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[l];for(const $ of R.get()){const Q=$.vaos||($.vaos={});(Q[M]||(Q[M]=new Eg)).bind(r,this,z,X?X.getPaintVertexBuffers():[],k,$.vertexOffset,W||[]),K.drawElements(l,$.primitiveLength*B,K.UNSIGNED_SHORT,$.primitiveOffset*B*2)}}}function nl(h,r){const l=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,h.transform.tileZoom)/l,g=p*(r.tileID.canonical.x+r.tileID.wrap*l),y=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/gt(r,1,h.transform.tileZoom),u_pixel_coord_upper:[g>>16,y>>16],u_pixel_coord_lower:[65535&g,65535&y]}}const Tp=a.create(),eh=(h,r,l,p,g,y,T,E,M,z,k)=>{const R=r.style.light,N=R.properties.get("position"),Z=[N.x,N.y,N.z],X=a.create$1();R.properties.get("anchor")==="viewport"&&(a.fromRotation(X,-r.transform.angle),a.transformMat3(Z,Z,X));const W=R.properties.get("color"),K=r.transform,B={u_matrix:h,u_lightpos:Z,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Tp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:y};return K.projection.name==="globe"&&(B.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],B.u_zoom_transition=M,B.u_inv_rot_matrix=k,B.u_merc_center=z,B.u_up_dir=K.projection.upVector(new a.CanonicalTileID(0,0,0),z[0]*a.EXTENT,z[1]*a.EXTENT),B.u_height_lift=E),B},Ep=(h,r,l,p,g,y,T,E,M,z,k,R)=>{const N=eh(h,r,l,p,g,y,T,M,z,k,R),Z={u_height_factor:-Math.pow(2,T.overscaledZ)/E.tileSize/8};return a.extend(N,nl(r,E),Z)},is=h=>({u_matrix:h}),th=(h,r,l)=>a.extend(is(h),nl(r,l)),Sg=(h,r)=>({u_matrix:h,u_world:r}),Cg=(h,r,l,p)=>a.extend(th(h,r,l),{u_world:p}),Mg=a.create(),nh=(h,r,l,p,g,y)=>{const T=h.transform,E=T.projection.name==="globe";let M;if(y.paint.get("circle-pitch-alignment")==="map")if(E){const k=a.globePixelsToTileUnits(T.zoom,r.canonical)*T._pixelsPerMercatorPixel;M=Float32Array.from([k,0,0,k])}else M=T.calculatePixelsToTileUnitsMatrix(l);else M=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:h.translatePosMatrix(r.projMatrix,l,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:Mg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){z.u_inv_rot_matrix=p,z.u_merc_center=g,z.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],z.u_zoom_transition=a.globeToMercatorTransition(T.zoom);const k=g[0]*a.EXTENT,R=g[1]*a.EXTENT;z.u_up_dir=T.projection.upVector(new a.CanonicalTileID(0,0,0),k,R)}return z},ih=h=>{const r=[];return h.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},rh=(h,r,l,p)=>{const g=a.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/g,r.pixelsToGLUnits[1]/g]}},uc=(h,r,l=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:l}),Sp=a.create(),Cp=(h,r,l,p,g,y,T)=>{const E=h.transform,M=E.projection.name==="globe",z=M?a.globePixelsToTileUnits(E.zoom,r.canonical)*E._pixelsPerMercatorPixel:gt(l,1,y),k={u_matrix:r.projMatrix,u_extrude_scale:z,u_intensity:T,u_inv_rot_matrix:Sp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){k.u_inv_rot_matrix=p,k.u_merc_center=g,k.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],k.u_zoom_transition=a.globeToMercatorTransition(E.zoom);const R=g[0]*a.EXTENT,N=g[1]*a.EXTENT;k.u_up_dir=E.projection.upVector(new a.CanonicalTileID(0,0,0),R,N)}return k},Ag=(h,r,l,p,g,y,T)=>{const E=h.transform,M=E.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:oh(h,r,l,p),u_pixels_to_tile_units:M,u_device_pixel_ratio:y,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:rl(l)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$s(r,h.transform),u_alpha_discard_threshold:0,u_trim_offset:T}},il=(h,r,l,p,g)=>{const y=h.transform;return{u_matrix:oh(h,r,l,p),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:g,u_image:0,u_tile_units_to_pixels:$s(r,y),u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function $s(h,r){return 1/gt(h,1,r.tileZoom)}function oh(h,r,l,p){return h.translatePosMatrix(p||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function rl(h){const r=h.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const sh=(h,r,l,p,g,y)=>{return{u_matrix:h,u_tl_parent:r,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(E=g.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(T=g.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Fr(g.paint.get("raster-hue-rotate")),u_perspective_transform:y};var T,E};function Fr(h){h*=Math.PI/180;const r=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const hc=a.create(),ah=(h,r,l,p,g,y,T,E,M,z,k,R,N,Z,X,W)=>{const K=g.transform,B={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:K.width/K.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+M,u_pitch_with_map:+p,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:hc,u_up_vector:[0,-1,0]};return W.name==="globe"&&(B.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],B.u_zoom_transition=R,B.u_inv_rot_matrix=Z,B.u_merc_center=N,B.u_camera_forward=K._camera.forward(),B.u_ecef_origin=a.globeECEFOrigin(K.globeMatrix,k.toUnwrapped()),B.u_tile_matrix=Float32Array.from(K.globeMatrix),B.u_up_vector=X),B},dc=(h,r,l,p,g,y,T,E,M,z,k,R,N,Z,X,W,K)=>a.extend(ah(h,r,l,p,g,y,T,E,M,z,R,N,Z,X,W,K),{u_gamma_scale:p?g.transform.cameraToCenterDistance*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+k}),Mp=(h,r,l,p,g,y,T,E,M,z,k,R,N,Z,X,W)=>a.extend(dc(h,r,l,p,g,y,T,E,!0,M,!0,k,R,N,Z,X,W),{u_texsize_icon:z,u_texture_icon:1}),lh=(h,r,l)=>({u_matrix:h,u_opacity:r,u_color:l}),Pg=(h,r,l,p,g)=>a.extend(function(y,T,E){const M=T.imageManager.getPattern(y.toString()),{width:z,height:k}=T.imageManager.getPixelSize(),R=Math.pow(2,E.tileID.overscaledZ),N=E.tileSize*Math.pow(2,T.transform.tileZoom)/R,Z=N*(E.tileID.canonical.x+E.tileID.wrap*R),X=N*E.tileID.canonical.y;return{u_image:0,u_pattern_tl:M.tl,u_pattern_br:M.br,u_texsize:[z,k],u_pattern_size:M.displaySize,u_tile_units_to_pixels:1/gt(E,1,T.transform.tileZoom),u_pixel_coord_upper:[Z>>16,X>>16],u_pixel_coord_lower:[65535&Z,65535&X]}}(p,l,g),{u_matrix:h,u_opacity:r}),ch={fillExtrusion:h=>({u_matrix:new a.UniformMatrix4f(h),u_lightpos:new a.Uniform3f(h),u_lightintensity:new a.Uniform1f(h),u_lightcolor:new a.Uniform3f(h),u_vertical_gradient:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h),u_edge_radius:new a.Uniform1f(h),u_ao:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_up_dir:new a.Uniform3f(h),u_height_lift:new a.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_lightpos:new a.Uniform3f(h),u_lightintensity:new a.Uniform1f(h),u_lightcolor:new a.Uniform3f(h),u_vertical_gradient:new a.Uniform1f(h),u_height_factor:new a.Uniform1f(h),u_edge_radius:new a.Uniform1f(h),u_ao:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_up_dir:new a.Uniform3f(h),u_height_lift:new a.Uniform1f(h),u_image:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h)}),fill:h=>({u_matrix:new a.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_image:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h)}),fillOutline:h=>({u_matrix:new a.UniformMatrix4f(h),u_world:new a.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_world:new a.Uniform2f(h),u_image:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new a.Uniform1f(h),u_extrude_scale:new a.UniformMatrix2f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_up_dir:new a.Uniform3f(h)}),collisionBox:h=>({u_matrix:new a.UniformMatrix4f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_extrude_scale:new a.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new a.UniformMatrix4f(h),u_inv_matrix:new a.UniformMatrix4f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_viewport_size:new a.Uniform2f(h)}),debug:h=>({u_color:new a.UniformColor(h),u_matrix:new a.UniformMatrix4f(h),u_overlay:new a.Uniform1i(h),u_overlay_scale:new a.Uniform1f(h)}),clippingMask:h=>({u_matrix:new a.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new a.Uniform1f(h),u_intensity:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_up_dir:new a.Uniform3f(h)}),heatmapTexture:h=>({u_image:new a.Uniform1i(h),u_color_ramp:new a.Uniform1i(h),u_opacity:new a.Uniform1f(h)}),hillshade:h=>({u_matrix:new a.UniformMatrix4f(h),u_image:new a.Uniform1i(h),u_latrange:new a.Uniform2f(h),u_light:new a.Uniform2f(h),u_shadow:new a.UniformColor(h),u_highlight:new a.UniformColor(h),u_accent:new a.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new a.UniformMatrix4f(h),u_image:new a.Uniform1i(h),u_dimension:new a.Uniform2f(h),u_zoom:new a.Uniform1f(h),u_unpack:new a.Uniform4f(h)}),line:h=>({u_matrix:new a.UniformMatrix4f(h),u_pixels_to_tile_units:new a.UniformMatrix2f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_units_to_pixels:new a.Uniform2f(h),u_dash_image:new a.Uniform1i(h),u_gradient_image:new a.Uniform1i(h),u_image_height:new a.Uniform1f(h),u_texsize:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h),u_alpha_discard_threshold:new a.Uniform1f(h),u_trim_offset:new a.Uniform2f(h)}),linePattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_texsize:new a.Uniform2f(h),u_pixels_to_tile_units:new a.UniformMatrix2f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_image:new a.Uniform1i(h),u_units_to_pixels:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h),u_alpha_discard_threshold:new a.Uniform1f(h)}),raster:h=>({u_matrix:new a.UniformMatrix4f(h),u_tl_parent:new a.Uniform2f(h),u_scale_parent:new a.Uniform1f(h),u_fade_t:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h),u_image0:new a.Uniform1i(h),u_image1:new a.Uniform1i(h),u_brightness_low:new a.Uniform1f(h),u_brightness_high:new a.Uniform1f(h),u_saturation_factor:new a.Uniform1f(h),u_contrast_factor:new a.Uniform1f(h),u_spin_weights:new a.Uniform3f(h),u_perspective_transform:new a.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new a.Uniform1i(h),u_is_size_feature_constant:new a.Uniform1i(h),u_size_t:new a.Uniform1f(h),u_size:new a.Uniform1f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_rotate_symbol:new a.Uniform1i(h),u_aspect_ratio:new a.Uniform1f(h),u_fade_change:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_label_plane_matrix:new a.UniformMatrix4f(h),u_coord_matrix:new a.UniformMatrix4f(h),u_is_text:new a.Uniform1i(h),u_pitch_with_map:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_camera_forward:new a.Uniform3f(h),u_tile_matrix:new a.UniformMatrix4f(h),u_up_vector:new a.Uniform3f(h),u_ecef_origin:new a.Uniform3f(h),u_texture:new a.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new a.Uniform1i(h),u_is_size_feature_constant:new a.Uniform1i(h),u_size_t:new a.Uniform1f(h),u_size:new a.Uniform1f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_rotate_symbol:new a.Uniform1i(h),u_aspect_ratio:new a.Uniform1f(h),u_fade_change:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_label_plane_matrix:new a.UniformMatrix4f(h),u_coord_matrix:new a.UniformMatrix4f(h),u_is_text:new a.Uniform1i(h),u_pitch_with_map:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_texture:new a.Uniform1i(h),u_gamma_scale:new a.Uniform1f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_camera_forward:new a.Uniform3f(h),u_tile_matrix:new a.UniformMatrix4f(h),u_up_vector:new a.Uniform3f(h),u_ecef_origin:new a.Uniform3f(h),u_is_halo:new a.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new a.Uniform1i(h),u_is_size_feature_constant:new a.Uniform1i(h),u_size_t:new a.Uniform1f(h),u_size:new a.Uniform1f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_rotate_symbol:new a.Uniform1i(h),u_aspect_ratio:new a.Uniform1f(h),u_fade_change:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_label_plane_matrix:new a.UniformMatrix4f(h),u_coord_matrix:new a.UniformMatrix4f(h),u_is_text:new a.Uniform1i(h),u_pitch_with_map:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_texsize_icon:new a.Uniform2f(h),u_texture:new a.Uniform1i(h),u_texture_icon:new a.Uniform1i(h),u_gamma_scale:new a.Uniform1f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_is_halo:new a.Uniform1i(h)}),background:h=>({u_matrix:new a.UniformMatrix4f(h),u_opacity:new a.Uniform1f(h),u_color:new a.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_opacity:new a.Uniform1f(h),u_image:new a.Uniform1i(h),u_pattern_tl:new a.Uniform2f(h),u_pattern_br:new a.Uniform2f(h),u_texsize:new a.Uniform2f(h),u_pattern_size:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h)}),terrainRaster:Ku,terrainDepth:Ku,skybox:h=>({u_matrix:new a.UniformMatrix4f(h),u_sun_direction:new a.Uniform3f(h),u_cubemap:new a.Uniform1i(h),u_opacity:new a.Uniform1f(h),u_temporal_offset:new a.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new a.UniformMatrix4f(h),u_color_ramp:new a.Uniform1i(h),u_center_direction:new a.Uniform3f(h),u_radius:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h),u_temporal_offset:new a.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new a.UniformMatrix3f(h),u_sun_direction:new a.Uniform3f(h),u_sun_intensity:new a.Uniform1f(h),u_color_tint_r:new a.Uniform4f(h),u_color_tint_m:new a.Uniform4f(h),u_luminance:new a.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new a.UniformMatrix4f(h),u_globe_matrix:new a.UniformMatrix4f(h),u_normalize_matrix:new a.UniformMatrix4f(h),u_merc_matrix:new a.UniformMatrix4f(h),u_zoom_transition:new a.Uniform1f(h),u_merc_center:new a.Uniform2f(h),u_image0:new a.Uniform1i(h),u_grid_matrix:new a.UniformMatrix3f(h),u_skirt_height:new a.Uniform1f(h),u_frustum_tl:new a.Uniform3f(h),u_frustum_tr:new a.Uniform3f(h),u_frustum_br:new a.Uniform3f(h),u_frustum_bl:new a.Uniform3f(h),u_globe_pos:new a.Uniform3f(h),u_globe_radius:new a.Uniform1f(h),u_viewport:new a.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new a.Uniform3f(h),u_frustum_tr:new a.Uniform3f(h),u_frustum_br:new a.Uniform3f(h),u_frustum_bl:new a.Uniform3f(h),u_horizon:new a.Uniform1f(h),u_transition:new a.Uniform1f(h),u_fadeout_range:new a.Uniform1f(h),u_color:new a.Uniform4f(h),u_high_color:new a.Uniform4f(h),u_space_color:new a.Uniform4f(h),u_star_intensity:new a.Uniform1f(h),u_star_density:new a.Uniform1f(h),u_star_size:new a.Uniform1f(h),u_temporal_offset:new a.Uniform1f(h),u_horizon_angle:new a.Uniform1f(h),u_rotation_matrix:new a.UniformMatrix4f(h)})};let pc;function ol(h,r,l,p,g,y,T){const E=h.context,M=E.gl,z=h.transform,k=h.useProgram("collisionBox"),R=[];let N=0,Z=0;for(let ee=0;ee<p.length;ee++){const he=p[ee],pe=r.getTile(he),de=pe.getBucket(l);if(!de)continue;const ve=ir(he,de,z);let ye=ve;g[0]===0&&g[1]===0||(ye=h.translatePosMatrix(ve,pe,g,y));const Se=T?de.textCollisionBox:de.iconCollisionBox,$e=de.collisionCircleArray;if($e.length>0){const be=a.create(),Fe=ye;a.mul(be,de.placementInvProjMatrix,z.glCoordMatrix),a.mul(be,be,de.placementViewportMatrix),R.push({circleArray:$e,circleOffset:Z,transform:Fe,invTransform:be,projection:de.getProjection()}),N+=$e.length/4,Z=N}Se&&(h.terrain&&h.terrain.setupElevationDraw(pe,k),k.draw(E,M.LINES,a.DepthMode.disabled,a.StencilMode.disabled,h.colorModeForRenderPass(),a.CullFaceMode.disabled,rh(ye,z,pe,de.getProjection()),l.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,z.zoom,null,[Se.collisionVertexBuffer,Se.collisionVertexBufferExt]))}if(!T||!R.length)return;const X=h.useProgram("collisionCircle"),W=new a.StructArrayLayout2f1f2i16;W.resize(4*N),W._trim();let K=0;for(const ee of R)for(let he=0;he<ee.circleArray.length/4;he++){const pe=4*he,de=ee.circleArray[pe+0],ve=ee.circleArray[pe+1],ye=ee.circleArray[pe+2],Se=ee.circleArray[pe+3];W.emplace(K++,de,ve,ye,Se,0),W.emplace(K++,de,ve,ye,Se,1),W.emplace(K++,de,ve,ye,Se,2),W.emplace(K++,de,ve,ye,Se,3)}(!pc||pc.length<2*N)&&(pc=function(ee){const he=2*ee,pe=new a.StructArrayLayout3ui6;pe.resize(he),pe._trim();for(let de=0;de<he;de++){const ve=6*de;pe.uint16[ve+0]=4*de+0,pe.uint16[ve+1]=4*de+1,pe.uint16[ve+2]=4*de+2,pe.uint16[ve+3]=4*de+2,pe.uint16[ve+4]=4*de+3,pe.uint16[ve+5]=4*de+0}return pe}(N));const B=E.createIndexBuffer(pc,!0),$=E.createVertexBuffer(W,a.collisionCircleLayout.members,!0);for(const ee of R){const he={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(Q=z).getCameraToCenterDistance(ee.projection),u_viewport_size:[Q.width,Q.height]};X.draw(E,M.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,h.colorModeForRenderPass(),a.CullFaceMode.disabled,he,l.id,$,B,a.SegmentVector.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,z.zoom)}var Q;$.destroy(),B.destroy()}const Ap=a.create();function uh({width:h,height:r,anchor:l,textOffset:p,textScale:g},y){const{horizontalAlign:T,verticalAlign:E}=a.getAnchorAlignment(l),M=-(T-.5)*h,z=-(E-.5)*r,k=a.evaluateVariableOffset(l,p);return new a.Point((M/g+k[0])*y,(z/g+k[1])*y)}function Ig(h,r,l,p,g,y,T,E,M,z,k){const R=h.text.placedSymbolArray,N=h.text.dynamicLayoutVertexArray,Z=h.icon.dynamicLayoutVertexArray,X={},W=h.getProjection(),K=xn(E,W,y),B=y.elevation,$=W.upVectorScale(E.canonical,y.center.lat,y.worldSize).metersToTile;N.clear();for(let Q=0;Q<R.length;Q++){const ee=R.get(Q),{tileAnchorX:he,tileAnchorY:pe,numGlyphs:de}=ee,ve=ee.hidden||!ee.crossTileID||h.allowVerticalPlacement&&!ee.placedOrientation?null:p[ee.crossTileID];if(ve){let ye=0,Se=0,$e=0;if(B){const Xe=B?B.getAtTileOffset(E,he,pe):0,[ft,Tt,ht]=W.upVector(E.canonical,he,pe);ye=Xe*ft*$,Se=Xe*Tt*$,$e=Xe*ht*$}let[be,Fe,Me,Ge]=oi(ee.projectedAnchorX+ye,ee.projectedAnchorY+Se,ee.projectedAnchorZ+$e,l?K:T);const Ee=fp(y.getCameraToCenterDistance(W),Ge);let Re=g.evaluateSizeForFeature(h.textSizeData,z,ee)*Ee/a.ONE_EM;l&&(Re*=h.tilePixelRatio/M);const qe=uh(ve,Re);l?({x:be,y:Fe,z:Me}=W.projectTilePoint(he+qe.x,pe+qe.y,E.canonical),[be,Fe,Me]=oi(be+ye,Fe+Se,Me+$e,T)):(r&&qe._rotate(-y.angle),be+=qe.x,Fe+=qe.y,Me=0);const Ue=h.allowVerticalPlacement&&ee.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Xe=0;Xe<de;Xe++)a.addDynamicAttributes(N,be,Fe,Me,Ue);k&&ee.associatedIconIndex>=0&&(X[ee.associatedIconIndex]={x:be,y:Fe,z:Me,angle:Ue})}else xr(de,N)}if(k){Z.clear();const Q=h.icon.placedSymbolArray;for(let ee=0;ee<Q.length;ee++){const he=Q.get(ee),{numGlyphs:pe}=he,de=X[ee];if(he.hidden||!de)xr(pe,Z);else{const{x:ve,y:ye,z:Se,angle:$e}=de;for(let be=0;be<pe;be++)a.addDynamicAttributes(Z,ve,ye,Se,$e)}}h.icon.dynamicLayoutVertexBuffer.updateData(Z)}h.text.dynamicLayoutVertexBuffer.updateData(N)}function hh(h,r,l){return l.iconsInText&&r?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Pp(h,r,l,p,g,y,T,E,M,z,k,R){const N=h.context,Z=N.gl,X=h.transform,W=E==="map",K=M==="map",B=W&&l.layout.get("symbol-placement")!=="point",$=W&&!K&&!B,Q=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ee=!1;const he=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),pe=[a.mercatorXfromLng(X.center.lng),a.mercatorYfromLat(X.center.lat)],de=l.layout.get("text-variable-anchor"),ve=X.projection.name==="globe",ye=[],Se=[0,-1,0];let $e=Se;!ve&&!X.mercatorFromTransition||W||($e=function(be){const Fe=be._camera.getWorldToCamera(be.worldSize,1),Me=a.multiply([],Fe,be.globeMatrix);a.invert(Me,Me);const Ge=[0,0,0],Ee=[0,1,0,0];return a.transformMat4$1(Ee,Ee,Me),Ge[0]=Ee[0],Ge[1]=Ee[1],Ge[2]=Ee[2],a.normalize(Ge,Ge),Ge}(X));for(const be of p){const Fe=r.getTile(be),Me=Fe.getBucket(l);if(!Me||Me.projection.name==="mercator"&&ve)continue;const Ge=g?Me.text:Me.icon;if(!Ge||Me.fullyClipped||!Ge.segments.get().length)continue;const Ee=Ge.programConfigurations.get(l.id),Re=g||Me.sdfIcons,qe=g?Me.textSizeData:Me.iconSizeData,Ue=K||X.pitch!==0,Xe=a.evaluateSizeForZoom(qe,X.zoom);let ft,Tt,ht,xt,Nt=[0,0],Ot=null;if(g)Tt=Fe.glyphAtlasTexture,ht=Z.LINEAR,ft=Fe.glyphAtlasTexture.size,Me.iconsInText&&(Nt=Fe.imageAtlasTexture.size,Ot=Fe.imageAtlasTexture,xt=Ue||h.options.rotating||h.options.zooming||qe.kind==="composite"||qe.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const co=l.layout.get("icon-size").constantOr(0)!==1||Me.iconsNeedLinear;Tt=Fe.imageAtlasTexture,ht=Re||h.options.rotating||h.options.zooming||co||Ue?Z.LINEAR:Z.NEAREST,ft=Fe.imageAtlasTexture.size}const pt=Me.projection.name==="globe",en=pt?$e:Se,nn=pt?a.globeToMercatorTransition(X.zoom):0,rn=xn(be,Me.getProjection(),X),on=X.calculatePixelsToTileUnitsMatrix(Fe),wi=De(rn,Fe.tileID.canonical,K,W,X,Me.getProjection(),on),ai=h.terrain&&K&&B?a.invert(a.create(),wi):Ap,ar=Vn(rn,Fe.tileID.canonical,K,W,X,Me.getProjection(),on),Vr=de&&Me.hasTextData(),wn=l.layout.get("icon-text-fit")!=="none"&&Vr&&Me.hasIconData();if(B){const co=X.elevation,zo=co?co.getAtTileOffsetFunc(be,X.center.lat,X.worldSize,Me.getProjection()):null,ls=to(rn,Fe.tileID.canonical,K,W,X,Me.getProjection(),on);Fu(Me,rn,h,g,ls,ar,K,z,zo,be)}const sn=B||g&&de||wn,Wt=h.translatePosMatrix(rn,Fe,y,T),Un=sn?Ap:wi,Pi=h.translatePosMatrix(ar,Fe,y,T,!0),_n=Me.getProjection().createInversionMatrix(X,be.canonical),Ri=[];h.terrainRenderModeElevated()&&K&&Ri.push("PITCH_WITH_MAP_TERRAIN"),pt&&Ri.push("PROJECTION_GLOBE_VIEW"),sn&&Ri.push("PROJECTED_POS_ON_VIEWPORT");const Pc=Re&&l.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let as;as=Re?Me.iconsInText?Mp(qe.kind,Xe,$,K,h,Wt,Un,Pi,ft,Nt,be,nn,pe,_n,en,Me.getProjection()):dc(qe.kind,Xe,$,K,h,Wt,Un,Pi,g,ft,!0,be,nn,pe,_n,en,Me.getProjection()):ah(qe.kind,Xe,$,K,h,Wt,Un,Pi,g,ft,be,nn,pe,_n,en,Me.getProjection());const gl={program:h.useProgram(hh(Re,g,Me),Ee,Ri),buffers:Ge,uniformValues:as,atlasTexture:Tt,atlasTextureIcon:Ot,atlasInterpolation:ht,atlasInterpolationIcon:xt,isSDF:Re,hasHalo:Pc,tile:Fe,labelPlaneMatrixInv:ai};if(Q&&Me.canOverlap){ee=!0;const co=Ge.segments.get();for(const zo of co)ye.push({segments:new a.SegmentVector([zo]),sortKey:zo.sortKey,state:gl})}else ye.push({segments:Ge.segments,sortKey:0,state:gl})}ee&&ye.sort((be,Fe)=>be.sortKey-Fe.sortKey);for(const be of ye){const Fe=be.state;if(h.terrain&&h.terrain.setupElevationDraw(Fe.tile,Fe.program,{useDepthForOcclusion:!ve,labelPlaneMatrixInv:Fe.labelPlaneMatrixInv}),N.activeTexture.set(Z.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,Z.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(N.activeTexture.set(Z.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Fe.isSDF){const Me=Fe.uniformValues;Fe.hasHalo&&(Me.u_is_halo=1,sl(Fe.buffers,be.segments,l,h,Fe.program,he,k,R,Me)),Me.u_is_halo=0}sl(Fe.buffers,be.segments,l,h,Fe.program,he,k,R,Fe.uniformValues)}}function sl(h,r,l,p,g,y,T,E,M){const z=p.context,k=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];g.draw(z,z.gl.TRIANGLES,y,T,E,a.CullFaceMode.disabled,M,l.id,h.layoutVertexBuffer,h.indexBuffer,r,l.paint,p.transform.zoom,h.programConfigurations.get(l.id),k)}function Ip(h,r,l,p,g,y,T){const E=h.context.gl,M=l.paint.get("fill-pattern"),z=M&&M.constantOr(1);let k,R,N,Z,X;T?(R=z&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=E.LINES):(R=z?"fillPattern":"fill",k=E.TRIANGLES);for(const W of p){const K=r.getTile(W);if(z&&!K.patternsLoaded())continue;const B=K.getBucket(l);if(!B)continue;h.prepareDrawTile();const $=B.programConfigurations.get(l.id),Q=h.useProgram(R,$);z&&(h.context.activeTexture.set(E.TEXTURE0),K.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),$.updatePaintBuffers());const ee=M.constantOr(null);if(ee&&K.imageAtlas){const pe=K.imageAtlas.patternPositions[ee.toString()];pe&&$.setConstantPatternPositions(pe)}const he=h.translatePosMatrix(W.projMatrix,K,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){Z=B.indexBuffer2,X=B.segments2;const pe=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];N=R==="fillOutlinePattern"&&z?Cg(he,h,K,pe):Sg(he,pe)}else Z=B.indexBuffer,X=B.segments,N=z?th(he,h,K):is(he);h.prepareDrawProgram(h.context,Q,W.toUnwrapped()),Q.draw(h.context,k,g,h.stencilModeForClipping(W),y,a.CullFaceMode.disabled,N,l.id,B.layoutVertexBuffer,Z,X,l.paint,h.transform.zoom,$)}}function fc(h,r,l,p,g,y,T){const E=h.context,M=E.gl,z=h.transform,k=l.paint.get("fill-extrusion-pattern"),R=k.constantOr(1),N=l.paint.get("fill-extrusion-opacity"),Z=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],X=l.layout.get("fill-extrusion-edge-radius"),W=X>0&&!l.paint.get("fill-extrusion-rounded-roof"),K=W?0:X,B=z.projection.name==="globe"?a.fillExtrusionHeightLift():0,$=z.projection.name==="globe",Q=$?a.globeToMercatorTransition(z.zoom):0,ee=[a.mercatorXfromLng(z.center.lng),a.mercatorYfromLat(z.center.lat)],he=[];$&&he.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&he.push("FAUX_AO"),W&&he.push("ZERO_ROOF_RADIUS");for(const pe of p){const de=r.getTile(pe),ve=de.getBucket(l);if(!ve||ve.projection.name!==z.projection.name)continue;const ye=ve.programConfigurations.get(l.id),Se=h.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ye,he);if(h.terrain){const Re=h.terrain;if(h.style.terrainSetForDrapingOnly())Re.setupElevationDraw(de,Se,{useMeterToDem:!0});else{if(!ve.enableTerrain)continue;if(Re.setupElevationDraw(de,Se,{useMeterToDem:!0}),kp(E,r,pe,ve,l,Re),!ve.centroidVertexBuffer){const qe=Se.attributes.a_centroid_pos;qe!==void 0&&M.vertexAttrib2f(qe,0,0)}}}R&&(h.context.activeTexture.set(M.TEXTURE0),de.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ye.updatePaintBuffers());const $e=k.constantOr(null);if($e&&de.imageAtlas){const Re=de.imageAtlas.patternPositions[$e.toString()];Re&&ye.setConstantPatternPositions(Re)}const be=h.translatePosMatrix(pe.projMatrix,de,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Fe=z.projection.createInversionMatrix(z,pe.canonical),Me=l.paint.get("fill-extrusion-vertical-gradient"),Ge=R?Ep(be,h,Me,N,Z,K,pe,de,B,Q,ee,Fe):eh(be,h,Me,N,Z,K,pe,B,Q,ee,Fe);h.prepareDrawProgram(E,Se,pe.toUnwrapped());const Ee=[];h.terrain&&Ee.push(ve.centroidVertexBuffer),$&&Ee.push(ve.layoutVertexExtBuffer),Se.draw(E,E.gl.TRIANGLES,g,y,T,a.CullFaceMode.backCCW,Ge,l.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,l.paint,h.transform.zoom,ye,Ee)}}function kp(h,r,l,p,g,y){const T=[B=>{let $=B.canonical.x-1,Q=B.wrap;return $<0&&($=(1<<B.canonical.z)-1,Q--),new a.OverscaledTileID(B.overscaledZ,Q,B.canonical.z,$,B.canonical.y)},B=>{let $=B.canonical.x+1,Q=B.wrap;return $===1<<B.canonical.z&&($=0,Q++),new a.OverscaledTileID(B.overscaledZ,Q,B.canonical.z,$,B.canonical.y)},B=>new a.OverscaledTileID(B.overscaledZ,B.wrap,B.canonical.z,B.canonical.x,(B.canonical.y===0?1<<B.canonical.z:B.canonical.y)-1),B=>new a.OverscaledTileID(B.overscaledZ,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y===(1<<B.canonical.z)-1?0:B.canonical.y+1)],E=B=>{const $=r.getSource().minzoom,Q=he=>{const pe=r.getTileByID(he);if(pe&&pe.hasData())return pe.getBucket(g)},ee=[0,-1,1];for(const he of ee){if(B.overscaledZ+he<$)continue;const pe=Q(B.calculateScaledKey(B.overscaledZ+he));if(pe)return pe}},M=[0,0,0],z=(B,$)=>(M[0]=Math.min(B.min.y,$.min.y),M[1]=Math.max(B.max.y,$.max.y),M[2]=a.EXTENT-$.min.x>B.max.x?$.min.x-a.EXTENT:B.max.x,M),k=(B,$)=>(M[0]=Math.min(B.min.x,$.min.x),M[1]=Math.max(B.max.x,$.max.x),M[2]=a.EXTENT-$.min.y>B.max.y?$.min.y-a.EXTENT:B.max.y,M),R=[(B,$)=>z(B,$),(B,$)=>z($,B),(B,$)=>k(B,$),(B,$)=>k($,B)],N=new a.Point(0,0);let Z,X,W;const K=(B,$,Q,ee,he)=>{const pe=[[ee?Q:B,ee?B:Q,0],[ee?Q:$,ee?$:Q,0]],de=he<0?a.EXTENT+he:he,ve=[ee?de:(B+$)/2,ee?(B+$)/2:de,0];return Q===0&&he<0||Q!==0&&he>0?y.getForTilePoints(W,[ve],!0,X):pe.push(ve),y.getForTilePoints(l,pe,!0,Z),Math.max(pe[0][2],pe[1][2],ve[2])/y.exaggeration()};for(let B=0;B<4;B++){const $=(B<2?1:5)-B,Q=p.borders[B];if(Q.length===0)continue;const ee=W=T[B](l),he=E(ee);if(!(he&&he instanceof a.FillExtrusionBucket&&he.enableTerrain)||p.borderDoneWithNeighborZ[B]===he.canonical.z&&he.borderDoneWithNeighborZ[$]===p.canonical.z||(X=y.findDEMTileFor(ee),!X||!X.dem))continue;if(!Z){const ye=y.findDEMTileFor(l);if(!ye||!ye.dem)return;Z=ye}const pe=he.borders[$];let de=0;const ve=he.borderDoneWithNeighborZ[$]!==p.canonical.z;if(p.canonical.z===he.canonical.z){for(let ye=0;ye<Q.length;ye++){const Se=p.featuresOnBorder[Q[ye]],$e=Se.borders[B];let be;for(;de<pe.length&&(be=he.featuresOnBorder[pe[de]],!(be.borders[$][1]>$e[0]+3));)ve&&he.encodeCentroid(void 0,be,!1),de++;if(be&&de<pe.length){const Fe=de;let Me=0;for(;!(be.borders[$][0]>$e[1]-3)&&(Me++,++de!==pe.length);)be=he.featuresOnBorder[pe[de]];if(be=he.featuresOnBorder[pe[Fe]],Se.intersectsCount()>1||be.intersectsCount()>1||Me!==1){Me!==1&&(de=Fe),p.encodeCentroid(void 0,Se,!1),ve&&he.encodeCentroid(void 0,be,!1);continue}const Ge=R[B](Se,be),Ee=B%2?a.EXTENT-1:0;N.x=K(Ge[0],Math.min(a.EXTENT-1,Ge[1]),Ee,B<2,Ge[2]),N.y=0,p.encodeCentroid(N,Se,!1),ve&&he.encodeCentroid(N,be,!1)}else p.encodeCentroid(void 0,Se,!1)}p.borderDoneWithNeighborZ[B]=he.canonical.z,p.needsCentroidUpdate=!0,ve&&(he.borderDoneWithNeighborZ[$]=p.canonical.z,he.needsCentroidUpdate=!0)}else{for(const ye of Q)p.encodeCentroid(void 0,p.featuresOnBorder[ye],!1);if(ve){for(const ye of pe)he.encodeCentroid(void 0,he.featuresOnBorder[ye],!1);he.borderDoneWithNeighborZ[$]=p.canonical.z,he.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[B]=he.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(h)}const Zs=new a.Color(1,0,0,1),kg=new a.Color(0,1,0,1),zg=new a.Color(0,0,1,1),Dg=new a.Color(1,0,1,1),Lg=new a.Color(0,1,1,1);function Rg(h,r,l){const p=h.context,g=h.transform,y=p.gl,T=g.projection.name==="globe",E=T?["PROJECTION_GLOBE_VIEW"]:null;let M=l.projMatrix;if(T&&a.globeToMercatorTransition(g.zoom)>0){const Se=a.transitionTileAABBinECEF(l.canonical,g),$e=a.globeDenormalizeECEF(Se);M=a.multiply(new Float32Array(16),g.globeMatrix,$e),a.multiply(M,g.projMatrix,M)}const z=h.useProgram("debug",null,E),k=r.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(k,z);const R=a.DepthMode.disabled,N=a.StencilMode.disabled,Z=h.colorModeForRenderPass(),X="$debug";p.activeTexture.set(y.TEXTURE0),h.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),T?k._makeGlobeTileDebugBuffers(h.context,g):k._makeDebugTileBoundsBuffers(h.context,g.projection);const W=k._tileDebugBuffer||h.debugBuffer,K=k._tileDebugIndexBuffer||h.debugIndexBuffer,B=k._tileDebugSegments||h.debugSegments;z.draw(p,y.LINE_STRIP,R,N,Z,a.CullFaceMode.disabled,uc(M,a.Color.red),X,W,K,B,null,null,null,[k._globeTileDebugBorderBuffer]);const $=k.latestRawTileData,Q=Math.floor(($&&$.byteLength||0)/1024),ee=r.getTile(l).tileSize,he=512/Math.min(ee,512)*(l.overscaledZ/g.zoom)*.5;let pe=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(pe+=` => ${l.overscaledZ}`),pe+=` ${Q}kb`,function(Se,$e){Se.initDebugOverlayCanvas();const be=Se.debugOverlayCanvas,Fe=Se.context.gl,Me=Se.debugOverlayCanvas.getContext("2d");Me.clearRect(0,0,be.width,be.height),Me.shadowColor="white",Me.shadowBlur=2,Me.lineWidth=1.5,Me.strokeStyle="white",Me.textBaseline="top",Me.font="bold 36px Open Sans, sans-serif",Me.fillText($e,5,5),Me.strokeText($e,5,5),Se.debugOverlayTexture.update(be),Se.debugOverlayTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}(h,pe);const de=k._tileDebugTextBuffer||h.debugBuffer,ve=k._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,ye=k._tileDebugTextSegments||h.debugSegments;z.draw(p,y.TRIANGLES,R,N,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,uc(M,a.Color.transparent,he),X,de,ve,ye,null,null,null,[k._globeTileDebugTextBuffer])}function zp(h,r,l,p){qs(h,0,r+l/2,h.transform.width,l,p)}function mc(h,r,l,p){qs(h,r-l/2,0,l,h.transform.height,p)}function qs(h,r,l,p,g,y){const T=h.context,E=T.gl;E.enable(E.SCISSOR_TEST),E.scissor(r*a.exported.devicePixelRatio,l*a.exported.devicePixelRatio,p*a.exported.devicePixelRatio,g*a.exported.devicePixelRatio),T.clear({color:y}),E.disable(E.SCISSOR_TEST)}const Dp=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Lp}=Dp;function ao(h,r,l,p){h.emplaceBack(r,l,p)}class gc{constructor(r){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,ao(this.vertexArray,-1,-1,1),ao(this.vertexArray,1,-1,1),ao(this.vertexArray,-1,1,1),ao(this.vertexArray,1,1,1),ao(this.vertexArray,-1,-1,-1),ao(this.vertexArray,1,-1,-1),ao(this.vertexArray,-1,1,-1),ao(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Lp),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function or(h,r,l,p,g,y){const T=h.gl,E=r.paint.get("sky-atmosphere-color"),M=r.paint.get("sky-atmosphere-halo-color"),z=r.paint.get("sky-atmosphere-sun-intensity"),k=((R,N,Z,X,W)=>({u_matrix_3f:R,u_sun_direction:N,u_sun_intensity:Z,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),p),g,z,E,M);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+y,r.skyboxTexture,0),l.draw(h,T.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,k,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const al=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Rp{constructor(r){const l=new a.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new a.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,al.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const rs={symbol:function(h,r,l,p,g){if(h.renderPass!=="translucent")return;const y=a.StencilMode.disabled,T=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(E,M,z,k,R,N,Z){const X=M.transform,W=R==="map",K=N==="map";for(const B of E){const $=k.getTile(B),Q=$.getBucket(z);if(!Q||!Q.text||!Q.text.segments.get().length)continue;const ee=a.evaluateSizeForZoom(Q.textSizeData,X.zoom),he=xn(B,Q.getProjection(),X),pe=X.calculatePixelsToTileUnitsMatrix($),de=De(he,$.tileID.canonical,K,W,X,Q.getProjection(),pe),ve=z.layout.get("icon-text-fit")!=="none"&&Q.hasIconData();if(ee){const ye=Math.pow(2,X.zoom-$.tileID.overscaledZ);Ig(Q,W,K,Z,a.symbolSize,X,de,B,ye,ee,ve)}}}(p,h,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),g),l.paint.get("icon-opacity").constantOr(1)!==0&&Pp(h,r,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),y,T),l.paint.get("text-opacity").constantOr(1)!==0&&Pp(h,r,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),y,T),r.map.showCollisionBoxes&&(ol(h,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),ol(h,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,l,p){if(h.renderPass!=="translucent")return;const g=l.paint.get("circle-opacity"),y=l.paint.get("circle-stroke-width"),T=l.paint.get("circle-stroke-opacity"),E=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)===0&&(y.constantOr(1)===0||T.constantOr(1)===0))return;const M=h.context,z=M.gl,k=h.transform,R=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),N=a.StencilMode.disabled,Z=h.colorModeForRenderPass(),X=k.projection.name==="globe",W=[a.mercatorXfromLng(k.center.lng),a.mercatorYfromLat(k.center.lat)],K=[];for(let $=0;$<p.length;$++){const Q=p[$],ee=r.getTile(Q),he=ee.getBucket(l);if(!he||he.projection.name!==k.projection.name)continue;const pe=he.programConfigurations.get(l.id),de=ih(l);X&&de.push("PROJECTION_GLOBE_VIEW");const ve=h.useProgram("circle",pe,de),ye=he.layoutVertexBuffer,Se=he.globeExtVertexBuffer,$e=he.indexBuffer,be=k.projection.createInversionMatrix(k,Q.canonical),Fe={programConfiguration:pe,program:ve,layoutVertexBuffer:ye,globeExtVertexBuffer:Se,indexBuffer:$e,uniformValues:nh(h,Q,ee,be,W,l),tile:ee};if(E){const Me=he.segments.get();for(const Ge of Me)K.push({segments:new a.SegmentVector([Ge]),sortKey:Ge.sortKey,state:Fe})}else K.push({segments:he.segments,sortKey:0,state:Fe})}E&&K.sort(($,Q)=>$.sortKey-Q.sortKey);const B={useDepthForOcclusion:!X};for(const $ of K){const{programConfiguration:Q,program:ee,layoutVertexBuffer:he,globeExtVertexBuffer:pe,indexBuffer:de,uniformValues:ve,tile:ye}=$.state,Se=$.segments;h.terrain&&h.terrain.setupElevationDraw(ye,ee,B),h.prepareDrawProgram(M,ee,ye.tileID.toUnwrapped()),ee.draw(M,z.TRIANGLES,R,N,Z,a.CullFaceMode.disabled,ve,l.id,he,de,Se,l.paint,k.zoom,Q,[pe])}},heatmap:function(h,r,l,p){if(l.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const g=h.context,y=g.gl,T=a.StencilMode.disabled,E=new a.ColorMode([y.ONE,y.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(Z,X,W,K){const B=Z.gl,$=X.width*K,Q=X.height*K;Z.activeTexture.set(B.TEXTURE1),Z.viewport.set([0,0,$,Q]);let ee=W.heatmapFbo;if(!ee||ee&&(ee.width!==$||ee.height!==Q)){ee&&ee.destroy();const he=B.createTexture();B.bindTexture(B.TEXTURE_2D,he),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),ee=W.heatmapFbo=Z.createFramebuffer($,Q,!1),function(pe,de,ve,ye,Se,$e){const be=pe.gl;be.texImage2D(be.TEXTURE_2D,0,pe.isWebGL2&&pe.extRenderToTextureHalfFloat?be.RGBA16F:be.RGBA,Se,$e,0,be.RGBA,pe.extRenderToTextureHalfFloat?pe.isWebGL2?be.HALF_FLOAT:pe.extTextureHalfFloat.HALF_FLOAT_OES:be.UNSIGNED_BYTE,null),ye.colorAttachment.set(ve)}(Z,0,he,ee,$,Q)}else B.bindTexture(B.TEXTURE_2D,ee.colorAttachment.get()),Z.bindFramebuffer.set(ee.framebuffer)})(g,h,l,h.transform.projection.name==="globe"?.5:.25),g.clear({color:a.Color.transparent});const M=h.transform,z=M.projection.name==="globe",k=z?["PROJECTION_GLOBE_VIEW"]:null,R=z?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,N=[a.mercatorXfromLng(M.center.lng),a.mercatorYfromLat(M.center.lat)];for(let Z=0;Z<p.length;Z++){const X=p[Z];if(r.hasRenderableParent(X))continue;const W=r.getTile(X),K=W.getBucket(l);if(!K||K.projection.name!==M.projection.name)continue;const B=K.programConfigurations.get(l.id),$=h.useProgram("heatmap",B,k),{zoom:Q}=h.transform;h.terrain&&h.terrain.setupElevationDraw(W,$),h.prepareDrawProgram(g,$,X.toUnwrapped());const ee=M.projection.createInversionMatrix(M,X.canonical);$.draw(g,y.TRIANGLES,a.DepthMode.disabled,T,E,R,Cp(h,X,W,ee,N,Q,l.paint.get("heatmap-intensity")),l.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,l.paint,h.transform.zoom,B,z?[K.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,y){const T=g.context,E=T.gl,M=y.heatmapFbo;if(!M)return;T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,M.colorAttachment.get()),T.activeTexture.set(E.TEXTURE1);let z=y.colorRampTexture;z||(z=y.colorRampTexture=new a.Texture(T,y.colorRamp,E.RGBA)),z.bind(E.LINEAR,E.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(T,E.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,g.colorModeForRenderPass(),a.CullFaceMode.disabled,((k,R,N,Z)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,y),y.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,y.paint,g.transform.zoom)}(h,l))},line:function(h,r,l,p){if(h.renderPass!=="translucent")return;const g=l.paint.get("line-opacity"),y=l.paint.get("line-width");if(g.constantOr(1)===0||y.constantOr(1)===0)return;const T=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),E=h.colorModeForRenderPass(),M=h.terrain&&h.terrain.renderingToTexture?1:a.exported.devicePixelRatio,z=l.paint.get("line-dasharray"),k=z.constantOr(1),R=l.layout.get("line-cap"),N=l.paint.get("line-pattern"),Z=N.constantOr(1),X=l.paint.get("line-gradient"),W=Z?"linePattern":"line",K=h.context,B=K.gl,$=(ee=>{const he=[];rl(ee)&&he.push("RENDER_LINE_DASH"),ee.paint.get("line-gradient")&&he.push("RENDER_LINE_GRADIENT");const pe=ee.paint.get("line-trim-offset");pe[0]===0&&pe[1]===0||he.push("RENDER_LINE_TRIM_OFFSET");const de=ee.paint.get("line-pattern").constantOr(1),ve=ee.paint.get("line-opacity").constantOr(1)!==1;return!de&&ve&&he.push("RENDER_LINE_ALPHA_DISCARD"),he})(l);let Q=$.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Q=!1);for(const ee of p){const he=r.getTile(ee);if(Z&&!he.patternsLoaded())continue;const pe=he.getBucket(l);if(!pe)continue;h.prepareDrawTile();const de=pe.programConfigurations.get(l.id),ve=h.useProgram(W,de,$),ye=N.constantOr(null);if(ye&&he.imageAtlas){const Re=he.imageAtlas.patternPositions[ye.toString()];Re&&de.setConstantPatternPositions(Re)}const Se=z.constantOr(null),$e=R.constantOr(null);if(!Z&&Se&&$e&&he.lineAtlas){const Re=he.lineAtlas.getDash(Se,$e);Re&&de.setConstantPatternPositions(Re)}let[be,Fe]=l.paint.get("line-trim-offset");($e==="round"||$e==="square")&&be!==Fe&&(be===0&&(be-=1),Fe===1&&(Fe+=1));const Me=h.terrain?ee.projMatrix:null,Ge=Z?il(h,he,l,Me,M):Ag(h,he,l,Me,pe.lineClipsArray.length,M,[be,Fe]);if(X){const Re=pe.gradients[l.id];let qe=Re.texture;if(l.gradientVersion!==Re.version){let Ue=256;if(l.stepInterpolant){const Xe=r.getSource().maxzoom,ft=ee.canonical.z===Xe?Math.ceil(1<<h.transform.maxZoom-ee.canonical.z):1;Ue=a.clamp(a.nextPowerOfTwo(pe.maxLineLength/a.EXTENT*1024*ft),256,K.maxTextureSize)}Re.gradient=a.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Ue,image:Re.gradient||void 0,clips:pe.lineClipsArray}),Re.texture?Re.texture.update(Re.gradient):Re.texture=new a.Texture(K,Re.gradient,B.RGBA),Re.version=l.gradientVersion,qe=Re.texture}K.activeTexture.set(B.TEXTURE1),qe.bind(l.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}k&&(K.activeTexture.set(B.TEXTURE0),he.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),de.updatePaintBuffers()),Z&&(K.activeTexture.set(B.TEXTURE0),he.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),de.updatePaintBuffers()),h.prepareDrawProgram(K,ve,ee.toUnwrapped());const Ee=Re=>{ve.draw(K,B.TRIANGLES,T,Re,E,a.CullFaceMode.disabled,Ge,l.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,l.paint,h.transform.zoom,de,[pe.layoutVertexBuffer2])};if(Q){const Re=h.stencilModeForClipping(ee).ref;Re===0&&h.terrain&&K.clear({stencil:0});const qe={func:B.EQUAL,mask:255};Ge.u_alpha_discard_threshold=.8,Ee(new a.StencilMode(qe,Re,255,B.KEEP,B.KEEP,B.INVERT)),Ge.u_alpha_discard_threshold=0,Ee(new a.StencilMode(qe,Re,255,B.KEEP,B.KEEP,B.KEEP))}else Ee(h.stencilModeForClipping(ee))}Q&&(h.resetStencilClippingMasks(),h.terrain&&K.clear({stencil:0}))},fill:function(h,r,l,p){const g=l.paint.get("fill-color"),y=l.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const T=h.colorModeForRenderPass(),E=l.paint.get("fill-pattern"),M=h.opaquePassEnabledForLayer()&&!E.constantOr(1)&&g.constantOr(a.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===M){const z=h.depthModeForSublayer(1,h.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Ip(h,r,l,p,z,T,!1)}if(h.renderPass==="translucent"&&l.paint.get("fill-antialias")){const z=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Ip(h,r,l,p,z,T,!0)}},"fill-extrusion":function(h,r,l,p){const g=l.paint.get("fill-extrusion-opacity");if(g!==0&&h.renderPass==="translucent"){const y=new a.DepthMode(h.context.gl.LEQUAL,a.DepthMode.ReadWrite,h.depthRangeFor3D);if(g!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))fc(h,r,l,p,y,a.StencilMode.disabled,a.ColorMode.disabled),fc(h,r,l,p,y,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const T=h.colorModeForRenderPass();fc(h,r,l,p,y,a.StencilMode.disabled,T)}}},hillshade:function(h,r,l,p){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const g=h.context,y=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),T=h.colorModeForRenderPass(),E=h.terrain&&h.terrain.renderingToTexture,[M,z]=h.renderPass!=="translucent"||E?[{},p]:h.stencilConfigForOverlap(p);for(const k of z){const R=r.getTile(k);if(R.needsHillshadePrepare&&h.renderPass==="offscreen")wp(h,R,l,y,a.StencilMode.disabled,T);else if(h.renderPass==="translucent"){const N=E&&h.terrain?h.terrain.stencilModeForRTTOverlap(k):M[k.overscaledZ];xp(h,k,R,l,y,N,T)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,l,p,g,y){if(h.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!p.length)return;const T=h.context,E=T.gl,M=r.getSource(),z=h.useProgram("raster"),k=h.colorModeForRenderPass(),R=h.terrain&&h.terrain.renderingToTexture,[N,Z]=M instanceof Bt||R?[{},p]:h.stencilConfigForOverlap(p),X=Z[Z.length-1].overscaledZ,W=!h.options.moving;for(const K of Z){const B=R?a.DepthMode.disabled:h.depthModeForSublayer(K.overscaledZ-X,l.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,E.LESS),$=K.toUnwrapped(),Q=r.getTile(K);if(R&&(!Q||!Q.hasData()))continue;const ee=R?K.projMatrix:h.transform.calculateProjMatrix($,W),he=h.terrain&&R?h.terrain.stencilModeForRTTOverlap(K):N[K.overscaledZ],pe=y?0:l.paint.get("raster-fade-duration");Q.registerFadeDuration(pe);const de=r.findLoadedParent(K,0),ve=Yu(Q,de,r,h.transform,pe);let ye,Se;h.terrain&&h.terrain.prepareDrawTile();const $e=l.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;T.activeTexture.set(E.TEXTURE0),Q.texture.bind($e,E.CLAMP_TO_EDGE),T.activeTexture.set(E.TEXTURE1),de?(de.texture.bind($e,E.CLAMP_TO_EDGE),ye=Math.pow(2,de.tileID.overscaledZ-Q.tileID.overscaledZ),Se=[Q.tileID.canonical.x*ye%1,Q.tileID.canonical.y*ye%1]):Q.texture.bind($e,E.CLAMP_TO_EDGE),Q.texture.useMipmap&&T.extTextureFilterAnisotropic&&h.transform.pitch>20&&E.texParameterf(E.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const be=sh(ee,Se||[0,0],ye||1,ve,l,M instanceof Bt?M.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(T,z,$),M instanceof Bt)M.boundsBuffer&&M.boundsSegments&&z.draw(T,E.TRIANGLES,B,a.StencilMode.disabled,k,a.CullFaceMode.disabled,be,l.id,M.boundsBuffer,h.quadTriangleIndexBuffer,M.boundsSegments);else{const{tileBoundsBuffer:Fe,tileBoundsIndexBuffer:Me,tileBoundsSegments:Ge}=h.getTileBoundsBuffers(Q);z.draw(T,E.TRIANGLES,B,he,k,a.CullFaceMode.disabled,be,l.id,Fe,Me,Ge)}}h.resetStencilClippingMasks()},background:function(h,r,l,p){const g=l.paint.get("background-color"),y=l.paint.get("background-opacity");if(y===0)return;const T=h.context,E=T.gl,M=h.transform,z=M.tileSize,k=l.paint.get("background-pattern");if(h.isPatternMissing(k))return;const R=!k&&g.a===1&&y===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==R)return;const N=a.StencilMode.disabled,Z=h.depthModeForSublayer(0,R==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),X=h.colorModeForRenderPass(),W=h.useProgram(k?"backgroundPattern":"background");let K,B=p;B||(K=h.getBackgroundTiles(),B=Object.values(K).map($=>$.tileID)),k&&(T.activeTexture.set(E.TEXTURE0),h.imageManager.bind(h.context));for(const $ of B){const Q=$.toUnwrapped(),ee=p?$.projMatrix:h.transform.calculateProjMatrix(Q);h.prepareDrawTile();const he=r?r.getTile($):K?K[$.key]:new a.Tile($,z,M.zoom,h),pe=k?Pg(ee,y,h,k,{tileID:$,tileSize:z}):lh(ee,y,g);h.prepareDrawProgram(T,W,Q);const{tileBoundsBuffer:de,tileBoundsIndexBuffer:ve,tileBoundsSegments:ye}=h.getTileBoundsBuffers(he);W.draw(T,E.TRIANGLES,Z,N,X,a.CullFaceMode.disabled,pe,l.id,de,ve,ye)}},sky:function(h,r,l){const p=h.transform,g=p.projection.name==="mercator"||p.projection.name==="globe"?1:a.smoothstep(7,8,p.zoom),y=l.paint.get("sky-opacity")*g;if(y===0)return;const T=h.context,E=l.paint.get("sky-type"),M=new a.DepthMode(T.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),z=h.frameCounter/1e3%1;E==="atmosphere"?h.renderPass==="offscreen"?l.needsSkyboxCapture(h)&&(function(k,R,N,Z){const X=k.context,W=X.gl;let K=R.skyboxFbo;if(!K){K=R.skyboxFbo=X.createFramebuffer(32,32,!1),R.skyboxGeometry=new gc(X),R.skyboxTexture=X.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,R.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let ee=0;ee<6;++ee)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(K.framebuffer),X.viewport.set([0,0,32,32]);const B=R.getCenter(k,!0),$=k.useProgram("skyboxCapture"),Q=new Float64Array(16);a.identity(Q),a.rotateY(Q,Q,.5*-Math.PI),or(X,R,$,Q,B,0),a.identity(Q),a.rotateY(Q,Q,.5*Math.PI),or(X,R,$,Q,B,1),a.identity(Q),a.rotateX(Q,Q,.5*-Math.PI),or(X,R,$,Q,B,2),a.identity(Q),a.rotateX(Q,Q,.5*Math.PI),or(X,R,$,Q,B,3),a.identity(Q),or(X,R,$,Q,B,4),a.identity(Q),a.rotateY(Q,Q,Math.PI),or(X,R,$,Q,B,5),X.viewport.set([0,0,k.width,k.height])}(h,l),l.markSkyboxValid(h)):h.renderPass==="sky"&&function(k,R,N,Z,X){const W=k.context,K=W.gl,B=k.transform,$=k.useProgram("skybox");W.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,R.skyboxTexture);const Q=((ee,he,pe,de,ve)=>({u_matrix:ee,u_sun_direction:he,u_cubemap:0,u_opacity:de,u_temporal_offset:ve}))(B.skyboxMatrix,R.getCenter(k,!1),0,Z,X);k.prepareDrawProgram(W,$),$.draw(W,K.TRIANGLES,N,a.StencilMode.disabled,k.colorModeForRenderPass(),a.CullFaceMode.backCW,Q,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,l,M,y,z):E==="gradient"&&h.renderPass==="sky"&&function(k,R,N,Z,X){const W=k.context,K=W.gl,B=k.transform,$=k.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new gc(W)),W.activeTexture.set(K.TEXTURE0);let Q=R.colorRampTexture;Q||(Q=R.colorRampTexture=new a.Texture(W,R.colorRamp,K.RGBA)),Q.bind(K.LINEAR,K.CLAMP_TO_EDGE);const ee=((he,pe,de,ve,ye)=>({u_matrix:he,u_color_ramp:0,u_center_direction:pe,u_radius:a.degToRad(de),u_opacity:ve,u_temporal_offset:ye}))(B.skyboxMatrix,R.getCenter(k,!1),R.paint.get("sky-gradient-radius"),Z,X);k.prepareDrawProgram(W,$),$.draw(W,K.TRIANGLES,N,a.StencilMode.disabled,k.colorModeForRenderPass(),a.CullFaceMode.backCW,ee,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,l,M,y,z)},debug:function(h,r,l){for(let p=0;p<l.length;p++)Rg(h,r,l[p])},custom:function(h,r,l,p){const g=h.context,y=l.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&l.isLayerDraped()){if(h.renderPass==="offscreen"){const T=y.prerender;if(T){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const E=h.transform.pointMerc;T.call(y,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(h.transform.zoom),[E.x,E.y],h.transform.pixelsPerMeterRatio)}else T.call(y,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const E=y.renderToTile;if(E){const M=p[0].canonical,z=new a.MercatorCoordinate(M.x+p[0].wrap*(1<<M.z),M.y,M.z);g.setDepthMode(a.DepthMode.disabled),g.setStencilMode(a.StencilMode.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),E.call(y,g.gl,z),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(a.StencilMode.disabled);const T=y.renderingMode==="3d"?new a.DepthMode(h.context.gl.LEQUAL,a.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,a.DepthMode.ReadOnly);if(g.setDepthMode(T),h.transform.projection.name==="globe"){const E=h.transform.pointMerc;y.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(h.transform.zoom),[E.x,E.y],h.transform.pixelsPerMeterRatio)}else y.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else a.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ws{constructor(r,l,p=!1){this.context=new Je(r,p),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qu(this,r));const g=this._terrain;this.transform.elevation=p?g:null,g.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,g]=l.getFovAdjustedRange(this.transform._fov);if(p>g)return void(this.transform.fogCullDistSq=null);const y=p+.78*(g-p);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*a.exported.devicePixelRatio,this.height=l*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,l=new a.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(a.EXTENT,0),l.emplaceBack(0,a.EXTENT),l.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const p=new a.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(a.EXTENT,0),p.emplaceBack(0,a.EXTENT),p.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=r.createVertexBuffer(p,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const g=new a.StructArrayLayout2i4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(g,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const y=new a.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(a.EXTENT,0,a.EXTENT,0),y.emplaceBack(0,a.EXTENT,0,a.EXTENT),y.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(y,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const T=new a.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(T);const E=new a.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])E.emplaceBack(z);this.debugIndexBuffer=r.createIndexBuffer(E),this.emptyTexture=new a.Texture(r,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=a.create();const M=this.context.gl;this.stencilClearMode=new a.StencilMode({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new Rp(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,tl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,p){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const M of p)if(this._tileClippingMaskIDs[M.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=l.id;const g=this.context,y=g.gl;this.nextStencilID+p.length>256&&this.clearStencil(),g.setColorMode(a.ColorMode.disabled),g.setDepthMode(a.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of p){const M=l.getTile(E),z=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:R,tileBoundsSegments:N}=this.getTileBoundsBuffers(M);T.draw(g,y.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:y.ALWAYS,mask:0},z,255,y.KEEP,y.KEEP,y.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,tl(E.projMatrix),"$clipping",k,R,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new a.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new a.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,p=r.sort((T,E)=>E.overscaledZ-T.overscaledZ),g=p[p.length-1].overscaledZ,y=p[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const T={};for(let E=0;E<y;E++)T[E+g]=new a.StencilMode({func:l.GEQUAL,mask:255},E+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[T,p]}return[{[g]:a.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([r.CONSTANT_COLOR,r.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(r,l,p){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new a.DepthMode(p||this.context.gl.LEQUAL,l,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const p=this.style.order,g=this.style._sourceCaches;for(const z in g){const k=g[z];k.used&&k.prepare(this.context)}const y={},T={},E={};for(const z in g){const k=g[z];y[z]=k.getVisibleCoordinates(),T[z]=y[z].slice().reverse(),E[z]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<p.length;z++)if(this.style._layers[p[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of p){const k=this.style._layers[z],R=r._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const N=R?T[R.id]:void 0;(k.type==="custom"||k.isSky()||N&&N.length)&&this.renderLayer(this,R,k,N)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon];const M=this.terrain;if(M&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&M.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[p[this.currentLayer]],k=r._getLayerSourceCache(z);if(z.isSky())continue;const R=k?T[k.id]:void 0;this._renderTileClippingMasks(z,k,R),this.renderLayer(this,k,z,R)}if(this.style.fog&&this.transform.projection.supportsFog&&function(z,k){const R=z.context,N=R.gl,Z=z.transform,X=new a.DepthMode(N.LEQUAL,a.DepthMode.ReadOnly,[0,1]),W=z.useProgram("globeAtmosphere",null,Z.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),K=a.globeToMercatorTransition(Z.zoom),B=k.properties.get("color").toArray01(),$=k.properties.get("high-color").toArray01(),Q=k.properties.get("space-color").toArray01PremultipliedAlpha(),ee=a.identity$1([]);a.rotateY$1(ee,ee,-a.degToRad(Z._center.lng)),a.rotateX$1(ee,ee,a.degToRad(Z._center.lat)),a.rotateZ$1(ee,ee,Z.angle),a.rotateX$1(ee,ee,-Z._pitch);const he=a.fromQuat(new Float32Array(16),ee),pe=a.mapValue(k.properties.get("star-intensity"),0,1,0,.25),de=5e-4,ve=a.mapValue(k.properties.get("horizon-blend"),0,1,de,.25),ye=a.globeUseCustomAntiAliasing(z,R,Z)&&ve===de?Z.worldSize/(2*Math.PI*1.025)-1:Z.globeRadius,Se=z.frameCounter/1e3%1,$e=a.length(Z.globeCenterInViewSpace),be=Math.sqrt(Math.pow($e,2)-Math.pow(ye,2)),Fe=Math.acos(be/$e),Me=((Ee,Re,qe,Ue,Xe,ft,Tt,ht,xt,Nt,Ot,pt,en,nn)=>({u_frustum_tl:Ee,u_frustum_tr:Re,u_frustum_br:qe,u_frustum_bl:Ue,u_horizon:Xe,u_transition:ft,u_fadeout_range:Tt,u_color:ht,u_high_color:xt,u_space_color:Nt,u_star_intensity:Ot,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:pt,u_horizon_angle:en,u_rotation_matrix:nn}))(Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.frustumCorners.horizon,K,ve,B,$,Q,pe,Se,Fe,he);z.prepareDrawProgram(R,W);const Ge=z.atmosphereBuffer;Ge&&W.draw(R,N.TRIANGLES,X,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,Me,"skybox",Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const z=this.style._layers[p[this.currentLayer]],k=r._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,k,z,k?T[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const z=this.style._layers[p[this.currentLayer]],k=r._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=k?(z.type==="symbol"?E:T)[k.id]:void 0;this._renderTileClippingMasks(z,k,k?y[k.id]:void 0),this.renderLayer(this,k,z,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let z=null;a.values(this.style._layers).forEach(k=>{const R=r._getLayerSourceCache(k);R&&!k.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<R.getSource().maxzoom)&&(z=R)}),z&&this.options.showTileBoundaries&&rs.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const k=z.transform.padding;zp(z,z.transform.height-(k.top||0),3,Zs),zp(z,k.bottom||0,3,kg),mc(z,k.left||0,3,zg),mc(z,z.transform.width-(k.right||0),3,Dg);const R=z.transform.centerPoint;(function(N,Z,X,W){qs(N,Z-1,X-10,2,20,W),qs(N,Z-10,X-1,20,2,W)})(z,R.x,z.transform.height-R.y,Lg)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,l,p,g){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||g&&g.length)&&(this.id=p.id,this.gpuTimingStart(p),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(p.type)||r.terrain&&p.type==="custom")&&rs[p.type](r,l,p,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const p in r){const g=r[p],y=this.context.extTimerQuery,T=y.getQueryObjectEXT(g.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(g.query),l[p]=T}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const g of r)p+=l.getQueryObjectEXT(g,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(g);return p}translatePosMatrix(r,l,p,g,y){if(!p[0]&&!p[1])return r;const T=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(T){const z=Math.sin(T),k=Math.cos(T);p=[p[0]*k-p[1]*z,p[0]*z+p[1]*k]}const E=[y?p[0]:gt(l,p[0],this.transform.zoom),y?p[1]:gt(l,p[1],this.transform.zoom),0],M=new Float32Array(16);return a.translate(M,r,E),M}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&this.terrain.exaggeration()===0,p=this.style&&this.style.fog,g=[];return this.terrainRenderModeElevated()&&g.push("TERRAIN"),this.transform.projection.name==="globe"&&g.push("GLOBE"),l&&g.push("ZERO_EXAGGERATION"),p&&!r&&p.getOpacity(this.transform.pitch)!==0&&g.push("FOG"),r&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(r,l,p){this.cache=this.cache||{};const g=p||[],y=this.currentGlobalDefines().concat(g),T=$t.cacheKey(Wu[r],r,y,l);return this.cache[T]||(this.cache[T]=new $t(this.context,r,Wu[r],l,ch[r],y)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const g=this.style.fog;if(g){const y=g.getOpacity(this.transform.pitch),T=((E,M,z,k,R,N,Z,X,W,K,B)=>{const $=E.transform,Q=M.properties.get("color").toArray01();Q[3]=k;const ee=E.frameCounter/1e3%1;return{u_fog_matrix:z?$.calculateFogTileMatrix(z):E.identityMat,u_fog_range:M.getFovAdjustedRange($._fov),u_fog_color:Q,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:ee,u_frustum_tl:R,u_frustum_tr:N,u_frustum_br:Z,u_frustum_bl:X,u_globe_pos:W,u_globe_radius:K,u_viewport:B,u_globe_transition:a.globeToMercatorTransition($.zoom),u_is_globe:+($.projection.name==="globe")}})(this,g,p,y,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);l.setFogUniformValues(r,T)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const g of p)l[g.key]=r[g.key]||new a.Tile(g,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class _c{constructor(r=0,l=0,p=0,g=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=g}interpolate(r,l,p){return l.top!=null&&r.top!=null&&(this.top=a.number(r.top,l.top,p)),l.bottom!=null&&r.bottom!=null&&(this.bottom=a.number(r.bottom,l.bottom,p)),l.left!=null&&r.left!=null&&(this.left=a.number(r.left,l.left,p)),l.right!=null&&r.right!=null&&(this.right=a.number(r.right,l.right,p)),this}getCenter(r,l){const p=a.clamp((this.left+r-this.right)/2,0,r),g=a.clamp((this.top+l-this.bottom)/2,0,l);return new a.Point(p,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new _c(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function yc(h,r){const l=a.getColumn(h,3);a.fromQuat(h,r),a.setColumn(h,3,l)}function Zt(h,r){const l=a.identity$1([]);return a.rotateZ$1(l,l,-r),a.rotateX$1(l,l,-h),l}function ll(h,r){const l=[h[0],h[1],0],p=[r[0],r[1],0];if(a.length(l)>=1e-15){const T=a.normalize([],l);a.scale$2(p,T,a.dot(p,T)),r[0]=p[0],r[1]=p[1]}const g=a.cross([],r,h);if(a.len(g)<1e-15)return null;const y=Math.atan2(-g[1],g[0]);return Zt(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}class Bp{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof a.MercatorCoordinate?r:new a.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=a.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const p=this.position,g=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(r)):0,y=a.MercatorCoordinate.fromLngLat(r,g),T=[y.x-p.x,y.y-p.y,y.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=ll(T,l)}setPitchBearing(r,l){this.orientation=Zt(a.degToRad(r),a.degToRad(-l))}}class vc{constructor(r,l){this._transform=a.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new a.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=a.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&a.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||a.identity$1([]),r&&yc(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=Zt(r,l),yc(this._transform,this._orientation)}forward(){const r=a.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=a.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=a.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const p=new Float64Array(16);return a.invert(p,this.getWorldToCamera(r,l)),p}getWorldToCameraPosition(r,l,p){const g=this.position;a.scale$2(g,g,-r);const y=new Float64Array(16);return a.fromScaling(y,[p,p,p]),a.translate(y,y,g),y[10]*=l,y}getWorldToCamera(r,l){const p=new Float64Array(16),g=new Float64Array(4),y=this.position;return a.conjugate(g,this._orientation),a.scale$2(y,y,-r),a.fromQuat(p,g),a.translate(p,p,y),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,g){const y=new Float64Array(16);return a.perspective(y,r,l,p,g),y}getDistanceToElevation(r,l=!1){const p=r===0?0:a.mercatorZfromAltitude(r,l?a.latFromMercatorY(this.position[1]):this.position[1]),g=this.forward();return(p-this.position[2])/g[2]}clone(){return new vc([...this.position],[...this.orientation])}}function Xs(h,r){const l=xc(h.projection,h.zoom,h.width,h.height),p=function(y,T,E,M,z){const k=new a.LngLat(E.lng-180*lo,E.lat),R=new a.LngLat(E.lng+180*lo,E.lat),N=y.project(k.lng,k.lat),Z=y.project(R.lng,R.lat),X=-Math.atan2(Z.y-N.y,Z.x-N.x),W=a.MercatorCoordinate.fromLngLat(E);W.y=a.clamp(W.y,-1+lo,1-lo);const K=W.toLngLat(),B=y.project(K.lng,K.lat),$=a.MercatorCoordinate.fromLngLat(K);$.x+=lo;const Q=$.toLngLat(),ee=y.project(Q.lng,Q.lat),he=wc(ee.x-B.x,ee.y-B.y,X),pe=a.MercatorCoordinate.fromLngLat(K);pe.y+=lo;const de=pe.toLngLat(),ve=y.project(de.lng,de.lat),ye=wc(ve.x-B.x,ve.y-B.y,X),Se=Math.abs(he.x)/Math.abs(ye.y),$e=a.identity([]);a.rotateZ($e,$e,-X*(1-(z?0:M)));const be=a.identity([]);return a.scale(be,be,[1,1-(1-Se)*M,1]),be[4]=-ye.x/ye.y*M,a.rotateZ(be,be,X),a.multiply(be,$e,be),be}(h.projection,0,h.center,l,r),g=Fp(h);return a.scale(p,p,[g,g,1]),p}function Fp(h){const r=h.projection,l=xc(h.projection,h.zoom,h.width,h.height),p=Op(r,h.center),g=Op(r,a.LngLat.convert(r.center));return Math.pow(2,p*l+(1-l)*g)}function xc(h,r,l,p,g=1/0){const y=h.range;if(!y)return 0;const T=Math.min(g,Math.max(l,p)),E=Math.log(T/1024)/Math.LN2;return a.smoothstep(y[0]+E,y[1]+E,r)}const lo=1/4e4;function Op(h,r){const l=a.clamp(r.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),p=new a.LngLat(r.lng-180*lo,l),g=new a.LngLat(r.lng+180*lo,l),y=h.project(p.lng,l),T=h.project(g.lng,l),E=a.MercatorCoordinate.fromLngLat(p),M=a.MercatorCoordinate.fromLngLat(g),z=T.x-y.x,k=T.y-y.y,R=M.x-E.x,N=M.y-E.y,Z=Math.sqrt((R*R+N*N)/(z*z+k*k));return Math.log(Z)/Math.LN2}function wc(h,r,l){const p=Math.cos(l),g=Math.sin(l);return{x:h*p-r*g,y:h*g+r*p}}class Hs{constructor(r,l,p,g,y,T,E){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=g??60,this.setProjection(T),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _c,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new vc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Hs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const p=!I(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var p;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(g,y,T){var E=y[0],M=y[1],z=y[2],k=y[3],R=Math.sin(T),N=Math.cos(T);g[0]=E*N+z*R,g[1]=M*N+k*R,g[2]=E*-R+z*N,g[3]=M*-R+k*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=a.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=a.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let g=0,y=0;for(let T=0;T<l.length;T++){const E=new a.Point(l[T][0]*this.width,p+l[T][1]*(this.height-p)),M=r.pointCoordinate(E);if(!M)continue;const z=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);g+=M[3]*z,y+=z}return y===0?NaN:g/y}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,g=this._mercatorZfromZoom(r),y=this._mercatorZfromZoom(this._maxZoom),T=Math.max(g-p,y);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const g=a.length(a.sub([],this._camera.position,p));return a.clamp(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!a.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];a.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new Bp;return l.position=new a.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!a.length$1(r))return!1;a.normalize$1(r,r);const l=a.transformQuat([],[0,0,-1],r),p=a.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const g=ll(l,p);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;r[2]=a.clamp(r[2],g/p,g/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new a.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new a.Point(0,0)),g=this.pointCoordinate(new a.Point(this.width,0)),y=this.pointCoordinate(new a.Point(this.width,this.height)),T=this.pointCoordinate(new a.Point(0,this.height)),E=Math.floor(Math.min(p.x,g.x,y.x,T.x)),M=Math.floor(Math.max(p.x,g.x,y.x,T.x)),z=1;for(let k=E-z;k<=M+z;k++)k!==0&&l.push(new a.UnwrappedTileID(k,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const p=l,g=this.elevation&&!r.isTerrainDEM,y=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);const T=this.locationCoordinate(this.center),E=this.center.lat,M=1<<l,z=[M*T.x,M*T.y,0],k=this.projection.name==="globe",R=!k,N=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,R),Z=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=M*a.mercatorZfromAltitude(1,this.center.lat),W=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),K=[M*Z.x,M*Z.y,W*(R?1:X)],B=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),$=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,Q=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ee=r.isTerrainDEM?-Q:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?Fp(this):1,pe=Ee=>{const qe=new a.MercatorCoordinate(Ee.x+25e-6,Ee.y,Ee.z),Ue=new a.MercatorCoordinate(Ee.x,Ee.y+25e-6,Ee.z),Xe=Ee.toLngLat(),ft=qe.toLngLat(),Tt=Ue.toLngLat(),ht=this.locationCoordinate(Xe),xt=this.locationCoordinate(ft),Nt=this.locationCoordinate(Tt),Ot=Math.hypot(xt.x-ht.x,xt.y-ht.y),pt=Math.hypot(Nt.x-ht.x,Nt.y-ht.y);return Math.sqrt(Ot*pt)*he/25e-6},de=Ee=>{const Re=Q,qe=ee;return{aabb:a.tileAABB(this,M,0,0,0,Ee,qe,Re,this.projection),zoom:0,x:0,y:0,minZ:qe,maxZ:Re,wrap:Ee,fullyVisible:!1}},ve=[];let ye=[];const Se=l,$e=r.reparseOverscaled?p:l,be=Ee=>Ee*Ee,Fe=be((W-this._centerAltitude)*X),Me=Ee=>{if(!this._elevation||!Ee.tileID||!y)return;const Re=this._elevation.getMinMaxForTile(Ee.tileID),qe=Ee.aabb;Re?(qe.min[2]=Re.min,qe.max[2]=Re.max,qe.center[2]=(qe.min[2]+qe.max[2])/2):(Ee.shouldSplit=Ge(Ee),Ee.shouldSplit||(qe.min[2]=qe.max[2]=qe.center[2]=this._centerAltitude))},Ge=Ee=>{if(Ee.zoom<$)return!0;if(Ee.zoom===Se)return!1;if(Ee.shouldSplit!=null)return Ee.shouldSplit;const Re=Ee.aabb.distanceX(K),qe=Ee.aabb.distanceY(K);let Ue=Fe,Xe=1;if(k){Ue=be(Ee.aabb.distanceZ(K));const ht=Math.pow(2,Ee.zoom),xt=a.latFromMercatorY((Ee.y+1)/ht),Nt=a.latFromMercatorY(Ee.y/ht),Ot=Math.min(Math.max(E,xt),Nt),pt=a.circumferenceAtLatitude(Ot)/a.circumferenceAtLatitude(E);if(Xe=Ot===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pt/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Ee.zoom===Se-1&&pt>=.9)return!0}else if(g&&(Ue=be(Ee.aabb.distanceZ(K)*X)),this.projection.isReprojectedInTileSpace&&p<=5){const ht=Math.pow(2,Ee.zoom),xt=pe(new a.MercatorCoordinate((Ee.x+.5)/ht,(Ee.y+.5)/ht));Xe=xt>.85?1:xt}const ft=Re*Re+qe*qe+Ue,Tt=be((1<<Se-Ee.zoom)*B*Xe*((ht,xt)=>{if(xt*be(.707)<ht)return 1;const Nt=Math.sqrt(xt/ht);return Nt/(1.4144271570014144+(Math.pow(1.1,Nt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ue,Fe),ft));return ft<Tt};if(this.renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)ve.push(de(-Ee)),ve.push(de(Ee));for(ve.push(de(0));ve.length>0;){const Ee=ve.pop(),Re=Ee.x,qe=Ee.y;let Ue=Ee.fullyVisible;if(!Ue){const Xe=Ee.aabb.intersects(N);if(Xe===0)continue;Ue=Xe===2}if(Ee.zoom!==Se&&Ge(Ee))for(let Xe=0;Xe<4;Xe++){const ft=(Re<<1)+Xe%2,Tt=(qe<<1)+(Xe>>1),ht={aabb:y?Ee.aabb.quadrant(Xe):a.tileAABB(this,M,Ee.zoom+1,ft,Tt,Ee.wrap,Ee.minZ,Ee.maxZ,this.projection),zoom:Ee.zoom+1,x:ft,y:Tt,wrap:Ee.wrap,fullyVisible:Ue,tileID:void 0,shouldSplit:void 0,minZ:Ee.minZ,maxZ:Ee.maxZ};g&&!k&&(ht.tileID=new a.OverscaledTileID(Ee.zoom+1===Se?$e:Ee.zoom+1,Ee.wrap,Ee.zoom+1,ft,Tt),Me(ht)),ve.push(ht)}else{const Xe=Ee.zoom===Se?$e:Ee.zoom;if(r.minzoom&&r.minzoom>Xe)continue;const ft=z[0]-(.5+Re+(Ee.wrap<<Ee.zoom))*(1<<l-Ee.zoom),Tt=z[1]-.5-qe,ht=Ee.tileID?Ee.tileID:new a.OverscaledTileID(Xe,Ee.wrap,Ee.zoom,Re,qe);ye.push({tileID:ht,distanceSq:ft*ft+Tt*Tt})}}if(this.fogCullDistSq){const Ee=this.fogCullDistSq,Re=this.horizonLineFromTop();ye=ye.filter(qe=>{const Ue=[0,0,0,1],Xe=[a.EXTENT,a.EXTENT,0,1],ft=this.calculateFogTileMatrix(qe.tileID.toUnwrapped());a.transformMat4$1(Ue,Ue,ft),a.transformMat4$1(Xe,Xe,ft);const Tt=a.getAABBPointSquareDist(Ue,Xe);if(Tt===0)return!0;let ht=!1;const xt=this._elevation;if(xt&&Tt>Ee&&Re!==0){const Nt=this.calculateProjMatrix(qe.tileID.toUnwrapped());let Ot;r.isTerrainDEM||(Ot=xt.getMinMaxForTile(qe.tileID)),Ot||(Ot={min:ee,max:Q});const pt=a.furthestTileCorner(this.rotation),en=[pt[0]*a.EXTENT,pt[1]*a.EXTENT,Ot.max];a.transformMat4(en,en,Nt),ht=(1-en[1])*this.height*.5<Re}return Tt<Ee||ht})}return ye.sort((Ee,Re)=>Ee.distanceSq-Re.distanceSq).map(Ee=>Ee.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=a.clamp(r.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),p=this.projection.project(r.lng,l);return new a.Point(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,l){let p,g;const y=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;p=(l.x-y.x)/E,g=(l.y-y.y)/E}else{const E=this.pointCoordinate(l),M=this.pointCoordinate(y);p=E.x-M.x,g=E.y-M.y}const T=this.locationCoordinate(r);this.setLocation(new a.MercatorCoordinate(T.x-p,T.y-g))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const p=l?a.mercatorZfromAltitude(l,r.lat):void 0,g=this.projection.project(r.lng,r.lat);return new a.MercatorCoordinate(g.x,g.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const p=l??this._centerAltitude,g=[r.x,r.y,0,1],y=[r.x,r.y,1,1];a.transformMat4$1(g,g,this.pixelMatrixInverse),a.transformMat4$1(y,y,this.pixelMatrixInverse);const T=y[3];a.scale$1(g,g,1/g[3]),a.scale$1(y,y,1/T);const E=g[2],M=y[2];return{p0:g,p1:y,t:E===M?0:(p-E)/(M-E)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return a.transformMat4$1(l,l,this.pixelMatrixInverse),a.transformMat4$1(p,p,this.pixelMatrixInverse),a.scale$1(l,l,1/l[3]),a.scale$1(p,p,1/p[3]),l[2]=a.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=a.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,a.scale$1(l,l,1/this.worldSize),a.scale$1(p,p,1/this.worldSize),new a.Ray([l[0],l[1],l[2]],a.normalize([],a.sub([],p,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:p,t:g}=r,y=a.mercatorZfromAltitude(l[2],this._center.lat),T=a.mercatorZfromAltitude(p[2],this._center.lat);return new a.MercatorCoordinate(a.number(l[0],p[0],g)/this.worldSize,a.number(l[1],p[1],g)/this.worldSize,a.number(y,T,g))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new a.MercatorCoordinate(l[0],l[1],l[2]);let p=0,g=this.horizonLineFromTop();if(r.y>g)return this.pointCoordinate(r);const y=.02*g,T=r.clone();for(let E=0;E<10&&g-p>y;E++){T.y=a.number(p,g,.66);const M=this.projection.pointCoordinate3D(this,T.x,T.y);M?(g=T.y,l=M):p=T.y}return l?new a.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(r);const l=this.pointCoordinate(r);return l.y>=0&&l.y<=1}_coordinatePoint(r,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,g=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return a.transformMat4$1(g,g,this.pixelMatrix),g[3]>0?new a.Point(g[0]/g[3],g[1]/g[3]):new a.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=this.pointLocation3D(new a.Point(l,r)),T=this.pointLocation3D(new a.Point(g,r)),E=this.pointLocation3D(new a.Point(g,p)),M=this.pointLocation3D(new a.Point(l,p));let z=Math.min(y.lng,T.lng,E.lng,M.lng),k=Math.max(y.lng,T.lng,E.lng,M.lng),R=Math.min(y.lat,T.lat,E.lat,M.lat),N=Math.max(y.lat,T.lat,E.lat,M.lat);const Z=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,W=(K,B,$,Q,ee)=>{const he=(K+$)/2,pe=(B+Q)/2,de=new a.Point(he,pe),{lng:ve,lat:ye}=this.pointLocation3D(de),Se=Math.max(0,z-ve,R-ye,ve-k,ye-N);z=Math.min(z,ve),k=Math.max(k,ve),R=Math.min(R,ye),N=Math.max(N,ye),(ee<X||Se>Z)&&(W(K,B,he,pe,ee+1),W(he,pe,$,Q,ee+1))};if(W(l,r,g,r,1),W(g,r,g,p,1),W(g,p,l,p,1),W(l,p,l,r,1),this.projection.name==="globe"){const[K,B]=a.polesInViewport(this);K?(N=90,k=180,z=-180):B&&(R=-90,k=180,z=-180)}return new a.LngLatBounds(new a.LngLat(z,R),new a.LngLat(k,N))}_getBoundsRectangular(r,l){const{top:p,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,E=new a.Point(g,p),M=new a.Point(T,p),z=new a.Point(T,y),k=new a.Point(g,y);let R=this.pointCoordinate(E,r),N=this.pointCoordinate(M,r);const Z=this.pointCoordinate(z,l),X=this.pointCoordinate(k,l),W=(K,B)=>(B.y-K.y)/(B.x-K.x);return R.y>1&&N.y>=0?R=new a.MercatorCoordinate((1-X.y)/W(X,R)+X.x,1):R.y<0&&N.y<=1&&(R=new a.MercatorCoordinate(-X.y/W(X,R)+X.x,0)),N.y>1&&R.y>=0?N=new a.MercatorCoordinate((1-Z.y)/W(Z,N)+Z.x,1):N.y<0&&R.y<=1&&(N=new a.MercatorCoordinate(-Z.y/W(Z,N)+Z.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(R)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=r.visibleDemTiles.reduce((p,g)=>{if(g.dem){const y=g.dem.tree;p.min=Math.min(p.min,y.minimums[0]),p.max=Math.max(p.max,y.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,p=this._distanceTileDataCache;if(p[l])return p[l];const g=r.canonical,y=1/this.height,T=this.cameraWorldSize,E=T/this.zoomScale(g.z),M=(g.x+Math.pow(2,g.z)*r.wrap)*E,z=g.y*E,k=this.point;k.x*=T/this.worldSize,k.y*=T/this.worldSize;const R=this.angle,N=Math.sin(-R),Z=-Math.cos(-R);return p[l]={bearing:[N,Z],center:[(k.x-M)*y,(k.y-z)*y],scale:E/a.EXTENT*y},p[l]}calculateFogTileMatrix(r){const l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return a.multiply(g,this.worldToFogMatrix,g),p[l]=new Float32Array(g),p[l]}calculateProjMatrix(r,l=!1){const p=r.key,g=l?this._alignedProjMatrixCache:this._projMatrixCache;if(g[p])return g[p];const y=this.calculatePosMatrix(r,this.worldSize);return a.multiply(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,y),g[p]=new Float32Array(y),g[p]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const g=function(y,T){const{scale:E}=y.tileTransform,M=E*a.EXTENT/(y.tileSize*Math.pow(2,T.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return z=new Float32Array(4),N=(k=T.inverseAdjustmentMatrix)[1],Z=k[2],X=k[3],K=(R=[M,M])[1],z[0]=k[0]*(W=R[0]),z[1]=N*W,z[2]=Z*K,z[3]=X*K,z;var z,k,R,N,Z,X,W,K}(r,this);return p[l]=g,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,l=a.fromScaling([],[r,r,r]);return a.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const l=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),g=this._camera.forward(),y=a.mercatorZfromAltitude(1,this._center.lat);p[2]/=y,g[2]/=y,a.normalize(g,g);const T=r.raycast(p,g,r.exaggeration());if(T){const E=a.scaleAndAdd([],p,g,T),M=new a.MercatorCoordinate(E[0],E[1],a.mercatorZfromAltitude(E[2],a.latFromMercatorY(E[1]))),z=(M.z+a.length([M.x-p[0],M.y-p[1],M.z-p[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,p=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(p),y=l.getAtPointOrZero(new a.MercatorCoordinate(...g)),T=this.pixelsPerMeter/this.worldSize*y,E=this._minimumHeightOverTerrain(),M=g[2]-T;if(M<=E)if(M<0||r){const z=this.locationCoordinate(this._center,this._centerAltitude),k=[g[0],g[1],z.z-g[2]],R=a.length(k);k[2]-=(E-M)/this._pixelsPerMercatorPixel;const N=a.length(k);if(N===0)return;a.scale$2(k,k,R/N*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],z.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const N=this.center;return N.lat=a.clamp(N.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(N.lng=a.clamp(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:g}=this.point;let y=0,T=p,E=g;const M=this.width/2,z=this.height/2,k=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(g-z<k&&(E=k+z),g+z>R&&(E=R-z),R-k<this.height&&(y=Math.max(y,this.height/(R-k)),E=(R+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const N=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,X=this.worldSize/2-(N+Z)/2;T=(p+X+this.worldSize)%this.worldSize-X,T-M<N&&(T=N+M),T+M>Z&&(T=Z-M),Z-N<this.width&&(y=Math.max(y,this.width/(Z-N)),T=(Z+N)/2)}T===p&&E===g||(this.center=this.unproject(new a.Point(T,E))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const p=xc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?l:1,y=this._camera.getWorldToCamera(this.worldSize,g),T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);T[8]=2*-r.x/this.width,T[9]=2*r.y/this.height;let E=a.mul([],T,y);if(this.projection.isReprojectedInTileSpace){const pe=this.locationCoordinate(this.center),de=a.identity([]);a.translate(de,de,[pe.x*this.worldSize,pe.y*this.worldSize,0]),a.multiply(de,de,Xs(this)),a.translate(de,de,[-pe.x*this.worldSize,-pe.y*this.worldSize,0]),a.multiply(E,E,de),this.inverseAdjustmentMatrix=function(ve){const ye=Xs(ve,!0);return Be([],[ye[0],ye[1],ye[4],ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],E,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=E,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const M=a.invert([],T);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(M,this.horizonLineFromTop(),this.height);const z=new Float32Array(16);a.identity(z),a.scale(z,z,[1,-1,1]),a.rotateX(z,z,this._pitch),a.rotateZ(z,z,this.angle);const k=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-r.x/this.width,k[9]=2*(r.y+R)/this.height,this.skyboxMatrix=a.multiply(z,k,z);const N=this.point,Z=N.x,X=N.y,W=this.width%2/2,K=this.height%2/2,B=Math.cos(this.angle),$=Math.sin(this.angle),Q=Z-Math.round(Z)+B*W+$*K,ee=X-Math.round(X)+B*K+$*W,he=new Float64Array(E);if(a.translate(he,he,[Q>.5?Q-1:Q,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=he,E=a.create(),a.scale(E,E,[this.width/2,-this.height/2,1]),a.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=a.create(),a.scale(E,E,[1,-1,1]),a.translate(E,E,[-1,-1,0]),a.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=a.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=E,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(pe,pe,y),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=E;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,y=[r,r,l];a.scale$2(y,y,g),a.scale$2(p,p,-1),a.multiply$2(p,p,y);const T=a.create();a.translate(T,T,p),a.scale(T,T,y),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,g)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),g=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-p[0]*y,g.y/this.worldSize-p[1]*y,r/this.worldSize*this._centerAltitude-p[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],g=r[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(y=Math.min((l-p)/g,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,r,y),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:g}=this._camera.getPitchBearing(),y=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),E=Math.max((r[2]-y)/Math.cos(p),T),M=this._zoomFromMercatorZ(E);a.scaleAndAdd(r,r,l,E),this._pitch=a.clamp(p,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(g,-Math.PI,Math.PI),this._setZoom(a.clamp(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let l=0,p=a.GLOBE_ZOOM_THRESHOLD_MAX,g=0,y=1/0;for(;p-l>1e-6&&p>l;){const T=l+.5*(p-l),E=this.tileSize*Math.pow(2,T),M=this.getCameraToCenterDistance(this.projection,T,E),z=this.scaleZoom(M/(r*this.tileSize)),k=Math.abs(T-z);k<y&&(y=k,g=T),T<z?l=T:p=T}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const p=Math.min(r.x,l.x),g=Math.max(r.x,l.x),y=Math.min(r.y,l.y),T=Math.max(r.y,l.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new a.Point(p,y),new a.Point(g,T),new a.Point(p,T),new a.Point(g,y)],M=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const k of E){const R=this.pointRayIntersection(k);if(R.t<0)return!0;const N=this.rayIntersectionCoordinate(R);if(N.x<M||N.y<0||N.x>z||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.Point(0,0),new a.Point(this.width,this.height))}zoomDeltaToMovement(r,l){const p=a.length(a.sub([],this._camera.position,r)),g=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([l,p,g],y){const T=[l,p,g,1];a.transformMat4$1(T,T,y);const E=T[3]=Math.max(T[3],1e-6);return T[0]/=E,T[1]/=E,T[2]/=E,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.Point(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,r))}}getCameraToCenterDistance(r,l=this.zoom,p=this.worldSize){const g=xc(r,l,this.width,this.height,1024),y=r.pixelSpaceConversion(this.center.lat,p,g);return .5/Math.tan(.5*this._fov)*this.height*y}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.multiply(r,r,this.globeMatrix),r}}function Ks(h,r){let l=!1,p=null;const g=()=>{p=null,l&&(h(),p=setTimeout(g,r),l=!1)};return()=>(l=!0,p||g(),p)}class dh{constructor(r){this._hashName=r&&encodeURIComponent(r),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ks(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,a.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=cl(r);if(this._hashName){const p=this._hashName;let g=!1;const y=a.window.location.hash.slice(1).split("&").map(T=>{const E=T.split("=")[0];return E===p?(g=!0,`${E}=${l}`):T}).filter(T=>T);return g||y.push(`${p}=${l}`),`#${y.join("&")}`}return`#${l}`}_getCurrentHash(){const r=a.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,r)}}function cl(h,r){const l=h.getCenter(),p=Math.round(100*h.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),T=Math.round(l.lng*y)/y,E=Math.round(l.lat*y)/y,M=h.getBearing(),z=h.getPitch();let k=r?`/${T}/${E}/${p}`:`${p}/${E}/${T}`;return(M||z)&&(k+="/"+Math.round(10*M)/10),z&&(k+=`/${Math.round(z)}`),k}const ul={linearity:.3,easing:a.bezier(0,0,.3,1)},bc=a.extend({deceleration:2500,maxSpeed:1400},ul),Tc=a.extend({deceleration:20,maxSpeed:1400},ul),lt=a.extend({deceleration:1e3,maxSpeed:360},ul),wr=a.extend({deceleration:1e3,maxSpeed:90},ul);class Vp{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=a.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(l.pan.mag()){const y=dl(l.pan.mag(),p,a.extend({},bc,r||{}));g.offset=l.pan.mult(y.amount/l.pan.mag()),g.center=this._map.transform.center,hl(g,y)}if(l.zoom){const y=dl(l.zoom,p,Tc);g.zoom=this._map.transform.zoom+y.amount,hl(g,y)}if(l.bearing){const y=dl(l.bearing,p,lt);g.bearing=this._map.transform.bearing+a.clamp(y.amount,-179,179),hl(g,y)}if(l.pitch){const y=dl(l.pitch,p,wr);g.pitch=this._map.transform.pitch+y.amount,hl(g,y)}if(g.zoom||g.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function hl(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function dl(h,r,l){const{maxSpeed:p,linearity:g,deceleration:y}=l,T=a.clamp(h*g/(r/1e3),-p,p),E=Math.abs(T)/(y*g);return{easing:l.easing,duration:1e3*E,amount:T*(E/2)}}class si extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,g={}){const y=je(l.getCanvasContainer(),p),T=l.unproject(y);super(r,a.extend({point:y,lngLat:T,originalEvent:p},g)),this._defaultPrevented=!1,this.target=l}}class pl extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){const g=r==="touchend"?p.changedTouches:p.touches,y=ct(l.getCanvasContainer(),g),T=y.map(M=>l.unproject(M)),E=y.reduce((M,z,k,R)=>M.add(z.div(R.length)),new a.Point(0,0));super(r,{points:y,point:E,lngLats:T,lngLat:l.unproject(E),originalEvent:p}),this._defaultPrevented=!1}}class Ec extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class ph{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Ec(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new si(r.type,this._map,r))}mouseup(r){this._map.fire(new si(r.type,this._map,r))}preclick(r){const l=a.extend({},r);l.type="preclick",this._map.fire(new si(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new si(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new si(r.type,this._map,r))}mouseover(r){this._map.fire(new si(r.type,this._map,r))}mouseout(r){this._map.fire(new si(r.type,this._map,r))}touchstart(r){return this._firePreventable(new pl(r.type,this._map,r))}touchmove(r){this._map.fire(new pl(r.type,this._map,r))}touchend(r){this._map.fire(new pl(r.type,this._map,r))}touchcancel(r){this._map.fire(new pl(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sc{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new si(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new si("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new si(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Up{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(me(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const p=l,g=this._startPos,y=this._lastPos;if(!g||!y||y.equals(p)||!this._box&&p.dist(g)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=H("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const T=Math.min(g.x,p.x),E=Math.max(g.x,p.x),M=Math.min(g.y,p.y),z=Math.max(g.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${M}px)`,this._box.style.width=E-T+"px",this._box.style.height=z-M+"px")})}mouseupWindow(r,l){if(!this._active)return;const p=this._startPos,g=l;if(p&&r.button===0){if(this.reset(),ke(),p.x!==g.x||p.y!==g.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(p,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ne(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new a.Event(r,{originalEvent:l}))}}function Cc(h,r){const l={};for(let p=0;p<h.length;p++)l[h[p].identifier]=r[p];return l}class Ys{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){const y=new a.Point(0,0);for(const T of g)y._add(T);return y.div(g.length)}(l),this.touches=Cc(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;const g=Cc(p,l);for(const y in this.touches){const T=g[y];(!T||T.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class fh{constructor(r){this.singleTap=new Ys(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){const g=this.singleTap.touchend(r,l,p);if(g){const y=r.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(g)<30;if(y&&T||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Bg{constructor(){this._zoomIn=new fh({numTouches:1,numTaps:2}),this._zoomOut=new fh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){const g=this._zoomIn.touchend(r,l,p),y=this._zoomOut.touchend(r,l,p);return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(g)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Np={0:1,2:2};class Js{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const p=it(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){const p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(g,y){const T=Np[y];return g.buttons===void 0||(g.buttons&T)!==T}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(r){this._lastPoint&&it(r)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mh extends Js{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class gh extends Js{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class _h extends Js{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class Mc{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,p)}}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);const g=Cc(p,l),y=new a.Point(0,0),T=new a.Point(0,0);let E=0;for(const z in g){const k=g[z],R=this._touches[z];R&&(y._add(k),T._add(k.sub(R)),E++,g[z]=k)}if(this._touches=g,E<this._minTouches||!T.mag())return;const M=T.div(E);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class fl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){const g=this._firstTwoTouches;if(!g)return;r.preventDefault();const[y,T]=g,E=ml(p,l,y),M=ml(p,l,T);if(!E||!M)return;const z=this._aroundCenter?null:E.add(M).div(2);return this._move([E,M],z,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;const[g,y]=this._firstTwoTouches,T=ml(p,l,g),E=ml(p,l,y);T&&E||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ml(h,r,l){for(let p=0;p<h.length;p++)if(h[p].identifier===l)return r[p]}function yh(h,r){return Math.log(h/r)/Math.LN2}class jp extends fl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(yh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yh(this._distance,p),pinchAround:l}}}function vh(h,r){return 180*h.angleWith(r)/Math.PI}class Gp extends fl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:vh(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const g=vh(r,p);return Math.abs(g)<l}}function ko(h){return Math.abs(h.y)>Math.abs(h.x)}class $p extends fl{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,ko(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){const g=this._lastPoints;if(!g)return;const y=r[0].sub(g[0]),T=r[1].sub(g[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(y,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(y.y+T.y)/2*-.5})}gestureBeginsVertically(r,l,p){if(this._valid!==void 0)return this._valid;const g=r.mag()>=2,y=l.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=r.y>0==l.y>0;return ko(r)&&ko(l)&&T}}const Zp={panStep:100,bearingStep:15,pitchStep:10};class Fg{constructor(){const r=Zp;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,g=0,y=0,T=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),T=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,g=0),{cameraAnimation:E=>{const M=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:qp,zoom:l?Math.round(M)+l*(r.shiftKey?2:1):M,bearing:E.getBearing()+p*this._bearingStep,pitch:E.getPitch()+g*this._pitchStep,offset:[-y*this._panStep,-T*this._panStep],center:E.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function qp(h){return h*(2-h)}const xh=4.000244140625;class Wp{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=a.exported.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%xh==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=je(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>xh?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&z!==0&&(z=1/z);const k=l(),R=Math.pow(2,k),N=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(N*z))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),g=this._startZoom,y=this._easing;let T,E=!1;if(this._type==="wheel"&&g&&y){const M=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),z=y(M);T=a.number(g,p,z),M<1?this._frameId||(this._frameId=!0):E=!0}else T=p,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:T-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=a.ease;if(this._prevEase){const p=this._prevEase,g=(a.exported.now()-p.start)/p.duration,y=p.easing(g+.01)-p.easing(g),T=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-T*T);l=a.bezier(T,E,.25,1)}return this._prevEase={start:a.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Xp{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Og{constructor(){this._tap=new fh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const g=l[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hp{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vg{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ug{constructor(r,l,p,g){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sr=h=>h.zoom||h.drag||h.pitch||h.rotate;class Kp extends a.Event{}class Ng{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const p=a.sub([],l,r);this.radius=a.length(p[2]<0?a.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){a.div(r,r,this.constants),a.normalize(r,r),a.mul$1(r,r,this.constants);const l=a.scale$2([],r,this.radius);if(l[2]>0){const p=a.scale$2([],[0,0,1],a.dot(l,[0,0,1])),g=a.scale$2([],a.normalize([],[l[0],l[1],0]),this.radius),y=a.add([],l,a.scale$2([],a.sub([],a.add([],g,p),l),2));l[0]=y[0],l[1]=y[1]}return l}}function br(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Or{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vp(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ng,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),a.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[g,y,T]of this._listeners)g.addEventListener(y,g===a.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[r,l,p]of this._listeners)r.removeEventListener(l,r===a.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new ph(l,r));const g=l.boxZoom=new Up(l,r);this._add("boxZoom",g);const y=new Bg,T=new xi;l.doubleClickZoom=new Xp(T,y),this._add("tapZoom",y),this._add("clickZoom",T);const E=new Og;this._add("tapDragZoom",E);const M=l.touchPitch=new $p(l);this._add("touchPitch",M);const z=new gh(r),k=new _h(r);l.dragRotate=new Vg(r,z,k),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const R=new mh(r),N=new Mc(l,r);l.dragPan=new Hp(p,R,N),this._add("mousePan",R),this._add("touchPan",N,["touchZoom","touchRotate"]);const Z=new Gp,X=new jp;l.touchZoomRotate=new Ug(p,X,Z,E),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Sc(l));const W=l.scrollZoom=new Wp(l,this);this._add("scrollZoom",W,["mousePan"]);const K=l.keyboard=new Fg;this._add("keyboard",K);for(const B of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[B]&&l[B].enable(r[B])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sr(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,p){for(const g in r)if(g!==p&&(!l||l.indexOf(g)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;const p=r.type==="renderFrame",g=p?void 0:r,y={needsRenderFrame:!1},T={},E={},M=r.touches?this._getMapTouches(r.touches):void 0,z=M?ct(this._el,M):p?void 0:je(this._el,r);for(const{handlerName:N,handler:Z,allowed:X}of this._handlers){if(!Z.isEnabled())continue;let W;this._blockedByActive(E,X,N)?Z.reset():Z[l||r.type]&&(W=Z[l||r.type](r,z,M),this.mergeHandlerResult(y,T,W,N,g),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||Z.isActive())&&(E[N]=Z)}const k={};for(const N in this._previousActiveHandlers)E[N]||(k[N]=g);this._previousActiveHandlers=E,(Object.keys(k).length||br(y))&&(this._changes.push([y,T,k]),this._triggerRenderFrame()),(Object.keys(E).length||br(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=y;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(r,l,p,g,y){if(!p)return;a.extend(r,p);const T={handlerName:g,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(l.zoom=T),p.panDelta!==void 0&&(l.drag=T),p.pitchDelta!==void 0&&(l.pitch=T),p.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const r={},l={},p={};for(const[g,y,T]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new a.Point(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(r.around=g.around),g.aroundCoord!==void 0&&(r.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),a.extend(l,y),a.extend(p,T);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){const g=this._map,y=g.transform,T=$=>[$.x,$.y,$.z];if(($=>{const Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!br(r)){const $=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",$!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&g._stop(!0),!br(r))return void this._fireEvents(l,p,!0);let{panDelta:E,zoomDelta:M,bearingDelta:z,pitchDelta:k,around:R,aroundCoord:N,pinchAround:Z}=r;y._isCameraConstrained&&(M>0&&(M=0),y._isCameraConstrained=!1),Z!==void 0&&(R=Z),(M||($=>l[$]&&!this._eventsInProgress[$])("drag"))&&R&&(this._dragOrigin=T(y.pointCoordinate3D(R)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",g._stop(!0),R=R||g.transform.centerPoint,z&&(y.bearing+=z),k&&(y.pitch+=k),y._updateCameraState();const X=[0,0,0];if(E)if(y.projection.name==="mercator"){const $=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(R).dir),Q=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(R.sub(E)).dir);X[0]=Q[0]-$[0],X[1]=Q[1]-$[1]}else{const $=y.pointCoordinate(R);if(y.projection.name==="globe"){E=E.rotate(-y.angle);const Q=y._pixelsPerMercatorPixel/y.worldSize;X[0]=-E.x*a.mercatorScale(a.latFromMercatorY($.y))*Q,X[1]=-E.y*a.mercatorScale(y.center.lat)*Q}else{const Q=y.pointCoordinate(R.sub(E));$&&Q&&(X[0]=Q.x-$.x,X[1]=Q.y-$.y)}}const W=y.zoom,K=[0,0,0];if(M){const $=T(N||y.pointCoordinate3D(R)),Q={dir:a.normalize([],a.sub([],$,y._camera.position))};if(Q.dir[2]<0){const ee=y.zoomDeltaToMovement($,M);a.scale$2(K,Q.dir,ee)}}const B=a.add(X,X,K);y._translateCameraConstrained(B),M&&Math.abs(y.zoom-W)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){const g=sr(this._eventsInProgress),y=sr(r),T={};for(const k in r){const{originalEvent:R}=r[k];this._eventsInProgress[k]||(T[`${k}start`]=R),this._eventsInProgress[k]=r[k]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(const k in T)this._fireEvent(k,T[k]);y&&this._fireEvent("move",y.originalEvent);for(const k in r){const{originalEvent:R}=r[k];this._fireEvent(k,R)}const E={};let M;for(const k in this._eventsInProgress){const{handlerName:R,originalEvent:N}=this._eventsInProgress[k];this._handlersById[R].isActive()||(delete this._eventsInProgress[k],M=l[R]||N,E[`${k}end`]=M)}for(const k in E)this._fireEvent(k,E[k]);const z=sr(this._eventsInProgress);if(p&&(g||y)&&!z){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;k?(R(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:M})):(this._map.fire(new a.Event("moveend",{originalEvent:M})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new a.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Kp("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const os="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ac extends a.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=a.Point.convert(r).mult(-1),this.panTo(this.transform.center,a.extend({offset:r},l),p)}panTo(r,l,p){return this.easeTo(a.extend({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(a.extend({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(a.extend({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,a.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=a.LngLatBounds.convert(r);const p=l&&l.bearing||0,g=l&&l.pitch||0,y=r.getNorthWest(),T=r.getSouthEast();return this._cameraForBounds(this.transform,y,T,p,g,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if(typeof(r=a.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=a.extend(l,r.padding),r}_minimumAABBFrustumDistance(r,l){const p=l.max[0]-l.min[0],g=l.max[1]-l.min[1];return p/g>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):g/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,p,g,y,T){const E=r.clone(),M=this._extendCameraOptions(T);E.bearing=g,E.pitch=y;const z=a.LngLat.convert(l),k=a.LngLat.convert(p),R=.5*(z.lat+k.lat),N=.5*(z.lng+k.lng),Z=a.latLngToECEF(R,N),X=a.normalize([],Z),W=a.normalize([],a.cross([],X,[0,1,0])),K=a.cross([],W,X),B=[W[0],W[1],W[2],0,K[0],K[1],K[2],0,X[0],X[1],X[2],0,0,0,0,1],$=[Z,a.latLngToECEF(z.lat,z.lng),a.latLngToECEF(k.lat,z.lng),a.latLngToECEF(k.lat,k.lng),a.latLngToECEF(z.lat,k.lng),a.latLngToECEF(R,z.lng),a.latLngToECEF(R,k.lng),a.latLngToECEF(z.lat,N),a.latLngToECEF(k.lat,N)];let Q=a.Aabb.fromPoints($.map(Ue=>[a.dot(W,Ue),a.dot(K,Ue),a.dot(X,Ue)]));const ee=a.transformMat4([],Q.center,B);a.squaredLength(ee)===0&&a.set(ee,0,0,1),a.normalize(ee,ee),a.scale$2(ee,ee,a.GLOBE_RADIUS),E.center=a.ecefToLatLng(ee);const he=E.getWorldToCameraMatrix(),pe=a.invert(new Float64Array(16),he);Q=a.Aabb.applyTransform(Q,a.multiply([],he,B)),a.transformMat4(ee,ee,he);const de=.5*(Q.max[2]-Q.min[2]),ve=this._minimumAABBFrustumDistance(E,Q),ye=a.scale$2([],[0,0,1],de),Se=a.add(ye,ee,ye),$e=ve+(E.pitch===0?0:a.distance(ee,Se)),be=E.globeCenterInViewSpace,Fe=a.sub([],ee,[be[0],be[1],be[2]]);a.normalize(Fe,Fe),a.scale$2(Fe,Fe,$e);const Me=a.add([],ee,Fe);a.transformMat4(Me,Me,pe);const Ge=a.earthRadius/a.GLOBE_RADIUS,Ee=a.length(Me),Re=a.mercatorZfromAltitude(Math.max(Ee*Ge-a.earthRadius,Number.EPSILON),0),qe=Math.min(E.zoomFromMercatorZAdjusted(Re),M.maxZoom);return qe>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(E.setProjection({name:"mercator"}),E.zoom=qe,this._cameraForBounds(E,l,p,g,y,T)):{center:E.center,zoom:qe,bearing:g,pitch:y}}queryTerrainElevation(r,l){const p=this.transform.elevation;return p?(l=a.extend({},{exaggerated:!0},l),p.getAtPoint(a.MercatorCoordinate.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,p,g,y,T){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,l,p,g,y,T);const E=r.clone(),M=this._extendCameraOptions(T),z=E.padding;E.bearing=g,E.pitch=y;const k=a.LngLat.convert(l),R=a.LngLat.convert(p),N=new a.LngLat(k.lng,R.lat),Z=new a.LngLat(R.lng,k.lat),X=E.project(k),W=E.project(R),K=this.queryTerrainElevation(k),B=this.queryTerrainElevation(R),$=this.queryTerrainElevation(N),Q=this.queryTerrainElevation(Z),ee=[[X.x,X.y,Math.min(K||0,B||0,$||0,Q||0)],[W.x,W.y,Math.max(K||0,B||0,$||0,Q||0)]];let he=a.Aabb.fromPoints(ee);const pe=E.getWorldToCameraMatrix(),de=a.invert(new Float64Array(16),pe);he=a.Aabb.applyTransform(he,pe);const ve=a.sub([],he.max,he.min),ye=z.left||0,Se=z.right||0,$e=z.bottom||0,be=z.top||0,{left:Fe,right:Me,top:Ge,bottom:Ee}=M.padding,Re=.5*(ye+Se),qe=.5*(be+$e),Ue=Math.min(E.scaleZoom(E.scale*Math.min((E.width-(ye+Se+Fe+Me))/ve[0],(E.height-($e+be+Ee+Ge))/ve[1])),M.maxZoom),Xe=E.scale/E.zoomScale(Ue);he=new a.Aabb([he.min[0]-(Fe+Re)*Xe,he.min[1]-(Ee+qe)*Xe,he.min[2]],[he.max[0]+(Me+Re)*Xe,he.max[1]+(Ge+qe)*Xe,he.max[2]]);const ft=.5*ve[2],Tt=this._minimumAABBFrustumDistance(E,he),ht=[0,0,1,0];a.transformMat4$1(ht,ht,pe),a.normalize$2(ht,ht);const xt=a.scale$2([],ht,Tt+ft),Nt=a.add([],he.center,xt),Ot=(typeof M.offset.x=="number"&&typeof M.offset.y=="number"?new a.Point(M.offset.x,M.offset.y):a.Point.convert(M.offset)).rotate(-a.degToRad(g));he.center[0]-=Ot.x*Xe,he.center[1]+=Ot.y*Xe,a.transformMat4(he.center,he.center,de),a.transformMat4(Nt,Nt,de);const pt=[he.center[0],he.center[1],Nt[2]*E.pixelsPerMeter];a.scale$2(pt,pt,1/E.worldSize);const en=a.lngFromMercatorX(pt[0]),nn=a.latFromMercatorY(pt[1]),rn=Math.min(E._zoomFromMercatorZ(pt[2]),M.maxZoom),on=new a.LngLat(en,nn);return E.mercatorFromTransition&&rn<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(E.setProjection({name:"globe"}),E.zoom=rn,this._cameraForBounds(E,l,p,g,y,T)):{center:on,zoom:rn,bearing:g,pitch:y}}fitBounds(r,l,p){const g=this.cameraForBounds(r,l);return this._fitInternal(g,l,p)}fitScreenCoordinates(r,l,p,g,y){const T=a.Point.convert(r),E=a.Point.convert(l),M=new a.Point(Math.min(T.x,E.x),Math.min(T.y,E.y)),z=new a.Point(Math.max(T.x,E.x),Math.max(T.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,E))return this;const k=this.transform.pointLocation3D(M),R=this.transform.pointLocation3D(z),N=this.transform.pointLocation3D(new a.Point(M.x,z.y)),Z=this.transform.pointLocation3D(new a.Point(z.x,M.y)),X=[Math.min(k.lng,R.lng,N.lng,Z.lng),Math.min(k.lat,R.lat,N.lat,Z.lat)],W=[Math.max(k.lng,R.lng,N.lng,Z.lng),Math.max(k.lat,R.lat,N.lat,Z.lat)],K=g&&g.pitch?g.pitch:this.getPitch(),B=this._cameraForBounds(this.transform,X,W,p,K,g);return this._fitInternal(B,g,y)}_fitInternal(r,l,p){return r?(delete(l=a.extend(r,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(r,l){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let g=!1,y=!1,T=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(g=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=a.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(y=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(T=!0,p.pitch=+r.pitch),r.padding==null||p.isPaddingEqual(r.padding)||(p.padding=r.padding),r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),g&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),y&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),T&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(os),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return a.warnOnce(os),this;this.stop();const g=p.zoom,y=p.pitch,T=p.bearing;p.setFreeCameraOptions(r);const E=g!==p.zoom,M=y!==p.pitch,z=T!==p.bearing;return this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),E&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),z&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),M&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=a.extend({offset:[0,0],duration:500,easing:a.ease},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const p=this.transform,g=this.getZoom(),y=this.getBearing(),T=this.getPitch(),E=this.getPadding(),M="zoom"in r?+r.zoom:g,z="bearing"in r?this._normalizeBearing(r.bearing,y):y,k="pitch"in r?+r.pitch:T,R="padding"in r?r.padding:p.padding,N=a.Point.convert(r.offset);let Z,X,W;if(p.projection.name==="globe"){const ye=a.MercatorCoordinate.fromLngLat(p.center),Se=N.rotate(-p.angle);ye.x+=Se.x/p.worldSize,ye.y+=Se.y/p.worldSize;const $e=ye.toLngLat(),be=a.LngLat.convert(r.center||$e);this._normalizeCenter(be),Z=p.centerPoint.add(Se),X=new a.Point(ye.x,ye.y).mult(p.worldSize),W=new a.Point(a.mercatorXfromLng(be.lng),a.mercatorYfromLat(be.lat)).mult(p.worldSize).sub(X)}else{Z=p.centerPoint.add(N);const ye=p.pointLocation(Z),Se=a.LngLat.convert(r.center||ye);this._normalizeCenter(Se),X=p.project(ye),W=p.project(Se).sub(X)}const K=p.zoomScale(M-g);let B,$;r.around&&(B=a.LngLat.convert(r.around),$=p.locationPoint(B));const Q=this._zooming||M!==g,ee=this._rotating||y!==z,he=this._pitching||k!==T,pe=!p.isPaddingEqual(R),de=ye=>Se=>{if(Q&&(ye.zoom=a.number(g,M,Se)),ee&&(ye.bearing=a.number(y,z,Se)),he&&(ye.pitch=a.number(T,k,Se)),pe&&(ye.interpolatePadding(E,R,Se),Z=ye.centerPoint.add(N)),B)ye.setLocationAtPoint(B,$);else{const $e=ye.zoomScale(ye.zoom-g),be=M>g?Math.min(2,K):Math.max(.5,K),Fe=Math.pow(be,1-Se),Me=ye.unproject(X.add(W.mult(Se*Fe)).mult($e));ye.setLocationAtPoint(ye.renderWorldCopies?Me.wrap():Me,Z)}return r.preloadOnly||this._fireMoveEvents(l),ye};if(r.preloadOnly){const ye=this._emulate(de,r.duration,p);return this._preloadTiles(ye),this}const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=ee,this._pitching=he,this._padding=pe,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,ve),this._ease(de(p),ye=>{p.recenterOnTerrain(),this._afterEase(l,ye)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new a.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new a.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new a.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new a.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new a.Event("move",r)),this._zooming&&this.fire(new a.Event("zoom",r)),this._rotating&&this.fire(new a.Event("rotate",r)),this._pitching&&this.fire(new a.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.Event("zoomend",r)),g&&this.fire(new a.Event("rotateend",r)),y&&this.fire(new a.Event("pitchend",r)),this.fire(new a.Event("moveend",r))}flyTo(r,l){if(this._prefersReducedMotion(r)){const Ue=a.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ue,l)}this.stop(),r=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},r);const p=this.transform,g=this.getZoom(),y=this.getBearing(),T=this.getPitch(),E=this.getPadding(),M="zoom"in r?a.clamp(+r.zoom,p.minZoom,p.maxZoom):g,z="bearing"in r?this._normalizeBearing(r.bearing,y):y,k="pitch"in r?+r.pitch:T,R="padding"in r?r.padding:p.padding,N=p.zoomScale(M-g),Z=a.Point.convert(r.offset);let X=p.centerPoint.add(Z);const W=p.pointLocation(X),K=a.LngLat.convert(r.center||W);this._normalizeCenter(K);const B=p.project(W),$=p.project(K).sub(B);let Q=r.curve;const ee=Math.max(p.width,p.height),he=ee/N,pe=$.mag();if("minZoom"in r){const Ue=a.clamp(Math.min(r.minZoom,g,M),p.minZoom,p.maxZoom),Xe=ee/p.zoomScale(Ue-g);Q=Math.sqrt(Xe/pe*2)}const de=Q*Q;function ve(Ue){const Xe=(he*he-ee*ee+(Ue?-1:1)*de*de*pe*pe)/(2*(Ue?he:ee)*de*pe);return Math.log(Math.sqrt(Xe*Xe+1)-Xe)}function ye(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function Se(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const $e=ve(0);let be=function(Ue){return Se($e)/Se($e+Q*Ue)},Fe=function(Ue){return ee*((Se($e)*(ye(Xe=$e+Q*Ue)/Se(Xe))-ye($e))/de)/pe;var Xe},Me=(ve(1)-$e)/Q;if(Math.abs(pe)<1e-6||!isFinite(Me)){if(Math.abs(ee-he)<1e-6)return this.easeTo(r,l);const Ue=he<ee?-1:1;Me=Math.abs(Math.log(he/ee))/Q,Fe=function(){return 0},be=function(Xe){return Math.exp(Ue*Q*Xe)}}r.duration="duration"in r?+r.duration:1e3*Me/("screenSpeed"in r?+r.screenSpeed/Q:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Ge=y!==z,Ee=k!==T,Re=!p.isPaddingEqual(R),qe=Ue=>Xe=>{const ft=Xe*Me,Tt=1/be(ft);Ue.zoom=Xe===1?M:g+Ue.scaleZoom(Tt),Ge&&(Ue.bearing=a.number(y,z,Xe)),Ee&&(Ue.pitch=a.number(T,k,Xe)),Re&&(Ue.interpolatePadding(E,R,Xe),X=Ue.centerPoint.add(Z));const ht=Xe===1?K:Ue.unproject(B.add($.mult(Fe(ft))).mult(Tt));return Ue.setLocationAtPoint(Ue.renderWorldCopies?ht.wrap():ht,X),Ue._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),Ue};if(r.preloadOnly){const Ue=this._emulate(qe,r.duration,p);return this._preloadTiles(Ue),this}return this._zooming=!0,this._rotating=Ge,this._pitching=Ee,this._padding=Re,this._prepareEase(l,!1),this._ease(qe(p),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){p.animate===!1||p.duration===0?(r(1),l()):(this._easeStart=a.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=a.wrap(r,-180,180);const p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&a.exported.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,l,p){const g=Math.ceil(15*l/1e3),y=[],T=r(p.clone());for(let E=0;E<=g;E++){const M=T(E/g);y.push(M.clone())}return y}}class ut{constructor(r={}){this.options=r,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H("button","mapboxgl-ctrl-attrib-button",this._container),H("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const p=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",p),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(r){const p=l.reduce((g,y,T)=>(y.value&&(g+=`${y.key}=${y.value}${T<l.length-1?"&":""}`),g),"?");r.href=`${a.config.FEEDBACK_URL}/${p}#${cl(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const l=this._map.style._sourceCaches;for(const g in l){const y=l[g];if(y.used){const T=y.getSource();T.attribution&&r.indexOf(T.attribution)<0&&r.push(T.attribution)}}r.sort((g,y)=>g.length-y.length),r=r.filter((g,y)=>{for(let T=y+1;T<r.length;T++)if(r[T].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class wh{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=H("div","mapboxgl-ctrl");const l=H("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const l in r){const p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class bh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const g of p)if(g.id===r)return void(g.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Qs(h,r,l){if(h=new a.LngLat(h.lng,h.lat),r){const p=new a.LngLat(h.lng-360,h.lat),g=new a.LngLat(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),T=l.locationPoint(h).distSqr(r),E=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(p).distSqr(r)<T&&(E||Math.abs(p.lng-l.center.lng)<y)?h=p:l.locationPoint(g).distSqr(r)<T&&(E||Math.abs(g.lng-l.center.lng)<y)&&(h=g)}for(;Math.abs(h.lng-l.center.lng)>180;){const p=l.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const ss={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ot extends a.Evented{constructor(r,l){if(super(),(r instanceof a.window.HTMLElement||l)&&(r=a.extend({element:r},l)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=a.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=H("div");const g=41,y=27,T=ue("svg",{display:"block",height:g*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${g}`},this._element),E=ue("radialGradient",{id:"shadowGradient"},ue("defs",{},T));ue("stop",{offset:"10%","stop-opacity":.4},E),ue("stop",{offset:"100%","stop-opacity":.05},E),ue("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),ue("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),ue("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),ue("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=a.Point.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const p=this._element.classList;for(const g in ss)p.remove(`mapboxgl-marker-anchor-${g}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,p=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const p=r.unproject(l),g=r.getFreeCameraOptions();if(!g.position)return!1;const y=g.position.toLngLat();return y.distanceTo(p)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(l);let g;r._showingGlobe()&&a.isLngLatBehindGlobe(r.transform,this._lngLat)?g=0:(g=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${ss[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const r=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!r||p!=="map")return"";if(!l._showingGlobe()){const M=l.getPitch();return M?`rotateX(${M}deg)`:""}const g=a.radToDeg(a.globeTiltAtLngLat(l.transform,this._lngLat)),y=r.sub(a.globeCenterToScreenPoint(l.transform)),T=Math.abs(y.x)+Math.abs(y.y);if(T===0)return"";const E=g/T;return`rotateX(${-y.y*E}deg) rotateY(${y.x*E}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let p=0;const g=this.getRotationAlignment();if(g==="map")if(l._showingGlobe()){const y=l.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),T=l.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);p=a.radToDeg(Math.atan2(T.y,T.x))-90}else p=-l.getBearing();else if(g==="horizon"){const y=a.smoothstep(4,6,l.getZoom()),T=a.globeCenterToScreenPoint(l.transform);T.y+=y*l.transform.height;const E=r.sub(T),M=a.radToDeg(Math.atan2(E.y,E.x));p=(M>90?M-270:M+90)*(1-y)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){a.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Qs(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),r===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=a.Point.convert(r),this._update(),this}_onMove(r){const l=this._map;if(!l)return;const p=this._pointerdownPos,g=this._positionDelta;if(p&&g){if(!this._isDragging){const y=this._clickTolerance||l._clickTolerance;if(r.point.dist(p)<y)return;this._isDragging=!0}this._pos=r.point.sub(g),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,p=this._pos;l&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Th={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jg=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yp(h=new a.Point(0,0),r="bottom"){if(typeof h=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new a.Point(0,h);case"top-left":return new a.Point(l,l);case"top-right":return new a.Point(-l,l);case"bottom":return new a.Point(0,-h);case"bottom-left":return new a.Point(l,-l);case"bottom-right":return new a.Point(-l,-l);case"left":return new a.Point(h,0);case"right":return new a.Point(-h,0)}return new a.Point(0,0)}return h instanceof a.Point||Array.isArray(h)?a.Point.convert(h):a.Point.convert(h[r]||[0,0])}class Eh{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=a.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}const Jp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Qp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Gg={showCompass:!0,showZoom:!0,visualizePitch:!1};class $g{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new gh({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new _h({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),me()}move(r,l){const p=this.map,g=this.mouseRotate.mousemoveWindow(r,l),y=g&&g.bearingDelta;if(y&&p.setBearing(p.getBearing()+y),this.mousePitch){const T=this.mousePitch.mousemoveWindow(r,l),E=T&&T.pitchDelta;E&&p.setPitch(p.getPitch()+E)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ne(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(a.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),je(this.element,r)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,je(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ct(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=ct(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Sh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ch={maxWidth:100,unit:"metric"},Mh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ea={version:a.version,supported:O,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Ac{constructor(h){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),(h=a.extend({},Qp,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(h.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Hs(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._useWebGL2=h.useWebGL2,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new bh,this._domRenderTaskQueue=new bh,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Jp,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Eh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=a.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Or(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new dh(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,a.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new ut({customAttribution:h.customAttribution})),this._logoControl=new wh,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(h,r){if(r===void 0&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),this.fire(new a.Event("resize",h)),r&&this.fire(new a.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(a.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?a.window.navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(r=>r==="auto"?a.window.navigator.language:r):h}setLanguage(h){const r=this._parseLanguage(h);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,r=h.projection.name;let l;r==="globe"&&h.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),l=!0):r==="mercator"&&h.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;if(r=h.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(a.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(a.Point.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,r,l){if(h==="mouseenter"||h==="mouseover"){let p=!1;const g=T=>{const E=r.filter(z=>this.getLayer(z)),M=E.length?this.queryRenderedFeatures(T.point,{layers:E}):[];M.length?p||(p=!0,l.call(this,new si(h,this,T.originalEvent,{features:M}))):p=!1},y=()=>{p=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:g,mouseout:y}}}if(h==="mouseleave"||h==="mouseout"){let p=!1;const g=T=>{const E=r.filter(M=>this.getLayer(M));(E.length?this.queryRenderedFeatures(T.point,{layers:E}):[]).length?p=!0:p&&(p=!1,l.call(this,new si(h,this,T.originalEvent)))},y=T=>{p&&(p=!1,l.call(this,new si(h,this,T.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:g,mouseout:y}}}{const p=g=>{const y=r.filter(E=>this.getLayer(E)),T=y.length?this.queryRenderedFeatures(g.point,{layers:y}):[];T.length&&(g.features=T,l.call(this,g),delete g.features)};return{layers:new Set(r),listener:l,delegates:{[h]:p}}}}on(h,r,l){if(l===void 0)return super.on(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const g in p.delegates)this.on(g,p.delegates[g]);return this}once(h,r,l){if(l===void 0)return super.once(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);for(const g in p.delegates)this.once(g,p.delegates[g]);return this}off(h,r,l){if(l===void 0)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);const p=(y,T)=>{if(y.size!==T.size)return!1;for(const E of y)if(!T.has(E))return!1;return!0},g=this._delegatedListeners?this._delegatedListeners[h]:void 0;return g&&(y=>{for(let T=0;T<y.length;T++){const E=y[T];if(E.listener===l&&p(E.layers,r)){for(const M in E.delegates)this.off(M,E.delegates[M]);return y.splice(T,1),this}}})(g),this}queryRenderedFeatures(h,r){return this.style?(r!==void 0||h===void 0||h instanceof a.Point||Array.isArray(h)||(r=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(h,r){return this.style.querySourceFeatures(h,r)}isPointOnSurface(h){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&a.warnOnce(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.Point.convert(h))}setStyle(h,r){return(r=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){const r=this._locale[h];if(r==null)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new Br(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Br(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if(typeof h=="string"){const l=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(l,a.ResourceType.Style);a.getJSON(p,(g,y)=>{g?this.fire(new a.ErrorEvent(g)):y&&this._updateDiff(y,r)})}else typeof h=="object"&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(l){a.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(h,r){return this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const r in h){const l=h[r]._tiles;for(const p in l){const g=l[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(h,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,r,{pixelRatio:l=1,sdf:p=!1,stretchX:g,stretchY:y,content:T}={}){if(this._lazyInitEmptyStyle(),r instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&r instanceof a.window.ImageBitmap){const{width:E,height:M,data:z}=a.exported.getImageData(r);this.style.addImage(h,{data:new a.RGBAImage({width:E,height:M},z),pixelRatio:l,stretchX:g,stretchY:y,content:T,sdf:p,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:M}=r,z=r;this.style.addImage(h,{data:new a.RGBAImage({width:E,height:M},new Uint8Array(z.data)),pixelRatio:l,stretchX:g,stretchY:y,content:T,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,h)}}updateImage(h,r){const l=this.style.getImage(h);if(!l)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&r instanceof a.window.ImageBitmap?a.exported.getImageData(r):r,{width:g,height:y}=p;g!==void 0&&y!==void 0?g===l.data.width&&y===l.data.height?(l.data.replace(p.data,!(r instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&r instanceof a.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${g}, ${y})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){a.getImage(this._requestManager.transformRequest(h,a.ResourceType.Image),(l,p)=>{r(l,p instanceof a.window.HTMLImageElement?a.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,r){return this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)}moveLayer(h,r){return this.style.moveLayer(h,r),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,r,l){return this.style.setLayerZoomRange(h,r,l),this._update(!0)}setFilter(h,r,l={}){return this.style.setFilter(h,r,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,r,l,p={}){return this.style.setPaintProperty(h,r,l,p),this._update(!0)}getPaintProperty(h,r){return this.style.getPaintProperty(h,r)}setLayoutProperty(h,r,l,p={}){return this.style.setLayoutProperty(h,r,l,p),this._update(!0)}getLayoutProperty(h,r){return this.style.getLayoutProperty(h,r)}setLight(h,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(h),this.transform):0}setFeatureState(h,r){return this.style.setFeatureState(h,r),this._update()}removeFeatureState(h,r){return this.style.removeFeatureState(h,r),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,p,g,y=this._container;for(;y&&(!p||!g);){const T=a.window.getComputedStyle(y).transform;T&&T!=="none"&&(l=T.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(g=l[3])),y=y.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=g?Math.abs(r/g):r}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=H("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=H("div","mapboxgl-canvas-container",h);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=H("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=H("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{p[g]=H("div",`mapboxgl-ctrl-${g}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){const l=a.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const r=this._markers.indexOf(h);r!==-1&&this._markers.splice(r,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const r=this._popups.indexOf(h);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const h=a.extend({},O.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",h),l=r||this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);l?(this._useWebGL2&&!r&&a.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),a.storeAuthState(l,!0),this.painter=new Ws(l,this.transform,!!r),this.on("data",p=>{p.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(l)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;const l=this.painter.context.extTimerQuery,p=a.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,M=this.transform.pitch,z=a.exported.now(),k=new a.EvaluationParameters(E,{now:z,fadeDuration:g,pitch:M,transition:this.style.getTransition()});this.style.update(k)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let y=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),y=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):y=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const E=a.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const M=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new a.Event("gpu-timing-frame",{cpuTime:E,gpuTime:M})),a.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:M}})},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(E);this.fire(new a.Event("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(E);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:M}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(T||this._repaint)this.triggerRepaint();else{const E=!this.isMoving()&&this.loaded();if(E&&(y=this._updateAverageElevation(p,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const r of this._markers)h&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!h||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(h,r=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let g=this.transform.sampleAverageElevation(),y=!1;this.transform.elevation&&(y=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=h;const T=Math.abs(p-g);if(T>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(g),l(g);this._averageElevation.easeTo(g,h,300)}else if(T>1e-4)return this._averageElevation.jumpTo(g),l(g)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===a.AUTH_ERR_MSG||h.status===401)){const r=this.painter.context.gl;a.storeAuthState(r,!1),this._logoControl instanceof wh&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function g(y){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,y,0);const T=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,T),T}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(g(h),r.canvasCopies.map(g),r.timeStamps)}_canvasPixelComparison(h,r,l){let p=l[1]-l[0];const g=h.length/4;for(let y=0;y<r.length;y++){const T=r[y];let E=0;for(let M=0;M<T.length;M+=4)T[M]===h[M]&&T[M+1]===h[M+1]&&T[M+2]===h[M+2]&&T[M+3]===h[M+3]&&(E+=1);p+=(l[y+2]-l[y+1])*(1-E/g)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=a.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(h){const r=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(r,(l,p)=>l._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){a.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,r){a.setCacheLimits(h,r)}get version(){return a.version}},NavigationControl:class{constructor(h){this.options=a.extend({},Gg,h),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),H("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),H("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=H("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const r=h.getZoom(),l=r===h.getMaxZoom(),p=r===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $g(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){const l=H("button",h,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(h,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends a.Evented{constructor(h){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},Sh,h),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ks(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(l=>r(l.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(h){const r=this._map.getMaxBounds(),l=h.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",h)),this._finish()}}_updateCamera(h){const r=new a.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,p=this._map.getBearing(),g=a.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),g,{geolocateSource:!0})}_updateMarker(h){if(h){const r=new a.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,r=a.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=H("button","mapboxgl-ctrl-geolocate",this._container),H("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H("div","mapboxgl-user-location"),this._dotElement.appendChild(H("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(H("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ot({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=H("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ot({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ut,ScaleControl:class{constructor(h){this.options=a.extend({},Ch,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,p=r._containerWidth/2-h/2,g=r.unproject([p,l]),y=r.unproject([p+h,l]),T=g.distanceTo(y);if(this.options.unit==="imperial"){const E=3.2808*T;E>5280?this._setScale(h,E/5280,"mile"):this._setScale(h,E,"foot")}else this.options.unit==="nautical"?this._setScale(h,T/1852,"nautical-mile"):T>=1e3?this._setScale(h,T/1e3,"kilometer"):this._setScale(h,T,"meter")}_setScale(h,r,l){this._map._requestDomTask(()=>{const p=function(y){const T=Math.pow(10,`${Math.floor(y)}`.length-1);let E=y/T;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z}(E),T*E}(r),g=p/r;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${Mh[l]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof a.window.HTMLElement?this._container=h.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=H("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(h){super(),this.options=a.extend(Object.create(Th),h),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=a.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(a.window.document.createTextNode(h))}setHTML(h){const r=a.window.document.createDocumentFragment(),l=a.window.document.createElement("body");let p;for(l.innerHTML=h;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=H("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){const l=this._closeButton=H("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,p=this._pos;if(!r||!l||!p)return"bottom";const g=l.offsetWidth,y=l.offsetHeight,T=p.x<g/2,E=p.x>r.transform.width-g/2;if(p.y+h<y)return T?"top-left":E?"top-right":"top";if(p.y>r.transform.height-y){if(T)return"bottom-left";if(E)return"bottom-right"}return T?"left":E?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=H("div","mapboxgl-popup",r.getContainer()),this._tip=H("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qs(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){const g=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),y=Yp(this.options.offset),T=this._anchor=this._getAnchor(y.y),E=Yp(this.options.offset,T),M=g.add(E).round();r._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${ss[T]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&r._showingGlobe()){const g=a.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(jg);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:ot,Style:Br,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Bp,Evented:a.Evented,config:a.config,prewarm:function(){Bs().acquire(Dr)},clearPrewarmedResources:function(){const h=Ai;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Dr),Ai=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(h){a.config.ACCESS_TOKEN=h},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(h){a.config.API_URL=h},get workerCount(){return ri.workerCount},set workerCount(h){ri.workerCount=h},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){a.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){a.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return ea});var C=v;return C})})(uS);var zk=uS.exports;const $m=KT(zk);const dS=Rt.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),mg=Rt.createContext({}),Uv=Rt.createContext(null),gg=typeof document<"u",Dk=gg?Rt.useLayoutEffect:Rt.useEffect,pS=Rt.createContext({strict:!1});function Lk(t,o,u,m){const{visualElement:v}=Rt.useContext(mg),b=Rt.useContext(pS),C=Rt.useContext(Uv),a=Rt.useContext(dS).reducedMotion,I=Rt.useRef();m=m||b.renderer,!I.current&&m&&(I.current=m(t,{visualState:o,parent:v,props:u,presenceContext:C,blockInitialAnimation:C?C.initial===!1:!1,reducedMotionConfig:a}));const O=I.current;Rt.useInsertionEffect(()=>{O&&O.update(u,C)});const q=Rt.useRef(!!window.HandoffAppearAnimations);return Dk(()=>{O&&(O.render(),q.current&&O.animationState&&O.animationState.animateChanges())}),Rt.useEffect(()=>{O&&(O.updateFeatures(),!q.current&&O.animationState&&O.animationState.animateChanges(),window.HandoffAppearAnimations=void 0,q.current=!1)}),O}function hu(t){return typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function Rk(t,o,u){return Rt.useCallback(m=>{m&&t.mount&&t.mount(m),o&&(m?o.mount(m):o.unmount()),u&&(typeof u=="function"?u(m):hu(u)&&(u.current=m))},[o])}function tp(t){return typeof t=="string"||Array.isArray(t)}function _g(t){return typeof t=="object"&&typeof t.start=="function"}const Nv=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],jv=["initial",...Nv];function yg(t){return _g(t.animate)||jv.some(o=>tp(t[o]))}function fS(t){return!!(yg(t)||t.variants)}function Bk(t,o){if(yg(t)){const{initial:u,animate:m}=t;return{initial:u===!1||tp(u)?u:void 0,animate:tp(m)?m:void 0}}return t.inherit!==!1?o:{}}function Fk(t){const{initial:o,animate:u}=Bk(t,Rt.useContext(mg));return Rt.useMemo(()=>({initial:o,animate:u}),[Zb(o),Zb(u)])}function Zb(t){return Array.isArray(t)?t.join(" "):t}const qb={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},np={};for(const t in qb)np[t]={isEnabled:o=>qb[t].some(u=>!!o[u])};function Ok(t){for(const o in t)np[o]={...np[o],...t[o]}}const mS=Rt.createContext({}),gS=Rt.createContext({}),Vk=Symbol.for("motionComponentSymbol");function Uk({preloadedFeatures:t,createVisualElement:o,useRender:u,useVisualState:m,Component:v}){t&&Ok(t);function b(a,I){let O;const q={...Rt.useContext(dS),...a,layoutId:Nk(a)},{isStatic:G}=q,H=Fk(a),ue=m(a,G);if(!G&&gg){H.visualElement=Lk(v,ue,q,o);const _e=Rt.useContext(gS),Ie=Rt.useContext(pS).strict;H.visualElement&&(O=H.visualElement.loadFeatures(q,Ie,t,_e))}return Rt.createElement(mg.Provider,{value:H},O&&H.visualElement?Rt.createElement(O,{visualElement:H.visualElement,...q}):null,u(v,a,Rk(ue,H.visualElement,I),ue,G,H.visualElement))}const C=Rt.forwardRef(b);return C[Vk]=v,C}function Nk({layoutId:t}){const o=Rt.useContext(mS).id;return o&&t!==void 0?o+"-"+t:t}function jk(t){function o(m,v={}){return Uk(t(m,v))}if(typeof Proxy>"u")return o;const u=new Map;return new Proxy(o,{get:(m,v)=>(u.has(v)||u.set(v,o(v)),u.get(v))})}const Gk=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Gv(t){return typeof t!="string"||t.includes("-")?!1:!!(Gk.indexOf(t)>-1||/[A-Z]/.test(t))}const Zm={};function $k(t){Object.assign(Zm,t)}const cp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Hl=new Set(cp);function _S(t,{layout:o,layoutId:u}){return Hl.has(t)||t.startsWith("origin")||(o||u!==void 0)&&(!!Zm[t]||t==="opacity")}const _r=t=>!!(t&&t.getVelocity),Zk={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},qk=cp.length;function Wk(t,{enableHardwareAcceleration:o=!0,allowTransformNone:u=!0},m,v){let b="";for(let C=0;C<qk;C++){const a=cp[C];if(t[a]!==void 0){const I=Zk[a]||a;b+=`${I}(${t[a]}) `}}return o&&!t.z&&(b+="translateZ(0)"),b=b.trim(),v?b=v(t,m?"":b):u&&m&&(b="none"),b}const yS=t=>o=>typeof o=="string"&&o.startsWith(t),vS=yS("--"),z0=yS("var(--"),Xk=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,Hk=(t,o)=>o&&typeof t=="number"?o.transform(t):t,Da=(t,o,u)=>Math.min(Math.max(u,t),o),Kl={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Ld={...Kl,transform:t=>Da(0,1,t)},nm={...Kl,default:1},Rd=t=>Math.round(t*1e5)/1e5,vg=/(-)?([\d]*\.?[\d])+/g,xS=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Kk=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function up(t){return typeof t=="string"}const hp=t=>({test:o=>up(o)&&o.endsWith(t)&&o.split(" ").length===1,parse:parseFloat,transform:o=>`${o}${t}`}),pa=hp("deg"),Wo=hp("%"),Lt=hp("px"),Yk=hp("vh"),Jk=hp("vw"),Wb={...Wo,parse:t=>Wo.parse(t)/100,transform:t=>Wo.transform(t*100)},Xb={...Kl,transform:Math.round},wS={borderWidth:Lt,borderTopWidth:Lt,borderRightWidth:Lt,borderBottomWidth:Lt,borderLeftWidth:Lt,borderRadius:Lt,radius:Lt,borderTopLeftRadius:Lt,borderTopRightRadius:Lt,borderBottomRightRadius:Lt,borderBottomLeftRadius:Lt,width:Lt,maxWidth:Lt,height:Lt,maxHeight:Lt,size:Lt,top:Lt,right:Lt,bottom:Lt,left:Lt,padding:Lt,paddingTop:Lt,paddingRight:Lt,paddingBottom:Lt,paddingLeft:Lt,margin:Lt,marginTop:Lt,marginRight:Lt,marginBottom:Lt,marginLeft:Lt,rotate:pa,rotateX:pa,rotateY:pa,rotateZ:pa,scale:nm,scaleX:nm,scaleY:nm,scaleZ:nm,skew:pa,skewX:pa,skewY:pa,distance:Lt,translateX:Lt,translateY:Lt,translateZ:Lt,x:Lt,y:Lt,z:Lt,perspective:Lt,transformPerspective:Lt,opacity:Ld,originX:Wb,originY:Wb,originZ:Lt,zIndex:Xb,fillOpacity:Ld,strokeOpacity:Ld,numOctaves:Xb};function $v(t,o,u,m){const{style:v,vars:b,transform:C,transformOrigin:a}=t;let I=!1,O=!1,q=!0;for(const G in o){const H=o[G];if(vS(G)){b[G]=H;continue}const ue=wS[G],_e=Hk(H,ue);if(Hl.has(G)){if(I=!0,C[G]=_e,!q)continue;H!==(ue.default||0)&&(q=!1)}else G.startsWith("origin")?(O=!0,a[G]=_e):v[G]=_e}if(o.transform||(I||m?v.transform=Wk(t.transform,u,q,m):v.transform&&(v.transform="none")),O){const{originX:G="50%",originY:H="50%",originZ:ue=0}=a;v.transformOrigin=`${G} ${H} ${ue}`}}const Zv=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function bS(t,o,u){for(const m in o)!_r(o[m])&&!_S(m,u)&&(t[m]=o[m])}function Qk({transformTemplate:t},o,u){return Rt.useMemo(()=>{const m=Zv();return $v(m,o,{enableHardwareAcceleration:!u},t),Object.assign({},m.vars,m.style)},[o])}function ez(t,o,u){const m=t.style||{},v={};return bS(v,m,t),Object.assign(v,Qk(t,o,u)),t.transformValues?t.transformValues(v):v}function tz(t,o,u){const m={},v=ez(t,o,u);return t.drag&&t.dragListener!==!1&&(m.draggable=!1,v.userSelect=v.WebkitUserSelect=v.WebkitTouchCallout="none",v.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(m.tabIndex=0),m.style=v,m}const nz=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onLayoutAnimationStart","onLayoutAnimationComplete","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","ignoreStrict","viewport"]);function qm(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||nz.has(t)}let TS=t=>!qm(t);function iz(t){t&&(TS=o=>o.startsWith("on")?!qm(o):t(o))}try{iz(require("@emotion/is-prop-valid").default)}catch{}function rz(t,o,u){const m={};for(const v in t)v==="values"&&typeof t.values=="object"||(TS(v)||u===!0&&qm(v)||!o&&!qm(v)||t.draggable&&v.startsWith("onDrag"))&&(m[v]=t[v]);return m}function Hb(t,o,u){return typeof t=="string"?t:Lt.transform(o+u*t)}function oz(t,o,u){const m=Hb(o,t.x,t.width),v=Hb(u,t.y,t.height);return`${m} ${v}`}const sz={offset:"stroke-dashoffset",array:"stroke-dasharray"},az={offset:"strokeDashoffset",array:"strokeDasharray"};function lz(t,o,u=1,m=0,v=!0){t.pathLength=1;const b=v?sz:az;t[b.offset]=Lt.transform(-m);const C=Lt.transform(o),a=Lt.transform(u);t[b.array]=`${C} ${a}`}function qv(t,{attrX:o,attrY:u,attrScale:m,originX:v,originY:b,pathLength:C,pathSpacing:a=1,pathOffset:I=0,...O},q,G,H){if($v(t,O,q,H),G){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:ue,style:_e,dimensions:Ie}=t;ue.transform&&(Ie&&(_e.transform=ue.transform),delete ue.transform),Ie&&(v!==void 0||b!==void 0||_e.transform)&&(_e.transformOrigin=oz(Ie,v!==void 0?v:.5,b!==void 0?b:.5)),o!==void 0&&(ue.x=o),u!==void 0&&(ue.y=u),m!==void 0&&(ue.scale=m),C!==void 0&&lz(ue,C,a,I,!1)}const ES=()=>({...Zv(),attrs:{}}),Wv=t=>typeof t=="string"&&t.toLowerCase()==="svg";function cz(t,o,u,m){const v=Rt.useMemo(()=>{const b=ES();return qv(b,o,{enableHardwareAcceleration:!1},Wv(m),t.transformTemplate),{...b.attrs,style:{...b.style}}},[o]);if(t.style){const b={};bS(b,t.style,t),v.style={...b,...v.style}}return v}function uz(t=!1){return(u,m,v,{latestValues:b},C)=>{const I=(Gv(u)?cz:tz)(m,b,C,u),q={...rz(m,typeof u=="string",t),...I,ref:v},{children:G}=m,H=Rt.useMemo(()=>_r(G)?G.get():G,[G]);return Rt.createElement(u,{...q,children:H})}}const Xv=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();function SS(t,{style:o,vars:u},m,v){Object.assign(t.style,o,v&&v.getProjectionStyles(m));for(const b in u)t.style.setProperty(b,u[b])}const CS=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function MS(t,o,u,m){SS(t,o,void 0,m);for(const v in o.attrs)t.setAttribute(CS.has(v)?v:Xv(v),o.attrs[v])}function Hv(t,o){const{style:u}=t,m={};for(const v in u)(_r(u[v])||o.style&&_r(o.style[v])||_S(v,t))&&(m[v]=u[v]);return m}function AS(t,o){const u=Hv(t,o);for(const m in t)if(_r(t[m])||_r(o[m])){const v=cp.indexOf(m)!==-1?"attr"+m.charAt(0).toUpperCase()+m.substring(1):m;u[v]=t[m]}return u}function Kv(t,o,u,m={},v={}){return typeof o=="function"&&(o=o(u!==void 0?u:t.custom,m,v)),typeof o=="string"&&(o=t.variants&&t.variants[o]),typeof o=="function"&&(o=o(u!==void 0?u:t.custom,m,v)),o}function hz(t){const o=Rt.useRef(null);return o.current===null&&(o.current=t()),o.current}const Wm=t=>Array.isArray(t),dz=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),pz=t=>Wm(t)?t[t.length-1]||0:t;function ym(t){const o=_r(t)?t.get():t;return dz(o)?o.toValue():o}function fz({scrapeMotionValuesFromProps:t,createRenderState:o,onMount:u},m,v,b){const C={latestValues:mz(m,v,b,t),renderState:o()};return u&&(C.mount=a=>u(m,a,C)),C}const PS=t=>(o,u)=>{const m=Rt.useContext(mg),v=Rt.useContext(Uv),b=()=>fz(t,o,m,v);return u?b():hz(b)};function mz(t,o,u,m){const v={},b=m(t,{});for(const H in b)v[H]=ym(b[H]);let{initial:C,animate:a}=t;const I=yg(t),O=fS(t);o&&O&&!I&&t.inherit!==!1&&(C===void 0&&(C=o.initial),a===void 0&&(a=o.animate));let q=u?u.initial===!1:!1;q=q||C===!1;const G=q?a:C;return G&&typeof G!="boolean"&&!_g(G)&&(Array.isArray(G)?G:[G]).forEach(ue=>{const _e=Kv(t,ue);if(!_e)return;const{transitionEnd:Ie,transition:at,...me}=_e;for(const ne in me){let le=me[ne];if(Array.isArray(le)){const ke=q?le.length-1:0;le=le[ke]}le!==null&&(v[ne]=le)}for(const ne in Ie)v[ne]=Ie[ne]}),v}const ei=t=>t;class Kb{constructor(){this.order=[],this.scheduled=new Set}add(o){if(!this.scheduled.has(o))return this.scheduled.add(o),this.order.push(o),!0}remove(o){const u=this.order.indexOf(o);u!==-1&&(this.order.splice(u,1),this.scheduled.delete(o))}clear(){this.order.length=0,this.scheduled.clear()}}function gz(t){let o=new Kb,u=new Kb,m=0,v=!1,b=!1;const C=new WeakSet,a={schedule:(I,O=!1,q=!1)=>{const G=q&&v,H=G?o:u;return O&&C.add(I),H.add(I)&&G&&v&&(m=o.order.length),I},cancel:I=>{u.remove(I),C.delete(I)},process:I=>{if(v){b=!0;return}if(v=!0,[o,u]=[u,o],u.clear(),m=o.order.length,m)for(let O=0;O<m;O++){const q=o.order[O];q(I),C.has(q)&&(a.schedule(q),t())}v=!1,b&&(b=!1,a.process(I))}};return a}const im=["prepare","read","update","preRender","render","postRender"],_z=40;function yz(t,o){let u=!1,m=!0;const v={delta:0,timestamp:0,isProcessing:!1},b=im.reduce((G,H)=>(G[H]=gz(()=>u=!0),G),{}),C=G=>b[G].process(v),a=()=>{const G=performance.now();u=!1,v.delta=m?1e3/60:Math.max(Math.min(G-v.timestamp,_z),1),v.timestamp=G,v.isProcessing=!0,im.forEach(C),v.isProcessing=!1,u&&o&&(m=!1,t(a))},I=()=>{u=!0,m=!0,v.isProcessing||t(a)};return{schedule:im.reduce((G,H)=>{const ue=b[H];return G[H]=(_e,Ie=!1,at=!1)=>(u||I(),ue.schedule(_e,Ie,at)),G},{}),cancel:G=>im.forEach(H=>b[H].cancel(G)),state:v,steps:b}}const{schedule:Dn,cancel:Ps,state:Ei,steps:My}=yz(typeof requestAnimationFrame<"u"?requestAnimationFrame:ei,!0),vz={useVisualState:PS({scrapeMotionValuesFromProps:AS,createRenderState:ES,onMount:(t,o,{renderState:u,latestValues:m})=>{Dn.read(()=>{try{u.dimensions=typeof o.getBBox=="function"?o.getBBox():o.getBoundingClientRect()}catch{u.dimensions={x:0,y:0,width:0,height:0}}}),Dn.render(()=>{qv(u,m,{enableHardwareAcceleration:!1},Wv(o.tagName),t.transformTemplate),MS(o,u)})}})},xz={useVisualState:PS({scrapeMotionValuesFromProps:Hv,createRenderState:Zv})};function wz(t,{forwardMotionProps:o=!1},u,m){return{...Gv(t)?vz:xz,preloadedFeatures:u,useRender:uz(o),createVisualElement:m,Component:t}}function ws(t,o,u,m={passive:!0}){return t.addEventListener(o,u,m),()=>t.removeEventListener(o,u)}const IS=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function xg(t,o="page"){return{point:{x:t[o+"X"],y:t[o+"Y"]}}}const bz=t=>o=>IS(o)&&t(o,xg(o));function Ts(t,o,u,m){return ws(t,o,bz(u),m)}const Tz=(t,o)=>u=>o(t(u)),Pa=(...t)=>t.reduce(Tz);function kS(t){let o=null;return()=>{const u=()=>{o=null};return o===null?(o=t,u):!1}}const Yb=kS("dragHorizontal"),Jb=kS("dragVertical");function zS(t){let o=!1;if(t==="y")o=Jb();else if(t==="x")o=Yb();else{const u=Yb(),m=Jb();u&&m?o=()=>{u(),m()}:(u&&u(),m&&m())}return o}function DS(){const t=zS(!0);return t?(t(),!1):!0}class Oa{constructor(o){this.isMounted=!1,this.node=o}update(){}}function Qb(t,o){const u="pointer"+(o?"enter":"leave"),m="onHover"+(o?"Start":"End"),v=(b,C)=>{if(b.type==="touch"||DS())return;const a=t.getProps();t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",o),a[m]&&Dn.update(()=>a[m](b,C))};return Ts(t.current,u,v,{passive:!t.getProps()[m]})}class Ez extends Oa{mount(){this.unmount=Pa(Qb(this.node,!0),Qb(this.node,!1))}unmount(){}}class Sz extends Oa{constructor(){super(...arguments),this.isActive=!1}onFocus(){let o=!1;try{o=this.node.current.matches(":focus-visible")}catch{o=!0}!o||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Pa(ws(this.node.current,"focus",()=>this.onFocus()),ws(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const LS=(t,o)=>o?t===o?!0:LS(t,o.parentElement):!1;function Ay(t,o){if(!o)return;const u=new PointerEvent("pointer"+t);o(u,xg(u))}class Cz extends Oa{constructor(){super(...arguments),this.removeStartListeners=ei,this.removeEndListeners=ei,this.removeAccessibleListeners=ei,this.startPointerPress=(o,u)=>{if(this.removeEndListeners(),this.isPressing)return;const m=this.node.getProps(),b=Ts(window,"pointerup",(a,I)=>{if(!this.checkPressEnd())return;const{onTap:O,onTapCancel:q}=this.node.getProps();Dn.update(()=>{LS(this.node.current,a.target)?O&&O(a,I):q&&q(a,I)})},{passive:!(m.onTap||m.onPointerUp)}),C=Ts(window,"pointercancel",(a,I)=>this.cancelPress(a,I),{passive:!(m.onTapCancel||m.onPointerCancel)});this.removeEndListeners=Pa(b,C),this.startPress(o,u)},this.startAccessiblePress=()=>{const o=b=>{if(b.key!=="Enter"||this.isPressing)return;const C=a=>{a.key!=="Enter"||!this.checkPressEnd()||Ay("up",(I,O)=>{const{onTap:q}=this.node.getProps();q&&Dn.update(()=>q(I,O))})};this.removeEndListeners(),this.removeEndListeners=ws(this.node.current,"keyup",C),Ay("down",(a,I)=>{this.startPress(a,I)})},u=ws(this.node.current,"keydown",o),m=()=>{this.isPressing&&Ay("cancel",(b,C)=>this.cancelPress(b,C))},v=ws(this.node.current,"blur",m);this.removeAccessibleListeners=Pa(u,v)}}startPress(o,u){this.isPressing=!0;const{onTapStart:m,whileTap:v}=this.node.getProps();v&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),m&&Dn.update(()=>m(o,u))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!DS()}cancelPress(o,u){if(!this.checkPressEnd())return;const{onTapCancel:m}=this.node.getProps();m&&Dn.update(()=>m(o,u))}mount(){const o=this.node.getProps(),u=Ts(this.node.current,"pointerdown",this.startPointerPress,{passive:!(o.onTapStart||o.onPointerStart)}),m=ws(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Pa(u,m)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const D0=new WeakMap,Py=new WeakMap,Mz=t=>{const o=D0.get(t.target);o&&o(t)},Az=t=>{t.forEach(Mz)};function Pz({root:t,...o}){const u=t||document;Py.has(u)||Py.set(u,{});const m=Py.get(u),v=JSON.stringify(o);return m[v]||(m[v]=new IntersectionObserver(Az,{root:t,...o})),m[v]}function Iz(t,o,u){const m=Pz(o);return D0.set(t,u),m.observe(t),()=>{D0.delete(t),m.unobserve(t)}}const kz={some:0,all:1};class zz extends Oa{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:o={}}=this.node.getProps(),{root:u,margin:m,amount:v="some",once:b}=o,C={root:u?u.current:void 0,rootMargin:m,threshold:typeof v=="number"?v:kz[v]},a=I=>{const{isIntersecting:O}=I;if(this.isInView===O||(this.isInView=O,b&&!O&&this.hasEnteredView))return;O&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",O);const{onViewportEnter:q,onViewportLeave:G}=this.node.getProps(),H=O?q:G;H&&H(I)};return Iz(this.node.current,C,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:o,prevProps:u}=this.node;["amount","margin","root"].some(Dz(o,u))&&this.startObserver()}unmount(){}}function Dz({viewport:t={}},{viewport:o={}}={}){return u=>t[u]!==o[u]}const Lz={inView:{Feature:zz},tap:{Feature:Cz},focus:{Feature:Sz},hover:{Feature:Ez}};function RS(t,o){if(!Array.isArray(o))return!1;const u=o.length;if(u!==t.length)return!1;for(let m=0;m<u;m++)if(o[m]!==t[m])return!1;return!0}function Rz(t){const o={};return t.values.forEach((u,m)=>o[m]=u.get()),o}function Bz(t){const o={};return t.values.forEach((u,m)=>o[m]=u.getVelocity()),o}function wg(t,o,u){const m=t.getProps();return Kv(m,o,u!==void 0?u:m.custom,Rz(t),Bz(t))}const Fz="framerAppearId",Oz="data-"+Xv(Fz);let Vz=ei,Yv=ei;const Ia=t=>t*1e3,Es=t=>t/1e3,Uz={current:!1},BS=t=>Array.isArray(t)&&typeof t[0]=="number";function FS(t){return!!(!t||typeof t=="string"&&OS[t]||BS(t)||Array.isArray(t)&&t.every(FS))}const Ed=([t,o,u,m])=>`cubic-bezier(${t}, ${o}, ${u}, ${m})`,OS={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ed([0,.65,.55,1]),circOut:Ed([.55,0,1,.45]),backIn:Ed([.31,.01,.66,-.59]),backOut:Ed([.33,1.53,.69,.99])};function VS(t){if(t)return BS(t)?Ed(t):Array.isArray(t)?t.map(VS):OS[t]}function Nz(t,o,u,{delay:m=0,duration:v,repeat:b=0,repeatType:C="loop",ease:a,times:I}={}){const O={[o]:u};I&&(O.offset=I);const q=VS(a);return Array.isArray(q)&&(O.easing=q),t.animate(O,{delay:m,duration:v,easing:Array.isArray(q)?"linear":q,fill:"both",iterations:b+1,direction:C==="reverse"?"alternate":"normal"})}function jz(t,{repeat:o,repeatType:u="loop"}){const m=o&&u!=="loop"&&o%2===1?0:t.length-1;return t[m]}const US=(t,o,u)=>(((1-3*u+3*o)*t+(3*u-6*o))*t+3*o)*t,Gz=1e-7,$z=12;function Zz(t,o,u,m,v){let b,C,a=0;do C=o+(u-o)/2,b=US(C,m,v)-t,b>0?u=C:o=C;while(Math.abs(b)>Gz&&++a<$z);return C}function dp(t,o,u,m){if(t===o&&u===m)return ei;const v=b=>Zz(b,0,1,t,u);return b=>b===0||b===1?b:US(v(b),o,m)}const qz=dp(.42,0,1,1),Wz=dp(0,0,.58,1),NS=dp(.42,0,.58,1),Xz=t=>Array.isArray(t)&&typeof t[0]!="number",jS=t=>o=>o<=.5?t(2*o)/2:(2-t(2*(1-o)))/2,GS=t=>o=>1-t(1-o),$S=t=>1-Math.sin(Math.acos(t)),Jv=GS($S),Hz=jS(Jv),ZS=dp(.33,1.53,.69,.99),Qv=GS(ZS),Kz=jS(Qv),Yz=t=>(t*=2)<1?.5*Qv(t):.5*(2-Math.pow(2,-10*(t-1))),Jz={linear:ei,easeIn:qz,easeInOut:NS,easeOut:Wz,circIn:$S,circInOut:Hz,circOut:Jv,backIn:Qv,backInOut:Kz,backOut:ZS,anticipate:Yz},eT=t=>{if(Array.isArray(t)){Yv(t.length===4);const[o,u,m,v]=t;return dp(o,u,m,v)}else if(typeof t=="string")return Jz[t];return t},ex=(t,o)=>u=>!!(up(u)&&Kk.test(u)&&u.startsWith(t)||o&&Object.prototype.hasOwnProperty.call(u,o)),qS=(t,o,u)=>m=>{if(!up(m))return m;const[v,b,C,a]=m.match(vg);return{[t]:parseFloat(v),[o]:parseFloat(b),[u]:parseFloat(C),alpha:a!==void 0?parseFloat(a):1}},Qz=t=>Da(0,255,t),Iy={...Kl,transform:t=>Math.round(Qz(t))},Vl={test:ex("rgb","red"),parse:qS("red","green","blue"),transform:({red:t,green:o,blue:u,alpha:m=1})=>"rgba("+Iy.transform(t)+", "+Iy.transform(o)+", "+Iy.transform(u)+", "+Rd(Ld.transform(m))+")"};function eD(t){let o="",u="",m="",v="";return t.length>5?(o=t.substring(1,3),u=t.substring(3,5),m=t.substring(5,7),v=t.substring(7,9)):(o=t.substring(1,2),u=t.substring(2,3),m=t.substring(3,4),v=t.substring(4,5),o+=o,u+=u,m+=m,v+=v),{red:parseInt(o,16),green:parseInt(u,16),blue:parseInt(m,16),alpha:v?parseInt(v,16)/255:1}}const L0={test:ex("#"),parse:eD,transform:Vl.transform},du={test:ex("hsl","hue"),parse:qS("hue","saturation","lightness"),transform:({hue:t,saturation:o,lightness:u,alpha:m=1})=>"hsla("+Math.round(t)+", "+Wo.transform(Rd(o))+", "+Wo.transform(Rd(u))+", "+Rd(Ld.transform(m))+")"},Ki={test:t=>Vl.test(t)||L0.test(t)||du.test(t),parse:t=>Vl.test(t)?Vl.parse(t):du.test(t)?du.parse(t):L0.parse(t),transform:t=>up(t)?t:t.hasOwnProperty("red")?Vl.transform(t):du.transform(t)},Xn=(t,o,u)=>-u*t+u*o+t;function ky(t,o,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?t+(o-t)*6*u:u<1/2?o:u<2/3?t+(o-t)*(2/3-u)*6:t}function tD({hue:t,saturation:o,lightness:u,alpha:m}){t/=360,o/=100,u/=100;let v=0,b=0,C=0;if(!o)v=b=C=u;else{const a=u<.5?u*(1+o):u+o-u*o,I=2*u-a;v=ky(I,a,t+1/3),b=ky(I,a,t),C=ky(I,a,t-1/3)}return{red:Math.round(v*255),green:Math.round(b*255),blue:Math.round(C*255),alpha:m}}const zy=(t,o,u)=>{const m=t*t;return Math.sqrt(Math.max(0,u*(o*o-m)+m))},nD=[L0,Vl,du],iD=t=>nD.find(o=>o.test(t));function tT(t){const o=iD(t);let u=o.parse(t);return o===du&&(u=tD(u)),u}const WS=(t,o)=>{const u=tT(t),m=tT(o),v={...u};return b=>(v.red=zy(u.red,m.red,b),v.green=zy(u.green,m.green,b),v.blue=zy(u.blue,m.blue,b),v.alpha=Xn(u.alpha,m.alpha,b),Vl.transform(v))};function rD(t){var o,u;return isNaN(t)&&up(t)&&(((o=t.match(vg))===null||o===void 0?void 0:o.length)||0)+(((u=t.match(xS))===null||u===void 0?void 0:u.length)||0)>0}const XS={regex:Xk,countKey:"Vars",token:"${v}",parse:ei},HS={regex:xS,countKey:"Colors",token:"${c}",parse:Ki.parse},KS={regex:vg,countKey:"Numbers",token:"${n}",parse:Kl.parse};function Dy(t,{regex:o,countKey:u,token:m,parse:v}){const b=t.tokenised.match(o);b&&(t["num"+u]=b.length,t.tokenised=t.tokenised.replace(o,m),t.values.push(...b.map(v)))}function Xm(t){const o=t.toString(),u={value:o,tokenised:o,values:[],numVars:0,numColors:0,numNumbers:0};return u.value.includes("var(--")&&Dy(u,XS),Dy(u,HS),Dy(u,KS),u}function YS(t){return Xm(t).values}function JS(t){const{values:o,numColors:u,numVars:m,tokenised:v}=Xm(t),b=o.length;return C=>{let a=v;for(let I=0;I<b;I++)I<m?a=a.replace(XS.token,C[I]):I<m+u?a=a.replace(HS.token,Ki.transform(C[I])):a=a.replace(KS.token,Rd(C[I]));return a}}const oD=t=>typeof t=="number"?0:t;function sD(t){const o=YS(t);return JS(t)(o.map(oD))}const La={test:rD,parse:YS,createTransformer:JS,getAnimatableNone:sD},QS=(t,o)=>u=>`${u>0?o:t}`;function eC(t,o){return typeof t=="number"?u=>Xn(t,o,u):Ki.test(t)?WS(t,o):t.startsWith("var(")?QS(t,o):nC(t,o)}const tC=(t,o)=>{const u=[...t],m=u.length,v=t.map((b,C)=>eC(b,o[C]));return b=>{for(let C=0;C<m;C++)u[C]=v[C](b);return u}},aD=(t,o)=>{const u={...t,...o},m={};for(const v in u)t[v]!==void 0&&o[v]!==void 0&&(m[v]=eC(t[v],o[v]));return v=>{for(const b in m)u[b]=m[b](v);return u}},nC=(t,o)=>{const u=La.createTransformer(o),m=Xm(t),v=Xm(o);return m.numVars===v.numVars&&m.numColors===v.numColors&&m.numNumbers>=v.numNumbers?Pa(tC(m.values,v.values),u):QS(t,o)},ip=(t,o,u)=>{const m=o-t;return m===0?1:(u-t)/m},nT=(t,o)=>u=>Xn(t,o,u);function lD(t){return typeof t=="number"?nT:typeof t=="string"?Ki.test(t)?WS:nC:Array.isArray(t)?tC:typeof t=="object"?aD:nT}function cD(t,o,u){const m=[],v=u||lD(t[0]),b=t.length-1;for(let C=0;C<b;C++){let a=v(t[C],t[C+1]);if(o){const I=Array.isArray(o)?o[C]||ei:o;a=Pa(I,a)}m.push(a)}return m}function iC(t,o,{clamp:u=!0,ease:m,mixer:v}={}){const b=t.length;if(Yv(b===o.length),b===1)return()=>o[0];t[0]>t[b-1]&&(t=[...t].reverse(),o=[...o].reverse());const C=cD(o,m,v),a=C.length,I=O=>{let q=0;if(a>1)for(;q<t.length-2&&!(O<t[q+1]);q++);const G=ip(t[q],t[q+1],O);return C[q](G)};return u?O=>I(Da(t[0],t[b-1],O)):I}function uD(t,o){const u=t[t.length-1];for(let m=1;m<=o;m++){const v=ip(0,o,m);t.push(Xn(u,1,v))}}function hD(t){const o=[0];return uD(o,t.length-1),o}function dD(t,o){return t.map(u=>u*o)}function pD(t,o){return t.map(()=>o||NS).splice(0,t.length-1)}function Hm({duration:t=300,keyframes:o,times:u,ease:m="easeInOut"}){const v=Xz(m)?m.map(eT):eT(m),b={done:!1,value:o[0]},C=dD(u&&u.length===o.length?u:hD(o),t),a=iC(C,o,{ease:Array.isArray(v)?v:pD(o,v)});return{calculatedDuration:t,next:I=>(b.value=a(I),b.done=I>=t,b)}}function rC(t,o){return o?t*(1e3/o):0}const fD=5;function oC(t,o,u){const m=Math.max(o-fD,0);return rC(u-t(m),o-m)}const Ly=.001,mD=.01,iT=10,gD=.05,_D=1;function yD({duration:t=800,bounce:o=.25,velocity:u=0,mass:m=1}){let v,b;Vz(t<=Ia(iT));let C=1-o;C=Da(gD,_D,C),t=Da(mD,iT,Es(t)),C<1?(v=O=>{const q=O*C,G=q*t,H=q-u,ue=R0(O,C),_e=Math.exp(-G);return Ly-H/ue*_e},b=O=>{const G=O*C*t,H=G*u+u,ue=Math.pow(C,2)*Math.pow(O,2)*t,_e=Math.exp(-G),Ie=R0(Math.pow(O,2),C);return(-v(O)+Ly>0?-1:1)*((H-ue)*_e)/Ie}):(v=O=>{const q=Math.exp(-O*t),G=(O-u)*t+1;return-Ly+q*G},b=O=>{const q=Math.exp(-O*t),G=(u-O)*(t*t);return q*G});const a=5/t,I=xD(v,b,a);if(t=Ia(t),isNaN(I))return{stiffness:100,damping:10,duration:t};{const O=Math.pow(I,2)*m;return{stiffness:O,damping:C*2*Math.sqrt(m*O),duration:t}}}const vD=12;function xD(t,o,u){let m=u;for(let v=1;v<vD;v++)m=m-t(m)/o(m);return m}function R0(t,o){return t*Math.sqrt(1-o*o)}const wD=["duration","bounce"],bD=["stiffness","damping","mass"];function rT(t,o){return o.some(u=>t[u]!==void 0)}function TD(t){let o={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!rT(t,bD)&&rT(t,wD)){const u=yD(t);o={...o,...u,velocity:0,mass:1},o.isResolvedFromDuration=!0}return o}function sC({keyframes:t,restDelta:o,restSpeed:u,...m}){const v=t[0],b=t[t.length-1],C={done:!1,value:v},{stiffness:a,damping:I,mass:O,velocity:q,duration:G,isResolvedFromDuration:H}=TD(m),ue=q?-Es(q):0,_e=I/(2*Math.sqrt(a*O)),Ie=b-v,at=Es(Math.sqrt(a/O)),me=Math.abs(Ie)<5;u||(u=me?.01:2),o||(o=me?.005:.5);let ne;if(_e<1){const le=R0(at,_e);ne=ke=>{const je=Math.exp(-_e*at*ke);return b-je*((ue+_e*at*Ie)/le*Math.sin(le*ke)+Ie*Math.cos(le*ke))}}else if(_e===1)ne=le=>b-Math.exp(-at*le)*(Ie+(ue+at*Ie)*le);else{const le=at*Math.sqrt(_e*_e-1);ne=ke=>{const je=Math.exp(-_e*at*ke),ct=Math.min(le*ke,300);return b-je*((ue+_e*at*Ie)*Math.sinh(ct)+le*Ie*Math.cosh(ct))/le}}return{calculatedDuration:H&&G||null,next:le=>{const ke=ne(le);if(H)C.done=le>=G;else{let je=ue;le!==0&&(_e<1?je=oC(ne,le,ke):je=0);const ct=Math.abs(je)<=u,it=Math.abs(b-ke)<=o;C.done=ct&&it}return C.value=C.done?b:ke,C}}}function oT({keyframes:t,velocity:o=0,power:u=.8,timeConstant:m=325,bounceDamping:v=10,bounceStiffness:b=500,modifyTarget:C,min:a,max:I,restDelta:O=.5,restSpeed:q}){const G=t[0],H={done:!1,value:G},ue=Qe=>a!==void 0&&Qe<a||I!==void 0&&Qe>I,_e=Qe=>a===void 0?I:I===void 0||Math.abs(a-Qe)<Math.abs(I-Qe)?a:I;let Ie=u*o;const at=G+Ie,me=C===void 0?at:C(at);me!==at&&(Ie=me-G);const ne=Qe=>-Ie*Math.exp(-Qe/m),le=Qe=>me+ne(Qe),ke=Qe=>{const Be=ne(Qe),St=le(Qe);H.done=Math.abs(Be)<=O,H.value=H.done?me:St};let je,ct;const it=Qe=>{ue(H.value)&&(je=Qe,ct=sC({keyframes:[H.value,_e(H.value)],velocity:oC(le,Qe,H.value),damping:v,stiffness:b,restDelta:O,restSpeed:q}))};return it(0),{calculatedDuration:null,next:Qe=>{let Be=!1;return!ct&&je===void 0&&(Be=!0,ke(Qe),it(Qe)),je!==void 0&&Qe>je?ct.next(Qe-je):(!Be&&ke(Qe),H)}}}const ED=t=>{const o=({timestamp:u})=>t(u);return{start:()=>Dn.update(o,!0),stop:()=>Ps(o),now:()=>Ei.isProcessing?Ei.timestamp:performance.now()}},sT=2e4;function aT(t){let o=0;const u=50;let m=t.next(o);for(;!m.done&&o<sT;)o+=u,m=t.next(o);return o>=sT?1/0:o}const SD={decay:oT,inertia:oT,tween:Hm,keyframes:Hm,spring:sC};function Km({autoplay:t=!0,delay:o=0,driver:u=ED,keyframes:m,type:v="keyframes",repeat:b=0,repeatDelay:C=0,repeatType:a="loop",onPlay:I,onStop:O,onComplete:q,onUpdate:G,...H}){let ue=1,_e=!1,Ie,at;const me=()=>{at=new Promise(gt=>{Ie=gt})};me();let ne;const le=SD[v]||Hm;let ke;le!==Hm&&typeof m[0]!="number"&&(ke=iC([0,100],m,{clamp:!1}),m=[0,100]);const je=le({...H,keyframes:m});let ct;a==="mirror"&&(ct=le({...H,keyframes:[...m].reverse(),velocity:-(H.velocity||0)}));let it="idle",Qe=null,Be=null,St=null;je.calculatedDuration===null&&b&&(je.calculatedDuration=aT(je));const{calculatedDuration:bn}=je;let bt=1/0,Jt=1/0;bn!==null&&(bt=bn+C,Jt=bt*(b+1)-C);let Tn=0;const vn=gt=>{if(Be===null)return;ue>0&&(Be=Math.min(Be,gt)),ue<0&&(Be=Math.min(gt-Jt/ue,Be)),Qe!==null?Tn=Qe:Tn=Math.round(gt-Be)*ue;const Qt=Tn-o*(ue>=0?1:-1),hn=ue>=0?Qt<0:Qt>Jt;Tn=Math.max(Qt,0),it==="finished"&&Qe===null&&(Tn=Jt);let ti=Tn,Zi=je;if(b){const yr=Tn/bt;let vr=Math.floor(yr),Pt=yr%1;!Pt&&yr>=1&&(Pt=1),Pt===1&&vr--,vr=Math.min(vr,b+1);const Yr=!!(vr%2);Yr&&(a==="reverse"?(Pt=1-Pt,C&&(Pt-=C/bt)):a==="mirror"&&(Zi=ct));let yi=Da(0,1,Pt);Tn>Jt&&(yi=a==="reverse"&&Yr?1:0),ti=yi*bt}const Ln=hn?{done:!1,value:m[0]}:Zi.next(ti);ke&&(Ln.value=ke(Ln.value));let{done:di}=Ln;!hn&&bn!==null&&(di=ue>=0?Tn>=Jt:Tn<=0);const ks=Qe===null&&(it==="finished"||it==="running"&&di);return G&&G(Ln.value),ks&&We(),Ln},ii=()=>{ne&&ne.stop(),ne=void 0},Mi=()=>{it="idle",ii(),Ie(),me(),Be=St=null},We=()=>{it="finished",q&&q(),ii(),Ie()},Et=()=>{if(_e)return;ne||(ne=u(vn));const gt=ne.now();I&&I(),Qe!==null?Be=gt-Qe:(!Be||it==="finished")&&(Be=gt),it==="finished"&&me(),St=Be,Qe=null,it="running",ne.start()};t&&Et();const vt={then(gt,Qt){return at.then(gt,Qt)},get time(){return Es(Tn)},set time(gt){gt=Ia(gt),Tn=gt,Qe!==null||!ne||ue===0?Qe=gt:Be=ne.now()-gt/ue},get duration(){const gt=je.calculatedDuration===null?aT(je):je.calculatedDuration;return Es(gt)},get speed(){return ue},set speed(gt){gt===ue||!ne||(ue=gt,vt.time=Es(Tn))},get state(){return it},play:Et,pause:()=>{it="paused",Qe=Tn},stop:()=>{_e=!0,it!=="idle"&&(it="idle",O&&O(),Mi())},cancel:()=>{St!==null&&vn(St),Mi()},complete:()=>{it="finished"},sample:gt=>(Be=0,vn(gt))};return vt}function CD(t){let o;return()=>(o===void 0&&(o=t()),o)}const MD=CD(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),AD=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),rm=10,PD=2e4,ID=(t,o)=>o.type==="spring"||t==="backgroundColor"||!FS(o.ease);function kD(t,o,{onUpdate:u,onComplete:m,...v}){if(!(MD()&&AD.has(o)&&!v.repeatDelay&&v.repeatType!=="mirror"&&v.damping!==0&&v.type!=="inertia"))return!1;let C=!1,a,I;const O=()=>{I=new Promise(ne=>{a=ne})};O();let{keyframes:q,duration:G=300,ease:H,times:ue}=v;if(ID(o,v)){const ne=Km({...v,repeat:0,delay:0});let le={done:!1,value:q[0]};const ke=[];let je=0;for(;!le.done&&je<PD;)le=ne.sample(je),ke.push(le.value),je+=rm;ue=void 0,q=ke,G=je-rm,H="linear"}const _e=Nz(t.owner.current,o,q,{...v,duration:G,ease:H,times:ue});v.syncStart&&(_e.startTime=Ei.isProcessing?Ei.timestamp:document.timeline?document.timeline.currentTime:performance.now());const Ie=()=>_e.cancel(),at=()=>{Dn.update(Ie),a(),O()};return _e.onfinish=()=>{t.set(jz(q,v)),m&&m(),at()},{then(ne,le){return I.then(ne,le)},attachTimeline(ne){return _e.timeline=ne,_e.onfinish=null,ei},get time(){return Es(_e.currentTime||0)},set time(ne){_e.currentTime=Ia(ne)},get speed(){return _e.playbackRate},set speed(ne){_e.playbackRate=ne},get duration(){return Es(G)},play:()=>{C||(_e.play(),Ps(Ie))},pause:()=>_e.pause(),stop:()=>{if(C=!0,_e.playState==="idle")return;const{currentTime:ne}=_e;if(ne){const le=Km({...v,autoplay:!1});t.setWithVelocity(le.sample(ne-rm).value,le.sample(ne).value,rm)}at()},complete:()=>_e.finish(),cancel:at}}function zD({keyframes:t,delay:o,onUpdate:u,onComplete:m}){const v=()=>(u&&u(t[t.length-1]),m&&m(),{time:0,speed:1,duration:0,play:ei,pause:ei,stop:ei,then:b=>(b(),Promise.resolve()),cancel:ei,complete:ei});return o?Km({keyframes:[0,1],duration:0,delay:o,onComplete:v}):v()}const DD={type:"spring",stiffness:500,damping:25,restSpeed:10},LD=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),RD={type:"keyframes",duration:.8},BD={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},FD=(t,{keyframes:o})=>o.length>2?RD:Hl.has(t)?t.startsWith("scale")?LD(o[1]):DD:BD,B0=(t,o)=>t==="zIndex"?!1:!!(typeof o=="number"||Array.isArray(o)||typeof o=="string"&&(La.test(o)||o==="0")&&!o.startsWith("url(")),OD=new Set(["brightness","contrast","saturate","opacity"]);function VD(t){const[o,u]=t.slice(0,-1).split("(");if(o==="drop-shadow")return t;const[m]=u.match(vg)||[];if(!m)return t;const v=u.replace(m,"");let b=OD.has(o)?1:0;return m!==u&&(b*=100),o+"("+b+v+")"}const UD=/([a-z-]*)\(.*?\)/g,F0={...La,getAnimatableNone:t=>{const o=t.match(UD);return o?o.map(VD).join(" "):t}},ND={...wS,color:Ki,backgroundColor:Ki,outlineColor:Ki,fill:Ki,stroke:Ki,borderColor:Ki,borderTopColor:Ki,borderRightColor:Ki,borderBottomColor:Ki,borderLeftColor:Ki,filter:F0,WebkitFilter:F0},tx=t=>ND[t];function aC(t,o){let u=tx(t);return u!==F0&&(u=La),u.getAnimatableNone?u.getAnimatableNone(o):void 0}const lC=t=>/^0[^.\s]+$/.test(t);function jD(t){if(typeof t=="number")return t===0;if(t!==null)return t==="none"||t==="0"||lC(t)}function GD(t,o,u,m){const v=B0(o,u);let b;Array.isArray(u)?b=[...u]:b=[null,u];const C=m.from!==void 0?m.from:t.get();let a;const I=[];for(let O=0;O<b.length;O++)b[O]===null&&(b[O]=O===0?C:b[O-1]),jD(b[O])&&I.push(O),typeof b[O]=="string"&&b[O]!=="none"&&b[O]!=="0"&&(a=b[O]);if(v&&I.length&&a)for(let O=0;O<I.length;O++){const q=I[O];b[q]=aC(o,a)}return b}function $D({when:t,delay:o,delayChildren:u,staggerChildren:m,staggerDirection:v,repeat:b,repeatType:C,repeatDelay:a,from:I,elapsed:O,...q}){return!!Object.keys(q).length}function cC(t,o){return t[o]||t.default||t}const nx=(t,o,u,m={})=>v=>{const b=cC(m,t)||{},C=b.delay||m.delay||0;let{elapsed:a=0}=m;a=a-Ia(C);const I=GD(o,t,u,b),O=I[0],q=I[I.length-1],G=B0(t,O),H=B0(t,q);let ue={keyframes:I,velocity:o.getVelocity(),ease:"easeOut",...b,delay:-a,onUpdate:_e=>{o.set(_e),b.onUpdate&&b.onUpdate(_e)},onComplete:()=>{v(),b.onComplete&&b.onComplete()}};if($D(b)||(ue={...ue,...FD(t,ue)}),ue.duration&&(ue.duration=Ia(ue.duration)),ue.repeatDelay&&(ue.repeatDelay=Ia(ue.repeatDelay)),!G||!H||Uz.current||b.type===!1)return zD(ue);if(o.owner&&o.owner.current instanceof HTMLElement&&!o.owner.getProps().onUpdate){const _e=kD(o,t,ue);if(_e)return _e}return Km(ue)};function Ym(t){return!!(_r(t)&&t.add)}const uC=t=>/^\-?\d*\.?\d+$/.test(t);function ix(t,o){t.indexOf(o)===-1&&t.push(o)}function rx(t,o){const u=t.indexOf(o);u>-1&&t.splice(u,1)}class ox{constructor(){this.subscriptions=[]}add(o){return ix(this.subscriptions,o),()=>rx(this.subscriptions,o)}notify(o,u,m){const v=this.subscriptions.length;if(v)if(v===1)this.subscriptions[0](o,u,m);else for(let b=0;b<v;b++){const C=this.subscriptions[b];C&&C(o,u,m)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const ZD=t=>!isNaN(parseFloat(t));class qD{constructor(o,u={}){this.version="10.16.4",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(m,v=!0)=>{this.prev=this.current,this.current=m;const{delta:b,timestamp:C}=Ei;this.lastUpdated!==C&&(this.timeDelta=b,this.lastUpdated=C,Dn.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),v&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>Dn.postRender(this.velocityCheck),this.velocityCheck=({timestamp:m})=>{m!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=o,this.canTrackVelocity=ZD(this.current),this.owner=u.owner}onChange(o){return this.on("change",o)}on(o,u){this.events[o]||(this.events[o]=new ox);const m=this.events[o].add(u);return o==="change"?()=>{m(),Dn.read(()=>{this.events.change.getSize()||this.stop()})}:m}clearListeners(){for(const o in this.events)this.events[o].clear()}attach(o,u){this.passiveEffect=o,this.stopPassiveEffect=u}set(o,u=!0){!u||!this.passiveEffect?this.updateAndNotify(o,u):this.passiveEffect(o,this.updateAndNotify)}setWithVelocity(o,u,m){this.set(u),this.prev=o,this.timeDelta=m}jump(o){this.updateAndNotify(o),this.prev=o,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?rC(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(o){return this.stop(),new Promise(u=>{this.hasAnimated=!0,this.animation=o(u),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Au(t,o){return new qD(t,o)}const hC=t=>o=>o.test(t),WD={test:t=>t==="auto",parse:t=>t},dC=[Kl,Lt,Wo,pa,Jk,Yk,WD],yd=t=>dC.find(hC(t)),XD=[...dC,Ki,La],HD=t=>XD.find(hC(t));function KD(t,o,u){t.hasValue(o)?t.getValue(o).set(u):t.addValue(o,Au(u))}function YD(t,o){const u=wg(t,o);let{transitionEnd:m={},transition:v={},...b}=u?t.makeTargetAnimatable(u,!1):{};b={...b,...m};for(const C in b){const a=pz(b[C]);KD(t,C,a)}}function JD(t,o,u){var m,v;const b=Object.keys(o).filter(a=>!t.hasValue(a)),C=b.length;if(C)for(let a=0;a<C;a++){const I=b[a],O=o[I];let q=null;Array.isArray(O)&&(q=O[0]),q===null&&(q=(v=(m=u[I])!==null&&m!==void 0?m:t.readValue(I))!==null&&v!==void 0?v:o[I]),q!=null&&(typeof q=="string"&&(uC(q)||lC(q))?q=parseFloat(q):!HD(q)&&La.test(O)&&(q=aC(I,O)),t.addValue(I,Au(q,{owner:t})),u[I]===void 0&&(u[I]=q),q!==null&&t.setBaseTarget(I,q))}}function QD(t,o){return o?(o[t]||o.default||o).from:void 0}function eL(t,o,u){const m={};for(const v in t){const b=QD(v,o);if(b!==void 0)m[v]=b;else{const C=u.getValue(v);C&&(m[v]=C.get())}}return m}function tL({protectedKeys:t,needsAnimating:o},u){const m=t.hasOwnProperty(u)&&o[u]!==!0;return o[u]=!1,m}function pC(t,o,{delay:u=0,transitionOverride:m,type:v}={}){let{transition:b=t.getDefaultTransition(),transitionEnd:C,...a}=t.makeTargetAnimatable(o);const I=t.getValue("willChange");m&&(b=m);const O=[],q=v&&t.animationState&&t.animationState.getState()[v];for(const G in a){const H=t.getValue(G),ue=a[G];if(!H||ue===void 0||q&&tL(q,G))continue;const _e={delay:u,elapsed:0,...b};if(window.HandoffAppearAnimations&&!H.hasAnimated){const at=t.getProps()[Oz];at&&(_e.elapsed=window.HandoffAppearAnimations(at,G,H,Dn),_e.syncStart=!0)}H.start(nx(G,H,ue,t.shouldReduceMotion&&Hl.has(G)?{type:!1}:_e));const Ie=H.animation;Ym(I)&&(I.add(G),Ie.then(()=>I.remove(G))),O.push(Ie)}return C&&Promise.all(O).then(()=>{C&&YD(t,C)}),O}function O0(t,o,u={}){const m=wg(t,o,u.custom);let{transition:v=t.getDefaultTransition()||{}}=m||{};u.transitionOverride&&(v=u.transitionOverride);const b=m?()=>Promise.all(pC(t,m,u)):()=>Promise.resolve(),C=t.variantChildren&&t.variantChildren.size?(I=0)=>{const{delayChildren:O=0,staggerChildren:q,staggerDirection:G}=v;return nL(t,o,O+I,q,G,u)}:()=>Promise.resolve(),{when:a}=v;if(a){const[I,O]=a==="beforeChildren"?[b,C]:[C,b];return I().then(()=>O())}else return Promise.all([b(),C(u.delay)])}function nL(t,o,u=0,m=0,v=1,b){const C=[],a=(t.variantChildren.size-1)*m,I=v===1?(O=0)=>O*m:(O=0)=>a-O*m;return Array.from(t.variantChildren).sort(iL).forEach((O,q)=>{O.notify("AnimationStart",o),C.push(O0(O,o,{...b,delay:u+I(q)}).then(()=>O.notify("AnimationComplete",o)))}),Promise.all(C)}function iL(t,o){return t.sortNodePosition(o)}function rL(t,o,u={}){t.notify("AnimationStart",o);let m;if(Array.isArray(o)){const v=o.map(b=>O0(t,b,u));m=Promise.all(v)}else if(typeof o=="string")m=O0(t,o,u);else{const v=typeof o=="function"?wg(t,o,u.custom):o;m=Promise.all(pC(t,v,u))}return m.then(()=>t.notify("AnimationComplete",o))}const oL=[...Nv].reverse(),sL=Nv.length;function aL(t){return o=>Promise.all(o.map(({animation:u,options:m})=>rL(t,u,m)))}function lL(t){let o=aL(t);const u=uL();let m=!0;const v=(I,O)=>{const q=wg(t,O);if(q){const{transition:G,transitionEnd:H,...ue}=q;I={...I,...ue,...H}}return I};function b(I){o=I(t)}function C(I,O){const q=t.getProps(),G=t.getVariantContext(!0)||{},H=[],ue=new Set;let _e={},Ie=1/0;for(let me=0;me<sL;me++){const ne=oL[me],le=u[ne],ke=q[ne]!==void 0?q[ne]:G[ne],je=tp(ke),ct=ne===O?le.isActive:null;ct===!1&&(Ie=me);let it=ke===G[ne]&&ke!==q[ne]&&je;if(it&&m&&t.manuallyAnimateOnMount&&(it=!1),le.protectedKeys={..._e},!le.isActive&&ct===null||!ke&&!le.prevProp||_g(ke)||typeof ke=="boolean")continue;const Qe=cL(le.prevProp,ke);let Be=Qe||ne===O&&le.isActive&&!it&&je||me>Ie&&je;const St=Array.isArray(ke)?ke:[ke];let bn=St.reduce(v,{});ct===!1&&(bn={});const{prevResolvedValues:bt={}}=le,Jt={...bt,...bn},Tn=vn=>{Be=!0,ue.delete(vn),le.needsAnimating[vn]=!0};for(const vn in Jt){const ii=bn[vn],Mi=bt[vn];_e.hasOwnProperty(vn)||(ii!==Mi?Wm(ii)&&Wm(Mi)?!RS(ii,Mi)||Qe?Tn(vn):le.protectedKeys[vn]=!0:ii!==void 0?Tn(vn):ue.add(vn):ii!==void 0&&ue.has(vn)?Tn(vn):le.protectedKeys[vn]=!0)}le.prevProp=ke,le.prevResolvedValues=bn,le.isActive&&(_e={..._e,...bn}),m&&t.blockInitialAnimation&&(Be=!1),Be&&!it&&H.push(...St.map(vn=>({animation:vn,options:{type:ne,...I}})))}if(ue.size){const me={};ue.forEach(ne=>{const le=t.getBaseTarget(ne);le!==void 0&&(me[ne]=le)}),H.push({animation:me})}let at=!!H.length;return m&&q.initial===!1&&!t.manuallyAnimateOnMount&&(at=!1),m=!1,at?o(H):Promise.resolve()}function a(I,O,q){var G;if(u[I].isActive===O)return Promise.resolve();(G=t.variantChildren)===null||G===void 0||G.forEach(ue=>{var _e;return(_e=ue.animationState)===null||_e===void 0?void 0:_e.setActive(I,O)}),u[I].isActive=O;const H=C(q,I);for(const ue in u)u[ue].protectedKeys={};return H}return{animateChanges:C,setActive:a,setAnimateFunction:b,getState:()=>u}}function cL(t,o){return typeof o=="string"?o!==t:Array.isArray(o)?!RS(o,t):!1}function kl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function uL(){return{animate:kl(!0),whileInView:kl(),whileHover:kl(),whileTap:kl(),whileDrag:kl(),whileFocus:kl(),exit:kl()}}class hL extends Oa{constructor(o){super(o),o.animationState||(o.animationState=lL(o))}updateAnimationControlsSubscription(){const{animate:o}=this.node.getProps();this.unmount(),_g(o)&&(this.unmount=o.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:o}=this.node.getProps(),{animate:u}=this.node.prevProps||{};o!==u&&this.updateAnimationControlsSubscription()}unmount(){}}let dL=0;class pL extends Oa{constructor(){super(...arguments),this.id=dL++}update(){if(!this.node.presenceContext)return;const{isPresent:o,onExitComplete:u,custom:m}=this.node.presenceContext,{isPresent:v}=this.node.prevPresenceContext||{};if(!this.node.animationState||o===v)return;const b=this.node.animationState.setActive("exit",!o,{custom:m??this.node.getProps().custom});u&&!o&&b.then(()=>u(this.id))}mount(){const{register:o}=this.node.presenceContext||{};o&&(this.unmount=o(this.id))}unmount(){}}const fL={animation:{Feature:hL},exit:{Feature:pL}},lT=(t,o)=>Math.abs(t-o);function mL(t,o){const u=lT(t.x,o.x),m=lT(t.y,o.y);return Math.sqrt(u**2+m**2)}class fC{constructor(o,u,{transformPagePoint:m}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=By(this.lastMoveEventInfo,this.history),q=this.startEvent!==null,G=mL(O.offset,{x:0,y:0})>=3;if(!q&&!G)return;const{point:H}=O,{timestamp:ue}=Ei;this.history.push({...H,timestamp:ue});const{onStart:_e,onMove:Ie}=this.handlers;q||(_e&&_e(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),Ie&&Ie(this.lastMoveEvent,O)},this.handlePointerMove=(O,q)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=Ry(q,this.transformPagePoint),Dn.update(this.updatePoint,!0)},this.handlePointerUp=(O,q)=>{if(this.end(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const{onEnd:G,onSessionEnd:H}=this.handlers,ue=By(O.type==="pointercancel"?this.lastMoveEventInfo:Ry(q,this.transformPagePoint),this.history);this.startEvent&&G&&G(O,ue),H&&H(O,ue)},!IS(o))return;this.handlers=u,this.transformPagePoint=m;const v=xg(o),b=Ry(v,this.transformPagePoint),{point:C}=b,{timestamp:a}=Ei;this.history=[{...C,timestamp:a}];const{onSessionStart:I}=u;I&&I(o,By(b,this.history)),this.removeListeners=Pa(Ts(window,"pointermove",this.handlePointerMove),Ts(window,"pointerup",this.handlePointerUp),Ts(window,"pointercancel",this.handlePointerUp))}updateHandlers(o){this.handlers=o}end(){this.removeListeners&&this.removeListeners(),Ps(this.updatePoint)}}function Ry(t,o){return o?{point:o(t.point)}:t}function cT(t,o){return{x:t.x-o.x,y:t.y-o.y}}function By({point:t},o){return{point:t,delta:cT(t,mC(o)),offset:cT(t,gL(o)),velocity:_L(o,.1)}}function gL(t){return t[0]}function mC(t){return t[t.length-1]}function _L(t,o){if(t.length<2)return{x:0,y:0};let u=t.length-1,m=null;const v=mC(t);for(;u>=0&&(m=t[u],!(v.timestamp-m.timestamp>Ia(o)));)u--;if(!m)return{x:0,y:0};const b=Es(v.timestamp-m.timestamp);if(b===0)return{x:0,y:0};const C={x:(v.x-m.x)/b,y:(v.y-m.y)/b};return C.x===1/0&&(C.x=0),C.y===1/0&&(C.y=0),C}function Ir(t){return t.max-t.min}function V0(t,o=0,u=.01){return Math.abs(t-o)<=u}function uT(t,o,u,m=.5){t.origin=m,t.originPoint=Xn(o.min,o.max,t.origin),t.scale=Ir(u)/Ir(o),(V0(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=Xn(u.min,u.max,t.origin)-t.originPoint,(V0(t.translate)||isNaN(t.translate))&&(t.translate=0)}function Bd(t,o,u,m){uT(t.x,o.x,u.x,m?m.originX:void 0),uT(t.y,o.y,u.y,m?m.originY:void 0)}function hT(t,o,u){t.min=u.min+o.min,t.max=t.min+Ir(o)}function yL(t,o,u){hT(t.x,o.x,u.x),hT(t.y,o.y,u.y)}function dT(t,o,u){t.min=o.min-u.min,t.max=t.min+Ir(o)}function Fd(t,o,u){dT(t.x,o.x,u.x),dT(t.y,o.y,u.y)}function vL(t,{min:o,max:u},m){return o!==void 0&&t<o?t=m?Xn(o,t,m.min):Math.max(t,o):u!==void 0&&t>u&&(t=m?Xn(u,t,m.max):Math.min(t,u)),t}function pT(t,o,u){return{min:o!==void 0?t.min+o:void 0,max:u!==void 0?t.max+u-(t.max-t.min):void 0}}function xL(t,{top:o,left:u,bottom:m,right:v}){return{x:pT(t.x,u,v),y:pT(t.y,o,m)}}function fT(t,o){let u=o.min-t.min,m=o.max-t.max;return o.max-o.min<t.max-t.min&&([u,m]=[m,u]),{min:u,max:m}}function wL(t,o){return{x:fT(t.x,o.x),y:fT(t.y,o.y)}}function bL(t,o){let u=.5;const m=Ir(t),v=Ir(o);return v>m?u=ip(o.min,o.max-m,t.min):m>v&&(u=ip(t.min,t.max-v,o.min)),Da(0,1,u)}function TL(t,o){const u={};return o.min!==void 0&&(u.min=o.min-t.min),o.max!==void 0&&(u.max=o.max-t.min),u}const U0=.35;function EL(t=U0){return t===!1?t=0:t===!0&&(t=U0),{x:mT(t,"left","right"),y:mT(t,"top","bottom")}}function mT(t,o,u){return{min:gT(t,o),max:gT(t,u)}}function gT(t,o){return typeof t=="number"?t:t[o]||0}const _T=()=>({translate:0,scale:1,origin:0,originPoint:0}),pu=()=>({x:_T(),y:_T()}),yT=()=>({min:0,max:0}),ui=()=>({x:yT(),y:yT()});function Go(t){return[t("x"),t("y")]}function gC({top:t,left:o,right:u,bottom:m}){return{x:{min:o,max:u},y:{min:t,max:m}}}function SL({x:t,y:o}){return{top:o.min,right:t.max,bottom:o.max,left:t.min}}function CL(t,o){if(!o)return t;const u=o({x:t.left,y:t.top}),m=o({x:t.right,y:t.bottom});return{top:u.y,left:u.x,bottom:m.y,right:m.x}}function Fy(t){return t===void 0||t===1}function N0({scale:t,scaleX:o,scaleY:u}){return!Fy(t)||!Fy(o)||!Fy(u)}function Ll(t){return N0(t)||_C(t)||t.z||t.rotate||t.rotateX||t.rotateY}function _C(t){return vT(t.x)||vT(t.y)}function vT(t){return t&&t!=="0%"}function Jm(t,o,u){const m=t-u,v=o*m;return u+v}function xT(t,o,u,m,v){return v!==void 0&&(t=Jm(t,v,m)),Jm(t,u,m)+o}function j0(t,o=0,u=1,m,v){t.min=xT(t.min,o,u,m,v),t.max=xT(t.max,o,u,m,v)}function yC(t,{x:o,y:u}){j0(t.x,o.translate,o.scale,o.originPoint),j0(t.y,u.translate,u.scale,u.originPoint)}function ML(t,o,u,m=!1){const v=u.length;if(!v)return;o.x=o.y=1;let b,C;for(let a=0;a<v;a++){b=u[a],C=b.projectionDelta;const I=b.instance;I&&I.style&&I.style.display==="contents"||(m&&b.options.layoutScroll&&b.scroll&&b!==b.root&&fu(t,{x:-b.scroll.offset.x,y:-b.scroll.offset.y}),C&&(o.x*=C.x.scale,o.y*=C.y.scale,yC(t,C)),m&&Ll(b.latestValues)&&fu(t,b.latestValues))}o.x=wT(o.x),o.y=wT(o.y)}function wT(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function ga(t,o){t.min=t.min+o,t.max=t.max+o}function bT(t,o,[u,m,v]){const b=o[v]!==void 0?o[v]:.5,C=Xn(t.min,t.max,b);j0(t,o[u],o[m],C,o.scale)}const AL=["x","scaleX","originX"],PL=["y","scaleY","originY"];function fu(t,o){bT(t.x,o,AL),bT(t.y,o,PL)}function vC(t,o){return gC(CL(t.getBoundingClientRect(),o))}function IL(t,o,u){const m=vC(t,u),{scroll:v}=o;return v&&(ga(m.x,v.offset.x),ga(m.y,v.offset.y)),m}const kL=new WeakMap;class zL{constructor(o){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ui(),this.visualElement=o}start(o,{snapToCursor:u=!1}={}){const{presenceContext:m}=this.visualElement;if(m&&m.isPresent===!1)return;const v=I=>{this.stopAnimation(),u&&this.snapToCursor(xg(I,"page").point)},b=(I,O)=>{const{drag:q,dragPropagation:G,onDragStart:H}=this.getProps();if(q&&!G&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=zS(q),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Go(_e=>{let Ie=this.getAxisMotionValue(_e).get()||0;if(Wo.test(Ie)){const{projection:at}=this.visualElement;if(at&&at.layout){const me=at.layout.layoutBox[_e];me&&(Ie=Ir(me)*(parseFloat(Ie)/100))}}this.originPoint[_e]=Ie}),H&&Dn.update(()=>H(I,O),!1,!0);const{animationState:ue}=this.visualElement;ue&&ue.setActive("whileDrag",!0)},C=(I,O)=>{const{dragPropagation:q,dragDirectionLock:G,onDirectionLock:H,onDrag:ue}=this.getProps();if(!q&&!this.openGlobalLock)return;const{offset:_e}=O;if(G&&this.currentDirection===null){this.currentDirection=DL(_e),this.currentDirection!==null&&H&&H(this.currentDirection);return}this.updateAxis("x",O.point,_e),this.updateAxis("y",O.point,_e),this.visualElement.render(),ue&&ue(I,O)},a=(I,O)=>this.stop(I,O);this.panSession=new fC(o,{onSessionStart:v,onStart:b,onMove:C,onSessionEnd:a},{transformPagePoint:this.visualElement.getTransformPagePoint()})}stop(o,u){const m=this.isDragging;if(this.cancel(),!m)return;const{velocity:v}=u;this.startAnimation(v);const{onDragEnd:b}=this.getProps();b&&Dn.update(()=>b(o,u))}cancel(){this.isDragging=!1;const{projection:o,animationState:u}=this.visualElement;o&&(o.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:m}=this.getProps();!m&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),u&&u.setActive("whileDrag",!1)}updateAxis(o,u,m){const{drag:v}=this.getProps();if(!m||!om(o,v,this.currentDirection))return;const b=this.getAxisMotionValue(o);let C=this.originPoint[o]+m[o];this.constraints&&this.constraints[o]&&(C=vL(C,this.constraints[o],this.elastic[o])),b.set(C)}resolveConstraints(){const{dragConstraints:o,dragElastic:u}=this.getProps(),{layout:m}=this.visualElement.projection||{},v=this.constraints;o&&hu(o)?this.constraints||(this.constraints=this.resolveRefConstraints()):o&&m?this.constraints=xL(m.layoutBox,o):this.constraints=!1,this.elastic=EL(u),v!==this.constraints&&m&&this.constraints&&!this.hasMutatedConstraints&&Go(b=>{this.getAxisMotionValue(b)&&(this.constraints[b]=TL(m.layoutBox[b],this.constraints[b]))})}resolveRefConstraints(){const{dragConstraints:o,onMeasureDragConstraints:u}=this.getProps();if(!o||!hu(o))return!1;const m=o.current,{projection:v}=this.visualElement;if(!v||!v.layout)return!1;const b=IL(m,v.root,this.visualElement.getTransformPagePoint());let C=wL(v.layout.layoutBox,b);if(u){const a=u(SL(C));this.hasMutatedConstraints=!!a,a&&(C=gC(a))}return C}startAnimation(o){const{drag:u,dragMomentum:m,dragElastic:v,dragTransition:b,dragSnapToOrigin:C,onDragTransitionEnd:a}=this.getProps(),I=this.constraints||{},O=Go(q=>{if(!om(q,u,this.currentDirection))return;let G=I&&I[q]||{};C&&(G={min:0,max:0});const H=v?200:1e6,ue=v?40:1e7,_e={type:"inertia",velocity:m?o[q]:0,bounceStiffness:H,bounceDamping:ue,timeConstant:750,restDelta:1,restSpeed:10,...b,...G};return this.startAxisValueAnimation(q,_e)});return Promise.all(O).then(a)}startAxisValueAnimation(o,u){const m=this.getAxisMotionValue(o);return m.start(nx(o,m,0,u))}stopAnimation(){Go(o=>this.getAxisMotionValue(o).stop())}getAxisMotionValue(o){const u="_drag"+o.toUpperCase(),m=this.visualElement.getProps(),v=m[u];return v||this.visualElement.getValue(o,(m.initial?m.initial[o]:void 0)||0)}snapToCursor(o){Go(u=>{const{drag:m}=this.getProps();if(!om(u,m,this.currentDirection))return;const{projection:v}=this.visualElement,b=this.getAxisMotionValue(u);if(v&&v.layout){const{min:C,max:a}=v.layout.layoutBox[u];b.set(o[u]-Xn(C,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:o,dragConstraints:u}=this.getProps(),{projection:m}=this.visualElement;if(!hu(u)||!m||!this.constraints)return;this.stopAnimation();const v={x:0,y:0};Go(C=>{const a=this.getAxisMotionValue(C);if(a){const I=a.get();v[C]=bL({min:I,max:I},this.constraints[C])}});const{transformTemplate:b}=this.visualElement.getProps();this.visualElement.current.style.transform=b?b({},""):"none",m.root&&m.root.updateScroll(),m.updateLayout(),this.resolveConstraints(),Go(C=>{if(!om(C,o,null))return;const a=this.getAxisMotionValue(C),{min:I,max:O}=this.constraints[C];a.set(Xn(I,O,v[C]))})}addListeners(){if(!this.visualElement.current)return;kL.set(this.visualElement,this);const o=this.visualElement.current,u=Ts(o,"pointerdown",I=>{const{drag:O,dragListener:q=!0}=this.getProps();O&&q&&this.start(I)}),m=()=>{const{dragConstraints:I}=this.getProps();hu(I)&&(this.constraints=this.resolveRefConstraints())},{projection:v}=this.visualElement,b=v.addEventListener("measure",m);v&&!v.layout&&(v.root&&v.root.updateScroll(),v.updateLayout()),m();const C=ws(window,"resize",()=>this.scalePositionWithinConstraints()),a=v.addEventListener("didUpdate",({delta:I,hasLayoutChanged:O})=>{this.isDragging&&O&&(Go(q=>{const G=this.getAxisMotionValue(q);G&&(this.originPoint[q]+=I[q].translate,G.set(G.get()+I[q].translate))}),this.visualElement.render())});return()=>{C(),u(),b(),a&&a()}}getProps(){const o=this.visualElement.getProps(),{drag:u=!1,dragDirectionLock:m=!1,dragPropagation:v=!1,dragConstraints:b=!1,dragElastic:C=U0,dragMomentum:a=!0}=o;return{...o,drag:u,dragDirectionLock:m,dragPropagation:v,dragConstraints:b,dragElastic:C,dragMomentum:a}}}function om(t,o,u){return(o===!0||o===t)&&(u===null||u===t)}function DL(t,o=10){let u=null;return Math.abs(t.y)>o?u="y":Math.abs(t.x)>o&&(u="x"),u}class LL extends Oa{constructor(o){super(o),this.removeGroupControls=ei,this.removeListeners=ei,this.controls=new zL(o)}mount(){const{dragControls:o}=this.node.getProps();o&&(this.removeGroupControls=o.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ei}unmount(){this.removeGroupControls(),this.removeListeners()}}const TT=t=>(o,u)=>{t&&Dn.update(()=>t(o,u))};class RL extends Oa{constructor(){super(...arguments),this.removePointerDownListener=ei}onPointerDown(o){this.session=new fC(o,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint()})}createPanHandlers(){const{onPanSessionStart:o,onPanStart:u,onPan:m,onPanEnd:v}=this.node.getProps();return{onSessionStart:TT(o),onStart:TT(u),onMove:m,onEnd:(b,C)=>{delete this.session,v&&Dn.update(()=>v(b,C))}}}mount(){this.removePointerDownListener=Ts(this.node.current,"pointerdown",o=>this.onPointerDown(o))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function BL(){const t=Rt.useContext(Uv);if(t===null)return[!0,null];const{isPresent:o,onExitComplete:u,register:m}=t,v=Rt.useId();return Rt.useEffect(()=>m(v),[]),!o&&u?[!1,()=>u&&u(v)]:[!0]}const vm={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function ET(t,o){return o.max===o.min?0:t/(o.max-o.min)*100}const vd={correct:(t,o)=>{if(!o.target)return t;if(typeof t=="string")if(Lt.test(t))t=parseFloat(t);else return t;const u=ET(t,o.target.x),m=ET(t,o.target.y);return`${u}% ${m}%`}},FL={correct:(t,{treeScale:o,projectionDelta:u})=>{const m=t,v=La.parse(t);if(v.length>5)return m;const b=La.createTransformer(t),C=typeof v[0]!="number"?1:0,a=u.x.scale*o.x,I=u.y.scale*o.y;v[0+C]/=a,v[1+C]/=I;const O=Xn(a,I,.5);return typeof v[2+C]=="number"&&(v[2+C]/=O),typeof v[3+C]=="number"&&(v[3+C]/=O),b(v)}};class OL extends H0.Component{componentDidMount(){const{visualElement:o,layoutGroup:u,switchLayoutGroup:m,layoutId:v}=this.props,{projection:b}=o;$k(VL),b&&(u.group&&u.group.add(b),m&&m.register&&v&&m.register(b),b.root.didUpdate(),b.addEventListener("animationComplete",()=>{this.safeToRemove()}),b.setOptions({...b.options,onExitComplete:()=>this.safeToRemove()})),vm.hasEverUpdated=!0}getSnapshotBeforeUpdate(o){const{layoutDependency:u,visualElement:m,drag:v,isPresent:b}=this.props,C=m.projection;return C&&(C.isPresent=b,v||o.layoutDependency!==u||u===void 0?C.willUpdate():this.safeToRemove(),o.isPresent!==b&&(b?C.promote():C.relegate()||Dn.postRender(()=>{const a=C.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:o}=this.props.visualElement;o&&(o.root.didUpdate(),queueMicrotask(()=>{!o.currentAnimation&&o.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:o,layoutGroup:u,switchLayoutGroup:m}=this.props,{projection:v}=o;v&&(v.scheduleCheckAfterUnmount(),u&&u.group&&u.group.remove(v),m&&m.deregister&&m.deregister(v))}safeToRemove(){const{safeToRemove:o}=this.props;o&&o()}render(){return null}}function xC(t){const[o,u]=BL(),m=Rt.useContext(mS);return H0.createElement(OL,{...t,layoutGroup:m,switchLayoutGroup:Rt.useContext(gS),isPresent:o,safeToRemove:u})}const VL={borderRadius:{...vd,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:vd,borderTopRightRadius:vd,borderBottomLeftRadius:vd,borderBottomRightRadius:vd,boxShadow:FL},wC=["TopLeft","TopRight","BottomLeft","BottomRight"],UL=wC.length,ST=t=>typeof t=="string"?parseFloat(t):t,CT=t=>typeof t=="number"||Lt.test(t);function NL(t,o,u,m,v,b){v?(t.opacity=Xn(0,u.opacity!==void 0?u.opacity:1,jL(m)),t.opacityExit=Xn(o.opacity!==void 0?o.opacity:1,0,GL(m))):b&&(t.opacity=Xn(o.opacity!==void 0?o.opacity:1,u.opacity!==void 0?u.opacity:1,m));for(let C=0;C<UL;C++){const a=`border${wC[C]}Radius`;let I=MT(o,a),O=MT(u,a);if(I===void 0&&O===void 0)continue;I||(I=0),O||(O=0),I===0||O===0||CT(I)===CT(O)?(t[a]=Math.max(Xn(ST(I),ST(O),m),0),(Wo.test(O)||Wo.test(I))&&(t[a]+="%")):t[a]=O}(o.rotate||u.rotate)&&(t.rotate=Xn(o.rotate||0,u.rotate||0,m))}function MT(t,o){return t[o]!==void 0?t[o]:t.borderRadius}const jL=bC(0,.5,Jv),GL=bC(.5,.95,ei);function bC(t,o,u){return m=>m<t?0:m>o?1:u(ip(t,o,m))}function AT(t,o){t.min=o.min,t.max=o.max}function $r(t,o){AT(t.x,o.x),AT(t.y,o.y)}function PT(t,o,u,m,v){return t-=o,t=Jm(t,1/u,m),v!==void 0&&(t=Jm(t,1/v,m)),t}function $L(t,o=0,u=1,m=.5,v,b=t,C=t){if(Wo.test(o)&&(o=parseFloat(o),o=Xn(C.min,C.max,o/100)-C.min),typeof o!="number")return;let a=Xn(b.min,b.max,m);t===b&&(a-=o),t.min=PT(t.min,o,u,a,v),t.max=PT(t.max,o,u,a,v)}function IT(t,o,[u,m,v],b,C){$L(t,o[u],o[m],o[v],o.scale,b,C)}const ZL=["x","scaleX","originX"],qL=["y","scaleY","originY"];function kT(t,o,u,m){IT(t.x,o,ZL,u?u.x:void 0,m?m.x:void 0),IT(t.y,o,qL,u?u.y:void 0,m?m.y:void 0)}function zT(t){return t.translate===0&&t.scale===1}function TC(t){return zT(t.x)&&zT(t.y)}function WL(t,o){return t.x.min===o.x.min&&t.x.max===o.x.max&&t.y.min===o.y.min&&t.y.max===o.y.max}function EC(t,o){return Math.round(t.x.min)===Math.round(o.x.min)&&Math.round(t.x.max)===Math.round(o.x.max)&&Math.round(t.y.min)===Math.round(o.y.min)&&Math.round(t.y.max)===Math.round(o.y.max)}function DT(t){return Ir(t.x)/Ir(t.y)}class XL{constructor(){this.members=[]}add(o){ix(this.members,o),o.scheduleRender()}remove(o){if(rx(this.members,o),o===this.prevLead&&(this.prevLead=void 0),o===this.lead){const u=this.members[this.members.length-1];u&&this.promote(u)}}relegate(o){const u=this.members.findIndex(v=>o===v);if(u===0)return!1;let m;for(let v=u;v>=0;v--){const b=this.members[v];if(b.isPresent!==!1){m=b;break}}return m?(this.promote(m),!0):!1}promote(o,u){const m=this.lead;if(o!==m&&(this.prevLead=m,this.lead=o,o.show(),m)){m.instance&&m.scheduleRender(),o.scheduleRender(),o.resumeFrom=m,u&&(o.resumeFrom.preserveOpacity=!0),m.snapshot&&(o.snapshot=m.snapshot,o.snapshot.latestValues=m.animationValues||m.latestValues),o.root&&o.root.isUpdating&&(o.isLayoutDirty=!0);const{crossfade:v}=o.options;v===!1&&m.hide()}}exitAnimationComplete(){this.members.forEach(o=>{const{options:u,resumingFrom:m}=o;u.onExitComplete&&u.onExitComplete(),m&&m.options.onExitComplete&&m.options.onExitComplete()})}scheduleRender(){this.members.forEach(o=>{o.instance&&o.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function LT(t,o,u){let m="";const v=t.x.translate/o.x,b=t.y.translate/o.y;if((v||b)&&(m=`translate3d(${v}px, ${b}px, 0) `),(o.x!==1||o.y!==1)&&(m+=`scale(${1/o.x}, ${1/o.y}) `),u){const{rotate:I,rotateX:O,rotateY:q}=u;I&&(m+=`rotate(${I}deg) `),O&&(m+=`rotateX(${O}deg) `),q&&(m+=`rotateY(${q}deg) `)}const C=t.x.scale*o.x,a=t.y.scale*o.y;return(C!==1||a!==1)&&(m+=`scale(${C}, ${a})`),m||"none"}const HL=(t,o)=>t.depth-o.depth;class KL{constructor(){this.children=[],this.isDirty=!1}add(o){ix(this.children,o),this.isDirty=!0}remove(o){rx(this.children,o),this.isDirty=!0}forEach(o){this.isDirty&&this.children.sort(HL),this.isDirty=!1,this.children.forEach(o)}}function YL(t,o){const u=performance.now(),m=({timestamp:v})=>{const b=v-u;b>=o&&(Ps(m),t(b-o))};return Dn.read(m,!0),()=>Ps(m)}function JL(t){window.MotionDebug&&window.MotionDebug.record(t)}function QL(t){return t instanceof SVGElement&&t.tagName!=="svg"}function eR(t,o,u){const m=_r(t)?t:Au(t);return m.start(nx("",m,o,u)),m.animation}const RT=["","X","Y","Z"],BT=1e3;let tR=0;const Rl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function SC({attachResizeListener:t,defaultParent:o,measureScroll:u,checkIsScrollRoot:m,resetTransform:v}){return class{constructor(C={},a=o==null?void 0:o()){this.id=tR++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{Rl.totalNodes=Rl.resolvedTargetDeltas=Rl.recalculatedProjection=0,this.nodes.forEach(rR),this.nodes.forEach(cR),this.nodes.forEach(uR),this.nodes.forEach(oR),JL(Rl)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=C,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let I=0;I<this.path.length;I++)this.path[I].shouldResetTransform=!0;this.root===this&&(this.nodes=new KL)}addEventListener(C,a){return this.eventHandlers.has(C)||this.eventHandlers.set(C,new ox),this.eventHandlers.get(C).add(a)}notifyListeners(C,...a){const I=this.eventHandlers.get(C);I&&I.notify(...a)}hasListeners(C){return this.eventHandlers.has(C)}mount(C,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=QL(C),this.instance=C;const{layoutId:I,layout:O,visualElement:q}=this.options;if(q&&!q.current&&q.mount(C),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(O||I)&&(this.isLayoutDirty=!0),t){let G;const H=()=>this.root.updateBlockedByResize=!1;t(C,()=>{this.root.updateBlockedByResize=!0,G&&G(),G=YL(H,250),vm.hasAnimatedSinceResize&&(vm.hasAnimatedSinceResize=!1,this.nodes.forEach(OT))})}I&&this.root.registerSharedNode(I,this),this.options.animate!==!1&&q&&(I||O)&&this.addEventListener("didUpdate",({delta:G,hasLayoutChanged:H,hasRelativeTargetChanged:ue,layout:_e})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Ie=this.options.transition||q.getDefaultTransition()||mR,{onLayoutAnimationStart:at,onLayoutAnimationComplete:me}=q.getProps(),ne=!this.targetLayout||!EC(this.targetLayout,_e)||ue,le=!H&&ue;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||le||H&&(ne||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(G,le);const ke={...cC(Ie,"layout"),onPlay:at,onComplete:me};(q.shouldReduceMotion||this.options.layoutRoot)&&(ke.delay=0,ke.type=!1),this.startAnimation(ke)}else H||OT(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=_e})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const C=this.getStack();C&&C.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ps(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(hR),this.animationId++)}getTransformTemplate(){const{visualElement:C}=this.options;return C&&C.getProps().transformTemplate}willUpdate(C=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let q=0;q<this.path.length;q++){const G=this.path[q];G.shouldResetTransform=!0,G.updateScroll("snapshot"),G.options.layoutRoot&&G.willUpdate(!1)}const{layoutId:a,layout:I}=this.options;if(a===void 0&&!I)return;const O=this.getTransformTemplate();this.prevTransformTemplateValue=O?O(this.latestValues,""):void 0,this.updateSnapshot(),C&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(FT);return}this.isUpdating||this.nodes.forEach(aR),this.isUpdating=!1,this.nodes.forEach(lR),this.nodes.forEach(nR),this.nodes.forEach(iR),this.clearAllSnapshots();const a=performance.now();Ei.delta=Da(0,1e3/60,a-Ei.timestamp),Ei.timestamp=a,Ei.isProcessing=!0,My.update.process(Ei),My.preRender.process(Ei),My.render.process(Ei),Ei.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(sR),this.sharedNodes.forEach(dR)}scheduleUpdateProjection(){Dn.preRender(this.updateProjection,!1,!0)}scheduleCheckAfterUnmount(){Dn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let I=0;I<this.path.length;I++)this.path[I].updateScroll();const C=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ui(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,C?C.layoutBox:void 0)}updateScroll(C="measure"){let a=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===C&&(a=!1),a&&(this.scroll={animationId:this.root.animationId,phase:C,isRoot:m(this.instance),offset:u(this.instance)})}resetTransform(){if(!v)return;const C=this.isLayoutDirty||this.shouldResetTransform,a=this.projectionDelta&&!TC(this.projectionDelta),I=this.getTransformTemplate(),O=I?I(this.latestValues,""):void 0,q=O!==this.prevTransformTemplateValue;C&&(a||Ll(this.latestValues)||q)&&(v(this.instance,O),this.shouldResetTransform=!1,this.scheduleRender())}measure(C=!0){const a=this.measurePageBox();let I=this.removeElementScroll(a);return C&&(I=this.removeTransform(I)),gR(I),{animationId:this.root.animationId,measuredBox:a,layoutBox:I,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:C}=this.options;if(!C)return ui();const a=C.measureViewportBox(),{scroll:I}=this.root;return I&&(ga(a.x,I.offset.x),ga(a.y,I.offset.y)),a}removeElementScroll(C){const a=ui();$r(a,C);for(let I=0;I<this.path.length;I++){const O=this.path[I],{scroll:q,options:G}=O;if(O!==this.root&&q&&G.layoutScroll){if(q.isRoot){$r(a,C);const{scroll:H}=this.root;H&&(ga(a.x,-H.offset.x),ga(a.y,-H.offset.y))}ga(a.x,q.offset.x),ga(a.y,q.offset.y)}}return a}applyTransform(C,a=!1){const I=ui();$r(I,C);for(let O=0;O<this.path.length;O++){const q=this.path[O];!a&&q.options.layoutScroll&&q.scroll&&q!==q.root&&fu(I,{x:-q.scroll.offset.x,y:-q.scroll.offset.y}),Ll(q.latestValues)&&fu(I,q.latestValues)}return Ll(this.latestValues)&&fu(I,this.latestValues),I}removeTransform(C){const a=ui();$r(a,C);for(let I=0;I<this.path.length;I++){const O=this.path[I];if(!O.instance||!Ll(O.latestValues))continue;N0(O.latestValues)&&O.updateSnapshot();const q=ui(),G=O.measurePageBox();$r(q,G),kT(a,O.latestValues,O.snapshot?O.snapshot.layoutBox:void 0,q)}return Ll(this.latestValues)&&kT(a,this.latestValues),a}setTargetDelta(C){this.targetDelta=C,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(C){this.options={...this.options,...C,crossfade:C.crossfade!==void 0?C.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ei.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(C=!1){var a;const I=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=I.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=I.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=I.isSharedProjectionDirty);const O=!!this.resumingFrom||this!==I;if(!(C||O&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:G,layoutId:H}=this.options;if(!(!this.layout||!(G||H))){if(this.resolvedRelativeTargetAt=Ei.timestamp,!this.targetDelta&&!this.relativeTarget){const ue=this.getClosestProjectingParent();ue&&ue.layout&&this.animationProgress!==1?(this.relativeParent=ue,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ui(),this.relativeTargetOrigin=ui(),Fd(this.relativeTargetOrigin,this.layout.layoutBox,ue.layout.layoutBox),$r(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=ui(),this.targetWithTransforms=ui()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),yL(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):$r(this.target,this.layout.layoutBox),yC(this.target,this.targetDelta)):$r(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const ue=this.getClosestProjectingParent();ue&&!!ue.resumingFrom==!!this.resumingFrom&&!ue.options.layoutScroll&&ue.target&&this.animationProgress!==1?(this.relativeParent=ue,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ui(),this.relativeTargetOrigin=ui(),Fd(this.relativeTargetOrigin,this.target,ue.target),$r(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Rl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||N0(this.parent.latestValues)||_C(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var C;const a=this.getLead(),I=!!this.resumingFrom||this!==a;let O=!0;if((this.isProjectionDirty||!((C=this.parent)===null||C===void 0)&&C.isProjectionDirty)&&(O=!1),I&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(O=!1),this.resolvedRelativeTargetAt===Ei.timestamp&&(O=!1),O)return;const{layout:q,layoutId:G}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(q||G))return;$r(this.layoutCorrected,this.layout.layoutBox);const H=this.treeScale.x,ue=this.treeScale.y;ML(this.layoutCorrected,this.treeScale,this.path,I),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox);const{target:_e}=a;if(!_e){this.projectionTransform&&(this.projectionDelta=pu(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=pu(),this.projectionDeltaWithTransform=pu());const Ie=this.projectionTransform;Bd(this.projectionDelta,this.layoutCorrected,_e,this.latestValues),this.projectionTransform=LT(this.projectionDelta,this.treeScale),(this.projectionTransform!==Ie||this.treeScale.x!==H||this.treeScale.y!==ue)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",_e)),Rl.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(C=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),C){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(C,a=!1){const I=this.snapshot,O=I?I.latestValues:{},q={...this.latestValues},G=pu();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const H=ui(),ue=I?I.source:void 0,_e=this.layout?this.layout.source:void 0,Ie=ue!==_e,at=this.getStack(),me=!at||at.members.length<=1,ne=!!(Ie&&!me&&this.options.crossfade===!0&&!this.path.some(fR));this.animationProgress=0;let le;this.mixTargetDelta=ke=>{const je=ke/1e3;VT(G.x,C.x,je),VT(G.y,C.y,je),this.setTargetDelta(G),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Fd(H,this.layout.layoutBox,this.relativeParent.layout.layoutBox),pR(this.relativeTarget,this.relativeTargetOrigin,H,je),le&&WL(this.relativeTarget,le)&&(this.isProjectionDirty=!1),le||(le=ui()),$r(le,this.relativeTarget)),Ie&&(this.animationValues=q,NL(q,O,this.latestValues,je,ne,me)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=je},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(C){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ps(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Dn.update(()=>{vm.hasAnimatedSinceResize=!0,this.currentAnimation=eR(0,BT,{...C,onUpdate:a=>{this.mixTargetDelta(a),C.onUpdate&&C.onUpdate(a)},onComplete:()=>{C.onComplete&&C.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const C=this.getStack();C&&C.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(BT),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const C=this.getLead();let{targetWithTransforms:a,target:I,layout:O,latestValues:q}=C;if(!(!a||!I||!O)){if(this!==C&&this.layout&&O&&CC(this.options.animationType,this.layout.layoutBox,O.layoutBox)){I=this.target||ui();const G=Ir(this.layout.layoutBox.x);I.x.min=C.target.x.min,I.x.max=I.x.min+G;const H=Ir(this.layout.layoutBox.y);I.y.min=C.target.y.min,I.y.max=I.y.min+H}$r(a,I),fu(a,q),Bd(this.projectionDeltaWithTransform,this.layoutCorrected,a,q)}}registerSharedNode(C,a){this.sharedNodes.has(C)||this.sharedNodes.set(C,new XL),this.sharedNodes.get(C).add(a);const O=a.options.initialPromotionConfig;a.promote({transition:O?O.transition:void 0,preserveFollowOpacity:O&&O.shouldPreserveFollowOpacity?O.shouldPreserveFollowOpacity(a):void 0})}isLead(){const C=this.getStack();return C?C.lead===this:!0}getLead(){var C;const{layoutId:a}=this.options;return a?((C=this.getStack())===null||C===void 0?void 0:C.lead)||this:this}getPrevLead(){var C;const{layoutId:a}=this.options;return a?(C=this.getStack())===null||C===void 0?void 0:C.prevLead:void 0}getStack(){const{layoutId:C}=this.options;if(C)return this.root.sharedNodes.get(C)}promote({needsReset:C,transition:a,preserveFollowOpacity:I}={}){const O=this.getStack();O&&O.promote(this,I),C&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const C=this.getStack();return C?C.relegate(this):!1}resetRotation(){const{visualElement:C}=this.options;if(!C)return;let a=!1;const{latestValues:I}=C;if((I.rotate||I.rotateX||I.rotateY||I.rotateZ)&&(a=!0),!a)return;const O={};for(let q=0;q<RT.length;q++){const G="rotate"+RT[q];I[G]&&(O[G]=I[G],C.setStaticValue(G,0))}C.render();for(const q in O)C.setStaticValue(q,O[q]);C.scheduleRender()}getProjectionStyles(C={}){var a,I;const O={};if(!this.instance||this.isSVG)return O;if(this.isVisible)O.visibility="";else return{visibility:"hidden"};const q=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,O.opacity="",O.pointerEvents=ym(C.pointerEvents)||"",O.transform=q?q(this.latestValues,""):"none",O;const G=this.getLead();if(!this.projectionDelta||!this.layout||!G.target){const Ie={};return this.options.layoutId&&(Ie.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,Ie.pointerEvents=ym(C.pointerEvents)||""),this.hasProjected&&!Ll(this.latestValues)&&(Ie.transform=q?q({},""):"none",this.hasProjected=!1),Ie}const H=G.animationValues||G.latestValues;this.applyTransformsToTarget(),O.transform=LT(this.projectionDeltaWithTransform,this.treeScale,H),q&&(O.transform=q(H,O.transform));const{x:ue,y:_e}=this.projectionDelta;O.transformOrigin=`${ue.origin*100}% ${_e.origin*100}% 0`,G.animationValues?O.opacity=G===this?(I=(a=H.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&I!==void 0?I:1:this.preserveOpacity?this.latestValues.opacity:H.opacityExit:O.opacity=G===this?H.opacity!==void 0?H.opacity:"":H.opacityExit!==void 0?H.opacityExit:0;for(const Ie in Zm){if(H[Ie]===void 0)continue;const{correct:at,applyTo:me}=Zm[Ie],ne=O.transform==="none"?H[Ie]:at(H[Ie],G);if(me){const le=me.length;for(let ke=0;ke<le;ke++)O[me[ke]]=ne}else O[Ie]=ne}return this.options.layoutId&&(O.pointerEvents=G===this?ym(C.pointerEvents)||"":"none"),O}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(C=>{var a;return(a=C.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(FT),this.root.sharedNodes.clear()}}}function nR(t){t.updateLayout()}function iR(t){var o;const u=((o=t.resumeFrom)===null||o===void 0?void 0:o.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&u&&t.hasListeners("didUpdate")){const{layoutBox:m,measuredBox:v}=t.layout,{animationType:b}=t.options,C=u.source!==t.layout.source;b==="size"?Go(G=>{const H=C?u.measuredBox[G]:u.layoutBox[G],ue=Ir(H);H.min=m[G].min,H.max=H.min+ue}):CC(b,u.layoutBox,m)&&Go(G=>{const H=C?u.measuredBox[G]:u.layoutBox[G],ue=Ir(m[G]);H.max=H.min+ue,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[G].max=t.relativeTarget[G].min+ue)});const a=pu();Bd(a,m,u.layoutBox);const I=pu();C?Bd(I,t.applyTransform(v,!0),u.measuredBox):Bd(I,m,u.layoutBox);const O=!TC(a);let q=!1;if(!t.resumeFrom){const G=t.getClosestProjectingParent();if(G&&!G.resumeFrom){const{snapshot:H,layout:ue}=G;if(H&&ue){const _e=ui();Fd(_e,u.layoutBox,H.layoutBox);const Ie=ui();Fd(Ie,m,ue.layoutBox),EC(_e,Ie)||(q=!0),G.options.layoutRoot&&(t.relativeTarget=Ie,t.relativeTargetOrigin=_e,t.relativeParent=G)}}}t.notifyListeners("didUpdate",{layout:m,snapshot:u,delta:I,layoutDelta:a,hasLayoutChanged:O,hasRelativeTargetChanged:q})}else if(t.isLead()){const{onExitComplete:m}=t.options;m&&m()}t.options.transition=void 0}function rR(t){Rl.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function oR(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function sR(t){t.clearSnapshot()}function FT(t){t.clearMeasurements()}function aR(t){t.isLayoutDirty=!1}function lR(t){const{visualElement:o}=t.options;o&&o.getProps().onBeforeLayoutMeasure&&o.notify("BeforeLayoutMeasure"),t.resetTransform()}function OT(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function cR(t){t.resolveTargetDelta()}function uR(t){t.calcProjection()}function hR(t){t.resetRotation()}function dR(t){t.removeLeadSnapshot()}function VT(t,o,u){t.translate=Xn(o.translate,0,u),t.scale=Xn(o.scale,1,u),t.origin=o.origin,t.originPoint=o.originPoint}function UT(t,o,u,m){t.min=Xn(o.min,u.min,m),t.max=Xn(o.max,u.max,m)}function pR(t,o,u,m){UT(t.x,o.x,u.x,m),UT(t.y,o.y,u.y,m)}function fR(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const mR={duration:.45,ease:[.4,0,.1,1]},NT=t=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(t),jT=NT("applewebkit/")&&!NT("chrome/")?Math.round:ei;function GT(t){t.min=jT(t.min),t.max=jT(t.max)}function gR(t){GT(t.x),GT(t.y)}function CC(t,o,u){return t==="position"||t==="preserve-aspect"&&!V0(DT(o),DT(u),.2)}const _R=SC({attachResizeListener:(t,o)=>ws(t,"resize",o),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Oy={current:void 0},MC=SC({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Oy.current){const t=new _R({});t.mount(window),t.setOptions({layoutScroll:!0}),Oy.current=t}return Oy.current},resetTransform:(t,o)=>{t.style.transform=o!==void 0?o:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),yR={pan:{Feature:RL},drag:{Feature:LL,ProjectionNode:MC,MeasureLayout:xC}},vR=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function xR(t){const o=vR.exec(t);if(!o)return[,];const[,u,m]=o;return[u,m]}function G0(t,o,u=1){const[m,v]=xR(t);if(!m)return;const b=window.getComputedStyle(o).getPropertyValue(m);if(b){const C=b.trim();return uC(C)?parseFloat(C):C}else return z0(v)?G0(v,o,u+1):v}function wR(t,{...o},u){const m=t.current;if(!(m instanceof Element))return{target:o,transitionEnd:u};u&&(u={...u}),t.values.forEach(v=>{const b=v.get();if(!z0(b))return;const C=G0(b,m);C&&v.set(C)});for(const v in o){const b=o[v];if(!z0(b))continue;const C=G0(b,m);C&&(o[v]=C,u||(u={}),u[v]===void 0&&(u[v]=b))}return{target:o,transitionEnd:u}}const bR=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),AC=t=>bR.has(t),TR=t=>Object.keys(t).some(AC),$T=t=>t===Kl||t===Lt,ZT=(t,o)=>parseFloat(t.split(", ")[o]),qT=(t,o)=>(u,{transform:m})=>{if(m==="none"||!m)return 0;const v=m.match(/^matrix3d\((.+)\)$/);if(v)return ZT(v[1],o);{const b=m.match(/^matrix\((.+)\)$/);return b?ZT(b[1],t):0}},ER=new Set(["x","y","z"]),SR=cp.filter(t=>!ER.has(t));function CR(t){const o=[];return SR.forEach(u=>{const m=t.getValue(u);m!==void 0&&(o.push([u,m.get()]),m.set(u.startsWith("scale")?1:0))}),o.length&&t.render(),o}const Pu={width:({x:t},{paddingLeft:o="0",paddingRight:u="0"})=>t.max-t.min-parseFloat(o)-parseFloat(u),height:({y:t},{paddingTop:o="0",paddingBottom:u="0"})=>t.max-t.min-parseFloat(o)-parseFloat(u),top:(t,{top:o})=>parseFloat(o),left:(t,{left:o})=>parseFloat(o),bottom:({y:t},{top:o})=>parseFloat(o)+(t.max-t.min),right:({x:t},{left:o})=>parseFloat(o)+(t.max-t.min),x:qT(4,13),y:qT(5,14)};Pu.translateX=Pu.x;Pu.translateY=Pu.y;const MR=(t,o,u)=>{const m=o.measureViewportBox(),v=o.current,b=getComputedStyle(v),{display:C}=b,a={};C==="none"&&o.setStaticValue("display",t.display||"block"),u.forEach(O=>{a[O]=Pu[O](m,b)}),o.render();const I=o.measureViewportBox();return u.forEach(O=>{const q=o.getValue(O);q&&q.jump(a[O]),t[O]=Pu[O](I,b)}),t},AR=(t,o,u={},m={})=>{o={...o},m={...m};const v=Object.keys(o).filter(AC);let b=[],C=!1;const a=[];if(v.forEach(I=>{const O=t.getValue(I);if(!t.hasValue(I))return;let q=u[I],G=yd(q);const H=o[I];let ue;if(Wm(H)){const _e=H.length,Ie=H[0]===null?1:0;q=H[Ie],G=yd(q);for(let at=Ie;at<_e&&H[at]!==null;at++)ue?Yv(yd(H[at])===ue):ue=yd(H[at])}else ue=yd(H);if(G!==ue)if($T(G)&&$T(ue)){const _e=O.get();typeof _e=="string"&&O.set(parseFloat(_e)),typeof H=="string"?o[I]=parseFloat(H):Array.isArray(H)&&ue===Lt&&(o[I]=H.map(parseFloat))}else G!=null&&G.transform&&(ue!=null&&ue.transform)&&(q===0||H===0)?q===0?O.set(ue.transform(q)):o[I]=G.transform(H):(C||(b=CR(t),C=!0),a.push(I),m[I]=m[I]!==void 0?m[I]:o[I],O.jump(H))}),a.length){const I=a.indexOf("height")>=0?window.pageYOffset:null,O=MR(o,t,a);return b.length&&b.forEach(([q,G])=>{t.getValue(q).set(G)}),t.render(),gg&&I!==null&&window.scrollTo({top:I}),{target:O,transitionEnd:m}}else return{target:o,transitionEnd:m}};function PR(t,o,u,m){return TR(o)?AR(t,o,u,m):{target:o,transitionEnd:m}}const IR=(t,o,u,m)=>{const v=wR(t,o,m);return o=v.target,m=v.transitionEnd,PR(t,o,u,m)},$0={current:null},PC={current:!1};function kR(){if(PC.current=!0,!!gg)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),o=()=>$0.current=t.matches;t.addListener(o),o()}else $0.current=!1}function zR(t,o,u){const{willChange:m}=o;for(const v in o){const b=o[v],C=u[v];if(_r(b))t.addValue(v,b),Ym(m)&&m.add(v);else if(_r(C))t.addValue(v,Au(b,{owner:t})),Ym(m)&&m.remove(v);else if(C!==b)if(t.hasValue(v)){const a=t.getValue(v);!a.hasAnimated&&a.set(b)}else{const a=t.getStaticValue(v);t.addValue(v,Au(a!==void 0?a:b,{owner:t}))}}for(const v in u)o[v]===void 0&&t.removeValue(v);return o}const WT=new WeakMap,IC=Object.keys(np),DR=IC.length,XT=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],LR=jv.length;class RR{constructor({parent:o,props:u,presenceContext:m,reducedMotionConfig:v,visualState:b},C={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Dn.render(this.render,!1,!0);const{latestValues:a,renderState:I}=b;this.latestValues=a,this.baseTarget={...a},this.initialValues=u.initial?{...a}:{},this.renderState=I,this.parent=o,this.props=u,this.presenceContext=m,this.depth=o?o.depth+1:0,this.reducedMotionConfig=v,this.options=C,this.isControllingVariants=yg(u),this.isVariantNode=fS(u),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(o&&o.current);const{willChange:O,...q}=this.scrapeMotionValuesFromProps(u,{});for(const G in q){const H=q[G];a[G]!==void 0&&_r(H)&&(H.set(a[G],!1),Ym(O)&&O.add(G))}}scrapeMotionValuesFromProps(o,u){return{}}mount(o){this.current=o,WT.set(o,this),this.projection&&!this.projection.instance&&this.projection.mount(o),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((u,m)=>this.bindToMotionValue(m,u)),PC.current||kR(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:$0.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){WT.delete(this.current),this.projection&&this.projection.unmount(),Ps(this.notifyUpdate),Ps(this.render),this.valueSubscriptions.forEach(o=>o()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const o in this.events)this.events[o].clear();for(const o in this.features)this.features[o].unmount();this.current=null}bindToMotionValue(o,u){const m=Hl.has(o),v=u.on("change",C=>{this.latestValues[o]=C,this.props.onUpdate&&Dn.update(this.notifyUpdate,!1,!0),m&&this.projection&&(this.projection.isTransformDirty=!0)}),b=u.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(o,()=>{v(),b()})}sortNodePosition(o){return!this.current||!this.sortInstanceNodePosition||this.type!==o.type?0:this.sortInstanceNodePosition(this.current,o.current)}loadFeatures({children:o,...u},m,v,b){let C,a;for(let I=0;I<DR;I++){const O=IC[I],{isEnabled:q,Feature:G,ProjectionNode:H,MeasureLayout:ue}=np[O];H&&(C=H),q(u)&&(!this.features[O]&&G&&(this.features[O]=new G(this)),ue&&(a=ue))}if(!this.projection&&C){this.projection=new C(this.latestValues,this.parent&&this.parent.projection);const{layoutId:I,layout:O,drag:q,dragConstraints:G,layoutScroll:H,layoutRoot:ue}=u;this.projection.setOptions({layoutId:I,layout:O,alwaysMeasureLayout:!!q||G&&hu(G),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof O=="string"?O:"both",initialPromotionConfig:b,layoutScroll:H,layoutRoot:ue})}return a}updateFeatures(){for(const o in this.features){const u=this.features[o];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ui()}getStaticValue(o){return this.latestValues[o]}setStaticValue(o,u){this.latestValues[o]=u}makeTargetAnimatable(o,u=!0){return this.makeTargetAnimatableFromInstance(o,this.props,u)}update(o,u){(o.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=o,this.prevPresenceContext=this.presenceContext,this.presenceContext=u;for(let m=0;m<XT.length;m++){const v=XT[m];this.propEventSubscriptions[v]&&(this.propEventSubscriptions[v](),delete this.propEventSubscriptions[v]);const b=o["on"+v];b&&(this.propEventSubscriptions[v]=this.on(v,b))}this.prevMotionValues=zR(this,this.scrapeMotionValuesFromProps(o,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(o){return this.props.variants?this.props.variants[o]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(o=!1){if(o)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const m=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(m.initial=this.props.initial),m}const u={};for(let m=0;m<LR;m++){const v=jv[m],b=this.props[v];(tp(b)||b===!1)&&(u[v]=b)}return u}addVariantChild(o){const u=this.getClosestVariantNode();if(u)return u.variantChildren&&u.variantChildren.add(o),()=>u.variantChildren.delete(o)}addValue(o,u){u!==this.values.get(o)&&(this.removeValue(o),this.bindToMotionValue(o,u)),this.values.set(o,u),this.latestValues[o]=u.get()}removeValue(o){this.values.delete(o);const u=this.valueSubscriptions.get(o);u&&(u(),this.valueSubscriptions.delete(o)),delete this.latestValues[o],this.removeValueFromRenderState(o,this.renderState)}hasValue(o){return this.values.has(o)}getValue(o,u){if(this.props.values&&this.props.values[o])return this.props.values[o];let m=this.values.get(o);return m===void 0&&u!==void 0&&(m=Au(u,{owner:this}),this.addValue(o,m)),m}readValue(o){var u;return this.latestValues[o]!==void 0||!this.current?this.latestValues[o]:(u=this.getBaseTargetFromProps(this.props,o))!==null&&u!==void 0?u:this.readValueFromInstance(this.current,o,this.options)}setBaseTarget(o,u){this.baseTarget[o]=u}getBaseTarget(o){var u;const{initial:m}=this.props,v=typeof m=="string"||typeof m=="object"?(u=Kv(this.props,m))===null||u===void 0?void 0:u[o]:void 0;if(m&&v!==void 0)return v;const b=this.getBaseTargetFromProps(this.props,o);return b!==void 0&&!_r(b)?b:this.initialValues[o]!==void 0&&v===void 0?void 0:this.baseTarget[o]}on(o,u){return this.events[o]||(this.events[o]=new ox),this.events[o].add(u)}notify(o,...u){this.events[o]&&this.events[o].notify(...u)}}class kC extends RR{sortInstanceNodePosition(o,u){return o.compareDocumentPosition(u)&2?1:-1}getBaseTargetFromProps(o,u){return o.style?o.style[u]:void 0}removeValueFromRenderState(o,{vars:u,style:m}){delete u[o],delete m[o]}makeTargetAnimatableFromInstance({transition:o,transitionEnd:u,...m},{transformValues:v},b){let C=eL(m,o||{},this);if(v&&(u&&(u=v(u)),m&&(m=v(m)),C&&(C=v(C))),b){JD(this,m,C);const a=IR(this,m,C,u);u=a.transitionEnd,m=a.target}return{transition:o,transitionEnd:u,...m}}}function BR(t){return window.getComputedStyle(t)}class FR extends kC{readValueFromInstance(o,u){if(Hl.has(u)){const m=tx(u);return m&&m.default||0}else{const m=BR(o),v=(vS(u)?m.getPropertyValue(u):m[u])||0;return typeof v=="string"?v.trim():v}}measureInstanceViewportBox(o,{transformPagePoint:u}){return vC(o,u)}build(o,u,m,v){$v(o,u,m,v.transformTemplate)}scrapeMotionValuesFromProps(o,u){return Hv(o,u)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:o}=this.props;_r(o)&&(this.childSubscription=o.on("change",u=>{this.current&&(this.current.textContent=`${u}`)}))}renderInstance(o,u,m,v){SS(o,u,m,v)}}class OR extends kC{constructor(){super(...arguments),this.isSVGTag=!1}getBaseTargetFromProps(o,u){return o[u]}readValueFromInstance(o,u){if(Hl.has(u)){const m=tx(u);return m&&m.default||0}return u=CS.has(u)?u:Xv(u),o.getAttribute(u)}measureInstanceViewportBox(){return ui()}scrapeMotionValuesFromProps(o,u){return AS(o,u)}build(o,u,m,v){qv(o,u,m,this.isSVGTag,v.transformTemplate)}renderInstance(o,u,m,v){MS(o,u,m,v)}mount(o){this.isSVGTag=Wv(o.tagName),super.mount(o)}}const VR=(t,o)=>Gv(t)?new OR(o,{enableHardwareAcceleration:!1}):new FR(o,{enableHardwareAcceleration:!0}),UR={layout:{ProjectionNode:MC,MeasureLayout:xC}},NR={...fL,...Lz,...yR,...UR},jR=jk((t,o)=>wz(t,o,NR,VR));$m.accessToken="pk.eyJ1IjoidG5nMDM5IiwiYSI6ImNsb2U2MHZwYjBlcnoyanBsa3RhYjJhZmUifQ.Pa7rSqz70fI3lBsKTv4WQQ";const HT=async t=>{const u=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(t)}.json?access_token=${$m.accessToken}`)).json();return u.features&&u.features[0]&&u.features[0].center?{lng:u.features[0].center[0],lat:u.features[0].center[1]}:null},GR=()=>{const t={initial:{strokeDasharray:1e3,strokeDashoffset:1e3},animate:{strokeDashoffset:0},transition:{duration:2}},o=Rt.useRef(null),u=Rt.useRef(null),[m,v]=Rt.useState(-70.9),[b,C]=Rt.useState(42.35),[a,I]=Rt.useState(1),[O,q]=Rt.useState(!1);Rt.useEffect(()=>{u.current||(u.current=new $m.Map({container:o.current,style:"mapbox://styles/tng039/clofkt020004r01ph5qku32fq",center:[10.877137580279825,59.847981573670154],zoom:3}),setTimeout(()=>{G("Norway"),H("Tromsø")},900),setTimeout(()=>{G(" buckhamshire, Beltchley Park"),H(" buckhamshire,  Beltchley Park")},1e3),H("Shibuya"),H("Seoul"),u.current.on("move",()=>{u.current&&(v(parseFloat(u.current.getCenter().lng.toFixed(4))),C(parseFloat(u.current.getCenter().lat.toFixed(4))),I(parseFloat(u.current.getZoom().toFixed(2))))}))},[]);const G=async ue=>{q(!1);const _e=await HT(ue);_e&&u.current&&u.current.flyTo({center:[_e.lng,_e.lat],duration:3e3,curve:1,pitch:20})},H=async ue=>{var Ie;const _e=await HT(ue);if(_e&&u.current){const at=document.createElement("div");at.className="custom-marker",(Ie=new $m.Marker(at).setLngLat([_e.lng,_e.lat]).addTo(u.current).getElement())==null||Ie.addEventListener("click",()=>{G(_e.lng+","+_e.lat),setTimeout(()=>{q(!0)},3e3)})}};return console.log(m,b,a),ys.jsx("div",{ref:o,className:"w-screen h-screen",children:ys.jsx("svg",{className:"absolute z-50 h-screen w-screen pointer-events-none",children:O&&ys.jsx(jR.path,{d:"M 760 360 L 800 290 L 1200 290",stroke:"white",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",...t})})})};function $R(){return ys.jsx(ys.Fragment,{children:ys.jsx("div",{children:ys.jsx(GR,{})})})}Vy.createRoot(document.getElementById("root")).render(ys.jsx(H0.StrictMode,{children:ys.jsx($R,{})}));
